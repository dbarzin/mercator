{"version":3,"file":"bpmn-edit.js","sources":["../../node_modules/@maxgraph/core/lib/esm/view/image/ImageBox.js","../../node_modules/@maxgraph/core/lib/esm/view/event/EventObject.js","../../node_modules/@maxgraph/core/lib/esm/view/event/EventSource.js","../../node_modules/@maxgraph/core/lib/esm/util/Constants.js","../../node_modules/@maxgraph/core/lib/esm/Client.js","../../node_modules/@maxgraph/core/lib/esm/util/EventUtils.js","../../node_modules/@maxgraph/core/lib/esm/util/domUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/event/InternalMouseEvent.js","../../node_modules/@maxgraph/core/lib/esm/view/event/InternalEvent.js","../../node_modules/@maxgraph/core/lib/esm/view/geometry/Point.js","../../node_modules/@maxgraph/core/lib/esm/view/geometry/Rectangle.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellPath.js","../../node_modules/@maxgraph/core/lib/esm/util/logger.js","../../node_modules/@maxgraph/core/lib/esm/internal/clone-utils.js","../../node_modules/@maxgraph/core/lib/esm/i18n/provider.js","../../node_modules/@maxgraph/core/lib/esm/util/config.js","../../node_modules/@maxgraph/core/lib/esm/internal/utils.js","../../node_modules/@maxgraph/core/lib/esm/util/styleUtils.js","../../node_modules/@maxgraph/core/lib/esm/util/StringUtils.js","../../node_modules/@maxgraph/core/lib/esm/util/ObjectIdentity.js","../../node_modules/@maxgraph/core/lib/esm/util/cloneUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/Cell.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/ChildChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/GeometryChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/RootChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/StyleChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/TerminalChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/ValueChange.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellState.js","../../node_modules/@maxgraph/core/lib/esm/util/mathUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/SideToSide.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/TopToBottom.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/Elbow.js","../../node_modules/@maxgraph/core/lib/esm/view/style/config.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/EntityRelation.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/Loop.js","../../node_modules/@maxgraph/core/lib/esm/util/arrayUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/geometry/Geometry.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/shared.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/Segment.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/Orthogonal.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/Manhattan.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/EllipsePerimeter.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/HexagonPerimeter.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/RectanglePerimeter.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/RhombusPerimeter.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/TrianglePerimeter.js","../../node_modules/@maxgraph/core/lib/esm/view/style/marker/edge-markers.js","../../node_modules/@maxgraph/core/lib/esm/internal/BaseRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/style/edge/EdgeStyleRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellHighlight.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellMarker.js","../../node_modules/@maxgraph/core/lib/esm/util/UrlConverter.js","../../node_modules/@maxgraph/core/lib/esm/view/canvas/AbstractCanvas2D.js","../../node_modules/@maxgraph/core/lib/esm/util/xmlUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/canvas/SvgCanvas2D.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/Shape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/EllipseShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/RectangleShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/ImageShape.js","../../node_modules/@maxgraph/core/lib/esm/view/other/ConnectionConstraint.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/ConstraintHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/config.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/EdgeHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/VertexHandler.js","../../node_modules/@maxgraph/core/lib/esm/internal/i18n-utils.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/ElbowEdgeHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/handler/EdgeSegmentHandler.js","../../node_modules/@maxgraph/core/lib/esm/util/cellArrayUtils.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/CellsMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/ConnectionsMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/DragDropMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/EdgeMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/EditingMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/EventsMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/FoldingMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/GroupingMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/ImageMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/LabelMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/OrderMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellOverlay.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/OverlaysMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/edge/PolylineShape.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/PageBreaksMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/PanningMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/PortsMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/SelectionMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/SnapMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/SwimlaneMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/TerminalMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/TooltipMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/ValidationMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/VertexMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/ZoomMixin.js","../../node_modules/@maxgraph/core/lib/esm/view/mixins/_graph-mixins-apply.js","../../node_modules/@maxgraph/core/lib/esm/view/AbstractGraph.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/UndoableEdit.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/CollapseChange.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/VisibleChange.js","../../node_modules/@maxgraph/core/lib/esm/view/GraphDataModel.js","../../node_modules/@maxgraph/core/lib/esm/view/style/marker/EdgeMarkerRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/edge/ConnectorShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/TextShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/ShapeRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/stencil/StencilShapeRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/cell/CellRenderer.js","../../node_modules/@maxgraph/core/lib/esm/view/style/Stylesheet.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/SelectionChange.js","../../node_modules/@maxgraph/core/lib/esm/view/GraphSelectionModel.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/CurrentRootChange.js","../../node_modules/@maxgraph/core/lib/esm/view/style/perimeter/PerimeterRegistry.js","../../node_modules/@maxgraph/core/lib/esm/view/GraphView.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/RhombusShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/CylinderShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/ActorShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/TriangleShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/HexagonShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/CloudShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/edge/LineShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/edge/ArrowShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/edge/ArrowConnectorShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/DoubleEllipseShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/SwimlaneShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/node/LabelShape.js","../../node_modules/@maxgraph/core/lib/esm/view/shape/register-shapes.js","../../node_modules/@maxgraph/core/lib/esm/view/style/register.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/CellEditorHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/TooltipHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/SelectionCellsHandler.js","../../node_modules/@maxgraph/core/lib/esm/gui/MaxPopupMenu.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/PopupMenuHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/ConnectionHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/other/Guide.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/SelectionHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/other/PanningManager.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/PanningHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/FitPlugin.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/RubberBandHandler.js","../../node_modules/@maxgraph/core/lib/esm/view/plugins/index.js","../../node_modules/@maxgraph/core/lib/esm/view/Graph.js","../../node_modules/@maxgraph/core/lib/esm/view/layout/SwimlaneManager.js","../../node_modules/@maxgraph/core/lib/esm/view/undoable_changes/UndoManager.js","../../resources/ts/graph-styles.ts","../../resources/ts/bpmn-edit.ts"],"sourcesContent":["/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Encapsulates the URL, width and height of an image.\n */\nclass ImageBox {\n    constructor(src, width, height) {\n        this.src = src;\n        this.width = width;\n        this.height = height;\n    }\n}\nexport default ImageBox;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * `EventObject` is a wrapper for all properties of a single event.\n *\n * Additionally, it also offers functions to consume the event and check if it was consumed as follows:\n *\n * ```javascript\n * evt.consume();\n * INV: evt.isConsumed() == true\n * ```\n *\n * @category Event\n */\nclass EventObject {\n    /**\n     * Constructs a new event object with the specified name. An optional\n     * sequence of key, value pairs can be appended to define properties.\n     *\n     * Example:\n     *\n     * ```javascript\n     * new EventObject(\"eventName\", key1, val1, .., keyN, valN)\n     * ```\n     *\n     * @param name\n     * @param args\n     */\n    constructor(name = '', ...args) {\n        /**\n         * Holds the consumed state. Default is false.\n         */\n        this.consumed = false;\n        this.name = name;\n        this.properties = {};\n        if (!!args[0] && args[0].constructor === Object) {\n            // A literal object ({})\n            for (const [key, value] of Object.entries(args[0])) {\n                this.properties[key] = value;\n            }\n        }\n        else {\n            // two-values [key, value, key, value, ...]\n            for (let i = 0; i < args.length; i += 2) {\n                if (args[i + 1] !== null) {\n                    this.properties[args[i]] = args[i + 1];\n                }\n            }\n        }\n    }\n    /**\n     * Returns <name>.\n     */\n    getName() {\n        return this.name;\n    }\n    /**\n     * Returns <properties>.\n     */\n    getProperties() {\n        return this.properties;\n    }\n    /**\n     * Returns the property for the given key.\n     */\n    getProperty(key) {\n        return this.properties[key];\n    }\n    /**\n     * Returns true if the event has been consumed.\n     */\n    isConsumed() {\n        return this.consumed;\n    }\n    /**\n     * Consumes the event.\n     */\n    consume() {\n        this.consumed = true;\n    }\n}\nexport default EventObject;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventObject from './EventObject.js';\n/**\n * Base class for objects that dispatch named events.\n *\n * To create a subclass that inherits from `EventSource`, the following code is used:\n *\n * ```javascript\n * class MyClass extends EventSource {\n *   // implement the logic here\n * };\n * ```\n *\n * Known Subclasses:\n * - {@link CellOverlay}\n * - {@link Editor}\n * - {@link AbstractGraph}\n * - {@link GraphDataModel}\n * - {@link GraphView}\n * - {@link MaxToolbar}\n * - {@link MaxWindow}\n *\n * @category Event\n */\nclass EventSource {\n    constructor(eventSource = null) {\n        /**\n         * Holds the event names and associated listeners in an array. The array\n         * contains the event name followed by the respective listener for each\n         * registered listener.\n         */\n        this.eventListeners = [];\n        /**\n         * Specifies if events can be fired. Default is true.\n         */\n        this.eventsEnabled = true;\n        /**\n         * Optional source for events. Default is null.\n         */\n        this.eventSource = null;\n        this.eventSource = eventSource;\n    }\n    /**\n     * Returns <eventsEnabled>.\n     */\n    isEventsEnabled() {\n        return this.eventsEnabled;\n    }\n    /**\n     * Sets <eventsEnabled>.\n     */\n    setEventsEnabled(value) {\n        this.eventsEnabled = value;\n    }\n    /**\n     * Returns <eventSource>.\n     */\n    getEventSource() {\n        return this.eventSource;\n    }\n    /**\n     * Sets <eventSource>.\n     */\n    setEventSource(value) {\n        this.eventSource = value;\n    }\n    /**\n     * Binds the specified function to the given event name. If no event name\n     * is given, then the listener is registered for all events.\n     *\n     * The parameters of the listener are the sender and an {@link EventObject}.\n     */\n    addListener(name, funct) {\n        this.eventListeners.push({ name, funct });\n    }\n    /**\n     * Removes all occurrences of the given listener from <eventListeners>.\n     */\n    removeListener(funct) {\n        let i = 0;\n        while (i < this.eventListeners.length) {\n            if (this.eventListeners[i].funct === funct) {\n                this.eventListeners.splice(i, 1);\n            }\n            else {\n                i += 1;\n            }\n        }\n    }\n    /**\n     * Dispatches the given event to the listeners which are registered for the event.\n     * The sender argument is optional.\n     * The current execution scope (\"this\") is used for the listener invocation.\n     *\n     * Example:\n     *\n     * ```javascript\n     * fireEvent(new EventObject(\"eventName\", key1, val1, .., keyN, valN))\n     * ```\n     *\n     * @param evt {@link EventObject} that represents the event.\n     * @param sender Optional sender to be passed to the listener. Default value is the return value of {@link getEventSource}.\n     */\n    fireEvent(evt, sender = null) {\n        if (this.isEventsEnabled()) {\n            if (!evt) {\n                evt = new EventObject('');\n            }\n            if (!sender) {\n                sender = this.getEventSource();\n            }\n            if (!sender) {\n                sender = this;\n            }\n            for (const eventListener of this.eventListeners) {\n                if (eventListener.name === null || eventListener.name === evt.getName()) {\n                    eventListener.funct.apply(this, [sender, evt]);\n                }\n            }\n        }\n    }\n}\nexport default EventSource;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * The version of the `maxGraph` library.\n */\n// WARN: this constant is updated at release time by the script located at 'scripts/update-versions.mjs'.\n// So, if you modify the name of this file or this constant, please update the script accordingly.\nexport const VERSION = '0.21.0';\n/**\n * Defines the portion of the cell which is to be used as a connectable\n * region. Default is 0.3. Possible values are 0 < x <= 1.\n */\nexport const DEFAULT_HOTSPOT = 0.3;\n/**\n * Defines the minimum size in pixels of the portion of the cell which is\n * to be used as a connectable region. Default is 8.\n */\nexport const MIN_HOTSPOT_SIZE = 8;\n/**\n * Defines the maximum size in pixels of the portion of the cell which is\n * to be used as a connectable region. Use 0 for no maximum. Default is 0.\n */\nexport const MAX_HOTSPOT_SIZE = 0;\n/**\n * Name of the field to be used to store the object ID.\n */\nexport const IDENTITY_FIELD_NAME = 'mxObjectId';\n/**\n * Defines the SVG namespace.\n */\nexport const NS_SVG = 'http://www.w3.org/2000/svg';\n/**\n * Defines the XLink namespace.\n */\nexport const NS_XLINK = 'http://www.w3.org/1999/xlink';\n/** Default value of {@link StyleDefaultsConfig.shadowColor}. */\nexport const SHADOWCOLOR = 'gray';\n/** Default value of {@link StyleDefaultsConfig.shadowOffsetX}. */\nexport const SHADOW_OFFSET_X = 2;\n/** Default value of {@link StyleDefaultsConfig.shadowOffsetY}. */\nexport const SHADOW_OFFSET_Y = 3;\n/** Default value of {@link StyleDefaultsConfig.shadowOpacity}. */\nexport const SHADOW_OPACITY = 1;\n/**\n * Defines the vertical offset for the tooltip.\n * Default is 16.\n */\nexport const TOOLTIP_VERTICAL_OFFSET = 16;\n/**\n * Specifies the default valid color. Default is #0000FF.\n */\nexport const DEFAULT_VALID_COLOR = '#00FF00';\n/**\n * Specifies the default invalid color. Default is #FF0000.\n */\nexport const DEFAULT_INVALID_COLOR = '#FF0000';\n/**\n * Specifies the default highlight color for shape outlines.\n * Default is #0000FF. This is used in {@link ConnectionHandler} and {@link EdgeHandler}.\n */\nexport const OUTLINE_HIGHLIGHT_COLOR = '#00FF00';\n/**\n * Defines the strokewidth to be used for shape outlines.\n * Default is 5. This is used in {@link ConnectionHandler} and {@link EdgeHandler}.\n */\nexport const OUTLINE_HIGHLIGHT_STROKEWIDTH = 5;\n/**\n * Defines the strokewidth to be used for the highlights.\n * Default is 3.\n */\nexport const HIGHLIGHT_STROKEWIDTH = 3;\n/**\n * Size of the constraint highlight (in px). Default is 2.\n */\nexport const HIGHLIGHT_SIZE = 2;\n/**\n * Opacity (in %) used for the highlights (including outline).\n * Default is 100.\n */\nexport const HIGHLIGHT_OPACITY = 100;\n/**\n * Defines the color to be used for the cell highlighting.\n * Use 'none' for no color. Default is #00FF00.\n */\n// TODO this constants is unused (it wasn't used in mxGraph as well)--> remove it (and all documentation references as well)\nexport const HIGHLIGHT_COLOR = '#00FF00';\n/**\n * Defines the color to be used for highlighting a target cell for a new\n * or changed connection. Note that this may be either a source or\n * target terminal in the graph. Use 'none' for no color.\n * Default is #0000FF.\n */\n// TODO this constants is unused (it wasn't used in mxGraph as well)--> remove it (and all documentation references as well)\nexport const CONNECT_TARGET_COLOR = '#0000FF';\n/**\n * Defines the color to be used for highlighting an invalid target cells\n * for a new or changed connections. Note that this may be either a source\n * or target terminal in the graph. Use 'none' for no color. Default is\n * #FF0000.\n */\nexport const INVALID_CONNECT_TARGET_COLOR = '#FF0000';\n/**\n * Defines the color to be used for the highlighting target parent cells\n * (for drag and drop). Use 'none' for no color. Default is #0000FF.\n */\nexport const DROP_TARGET_COLOR = '#0000FF';\n/**\n * Defines the color to be used for the coloring valid connection\n * previews. Use 'none' for no color. Default is #FF0000.\n */\nexport const VALID_COLOR = '#00FF00';\n/**\n * Defines the color to be used for the coloring invalid connection\n * previews. Use 'none' for no color. Default is #FF0000.\n */\nexport const INVALID_COLOR = '#FF0000';\n/**\n * Default value ('green' color) of {@link EdgeHandlerConfig.selectionColor}.\n */\nexport const EDGE_SELECTION_COLOR = '#00FF00';\n/**\n * Default value ('green' color) of {@link VertexHandlerConfig.selectionColor}.\n */\nexport const VERTEX_SELECTION_COLOR = '#00FF00';\n/**\n * Default value of {@link VertexHandlerConfig.selectionStrokeWidth}.\n */\nexport const VERTEX_SELECTION_STROKEWIDTH = 1;\n/**\n * Default value of {@link EdgeHandlerConfig.selectionStrokeWidth}.\n */\nexport const EDGE_SELECTION_STROKEWIDTH = 1;\n/**\n * Default value of {@link VertexHandlerConfig.selectionDashed}.\n */\nexport const VERTEX_SELECTION_DASHED = true;\n/**\n * Default value of {@link EdgeHandlerConfig.selectionDashed}.\n */\nexport const EDGE_SELECTION_DASHED = true;\n/**\n * Defines the color to be used for the guidelines in `Guide`.\n * @default #FF0000.\n */\nexport const GUIDE_COLOR = '#FF0000';\n/**\n * Defines the strokewidth to be used for the guidelines in `Guide`.\n * @default 1.\n */\nexport const GUIDE_STROKEWIDTH = 1;\n/**\n * Defines the color to be used for the outline rectangle\n * border.  Use 'none' for no color. Default is #0099FF.\n */\nexport const OUTLINE_COLOR = '#0099FF';\n/**\n * Defines the strokewidth to be used for the outline rectangle\n * stroke width. Default is 3.\n */\nexport const OUTLINE_STROKEWIDTH = 3;\n/**\n * Default value of {@link HandleConfig.size}.\n */\nexport const HANDLE_SIZE = 6;\n/**\n * Default value of {@link HandleConfig.labelSize}.\n */\nexport const LABEL_HANDLE_SIZE = 4;\n/**\n * Default value ('green' color) of {@link HandleConfig.fillColor}.\n */\nexport const HANDLE_FILLCOLOR = '#00FF00';\n/**\n * Default value of {@link HandleConfig.strokeColor}.\n */\nexport const HANDLE_STROKECOLOR = 'black';\n/**\n * Default value of {@link HandleConfig.labelFillColor}.\n */\nexport const LABEL_HANDLE_FILLCOLOR = 'yellow';\n/**\n * Default value ('blue' color) of {@link EdgeHandlerConfig.connectFillColor}.\n */\nexport const CONNECT_HANDLE_FILLCOLOR = '#0000FF';\n/**\n * Defines the color to be used for the locked handle fill color. Use\n * 'none' for no color. Default is #FF0000 (red).\n */\nexport const LOCKED_HANDLE_FILLCOLOR = '#FF0000';\n/**\n * Defines the color to be used for the outline sizer fill color. Use\n * 'none' for no color. Default is #00FFFF.\n */\nexport const OUTLINE_HANDLE_FILLCOLOR = '#00FFFF';\n/**\n * Defines the color to be used for the outline sizer stroke color. Use\n * 'none' for no color. Default is #0033FF.\n */\nexport const OUTLINE_HANDLE_STROKECOLOR = '#0033FF';\n/**\n * Defines the default family for all fonts. Default is Arial,Helvetica.\n */\nexport const DEFAULT_FONTFAMILY = 'Arial,Helvetica';\n/**\n * Defines the default size (in px). Default is 11.\n */\nexport const DEFAULT_FONTSIZE = 11;\n/**\n * Defines the default value for the <STYLE_TEXT_DIRECTION> if no value is\n * defined for it in the style. Default value is an empty string which means\n * the default system setting is used and no direction is set.\n */\nexport const DEFAULT_TEXT_DIRECTION = '';\n/**\n * Defines the default line height for text labels. Default is 1.2.\n */\nexport const LINE_HEIGHT = 1.2;\n/**\n * Defines the CSS value for the word-wrap property. Default is \"normal\".\n * Change this to \"break-word\" to allow long words to be able to be broken\n * and wrap onto the next line.\n */\nexport const WORD_WRAP = 'normal';\n/**\n * Specifies if absolute line heights should be used (px) in CSS. Default\n * is false. Set this to true for backwards compatibility.\n */\nexport const ABSOLUTE_LINE_HEIGHT = false;\n/**\n * Defines the default style for all fonts. Default is 0. This can be set\n * to any combination of font styles as follows.\n *\n * ```javascript\n * mxConstants.DEFAULT_FONTSTYLE = mxConstants.FONT_BOLD | mxConstants.FONT_ITALIC;\n * ```\n */\nexport const DEFAULT_FONTSTYLE = 0;\n/**\n * Defines the default start size for swimlanes. Default is 40.\n */\nexport const DEFAULT_STARTSIZE = 40;\n/**\n * Defines the default size for all markers. Default is 6.\n */\nexport const DEFAULT_MARKERSIZE = 6;\n/**\n * Defines the default width and height for images used in the\n * label shape. Default is 24.\n */\nexport const DEFAULT_IMAGESIZE = 24;\n/**\n * Default value of {@link EntityRelationConnectorConfig.segment}.\n */\nexport const ENTITY_SEGMENT = 30;\n/**\n * Defines the default rounding factor for the rounded vertices in percent between `0` and `1`.\n * Values should be smaller than `0.5`.\n * See {@link CellStateStyle.arcSize}.\n */\nexport const RECTANGLE_ROUNDING_FACTOR = 0.15;\n/**\n * Defines the default size in pixels of the arcs for the rounded edges and vertices.\n * See {@link CellStateStyle.arcSize}.\n */\nexport const LINE_ARCSIZE = 20;\n/**\n * Defines the spacing between the arrow shape and its terminals. Default is 0.\n */\nexport const ARROW_SPACING = 0;\n/**\n * Defines the width of the arrow shape. Default is 30.\n */\nexport const ARROW_WIDTH = 30;\n/**\n * Defines the size of the arrowhead in the arrow shape. Default is 30.\n */\nexport const ARROW_SIZE = 30;\n/**\n * Defines the rectangle for the A4 portrait page format.\n * The dimensions of this page format are 827x1169 pixels.\n */\nexport const PAGE_FORMAT_A4_PORTRAIT = [0, 0, 827, 1169];\n/**\n * Defines the rectangle for the A4 landscape page format.\n * The dimensions of this page format are 1169x827 pixels.\n */\nexport const PAGE_FORMAT_A4_LANDSCAPE = [0, 0, 1169, 827];\n/**\n * Defines the rectangle for the Letter portrait page format.\n * The dimensions of this page format are 850x1100 pixels.\n */\n// It may not be used in @maxGraph/core for now, but helpful for users. So don't remove it.\nexport const PAGE_FORMAT_LETTER_PORTRAIT = [0, 0, 850, 1100];\n/**\n * Defines the rectangle for the Letter landscape page format.\n * The dimensions of this page format are 1100x850 pixels.\n */\n// It may not be used in @maxGraph/core for now, but helpful for users. So don't remove it.\nexport const PAGE_FORMAT_LETTER_LANDSCAPE = [0, 0, 1100, 850];\n/**\n * Defines the value for none. Default is \"none\".\n */\nexport const NONE = 'none';\nexport const FONT_STYLE_MASK = {\n    /** for bold fonts. */\n    BOLD: 1,\n    /** for italic fonts. */\n    ITALIC: 2,\n    /** for underlined fonts. */\n    UNDERLINE: 4,\n    /** for strikethrough fonts. */\n    STRIKETHROUGH: 8,\n};\n/**\n * Bitwise mask for all directions.\n */\nexport const DIRECTION_MASK = {\n    /** No direction. */\n    NONE: 0,\n    WEST: 1,\n    NORTH: 2,\n    SOUTH: 4,\n    EAST: 8,\n    /** All directions. */\n    ALL: 15,\n};\n/**\n * The values of {@link Node.nodeType}\n */\nexport const NODE_TYPE = {\n    ELEMENT: 1,\n    ATTRIBUTE: 2,\n    TEXT: 3,\n    CDATA: 4,\n    ENTITY_REFERENCE: 5,\n    ENTITY: 6,\n    PROCESSING_INSTRUCTION: 7,\n    COMMENT: 8,\n    DOCUMENT: 9,\n    DOCUMENT_TYPE: 10,\n    DOCUMENT_FRAGMENT: 11,\n    NOTATION: 12,\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2017, JGraph Ltd\nCopyright (c) 2006-2017, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NS_SVG } from './util/Constants.js';\n/**\n * @category Configuration\n */\nclass Client {\n}\n/**\n * Base path for all URLs in the core without trailing slash.\n *\n * When using a relative path, the path is relative to the URL of the page that contains the assignment. Trailing slashes are automatically removed.\n * @default '.'\n */\nClient.basePath = '.';\nClient.setBasePath = (value) => {\n    if (typeof value !== 'undefined' && value.length > 0) {\n        // Adds a trailing slash if required\n        if (value.substring(value.length - 1) === '/') {\n            value = value.substring(0, value.length - 1);\n        }\n        Client.basePath = value;\n    }\n    else {\n        Client.basePath = '.';\n    }\n};\n/**\n * Base path for all images URLs in the core without trailing slash.\n *\n * When using a relative path, the path is relative to the URL of the page that\n * contains the assignment. Trailing slashes are automatically removed.\n * @default '.'\n */\nClient.imageBasePath = '.';\nClient.setImageBasePath = (value) => {\n    if (typeof value !== 'undefined' && value.length > 0) {\n        // Adds a trailing slash if required\n        if (value.substring(value.length - 1) === '/') {\n            value = value.substring(0, value.length - 1);\n        }\n        Client.imageBasePath = value;\n    }\n    else {\n        Client.imageBasePath = `${Client.basePath}/images`;\n    }\n};\n/**\n * True if the current browser is Microsoft Edge.\n */\nClient.IS_EDGE = typeof window !== 'undefined' &&\n    navigator.userAgent != null &&\n    !!navigator.userAgent.match(/Edge\\//);\n/**\n * True if the current browser is Netscape (including Firefox).\n */\nClient.IS_NS = typeof window !== 'undefined' &&\n    navigator.userAgent != null &&\n    navigator.userAgent.indexOf('Mozilla/') >= 0 &&\n    navigator.userAgent.indexOf('MSIE') < 0 &&\n    navigator.userAgent.indexOf('Edge/') < 0;\n/**\n * True if the current browser is Safari.\n */\nClient.IS_SF = typeof window !== 'undefined' && /Apple Computer, Inc/.test(navigator.vendor);\n/**\n * Returns true if the user agent contains Android.\n */\nClient.IS_ANDROID = typeof window !== 'undefined' && navigator.appVersion.indexOf('Android') >= 0;\n/**\n * Returns true if the user agent is an iPad, iPhone or iPod.\n */\nClient.IS_IOS = typeof window !== 'undefined' && /iP(hone|od|ad)/.test(navigator.platform);\n/**\n * True if the current browser is Google Chrome.\n */\nClient.IS_GC = typeof window !== 'undefined' && /Google Inc/.test(navigator.vendor);\n/**\n * True if the this is running inside a Chrome App.\n */\nClient.IS_CHROMEAPP = typeof window !== 'undefined' &&\n    // @ts-ignore\n    window.chrome != null &&\n    // @ts-ignore\n    chrome.app != null &&\n    // @ts-ignore\n    chrome.app.runtime != null;\n/**\n * True if the current browser is Firefox.\n */\nClient.IS_FF = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n/**\n * True if -moz-transform is available as a CSS style. This is the case\n * for all Firefox-based browsers newer than or equal 3, such as Camino,\n * Iceweasel, Seamonkey and Iceape.\n */\nClient.IS_MT = typeof window !== 'undefined' &&\n    ((navigator.userAgent.indexOf('Firefox/') >= 0 &&\n        navigator.userAgent.indexOf('Firefox/1.') < 0 &&\n        navigator.userAgent.indexOf('Firefox/2.') < 0) ||\n        (navigator.userAgent.indexOf('Iceweasel/') >= 0 &&\n            navigator.userAgent.indexOf('Iceweasel/1.') < 0 &&\n            navigator.userAgent.indexOf('Iceweasel/2.') < 0) ||\n        (navigator.userAgent.indexOf('SeaMonkey/') >= 0 &&\n            navigator.userAgent.indexOf('SeaMonkey/1.') < 0) ||\n        (navigator.userAgent.indexOf('Iceape/') >= 0 &&\n            navigator.userAgent.indexOf('Iceape/1.') < 0));\n/**\n * True if the browser supports SVG.\n */\nClient.IS_SVG = typeof window !== 'undefined' &&\n    navigator.appName.toUpperCase() !== 'MICROSOFT INTERNET EXPLORER';\n/**\n * True if foreignObject support is not available. This is the case for\n * Opera, older SVG-based browsers and all versions of IE.\n */\nClient.NO_FO = typeof window !== 'undefined' &&\n    (!document.createElementNS ||\n        document.createElementNS(NS_SVG, 'foreignObject').toString() !==\n            '[object SVGForeignObjectElement]' ||\n        navigator.userAgent.indexOf('Opera/') >= 0);\n/**\n * True if the client is a Windows.\n */\nClient.IS_WIN = typeof window !== 'undefined' && navigator.appVersion.indexOf('Win') > 0;\n/**\n * True if the client is a Mac.\n */\nClient.IS_MAC = typeof window !== 'undefined' && navigator.appVersion.indexOf('Mac') > 0;\n/**\n * True if the client is a Chrome OS.\n */\nClient.IS_CHROMEOS = typeof window !== 'undefined' && /\\bCrOS\\b/.test(navigator.appVersion);\n/**\n * True if this device supports touchstart/-move/-end events (Apple iOS,\n * Android, Chromebook and Chrome Browser on touch-enabled devices).\n */\nClient.IS_TOUCH = typeof window !== 'undefined' && 'ontouchstart' in document.documentElement;\n/**\n * True if this device supports Microsoft pointer events (always false on Macs).\n */\nClient.IS_POINTER = typeof window !== 'undefined' &&\n    window.PointerEvent != null &&\n    !(navigator.appVersion.indexOf('Mac') > 0);\n/**\n * True if the documents location does not start with http:// or https://.\n */\nClient.IS_LOCAL = typeof window !== 'undefined' &&\n    document.location.href.indexOf('http://') < 0 &&\n    document.location.href.indexOf('https://') < 0;\nexport default Client;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Client from '../Client.js';\n/**\n * Returns the touch or mouse event that contains the mouse coordinates.\n */\nexport const getMainEvent = (evt) => {\n    let t = evt;\n    if ((t.type === 'touchstart' || t.type === 'touchmove') && t.touches && t.touches[0]) {\n        t = t.touches[0];\n    }\n    else if (t.type === 'touchend' && t.changedTouches && t.changedTouches[0]) {\n        t = t.changedTouches[0];\n    }\n    return t;\n};\n/**\n * Returns true if the meta key is pressed for the given event.\n */\nexport const getClientX = (evt) => {\n    return getMainEvent(evt).clientX;\n};\n/**\n * Returns true if the meta key is pressed for the given event.\n */\nexport const getClientY = (evt) => {\n    return getMainEvent(evt).clientY;\n};\n/**\n * Returns the event's target or srcElement depending on the browser.\n */\nexport const getSource = (evt) => {\n    return evt.target;\n};\n/**\n * Returns true if the event has been consumed using {@link consume}.\n */\nexport const isConsumed = (evt) => {\n    const t = evt;\n    return t.isConsumed !== undefined && t.isConsumed;\n};\n/**\n * Returns true if the event was generated using a touch device (not a pen or mouse).\n */\nexport const isTouchEvent = (evt) => {\n    const t = evt;\n    return t.pointerType\n        ? t.pointerType === 'touch' || t.pointerType === t.MSPOINTER_TYPE_TOUCH\n        : t.mozInputSource !== undefined\n            ? t.mozInputSource === 5\n            : t.type.indexOf('touch') === 0;\n};\n/**\n * Returns true if the event was generated using a pen (not a touch device or mouse).\n */\nexport const isPenEvent = (evt) => {\n    const t = evt;\n    return t.pointerType\n        ? t.pointerType == 'pen' || t.pointerType === t.MSPOINTER_TYPE_PEN\n        : t.mozInputSource !== undefined\n            ? t.mozInputSource === 2\n            : t.type.indexOf('pen') === 0;\n};\n/**\n * Returns true if the event was generated using a touch device (not a pen or mouse).\n */\nexport const isMultiTouchEvent = (evt) => {\n    const t = evt;\n    return (t.type &&\n        t.type.indexOf('touch') == 0 &&\n        t.touches !== undefined &&\n        t.touches.length > 1);\n};\n/**\n * Returns true if the event was generated using a mouse (not a pen or touch device).\n */\nexport const isMouseEvent = (evt) => {\n    const t = evt;\n    return t.pointerType\n        ? t.pointerType == 'mouse' || t.pointerType === t.MSPOINTER_TYPE_MOUSE\n        : t.mozInputSource !== undefined\n            ? t.mozInputSource === 1\n            : t.type.indexOf('mouse') === 0;\n};\n/**\n * Returns true if the left mouse button is pressed for the given event.\n * To check if a button is pressed during a mouseMove you should use the\n * {@link AbstractGraph.isMouseDown} property. Note that this returns true in Firefox\n * for control+left-click on the Mac.\n */\nexport const isLeftMouseButton = (evt) => {\n    // Special case for mousemove and mousedown we check the buttons\n    // if it exists because which is 0 even if no button is pressed\n    if ('buttons' in evt && (evt.type === 'mousedown' || evt.type === 'mousemove')) {\n        return evt.buttons === 1;\n    }\n    if (evt.which !== undefined) {\n        return evt.which === 1;\n    }\n    return evt.button === 1;\n};\n/**\n * Returns true if the middle mouse button is pressed for the given event.\n * To check if a button is pressed during a mouseMove you should use the\n * {@link AbstractGraph.isMouseDown} property.\n */\nexport const isMiddleMouseButton = (evt) => {\n    return evt.button === 4;\n};\n/**\n * Returns true if the right mouse button was pressed. Note that this\n * button might not be available on some systems. For handling a popup\n * trigger {@link isPopupTrigger} should be used.\n */\nexport const isRightMouseButton = (evt) => {\n    return evt.button === 2;\n};\n/**\n * Returns true if the event is a popup trigger. This implementation\n * returns true if the right button or the left button and control was\n * pressed on a Mac.\n */\nexport const isPopupTrigger = (evt) => {\n    return (isRightMouseButton(evt) ||\n        (Client.IS_MAC &&\n            isControlDown(evt) &&\n            !isShiftDown(evt) &&\n            !isMetaDown(evt) &&\n            !isAltDown(evt)));\n};\n/**\n * Returns true if the shift key is pressed for the given event.\n */\nexport const isShiftDown = (evt) => {\n    return evt.shiftKey;\n};\n/**\n * Returns true if the alt key is pressed for the given event.\n */\nexport const isAltDown = (evt) => {\n    return evt.altKey;\n};\n/**\n * Returns true if the control key is pressed for the given event.\n */\nexport const isControlDown = (evt) => {\n    return evt.ctrlKey;\n};\n/**\n * Returns true if the meta key is pressed for the given event.\n */\nexport const isMetaDown = (evt) => {\n    return evt.metaKey;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NODE_TYPE } from './Constants.js';\n/**\n * Returns the text content of the specified node.\n *\n * @param elems DOM nodes to return the text for.\n */\nexport const extractTextWithWhitespace = (elems) => {\n    // Known block elements for handling linefeeds (list is not complete)\n    const blocks = [\n        'BLOCKQUOTE',\n        'DIV',\n        'H1',\n        'H2',\n        'H3',\n        'H4',\n        'H5',\n        'H6',\n        'OL',\n        'P',\n        'PRE',\n        'TABLE',\n        'UL',\n    ];\n    const ret = [];\n    function doExtract(elts) {\n        // Single break should be ignored\n        if (elts.length == 1 && (elts[0].nodeName == 'BR' || elts[0].innerHTML == '\\n')) {\n            return;\n        }\n        for (let i = 0; i < elts.length; i += 1) {\n            const elem = elts[i];\n            // DIV with a br or linefeed forces a linefeed\n            if (elem.nodeName == 'BR' ||\n                elem.innerHTML == '\\n' ||\n                ((elts.length == 1 || i == 0) &&\n                    elem.nodeName == 'DIV' &&\n                    elem.innerHTML.toLowerCase() == '<br>')) {\n                ret.push('\\n');\n            }\n            else {\n                if (elem.nodeType === 3 || elem.nodeType === 4) {\n                    if (elem.nodeValue && elem.nodeValue.length > 0) {\n                        ret.push(elem.nodeValue);\n                    }\n                }\n                else if (elem.nodeType !== 8 && elem.childNodes.length > 0) {\n                    doExtract(Array.from(elem.childNodes));\n                }\n                if (i < elts.length - 1 && blocks.indexOf(elts[i + 1].nodeName) >= 0) {\n                    ret.push('\\n');\n                }\n            }\n        }\n    }\n    doExtract(elems);\n    return ret.join('');\n};\n/**\n * Returns the text content of the specified node.\n *\n * @param node DOM node to return the text content for.\n */\nexport const getTextContent = (node) => {\n    return node?.textContent ?? '';\n};\n/**\n * Sets the text content of the specified node.\n *\n * @param node DOM node to set the text content for.\n * @param text String that represents the text content.\n */\nexport const setTextContent = (node, text) => {\n    if ('innerText' in node) {\n        node.innerText = text;\n    }\n    else {\n        node.textContent = text;\n    }\n};\n/**\n * Returns the inner HTML for the given node as a string or an empty string\n * if no node was specified. The inner HTML is the text representing all\n * children of the node, but not the node itself.\n *\n * @param node DOM node to return the inner HTML for.\n */\nexport const getInnerHtml = (node) => {\n    if (node != null) {\n        const serializer = new XMLSerializer();\n        return serializer.serializeToString(node);\n    }\n    return '';\n};\n/**\n * Returns the outer HTML for the given node as a string or an empty\n * string if no node was specified. The outer HTML is the text representing\n * all children of the node including the node itself.\n *\n * @param node DOM node to return the outer HTML for.\n */\nexport const getOuterHtml = (node) => {\n    if (node != null) {\n        const serializer = new XMLSerializer();\n        return serializer.serializeToString(node);\n    }\n    return '';\n};\n/**\n * Creates a text node for the given string and appends it to the given\n * parent. Returns the text node.\n *\n * @param parent DOM node to append the text node to.\n * @param text String representing the text to be added.\n */\nexport const write = (parent, text) => {\n    const doc = parent.ownerDocument;\n    const node = doc.createTextNode(text);\n    if (parent != null) {\n        parent.appendChild(node);\n    }\n    return node;\n};\n/**\n * Creates a text node for the given string and appends it to the given\n * parent with an additional linefeed. Returns the text node.\n *\n * @param parent DOM node to append the text node to.\n * @param text String representing the text to be added.\n */\nexport const writeln = (parent, text) => {\n    const doc = parent.ownerDocument;\n    const node = doc.createTextNode(text);\n    if (parent != null) {\n        parent.appendChild(node);\n        parent.appendChild(document.createElement('br'));\n    }\n    return node;\n};\n/**\n * Appends a linebreak to the given parent and returns the linebreak.\n *\n * @param parent DOM node to append the linebreak to.\n */\nexport const br = (parent, count = 1) => {\n    let br = null;\n    for (let i = 0; i < count; i += 1) {\n        if (parent != null) {\n            br = parent.ownerDocument.createElement('br');\n            parent.appendChild(br);\n        }\n    }\n    return br;\n};\n/**\n * Appends a new paragraph with the given text to the specified parent and\n * returns the paragraph.\n *\n * @param parent DOM node to append the text node to.\n * @param text String representing the text for the new paragraph.\n */\nexport const para = (parent, text) => {\n    const p = document.createElement('p');\n    write(p, text);\n    if (parent != null) {\n        parent.appendChild(p);\n    }\n    return p;\n};\n/**\n * Returns true if the given value is an XML node with the node name\n * and if the optional attribute has the specified value.\n *\n * This implementation assumes that the given value is a DOM node if the\n * nodeType property is numeric, that is, if isNaN returns false for\n * value.nodeType.\n *\n * @param value Object that should be examined as a node.\n * @param nodeName String that specifies the node name.\n * @param attributeName Optional attribute name to check.\n * @param attributeValue Optional attribute value to check.\n */\nexport const isNode = (value, nodeName = null, attributeName, attributeValue) => {\n    if (value != null &&\n        !isNaN(value.nodeType) &&\n        (nodeName == null || value.nodeName.toLowerCase() == nodeName.toLowerCase())) {\n        return attributeName == null || value.getAttribute(attributeName) == attributeValue;\n    }\n    return false;\n};\n/**\n * Returns true if the given ancestor is an ancestor of the\n * given DOM node in the DOM. This also returns true if the\n * child is the ancestor.\n *\n * @param ancestor DOM node that represents the ancestor.\n * @param child DOM node that represents the child.\n */\nexport const isAncestorNode = (ancestor, child) => {\n    let parent = child;\n    while (parent != null) {\n        if (parent === ancestor) {\n            return true;\n        }\n        parent = parent.parentNode;\n    }\n    return false;\n};\n/**\n * Returns an array of child nodes that are of the given node type.\n *\n * @param node Parent DOM node to return the children from.\n * @param nodeType Optional node type to return. Default is {@link NODE_TYPE.ELEMENT}.\n */\nexport const getChildNodes = (node, nodeType = NODE_TYPE.ELEMENT) => {\n    const children = [];\n    let tmp = node.firstChild;\n    while (tmp != null) {\n        if (tmp.nodeType === nodeType) {\n            children.push(tmp);\n        }\n        tmp = tmp.nextSibling;\n    }\n    return children;\n};\n/**\n * Cross browser implementation for document.importNode. Uses {@link Document.importNode}\n * in all browsers but IE, where the node is cloned by creating a new node and\n * copying all attributes and children into it using importNode, recursively.\n *\n * @param doc Document to import the node into.\n * @param node Node to be imported.\n * @param allChildren If all children should be imported.\n */\nexport const importNode = (doc, node, allChildren) => {\n    return doc.importNode(node, allChildren);\n};\n/**\n * Clears the current selection in the page.\n */\nexport const clearSelection = () => {\n    // @ts-ignore\n    const sel = window.getSelection ? window.getSelection() : document.selection;\n    if (sel) {\n        if (sel.removeAllRanges) {\n            sel.removeAllRanges();\n        }\n        else if (sel.empty) {\n            sel.empty();\n        }\n    }\n};\n/**\n * Creates and returns an image (IMG node) or VML image (v:image) in IE6 in\n * quirks mode.\n *\n * @param src URL that points to the image to be displayed.\n */\nexport const createImage = (src) => {\n    let imageNode = null;\n    imageNode = document.createElement('img');\n    imageNode.setAttribute('src', src);\n    imageNode.setAttribute('border', '0');\n    return imageNode;\n};\n/**\n * Adds a link node to the head of the document.\n *\n * The charset is hardcoded to `UTF-8` and the type is `text/css`.\n *\n * @param rel String that represents the rel attribute of the link node.\n * @param href String that represents the href attribute of the link node.\n * @param doc Optional parent document of the link node.\n * @param id unique id for the link element to check if it already exists\n */\nexport const addLinkToHead = (rel, href, doc = null, id = null) => {\n    doc = doc || document;\n    // Workaround for Operation Aborted in IE6 if base tag is used in head\n    const link = doc.createElement('link');\n    link.setAttribute('rel', rel);\n    link.setAttribute('href', href);\n    link.setAttribute('charset', 'UTF-8');\n    link.setAttribute('type', 'text/css');\n    if (id) {\n        link.setAttribute('id', id);\n    }\n    const head = doc.getElementsByTagName('head')[0];\n    head.appendChild(link);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { getClientX, getClientY, getSource, isMouseEvent, isPopupTrigger, } from '../../util/EventUtils.js';\nimport { isAncestorNode } from '../../util/domUtils.js';\n/**\n * Base class for all mouse events in mxGraph. A listener for this event should\n * implement the following methods:\n *\n * ```javascript\n * graph.addMouseListener({\n *   mouseDown: (sender, evt) => {\n *     GlobalConfig.logger.debug('mouseDown');\n *   },\n *   mouseMove: (sender, evt) => {\n *     GlobalConfig.logger.debug('mouseMove');\n *   },\n *   mouseUp: (sender, evt) => {\n *     GlobalConfig.logger.debug('mouseUp');\n *   }\n * });\n * ```\n *\n * @category Event\n */\nclass InternalMouseEvent {\n    /**\n     * Constructs a new event object for the given arguments.\n     *\n     * @param evt Native mouse event.\n     * @param state Optional {@link CellState} under the mouse.\n     */\n    constructor(evt, state = null) {\n        /**\n         * Holds the consumed state of this event.\n         */\n        this.consumed = false;\n        this.evt = evt;\n        this.state = state;\n        this.sourceState = state;\n        // graphX and graphY are updated right after this constructor is executed,\n        // so let them default to 0 and make them not nullable.\n        this.graphX = 0;\n        this.graphY = 0;\n    }\n    /**\n     * Returns <evt>.\n     */\n    getEvent() {\n        return this.evt;\n    }\n    /**\n     * Returns the target DOM element using {@link Event#getSource} for <evt>.\n     */\n    getSource() {\n        return getSource(this.evt);\n    }\n    /**\n     * Returns true if the given {@link Shape} is the source of <evt>.\n     */\n    isSource(shape) {\n        return shape ? isAncestorNode(shape.node, this.getSource()) : false;\n    }\n    /**\n     * Returns <evt.clientX>.\n     */\n    getX() {\n        return getClientX(this.getEvent());\n    }\n    /**\n     * Returns <evt.clientY>.\n     */\n    getY() {\n        return getClientY(this.getEvent());\n    }\n    /**\n     * Returns <graphX>.\n     */\n    getGraphX() {\n        return this.graphX;\n    }\n    /**\n     * Returns <graphY>.\n     */\n    getGraphY() {\n        return this.graphY;\n    }\n    /**\n     * Returns <state>.\n     */\n    getState() {\n        return this.state;\n    }\n    /**\n     * Returns the <Cell> in <state> is not null.\n     */\n    getCell() {\n        const state = this.getState();\n        return state ? state.cell : null;\n    }\n    /**\n     * Returns true if the event is a popup trigger.\n     */\n    isPopupTrigger() {\n        return isPopupTrigger(this.getEvent());\n    }\n    /**\n     * Returns <consumed>.\n     */\n    isConsumed() {\n        return this.consumed;\n    }\n    /**\n     * Sets <consumed> to true and invokes preventDefault on the native event\n     * if such a method is defined. This is used mainly to avoid the cursor from\n     * being changed to a text cursor in Webkit. You can use the preventDefault\n     * flag to disable this functionality.\n     *\n     * @param preventDefault Specifies if the native event should be canceled. Default\n     * is true.\n     */\n    consume(preventDefault) {\n        preventDefault = preventDefault\n            ? preventDefault\n            : (window.TouchEvent && this.evt instanceof TouchEvent) || isMouseEvent(this.evt);\n        if (preventDefault && this.evt.preventDefault) {\n            this.evt.preventDefault();\n        }\n        // Sets local consumed state\n        this.consumed = true;\n    }\n}\nexport default InternalMouseEvent;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport InternalMouseEvent from './InternalMouseEvent.js';\nimport Client from '../../Client.js';\nimport { isConsumed, isMouseEvent } from '../../util/EventUtils.js';\n// Checks if passive event listeners are supported\n// see https://github.com/Modernizr/Modernizr/issues/1894\nlet supportsPassive = false;\ntry {\n    document.addEventListener('test', () => {\n        return;\n    }, Object.defineProperty &&\n        Object.defineProperty({}, 'passive', {\n            get: () => {\n                supportsPassive = true;\n            },\n        }));\n}\ncatch (e) {\n    // ignore\n}\n/**\n * @class InternalEvent\n *\n * Cross-browser DOM event support. For internal event handling,\n * {@link EventSource} and the graph event dispatch loop in {@link AbstractGraph} are used.\n *\n * ### Memory Leaks:\n *\n * Use this class for adding and removing listeners to/from DOM nodes. The\n * {@link removeAllListeners} function is provided to remove all listeners that\n * have been added using {@link addListener}. The function should be invoked when\n * the last reference is removed in the JavaScript code, typically when the\n * referenced DOM node is removed from the DOM.\n *\n * @category Event\n */\nclass InternalEvent {\n    /**\n     * Binds the function to the specified event on the given element.\n     */\n    static addListener(element, eventName, funct) {\n        element.addEventListener(eventName, funct, supportsPassive ? { passive: false } : false);\n        if (!element.mxListenerList) {\n            element.mxListenerList = [];\n        }\n        const entry = { name: eventName, f: funct };\n        element.mxListenerList.push(entry);\n    }\n    /**\n     * Removes the specified listener from the given element.\n     */\n    static removeListener(element, eventName, funct) {\n        element.removeEventListener(eventName, funct, false);\n        if (element.mxListenerList) {\n            const listenerCount = element.mxListenerList.length;\n            for (let i = 0; i < listenerCount; i += 1) {\n                const entry = element.mxListenerList[i];\n                if (entry.f === funct) {\n                    element.mxListenerList.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    }\n    /**\n     * Removes all listeners from the given element.\n     */\n    static removeAllListeners(element) {\n        const list = element.mxListenerList;\n        if (list) {\n            while (list.length > 0) {\n                const entry = list[0];\n                InternalEvent.removeListener(element, entry.name, entry.f);\n            }\n        }\n    }\n    /**\n     * Adds the given listeners for touch, mouse and/or pointer events. If\n     * <Client.IS_POINTER> is true then pointer events will be registered,\n     * else the respective mouse events will be registered. If <Client.IS_POINTER>\n     * is false and <Client.IS_TOUCH> is true then the respective touch events\n     * will be registered as well as the mouse events.\n     */\n    static addGestureListeners(node, startListener = null, moveListener = null, endListener = null) {\n        if (startListener) {\n            InternalEvent.addListener(node, Client.IS_POINTER ? 'pointerdown' : 'mousedown', startListener);\n        }\n        if (moveListener) {\n            InternalEvent.addListener(node, Client.IS_POINTER ? 'pointermove' : 'mousemove', moveListener);\n        }\n        if (endListener) {\n            InternalEvent.addListener(node, Client.IS_POINTER ? 'pointerup' : 'mouseup', endListener);\n        }\n        if (!Client.IS_POINTER && Client.IS_TOUCH) {\n            if (startListener) {\n                InternalEvent.addListener(node, 'touchstart', startListener);\n            }\n            if (moveListener) {\n                InternalEvent.addListener(node, 'touchmove', moveListener);\n            }\n            if (endListener) {\n                InternalEvent.addListener(node, 'touchend', endListener);\n            }\n        }\n    }\n    /**\n     * Removes the given listeners from mousedown, mousemove, mouseup and the\n     * respective touch events if <Client.IS_TOUCH> is true.\n     */\n    static removeGestureListeners(node, startListener, moveListener, endListener) {\n        if (startListener) {\n            InternalEvent.removeListener(node, Client.IS_POINTER ? 'pointerdown' : 'mousedown', startListener);\n        }\n        if (moveListener) {\n            InternalEvent.removeListener(node, Client.IS_POINTER ? 'pointermove' : 'mousemove', moveListener);\n        }\n        if (endListener) {\n            InternalEvent.removeListener(node, Client.IS_POINTER ? 'pointerup' : 'mouseup', endListener);\n        }\n        if (!Client.IS_POINTER && Client.IS_TOUCH) {\n            if (startListener) {\n                InternalEvent.removeListener(node, 'touchstart', startListener);\n            }\n            if (moveListener) {\n                InternalEvent.removeListener(node, 'touchmove', moveListener);\n            }\n            if (endListener) {\n                InternalEvent.removeListener(node, 'touchend', endListener);\n            }\n        }\n    }\n    /**\n     * Redirects the mouse events from the given DOM node to the graph dispatch\n     * loop using the event and given state as event arguments. State can\n     * either be an instance of <CellState> or a function that returns an\n     * <CellState>. The down, move, up and dblClick arguments are optional\n     * functions that take the trigger event as arguments and replace the\n     * default behaviour.\n     */\n    static redirectMouseEvents(node, graph, state = null, down = null, move = null, up = null, dblClick = null) {\n        const getState = (evt) => {\n            return typeof state === 'function' ? state(evt) : state;\n        };\n        InternalEvent.addGestureListeners(node, (evt) => {\n            if (down) {\n                down(evt);\n            }\n            else if (!isConsumed(evt)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt, getState(evt)));\n            }\n        }, (evt) => {\n            if (move) {\n                move(evt);\n            }\n            else if (!isConsumed(evt)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, getState(evt)));\n            }\n        }, (evt) => {\n            if (up) {\n                up(evt);\n            }\n            else if (!isConsumed(evt)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt, getState(evt)));\n            }\n        });\n        InternalEvent.addListener(node, 'dblclick', (evt) => {\n            if (dblClick) {\n                dblClick(evt);\n            }\n            else if (!isConsumed(evt)) {\n                const tmp = getState(evt);\n                graph.dblClick(evt, tmp?.cell);\n            }\n        });\n    }\n    /**\n     * Removes the known listeners from the given DOM node and its descendants.\n     *\n     * @param element DOM node to remove the listeners from.\n     */\n    static release(element) {\n        try {\n            InternalEvent.removeAllListeners(element);\n            // @ts-ignore\n            const children = element.childNodes;\n            if (children !== undefined) {\n                const childCount = children.length;\n                for (let i = 0; i < childCount; i += 1) {\n                    InternalEvent.release(children[i]);\n                }\n            }\n        }\n        catch (e) {\n            // ignores errors as this is typically called in cleanup code\n        }\n    }\n    /**\n     * Installs the given function as a handler for mouse wheel events. The\n     * function has two arguments: the mouse event and a boolean that specifies\n     * if the wheel was moved up or down.\n     *\n     * This has been tested with IE 6 and 7, Firefox (all versions), Opera and\n     * Safari. It does currently not work on Safari for Mac.\n     *\n     * ### Example\n     *\n     * @example\n     * ```javascript\n     * mxEvent.addMouseWheelListener(function (evt, up)\n     * {\n     *   GlobalConfig.logger.show();\n     *   GlobalConfig.logger.debug('mouseWheel: up='+up);\n     * });\n     * ```\n     *\n     * @param funct Handler function that takes the event argument and a boolean up\n     * argument for the mousewheel direction.\n     * @param target Target for installing the listener in Google Chrome. See\n     * https://www.chromestatus.com/features/6662647093133312.\n     */\n    static addMouseWheelListener(funct, target) {\n        if (funct != null) {\n            const wheelHandler = (evt) => {\n                // To prevent window zoom on trackpad pinch\n                if (evt.ctrlKey) {\n                    evt.preventDefault();\n                }\n                // Handles the event using the given function\n                if (Math.abs(evt.deltaX) > 0.5 || Math.abs(evt.deltaY) > 0.5) {\n                    funct(evt, evt.deltaY == 0 ? -evt.deltaX > 0 : -evt.deltaY > 0);\n                }\n            };\n            target = target != null ? target : window;\n            if (Client.IS_SF && !Client.IS_TOUCH) {\n                let scale = 1;\n                InternalEvent.addListener(target, 'gesturestart', (evt) => {\n                    InternalEvent.consume(evt);\n                    scale = 1;\n                });\n                InternalEvent.addListener(target, 'gesturechange', ((evt) => {\n                    InternalEvent.consume(evt);\n                    if (typeof evt.scale === 'number') {\n                        const diff = scale - evt.scale;\n                        if (Math.abs(diff) > 0.2) {\n                            funct(evt, diff < 0, true);\n                            scale = evt.scale;\n                        }\n                    }\n                }));\n                InternalEvent.addListener(target, 'gestureend', (evt) => {\n                    InternalEvent.consume(evt);\n                });\n            }\n            else {\n                let evtCache = [];\n                let dx0 = 0;\n                let dy0 = 0;\n                // Adds basic listeners for graph event dispatching\n                InternalEvent.addGestureListeners(target, ((evt) => {\n                    if (!isMouseEvent(evt) && evt.pointerId != null) {\n                        evtCache.push(evt);\n                    }\n                }), ((evt) => {\n                    if (!isMouseEvent(evt) && evtCache.length == 2) {\n                        // Find this event in the cache and update its record with this event\n                        for (let i = 0; i < evtCache.length; i += 1) {\n                            if (evt.pointerId == evtCache[i].pointerId) {\n                                evtCache[i] = evt;\n                                break;\n                            }\n                        }\n                        // Calculate the distance between the two pointers\n                        const dx = Math.abs(evtCache[0].clientX - evtCache[1].clientX);\n                        const dy = Math.abs(evtCache[0].clientY - evtCache[1].clientY);\n                        const tx = Math.abs(dx - dx0);\n                        const ty = Math.abs(dy - dy0);\n                        if (tx > InternalEvent.PINCH_THRESHOLD ||\n                            ty > InternalEvent.PINCH_THRESHOLD) {\n                            const cx = evtCache[0].clientX + (evtCache[1].clientX - evtCache[0].clientX) / 2;\n                            const cy = evtCache[0].clientY + (evtCache[1].clientY - evtCache[0].clientY) / 2;\n                            funct(evtCache[0], tx > ty ? dx > dx0 : dy > dy0, true, cx, cy);\n                            // Cache the distance for the next move event\n                            dx0 = dx;\n                            dy0 = dy;\n                        }\n                    }\n                }), (evt) => {\n                    evtCache = [];\n                    dx0 = 0;\n                    dy0 = 0;\n                });\n            }\n            InternalEvent.addListener(target, 'wheel', wheelHandler);\n        }\n    }\n    /**\n     * Disables the context menu for the given element.\n     */\n    static disableContextMenu(element) {\n        InternalEvent.addListener(element, 'contextmenu', (evt) => {\n            if (evt.preventDefault) {\n                evt.preventDefault();\n            }\n            return false;\n        });\n    }\n    /**\n     * Consumes the given event.\n     *\n     * @param evt Native event to be consumed.\n     * @param {boolean} [preventDefault=true] Optional boolean to prevent the default for the event.\n     * Default is true.\n     * @param {boolean} [stopPropagation=true] Option boolean to stop event propagation. Default is\n     * true.\n     */\n    static consume(evt, preventDefault = true, stopPropagation = true) {\n        if (preventDefault) {\n            if (evt.preventDefault) {\n                if (stopPropagation) {\n                    evt.stopPropagation();\n                }\n                evt.preventDefault();\n            }\n            else if (stopPropagation) {\n                evt.cancelBubble = true;\n            }\n        }\n        // Opera\n        // @ts-ignore This is a non-standard property.\n        evt.isConsumed = true;\n        // Other browsers\n        if (!evt.preventDefault) {\n            evt.returnValue = false;\n        }\n    }\n}\n//\n// Special handles in mouse events\n//\n/**\n * Index for the label handle in an mxMouseEvent. This should be a negative\n * value that does not interfere with any possible handle indices.\n * @default -1\n */\nInternalEvent.LABEL_HANDLE = -1;\n/**\n * Index for the rotation handle in an mxMouseEvent. This should be a\n * negative value that does not interfere with any possible handle indices.\n * @default -2\n */\nInternalEvent.ROTATION_HANDLE = -2;\n/**\n * Start index for the custom handles in an mxMouseEvent. This should be a\n * negative value and is the start index which is decremented for each\n * custom handle.\n * @default -100\n */\nInternalEvent.CUSTOM_HANDLE = -100;\n/**\n * Start index for the virtual handles in an mxMouseEvent. This should be a\n * negative value and is the start index which is decremented for each\n * virtual handle.\n * This assumes that there are no more\n * than VIRTUAL_HANDLE - CUSTOM_HANDLE custom handles.\n *\n * @default -100000\n */\nInternalEvent.VIRTUAL_HANDLE = -100000;\n//\n// Event names\n//\n/**\n * Specifies the event name for mouseDown.\n */\nInternalEvent.MOUSE_DOWN = 'mouseDown';\n/**\n * Specifies the event name for mouseMove.\n */\nInternalEvent.MOUSE_MOVE = 'mouseMove';\n/**\n * Specifies the event name for mouseUp.\n */\nInternalEvent.MOUSE_UP = 'mouseUp';\n/**\n * Specifies the event name for activate.\n */\nInternalEvent.ACTIVATE = 'activate';\n/**\n * Specifies the event name for resizeStart.\n */\nInternalEvent.RESIZE_START = 'resizeStart';\n/**\n * Specifies the event name for resize.\n */\nInternalEvent.RESIZE = 'resize';\n/**\n * Specifies the event name for resizeEnd.\n */\nInternalEvent.RESIZE_END = 'resizeEnd';\n/**\n * Specifies the event name for moveStart.\n */\nInternalEvent.MOVE_START = 'moveStart';\n/**\n * Specifies the event name for move.\n */\nInternalEvent.MOVE = 'move';\n/**\n * Specifies the event name for moveEnd.\n */\nInternalEvent.MOVE_END = 'moveEnd';\n/**\n * Specifies the event name for panStart.\n */\nInternalEvent.PAN_START = 'panStart';\n/**\n * Specifies the event name for pan.\n */\nInternalEvent.PAN = 'pan';\n/**\n * Specifies the event name for panEnd.\n */\nInternalEvent.PAN_END = 'panEnd';\n/**\n * Specifies the event name for minimize.\n */\nInternalEvent.MINIMIZE = 'minimize';\n/**\n * Specifies the event name for normalize.\n */\nInternalEvent.NORMALIZE = 'normalize';\n/**\n * Specifies the event name for maximize.\n */\nInternalEvent.MAXIMIZE = 'maximize';\n/**\n * Specifies the event name for hide.\n */\nInternalEvent.HIDE = 'hide';\n/**\n * Specifies the event name for show.\n */\nInternalEvent.SHOW = 'show';\n/**\n * Specifies the event name for close.\n */\nInternalEvent.CLOSE = 'close';\n/**\n * Specifies the event name for destroy.\n */\nInternalEvent.DESTROY = 'destroy';\n/**\n * Specifies the event name for refresh.\n */\nInternalEvent.REFRESH = 'refresh';\n/**\n * Specifies the event name for size.\n */\nInternalEvent.SIZE = 'size';\n/**\n * Specifies the event name for select.\n */\nInternalEvent.SELECT = 'select';\n/**\n * Specifies the event name for fired.\n */\nInternalEvent.FIRED = 'fired';\n/**\n * Specifies the event name for fireMouseEvent.\n */\nInternalEvent.FIRE_MOUSE_EVENT = 'fireMouseEvent';\n/**\n * Specifies the event name for gesture.\n */\nInternalEvent.GESTURE = 'gesture';\n/**\n * Specifies the event name for tapAndHold.\n */\nInternalEvent.TAP_AND_HOLD = 'tapAndHold';\n/**\n * Specifies the event name for get.\n */\nInternalEvent.GET = 'get';\n/**\n * Specifies the event name for receive.\n */\nInternalEvent.RECEIVE = 'receive';\n/**\n * Specifies the event name for connect.\n */\nInternalEvent.CONNECT = 'connect';\n/**\n * Specifies the event name for disconnect.\n */\nInternalEvent.DISCONNECT = 'disconnect';\n/**\n * Specifies the event name for suspend.\n */\nInternalEvent.SUSPEND = 'suspend';\n/**\n * Specifies the event name for suspend.\n */\nInternalEvent.RESUME = 'resume';\n/**\n * Specifies the event name for mark.\n */\nInternalEvent.MARK = 'mark';\n/**\n * Specifies the event name for root.\n */\nInternalEvent.ROOT = 'root';\n/**\n * Specifies the event name for post.\n */\nInternalEvent.POST = 'post';\n/**\n * Specifies the event name for open.\n */\nInternalEvent.OPEN = 'open';\n/**\n * Specifies the event name for open.\n */\nInternalEvent.SAVE = 'save';\n/**\n * Specifies the event name for beforeAddVertex.\n */\nInternalEvent.BEFORE_ADD_VERTEX = 'beforeAddVertex';\n/**\n * Specifies the event name for addVertex.\n */\nInternalEvent.ADD_VERTEX = 'addVertex';\n/**\n * Specifies the event name for afterAddVertex.\n */\nInternalEvent.AFTER_ADD_VERTEX = 'afterAddVertex';\n/**\n * Specifies the event name for done.\n */\nInternalEvent.DONE = 'done';\n/**\n * Specifies the event name for execute.\n */\nInternalEvent.EXECUTE = 'execute';\n/**\n * Specifies the event name for executed.\n */\nInternalEvent.EXECUTED = 'executed';\n/**\n * Specifies the event name for beginUpdate.\n */\nInternalEvent.BEGIN_UPDATE = 'beginUpdate';\n/**\n * Specifies the event name for startEdit.\n */\nInternalEvent.START_EDIT = 'startEdit';\n/**\n * Specifies the event name for endUpdate.\n */\nInternalEvent.END_UPDATE = 'endUpdate';\n/**\n * Specifies the event name for endEdit.\n */\nInternalEvent.END_EDIT = 'endEdit';\n/**\n * Specifies the event name for beforeUndo.\n */\nInternalEvent.BEFORE_UNDO = 'beforeUndo';\n/**\n * Specifies the event name for undo.\n */\nInternalEvent.UNDO = 'undo';\n/**\n * Specifies the event name for redo.\n */\nInternalEvent.REDO = 'redo';\n/**\n * Specifies the event name for change.\n */\nInternalEvent.CHANGE = 'change';\n/**\n * Specifies the event name for notify.\n */\nInternalEvent.NOTIFY = 'notify';\n/**\n * Specifies the event name for layoutCells.\n */\nInternalEvent.LAYOUT_CELLS = 'layoutCells';\n/**\n * Specifies the event name for click.\n */\nInternalEvent.CLICK = 'click';\n/**\n * Specifies the event name for scale.\n */\nInternalEvent.SCALE = 'scale';\n/**\n * Specifies the event name for translate.\n */\nInternalEvent.TRANSLATE = 'translate';\n/**\n * Specifies the event name for scaleAndTranslate.\n */\nInternalEvent.SCALE_AND_TRANSLATE = 'scaleAndTranslate';\n/**\n * Specifies the event name for up.\n */\nInternalEvent.UP = 'up';\n/**\n * Specifies the event name for down.\n */\nInternalEvent.DOWN = 'down';\n/**\n * Specifies the event name for add.\n */\nInternalEvent.ADD = 'add';\n/**\n * Specifies the event name for remove.\n */\nInternalEvent.REMOVE = 'remove';\n/**\n * Specifies the event name for clear.\n */\nInternalEvent.CLEAR = 'clear';\n/**\n * Specifies the event name for addCells.\n */\nInternalEvent.ADD_CELLS = 'addCells';\n/**\n * Specifies the event name for cellsAdded.\n */\nInternalEvent.CELLS_ADDED = 'cellsAdded';\n/**\n * Specifies the event name for moveCells.\n */\nInternalEvent.MOVE_CELLS = 'moveCells';\n/**\n * Specifies the event name for cellsMoved.\n */\nInternalEvent.CELLS_MOVED = 'cellsMoved';\n/**\n * Specifies the event name for resizeCells.\n */\nInternalEvent.RESIZE_CELLS = 'resizeCells';\n/**\n * Specifies the event name for cellsResized.\n */\nInternalEvent.CELLS_RESIZED = 'cellsResized';\n/**\n * Specifies the event name for toggleCells.\n */\nInternalEvent.TOGGLE_CELLS = 'toggleCells';\n/**\n * Specifies the event name for cellsToggled.\n */\nInternalEvent.CELLS_TOGGLED = 'cellsToggled';\n/**\n * Specifies the event name for orderCells.\n */\nInternalEvent.ORDER_CELLS = 'orderCells';\n/**\n * Specifies the event name for cellsOrdered.\n */\nInternalEvent.CELLS_ORDERED = 'cellsOrdered';\n/**\n * Specifies the event name for removeCells.\n */\nInternalEvent.REMOVE_CELLS = 'removeCells';\n/**\n * Specifies the event name for cellsRemoved.\n */\nInternalEvent.CELLS_REMOVED = 'cellsRemoved';\n/**\n * Specifies the event name for groupCells.\n */\nInternalEvent.GROUP_CELLS = 'groupCells';\n/**\n * Specifies the event name for ungroupCells.\n */\nInternalEvent.UNGROUP_CELLS = 'ungroupCells';\n/**\n * Specifies the event name for removeCellsFromParent.\n */\nInternalEvent.REMOVE_CELLS_FROM_PARENT = 'removeCellsFromParent';\n/**\n * Specifies the event name for foldCells.\n */\nInternalEvent.FOLD_CELLS = 'foldCells';\n/**\n * Specifies the event name for cellsFolded.\n */\nInternalEvent.CELLS_FOLDED = 'cellsFolded';\n/**\n * Specifies the event name for alignCells.\n */\nInternalEvent.ALIGN_CELLS = 'alignCells';\n/**\n * Specifies the event name for labelChanged.\n */\nInternalEvent.LABEL_CHANGED = 'labelChanged';\n/**\n * Specifies the event name for connectCell.\n */\nInternalEvent.CONNECT_CELL = 'connectCell';\n/**\n * Specifies the event name for cellConnected.\n */\nInternalEvent.CELL_CONNECTED = 'cellConnected';\n/**\n * Specifies the event name for splitEdge.\n */\nInternalEvent.SPLIT_EDGE = 'splitEdge';\n/**\n * Specifies the event name for flipEdge.\n */\nInternalEvent.FLIP_EDGE = 'flipEdge';\n/**\n * Specifies the event name for startEditing.\n */\nInternalEvent.START_EDITING = 'startEditing';\n/**\n * Specifies the event name for editingStarted.\n */\nInternalEvent.EDITING_STARTED = 'editingStarted';\n/**\n * Specifies the event name for editingStopped.\n */\nInternalEvent.EDITING_STOPPED = 'editingStopped';\n/**\n * Specifies the event name for addOverlay.\n */\nInternalEvent.ADD_OVERLAY = 'addOverlay';\n/**\n * Specifies the event name for removeOverlay.\n */\nInternalEvent.REMOVE_OVERLAY = 'removeOverlay';\n/**\n * Specifies the event name for updateCellSize.\n */\nInternalEvent.UPDATE_CELL_SIZE = 'updateCellSize';\n/**\n * Specifies the event name for escape.\n */\nInternalEvent.ESCAPE = 'escape';\n/**\n * Specifies the event name for doubleClick.\n */\nInternalEvent.DOUBLE_CLICK = 'doubleClick';\n/**\n * Specifies the event name for start.\n */\nInternalEvent.START = 'start';\n/**\n * Specifies the event name for reset.\n */\nInternalEvent.RESET = 'reset';\n/**\n * Threshold for pinch gestures to fire a mouse wheel event.\n * Default value is 10.\n */\nInternalEvent.PINCH_THRESHOLD = 10;\nexport default InternalEvent;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Implements a 2-dimensional vector with double precision coordinates.\n *\n * @category Geometry\n */\nclass Point {\n    /**\n     * Constructs a new point for the optional x and y coordinates.\n     *\n     * @param x - The x-coordinate (default is 0).\n     * @param y - The y-coordinate (default is 0).\n     */\n    constructor(x = 0, y = 0) {\n        /**\n         * Holds the x-coordinate of the point. Default is 0.\n         */\n        this._x = 0;\n        /**\n         * Holds the y-coordinate of the point. Default is 0.\n         */\n        this._y = 0;\n        this.x = x;\n        this.y = y;\n    }\n    get x() {\n        return this._x;\n    }\n    set x(x) {\n        if (Number.isNaN(x))\n            throw new Error('Invalid x supplied.');\n        this._x = x;\n    }\n    get y() {\n        return this._y;\n    }\n    set y(y) {\n        if (Number.isNaN(y))\n            throw new Error('Invalid y supplied.');\n        this._y = y;\n    }\n    /**\n     * Returns true if the given object equals this point.\n     */\n    equals(p) {\n        if (!p)\n            return false;\n        return p.x === this.x && p.y === this.y;\n    }\n    /**\n     * Returns a clone of this {@link Point}.\n     */\n    clone() {\n        return new Point(this.x, this.y);\n    }\n}\nexport default Point;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from './Point.js';\n/**\n * Extends {@link Point} to implement a 2-dimensional rectangle with double precision coordinates.\n *\n * @category Geometry\n */\nclass Rectangle extends Point {\n    /**\n     * Constructs a new rectangle for the optional parameters.\n     */\n    constructor(x = 0, y = 0, width = 0, height = 0) {\n        super(x, y);\n        /**\n         * Holds the width of the rectangle.\n         * @default 0\n         */\n        this._width = 0;\n        /**\n         * Holds the height of the rectangle.\n         * @default 0\n         */\n        this._height = 0;\n        this.width = width;\n        this.height = height;\n    }\n    get width() {\n        return this._width;\n    }\n    set width(width) {\n        if (Number.isNaN(width))\n            throw new Error('Invalid width supplied.');\n        this._width = width;\n    }\n    get height() {\n        return this._height;\n    }\n    set height(height) {\n        if (Number.isNaN(height))\n            throw new Error('Invalid height supplied.');\n        this._height = height;\n    }\n    /**\n     * Sets this rectangle to the specified values\n     */\n    setRect(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    /**\n     * Returns the x-coordinate of the center point.\n     */\n    getCenterX() {\n        return this.x + this.width / 2;\n    }\n    /**\n     * Returns the y-coordinate of the center point.\n     */\n    getCenterY() {\n        return this.y + this.height / 2;\n    }\n    /**\n     * Adds the given rectangle to this rectangle.\n     */\n    add(rect) {\n        const minX = Math.min(this.x, rect.x);\n        const minY = Math.min(this.y, rect.y);\n        const maxX = Math.max(this.x + this.width, rect.x + rect.width);\n        const maxY = Math.max(this.y + this.height, rect.y + rect.height);\n        this.x = minX;\n        this.y = minY;\n        this.width = maxX - minX;\n        this.height = maxY - minY;\n    }\n    /**\n     * Changes this rectangle to where it overlaps with the given rectangle.\n     */\n    intersect(rect) {\n        const r1 = this.x + this.width;\n        const r2 = rect.x + rect.width;\n        const b1 = this.y + this.height;\n        const b2 = rect.y + rect.height;\n        this.x = Math.max(this.x, rect.x);\n        this.y = Math.max(this.y, rect.y);\n        this.width = Math.min(r1, r2) - this.x;\n        this.height = Math.min(b1, b2) - this.y;\n    }\n    /**\n     * Grows the rectangle by the given amount, that is, this method subtracts\n     * the given amount from the x- and y-coordinates and adds twice the amount\n     * to the width and height.\n     */\n    grow(amount) {\n        this.x -= amount;\n        this.y -= amount;\n        this.width += 2 * amount;\n        this.height += 2 * amount;\n    }\n    /**\n     * Returns the top, left corner as a new {@link Point}.\n     */\n    getPoint() {\n        return new Point(this.x, this.y);\n    }\n    /**\n     * Rotates this rectangle by 90 degree around its center point.\n     */\n    rotate90() {\n        const t = (this.width - this.height) / 2;\n        this.x += t;\n        this.y -= t;\n        const tmp = this.width;\n        this.width = this.height;\n        this.height = tmp;\n    }\n    /**\n     * Returns true if the given object equals this rectangle.\n     */\n    equals(rect) {\n        if (!rect)\n            return false;\n        return (rect.x === this.x &&\n            rect.y === this.y &&\n            rect.width === this.width &&\n            rect.height === this.height);\n    }\n    clone() {\n        return new Rectangle(this.x, this.y, this.width, this.height);\n    }\n}\n/**\n * Returns a new {@link Rectangle} which is a copy of the given rectangle.\n */\nRectangle.fromRectangle = (rect) => {\n    return new Rectangle(rect.x, rect.y, rect.width, rect.height);\n};\nexport default Rectangle;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Implements a mechanism for temporary cell Ids.\n * @class CellPath\n */\nclass CellPath {\n    constructor() {\n        throw new Error(\"Static class can't be instantiated!\");\n    }\n    /**\n     * Creates the cell path for the given cell. The cell path is a\n     * concatenation of the indices of all ancestors on the (finite) path to\n     * the root, eg. \"0.0.0.1\".\n     *\n     * @param cell Cell whose path should be returned.\n     */\n    static create(cell) {\n        let result = '';\n        let parent = cell.getParent();\n        while (parent) {\n            const index = parent.getIndex(cell);\n            result = index + CellPath.PATH_SEPARATOR + result;\n            cell = parent;\n            parent = cell.getParent();\n        }\n        // Remove trailing separator\n        const n = result.length;\n        if (n > 1) {\n            result = result.substring(0, n - 1);\n        }\n        return result;\n    }\n    /**\n     * Returns the path for the parent of the cell represented by the given\n     * path. Returns null if the given path has no parent.\n     *\n     * @param path Path whose parent path should be returned.\n     */\n    static getParentPath(path) {\n        const index = path.lastIndexOf(CellPath.PATH_SEPARATOR);\n        if (index >= 0) {\n            return path.substring(0, index);\n        }\n        if (path.length > 0) {\n            return '';\n        }\n        return null;\n    }\n    /**\n     * Returns the cell for the specified cell path using the given root as the\n     * root of the path.\n     *\n     * @param root Root cell of the path to be resolved.\n     * @param path String that defines the path.\n     */\n    static resolve(root, path) {\n        let parent = root;\n        const tokens = path.split(CellPath.PATH_SEPARATOR);\n        for (let i = 0; i < tokens.length; i += 1) {\n            parent = parent.getChildAt(parseInt(tokens[i]));\n        }\n        return parent;\n    }\n    /**\n     * Compares the given cell paths and returns -1 if p1 is smaller, 0 if\n     * p1 is equal and 1 if p1 is greater than p2.\n     */\n    static compare(p1, p2) {\n        const min = Math.min(p1.length, p2.length);\n        let comp = 0;\n        for (let i = 0; i < min; i += 1) {\n            if (p1[i] !== p2[i]) {\n                if (p1[i].length === 0 || p2[i].length === 0) {\n                    comp = p1[i] === p2[i] ? 0 : p1[i] > p2[i] ? 1 : -1;\n                }\n                else {\n                    const t1 = parseInt(p1[i]);\n                    const t2 = parseInt(p2[i]);\n                    comp = t1 === t2 ? 0 : t1 > t2 ? 1 : -1;\n                }\n                break;\n            }\n        }\n        // Compares path length if both paths are equal to this point\n        if (comp === 0) {\n            const t1 = p1.length;\n            const t2 = p2.length;\n            if (t1 !== t2) {\n                comp = t1 > t2 ? 1 : -1;\n            }\n        }\n        return comp;\n    }\n}\n/**\n * Defines the separator between the path components. Default is \".\".\n */\nCellPath.PATH_SEPARATOR = '.';\nexport default CellPath;\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { getElapseMillisecondsMessage } from '../internal/time-utils.js';\n/**\n * A {@link Logger} that does nothing.\n *\n * @experimental subject to change or removal. The logging system may be modified in the future without prior notice.\n * @since 0.11.0\n * @category Logging\n */\nexport class NoOpLogger {\n    debug(_message) { }\n    enter(_message) {\n        return undefined;\n    }\n    error(_message, ..._optionalParams) { }\n    info(_message) { }\n    leave(_message, _baseTimestamp) { }\n    show() { }\n    trace(_message) { }\n    warn(_message) { }\n}\n/**\n * A {@link Logger} that directs logs to the browser console.\n *\n * @experimental subject to change or removal. The logging system may be modified in the future without prior notice.\n * @since 0.11.0\n * @category Logging\n */\nexport class ConsoleLogger {\n    constructor() {\n        this.debugEnabled = false;\n        this.infoEnabled = false;\n        this.traceEnabled = false;\n    }\n    /* eslint-disable no-console -- we must use \"console\" to direct logs to the browser console */\n    enter(message) {\n        if (this.traceEnabled) {\n            console.trace(`Entering ${message}`);\n            return new Date().getTime();\n        }\n    }\n    leave(message, baseTimestamp) {\n        if (this.traceEnabled) {\n            const dt = getElapseMillisecondsMessage(baseTimestamp);\n            console.trace(`Leaving ${message}${dt}`);\n        }\n    }\n    show() { }\n    trace(message) {\n        if (this.traceEnabled) {\n            console.trace(message);\n        }\n    }\n    debug(message) {\n        if (this.debugEnabled) {\n            console.debug(message);\n        }\n    }\n    info(message) {\n        if (this.infoEnabled) {\n            console.info(message);\n        }\n    }\n    warn(message) {\n        console.warn(message);\n    }\n    error(message, ...optionalParams) {\n        console.error(message, ...optionalParams);\n    }\n}\n/* eslint-enable no-console */\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Shallow copies properties from the source object to the target object.\n *\n * **WARNING**: This function performs only a **shallow** copy i.e. there is no deep copy of the properties that are objects, expect for arrays.\n *\n * @template T The type of the objects.\n *\n * @param source The source object from which properties will be copied.\n * @param target The target object to which properties will be copied.\n *\n * @private not part of the public API, can be removed or changed without prior notice\n * @since 0.14.0\n */\nexport const shallowCopy = (source, target) => {\n    for (const key in source) {\n        // attempt to prevent prototype pollution\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n            const sourceValue = source[key];\n            if (Array.isArray(sourceValue)) {\n                // TypeScript cannot infer that the key in target will also be an array when source and target are of the same type\n                target[key] = [...sourceValue];\n            }\n            else {\n                target[key] = sourceValue;\n            }\n        }\n    }\n};\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * A {@link I18nProvider} that does nothing.\n *\n * @experimental subject to change or removal. The I18n system may be modified in the future without prior notice.\n * @since 0.17.0\n * @category I18n\n */\nexport class NoOpI18n {\n    isEnabled() {\n        return false;\n    }\n    get() {\n        return null;\n    }\n    addResource() {\n        // do nothing\n    }\n}\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NoOpLogger } from './logger.js';\nimport { SHADOW_OFFSET_X, SHADOW_OFFSET_Y, SHADOW_OPACITY, SHADOWCOLOR, } from './Constants.js';\nimport { shallowCopy } from '../internal/clone-utils.js';\nimport { NoOpI18n } from '../i18n/provider.js';\n/**\n * Global configuration for maxGraph.\n *\n * @experimental subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.11.0\n * @category Configuration\n */\nexport const GlobalConfig = {\n    /**\n     * Configure the {@link I18nProvider} to use for all translated messages.\n     *\n     * Available implementations provided by maxGraph are:\n     * * {@link NoOpI18n} - Default implementation that does nothing.\n     * * {@link TranslationsAsI18n} - Uses {@link Translations} to manage translations.\n     *\n     * To change the i18n provider, set this property to an instance of the desired provider:\n     * ```js\n     * // To use the i18n system provided by maxGraph\n     * GlobalConfig.i18n = new TranslationsAsI18n();\n     * ```\n     *\n     * @default {@link NoOpI18n}\n     * @since 0.17.0\n     */\n    i18n: new NoOpI18n(),\n    /**\n     * Configure the logger to use for all log messages.\n     *\n     * Available implementations provided by maxGraph are:\n     * * {@link ConsoleLogger} - Directs logs to the browser console.\n     * * {@link NoOpLogger} - Default implementation that does nothing.\n     * * {@link MaxLogAsLogger} - Directs logs to {@link MaxLog}.\n     *\n     * To change the logger, set this property to an instance of the desired logger:\n     * ```js\n     * // To direct logs to the browser console\n     * GlobalConfig.logger = new ConsoleLogger();\n     * // To direct logs to MaxLog\n     * GlobalConfig.logger = new MaxLogAsLogger();\n     * ```\n     *\n     * @default {@link NoOpLogger}\n     */\n    logger: new NoOpLogger(),\n};\n/**\n * Configure style defaults for maxGraph.\n *\n * @experimental subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const StyleDefaultsConfig = {\n    /**\n     * Defines the color to be used to draw shadows in shapes and windows.\n     * @default {@link SHADOWCOLOR}\n     */\n    shadowColor: SHADOWCOLOR,\n    /**\n     * Specifies the x-offset of the shadow.\n     * @default {@link SHADOW_OFFSET_X}\n     */\n    shadowOffsetX: SHADOW_OFFSET_X,\n    /**\n     * Specifies the y-offset of the shadow.\n     * @default {@link SHADOW_OFFSET_Y}\n     */\n    shadowOffsetY: SHADOW_OFFSET_Y,\n    /**\n     * Defines the opacity for shadow. Possible values are between 1 (opaque) and 0 (transparent).\n     * @default {@link SHADOW_OPACITY}\n     */\n    shadowOpacity: SHADOW_OPACITY,\n};\nconst defaultStyleDefaultsConfig = { ...StyleDefaultsConfig };\n/**\n * Resets {@link StyleDefaultsConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const resetStyleDefaultsConfig = () => {\n    shallowCopy(defaultStyleDefaultsConfig, StyleDefaultsConfig);\n};\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NODE_TYPE } from '../util/Constants.js';\nimport { GlobalConfig } from '../util/config.js';\n/**\n * @private\n */\nexport const doEval = (expression) => {\n    // eslint-disable-next-line no-eval -- valid here as we want this function to be the only place in the codebase that uses eval\n    return eval(expression);\n};\n/**\n * Returns true if the parameter is not `nullish` and its nodeType relates to an {@link Element}.\n * @private\n */\nexport const isElement = (node) => node?.nodeType === NODE_TYPE.ELEMENT;\n/**\n * @private not part of the public API, can be removed or changed without prior notice\n */\nexport const isNullish = (v) => v === null || v === undefined;\n/**\n * Merge a mixin into the destination\n * @param dest the destination class\n *\n * @private not part of the public API, can be removed or changed without prior notice\n */\nexport const mixInto = (dest) => (mixin) => {\n    const keys = Reflect.ownKeys(mixin);\n    try {\n        for (const key of keys) {\n            Object.defineProperty(dest.prototype, key, {\n                value: mixin[key],\n                writable: true,\n            });\n        }\n    }\n    catch (e) {\n        GlobalConfig.logger.error('Error while mixing', e);\n    }\n};\n/**\n * @param value the value to check.\n * @param mask the binary mask to apply.\n * @returns `true` if the value matches the binary mask.\n * @private Subject to change prior being part of the public API.\n */\nexport const matchBinaryMask = (value, mask) => {\n    return (value & mask) === mask;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Client from '../Client.js';\nimport { DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, FONT_STYLE_MASK, LINE_HEIGHT, } from './Constants.js';\nimport Point from '../view/geometry/Point.js';\nimport CellPath from '../view/cell/CellPath.js';\nimport Rectangle from '../view/geometry/Rectangle.js';\nimport { matchBinaryMask } from '../internal/utils.js';\n/**\n * Removes the cursors from the style of the given DOM node and its descendants.\n *\n * @param element DOM node to remove the cursor style from.\n */\nexport const removeCursors = (element) => {\n    if (element.style) {\n        element.style.cursor = '';\n    }\n    const children = element.children;\n    if (children) {\n        const childCount = children.length;\n        for (let i = 0; i < childCount; i += 1) {\n            removeCursors(children[i]);\n        }\n    }\n};\n/**\n * Returns the current style of the specified element.\n *\n * @param element DOM node whose current style should be returned.\n */\nexport const getCurrentStyle = (element) => {\n    return !element || element.toString() === '[object ShadowRoot]'\n        ? null\n        : window.getComputedStyle(element, '');\n};\n/**\n * Parses the given CSS numeric value adding handling for the values thin, medium and thick (2, 4 and 6).\n */\nexport const parseCssNumber = (value) => {\n    if (value === 'thin') {\n        value = '2';\n    }\n    else if (value === 'medium') {\n        value = '4';\n    }\n    else if (value === 'thick') {\n        value = '6';\n    }\n    let n = parseFloat(value);\n    if (Number.isNaN(n)) {\n        n = 0;\n    }\n    return n;\n};\n/**\n * Adds the given style with the standard name and an optional vendor prefix for the current browser.\n *\n * ```javascript\n * styleUtils.setPrefixedStyle(node.style, 'transformOrigin', '0% 0%');\n * ```\n */\nexport const setPrefixedStyle = (style, name, value) => {\n    let prefix = null;\n    if (Client.IS_SF || Client.IS_GC) {\n        prefix = 'Webkit';\n    }\n    else if (Client.IS_MT) {\n        prefix = 'Moz';\n    }\n    style.setProperty(name, value);\n    if (prefix !== null && name.length > 0) {\n        name = prefix + name.substring(0, 1).toUpperCase() + name.substring(1);\n        style.setProperty(name, value);\n    }\n};\n/**\n * Function: hasScrollbars\n *\n * Returns true if the overflow CSS property of the given node is either\n * scroll or auto.\n *\n * @param node DOM node whose style should be checked for scrollbars.\n */\nexport const hasScrollbars = (node) => {\n    const style = getCurrentStyle(node);\n    return !!style && (style.overflow === 'scroll' || style.overflow === 'auto');\n};\n/**\n * Returns the client size for the current document as an {@link Rectangle}.\n */\nexport const getDocumentSize = () => {\n    const b = document.body;\n    const d = document.documentElement;\n    try {\n        return new Rectangle(0, 0, b.clientWidth ?? d.clientWidth, Math.max(b.clientHeight ?? 0, d.clientHeight));\n    }\n    catch (e) {\n        return new Rectangle();\n    }\n};\n/**\n * Makes sure the given node is inside the visible area of the window.\n * This is done by setting the left and top in the style.\n */\nexport const fit = (node) => {\n    const ds = getDocumentSize();\n    const left = node.offsetLeft;\n    const width = node.offsetWidth;\n    const offset = getDocumentScrollOrigin(node.ownerDocument);\n    const sl = offset.x;\n    const st = offset.y;\n    const right = sl + ds.width;\n    if (left + width > right) {\n        node.style.left = `${Math.max(sl, right - width)}px`;\n    }\n    const top = node.offsetTop;\n    const height = node.offsetHeight;\n    const bottom = st + ds.height;\n    if (top + height > bottom) {\n        node.style.top = `${Math.max(st, bottom - height)}px`;\n    }\n};\n/**\n * Returns the offset for the specified container as an {@link Point}.\n * The offset is the distance from the top left corner of the container to the top left corner of the document.\n *\n * @param container DOM node to return the offset for.\n * @param scrollOffset Optional boolean to add the scroll offset of the document. Default is `false`.\n */\nexport const getOffset = (container, scrollOffset = false) => {\n    let offsetLeft = 0;\n    let offsetTop = 0;\n    // Ignores document scroll origin for fixed elements\n    let fixed = false;\n    let node = container;\n    const b = document.body;\n    const d = document.documentElement;\n    while (node != null && node != b && node != d && !fixed) {\n        const style = getCurrentStyle(node);\n        if (style != null) {\n            fixed = fixed || style.position == 'fixed';\n        }\n        node = node.parentNode;\n    }\n    if (!scrollOffset && !fixed) {\n        const offset = getDocumentScrollOrigin(container.ownerDocument);\n        offsetLeft += offset.x;\n        offsetTop += offset.y;\n    }\n    const r = container.getBoundingClientRect();\n    if (r != null) {\n        offsetLeft += r.left;\n        offsetTop += r.top;\n    }\n    return new Point(offsetLeft, offsetTop);\n};\n/**\n * Returns the scroll origin of the given document or the current document if no document is given.\n */\nexport const getDocumentScrollOrigin = (doc) => {\n    // @ts-ignore 'parentWindow' is an unknown property.\n    const wnd = doc.defaultView || doc.parentWindow;\n    const x = wnd != null && window.pageXOffset !== undefined\n        ? window.pageXOffset\n        : (document.documentElement || document.body.parentNode || document.body)\n            .scrollLeft;\n    const y = wnd != null && window.pageYOffset !== undefined\n        ? window.pageYOffset\n        : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n    return new Point(x, y);\n};\n/**\n * Returns the top, left corner of the view rectangle as an {@link Point}.\n *\n * @param node DOM node whose scroll origin should be returned.\n * @param includeAncestors Whether the scroll origin of the ancestors should be included. Default is `false`.\n * @param includeDocument Whether the scroll origin of the document should be included. Default is `true`.\n */\nexport const getScrollOrigin = (node = null, includeAncestors = false, includeDocument = true) => {\n    const doc = node != null ? node.ownerDocument : document;\n    const b = doc.body;\n    const d = doc.documentElement;\n    const result = new Point();\n    let fixed = false;\n    while (node != null && node != b && node != d) {\n        if (!Number.isNaN(node.scrollLeft) && !Number.isNaN(node.scrollTop)) {\n            result.x += node.scrollLeft;\n            result.y += node.scrollTop;\n        }\n        const style = getCurrentStyle(node);\n        if (style != null) {\n            fixed = fixed || style.position == 'fixed';\n        }\n        node = includeAncestors ? node.parentNode : null;\n    }\n    if (!fixed && includeDocument) {\n        const origin = getDocumentScrollOrigin(doc);\n        result.x += origin.x;\n        result.y += origin.y;\n    }\n    return result;\n};\n/**\n * Converts the specified point (x, y) using the offset of the specified container and returns a new {@link Point} with the result.\n *\n * ```javascript\n * const pt = styleUtils.convertPoint(graph.container, eventUtils.getClientX(evt), eventUtils.getClientY(evt));\n * ```\n *\n * @param container DOM node to use for the offset.\n * @param x X-coordinate of the point to be converted.\n * @param y Y-coordinate of the point to be converted.\n */\nexport const convertPoint = (container, x, y) => {\n    const origin = getScrollOrigin(container, false);\n    const offset = getOffset(container);\n    offset.x -= origin.x;\n    offset.y -= origin.y;\n    return new Point(x - offset.x, y - offset.y);\n};\n/**\n * Assigns the value for the given key in the styles of the given cells, or removes the key from the styles if the value is `null`.\n *\n * @param model {@link GraphDataModel} to execute the transaction in.\n * @param cells Array of {@link Cell}s to be updated.\n * @param key Key of the style to be changed.\n * @param value New value for the given key.\n */\nexport const setCellStyles = (model, cells, key, value) => {\n    if (cells.length > 0) {\n        model.batchUpdate(() => {\n            for (let i = 0; i < cells.length; i += 1) {\n                const cell = cells[i];\n                if (cell) {\n                    // Currently, the style object must be cloned, otherwise model.setStyle does not trigger the change event and the cell state in the view is not updated\n                    const style = cell.getClonedStyle();\n                    style[key] = value;\n                    model.setStyle(cell, style);\n                }\n            }\n        });\n    }\n};\n/**\n * Sets or toggles the flag bit for the given key in the cell's styles.\n * If the `value` parameter is not set, then the flag is toggled.\n *\n * Example that toggles the bold font style:\n *\n * ```javascript\n * const cells = graph.getSelectionCells();\n * setCellStyleFlags(graph.model,\n *       cells,\n *       'fontStyle',\n *       constants.FONT_STYLE_FLAG.BOLD);\n * ```\n *\n * @param model {@link GraphDataModel} that contains the cells.\n * @param cells Array of {@link Cell}s to change the style for.\n * @param key Key of the style to be changed.\n * @param flag Integer for the bit to be changed.\n * @param value Optional boolean value for the flag.\n */\nexport const setCellStyleFlags = (model, cells, key, flag, value) => {\n    if (cells.length > 0) {\n        model.batchUpdate(() => {\n            for (let i = 0; i < cells.length; i += 1) {\n                const cell = cells[i];\n                if (cell) {\n                    // Currently, the style object must be cloned, otherwise model.setStyle does not trigger the change event and the cell state in the view is not updated\n                    const style = setStyleFlag(cell.getClonedStyle(), key, flag, value);\n                    model.setStyle(cell, style);\n                }\n            }\n        });\n    }\n};\n/**\n * Sets or toggles the flag bit for the given key in the cell's style.\n * If the `value` parameter is not set, then the flag is toggled.\n *\n * @param style The style of the Cell.\n * @param key Key of the style to be changed.\n * @param flag Integer for the bit to be changed.\n * @param value Optional boolean value for the given flag.\n */\nexport const setStyleFlag = (style, key, flag, value) => {\n    const v = style[key];\n    if (v === undefined) {\n        style[key] = value === undefined || value ? flag : 0;\n    }\n    else {\n        if (value === undefined) {\n            style[key] = v ^ flag;\n        }\n        else if (value) {\n            style[key] = v | flag;\n        }\n        else {\n            style[key] = v & ~flag;\n        }\n    }\n    return style;\n};\n/**\n * Sets the opacity of the specified DOM node to the given value in %.\n *\n * @param node DOM node to set the opacity for.\n * @param value Opacity in %. Possible values are between 0 and 100.\n */\nexport const setOpacity = (node, value) => {\n    node.style.opacity = String(value / 100);\n};\n/**\n * Returns an {@link Rectangle} with the size (width and height in pixels) of the given string.\n * The string may contain HTML markup.\n * Newlines should be converted to `<br>` before calling this method.\n * The caller is responsible for sanitizing the HTML markup.\n *\n * Example:\n *\n * ```javascript\n * const label = graph.getLabel(cell).replace(/\\n/g, \"<br>\");\n * const size = graph.getSizeForString(label);\n * ```\n *\n * @param text String whose size should be returned.\n * @param fontSize Integer that specifies the font size in pixels. Default is {@link DEFAULT_FONTSIZE}.\n * @param fontFamily String that specifies the name of the font family. Default is {@link DEFAULT_FONTFAMILY}.\n * @param textWidth Optional width for text wrapping.\n * @param fontStyle Optional font style, value generally taken from {@link CellStateStyle.fontStyle}.\n */\nexport const getSizeForString = (text, fontSize = DEFAULT_FONTSIZE, fontFamily = DEFAULT_FONTFAMILY, textWidth = null, fontStyle = null) => {\n    const div = document.createElement('div');\n    // Sets the font size and family\n    div.style.fontFamily = fontFamily;\n    div.style.fontSize = `${Math.round(fontSize)}px`;\n    div.style.lineHeight = `${Math.round(fontSize * LINE_HEIGHT)}px`;\n    // Sets the font style\n    if (fontStyle !== null) {\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.BOLD) && (div.style.fontWeight = 'bold');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.ITALIC) &&\n            (div.style.fontStyle = 'italic');\n        const txtDecor = [];\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.UNDERLINE) && txtDecor.push('underline');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n            txtDecor.push('line-through');\n        txtDecor.length > 0 && (div.style.textDecoration = txtDecor.join(' '));\n    }\n    // Disables block layout and outside wrapping and hides the div\n    div.style.position = 'absolute';\n    div.style.visibility = 'hidden';\n    div.style.display = 'inline-block';\n    if (textWidth !== null) {\n        div.style.width = `${textWidth}px`;\n        div.style.whiteSpace = 'normal';\n    }\n    else {\n        div.style.whiteSpace = 'nowrap';\n    }\n    // Adds the text and inserts into DOM for updating of size\n    div.innerHTML = text;\n    document.body.appendChild(div);\n    // Gets the size and removes from DOM\n    const size = new Rectangle(0, 0, div.offsetWidth, div.offsetHeight);\n    document.body.removeChild(div);\n    return size;\n};\n/**\n * Sorts the given cells according to the order in the cell hierarchy.\n * Ascending is optional and defaults to `true`.\n */\nexport const sortCells = (cells, ascending = true) => {\n    const lookup = new Map();\n    cells.sort((o1, o2) => {\n        let p1 = lookup.get(o1);\n        if (p1 == null) {\n            p1 = CellPath.create(o1).split(CellPath.PATH_SEPARATOR);\n            lookup.set(o1, p1);\n        }\n        let p2 = lookup.get(o2);\n        if (p2 == null) {\n            p2 = CellPath.create(o2).split(CellPath.PATH_SEPARATOR);\n            lookup.set(o2, p2);\n        }\n        const comp = CellPath.compare(p1, p2);\n        return comp == 0 ? 0 : comp > 0 == ascending ? 1 : -1;\n    });\n    return cells;\n};\n/**\n * Returns an {@link Point} that represents the horizontal and vertical alignment for numeric computations.\n *\n * X is -0.5 for center, -1 for right and 0 for left alignment.\n * Y is -0.5 for middle, -1 for bottom and 0 for top alignment.\n *\n * Default values for missing arguments is center and middle.\n */\nexport const getAlignmentAsPoint = (align, valign) => {\n    let dx = -0.5;\n    let dy = -0.5;\n    // Horizontal alignment\n    if (align === 'left') {\n        dx = 0;\n    }\n    else if (align === 'right') {\n        dx = -1;\n    }\n    // Vertical alignment\n    if (valign === 'top') {\n        dy = 0;\n    }\n    else if (valign === 'bottom') {\n        dy = -1;\n    }\n    return new Point(dx, dy);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NODE_TYPE } from './Constants.js';\nimport { getTextContent } from './domUtils.js';\n/**\n * Strips all whitespaces from the beginning of the string. Without the\n * second parameter, this will trim these characters:\n *\n * - \" \" (ASCII 32 (0x20)), an ordinary space\n * - \"\\t\" (ASCII 9 (0x09)), a tab\n * - \"\\n\" (ASCII 10 (0x0A)), a new line (line feed)\n * - \"\\r\" (ASCII 13 (0x0D)), a carriage return\n * - \"\\0\" (ASCII 0 (0x00)), the NUL-byte\n * - \"\\x0B\" (ASCII 11 (0x0B)), a vertical tab\n */\nexport const ltrim = (str, chars = '\\\\s') => str != null ? str.replace(new RegExp(`^[${chars}]+`, 'g'), '') : null;\n/**\n * Strips all whitespaces from the end of the string. Without the second\n * parameter, this will trim these characters:\n *\n * - \" \" (ASCII 32 (0x20)), an ordinary space\n * - \"\\t\" (ASCII 9 (0x09)), a tab\n * - \"\\n\" (ASCII 10 (0x0A)), a new line (line feed)\n * - \"\\r\" (ASCII 13 (0x0D)), a carriage return\n * - \"\\0\" (ASCII 0 (0x00)), the NUL-byte\n * - \"\\x0B\" (ASCII 11 (0x0B)), a vertical tab\n */\nexport const rtrim = (str, chars = '\\\\s') => str != null ? str.replace(new RegExp(`[${chars}]+$`, 'g'), '') : null;\n/**\n * Strips all whitespaces from both end of the string.\n * Without the second parameter, Javascript function will trim these\n * characters:\n *\n * - \" \" (ASCII 32 (0x20)), an ordinary space\n * - \"\\t\" (ASCII 9 (0x09)), a tab\n * - \"\\n\" (ASCII 10 (0x0A)), a new line (line feed)\n * - \"\\r\" (ASCII 13 (0x0D)), a carriage return\n * - \"\\0\" (ASCII 0 (0x00)), the NUL-byte\n * - \"\\x0B\" (ASCII 11 (0x0B)), a vertical tab\n */\nexport const trim = (str, chars) => ltrim(rtrim(str, chars), chars);\n/**\n * Returns the name for the given function.\n *\n * @param f JavaScript object that represents a function.\n */\nexport const getFunctionName = (f) => {\n    let str = null;\n    if (f != null) {\n        if (f.name != null) {\n            str = f.name;\n        }\n        else {\n            str = trim(f.toString());\n            if (str !== null && /^function\\s/.test(str)) {\n                str = ltrim(str.substring(9));\n                if (str !== null) {\n                    const idx2 = str.indexOf('(');\n                    if (idx2 > 0) {\n                        str = str.substring(0, idx2);\n                    }\n                }\n            }\n        }\n    }\n    return str;\n};\n/**\n * Replaces each trailing newline with the given pattern.\n */\nexport const replaceTrailingNewlines = (str, pattern) => {\n    // LATER: Check is this can be done with a regular expression\n    let postfix = '';\n    while (str.length > 0 && str.charAt(str.length - 1) == '\\n') {\n        str = str.substring(0, str.length - 1);\n        postfix += pattern;\n    }\n    return str + postfix;\n};\n/**\n * Removes the sibling text nodes for the given node that only consists\n * of tabs, newlines and spaces.\n *\n * @param node DOM node whose siblings should be removed.\n * @param before Optional boolean that specifies the direction of the traversal.\n */\nexport const removeWhitespace = (node, before) => {\n    let tmp = before ? node.previousSibling : node.nextSibling;\n    while (tmp != null && tmp.nodeType === NODE_TYPE.TEXT) {\n        const next = before ? tmp.previousSibling : tmp.nextSibling;\n        const text = getTextContent(tmp);\n        if (trim(text)?.length === 0) {\n            tmp.parentNode?.removeChild(tmp);\n        }\n        tmp = next;\n    }\n};\n/**\n * Replaces characters (less than, greater than, newlines and quotes) with\n * their HTML entities in the given string and returns the result.\n *\n * @param s String that contains the characters to be converted.\n * @param newline If newlines should be replaced. Default is `true`.\n */\nexport const htmlEntities = (s, newline = true) => {\n    s = String(s || '');\n    s = s.replace(/&/g, '&amp;'); // 38 26\n    s = s.replace(/\"/g, '&quot;'); // 34 22\n    s = s.replace(/'/g, '&#39;'); // 39 27\n    s = s.replace(/</g, '&lt;'); // 60 3C\n    s = s.replace(/>/g, '&gt;'); // 62 3E\n    if (newline) {\n        s = s.replace(/\\n/g, '&#xa;');\n    }\n    return s;\n};\n/**\n * Returns a textual representation of the specified object.\n *\n * @param obj Object to return the string representation for.\n */\nexport const toString = (obj) => {\n    let output = '';\n    for (const i in obj) {\n        try {\n            if (obj[i] == null) {\n                output += `${i} = [null]\\n`;\n            }\n            else if (typeof obj[i] === 'function') {\n                output += `${i} => [Function]\\n`;\n            }\n            else if (typeof obj[i] === 'object') {\n                const ctor = getFunctionName(obj[i].constructor);\n                output += `${i} => [${ctor}]\\n`;\n            }\n            else {\n                output += `${i} = ${obj[i]}\\n`;\n            }\n        }\n        catch (e) {\n            output += `${i}=${e.message}`;\n        }\n    }\n    return output;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { IDENTITY_FIELD_NAME } from './Constants.js';\nimport { getFunctionName } from './StringUtils.js';\n/**\n * Identity for JavaScript objects and functions.\n *\n * This is implemented using a simple incrementing counter which is stored in each object under {@link FIELD_NAME}.\n *\n * The identity for an object does not change during its lifecycle.\n */\nclass ObjectIdentity {\n    /**\n     * Returns the ID for the given object or function.\n     */\n    static get(obj) {\n        if (obj) {\n            if (obj[IDENTITY_FIELD_NAME] === null || obj[IDENTITY_FIELD_NAME] === undefined) {\n                if (typeof obj === 'object') {\n                    const ctor = getFunctionName(obj.constructor);\n                    obj[IDENTITY_FIELD_NAME] = `${ctor}#${ObjectIdentity.counter++}`;\n                }\n                else if (typeof obj === 'function') {\n                    obj[IDENTITY_FIELD_NAME] = `Function#${ObjectIdentity.counter++}`;\n                }\n            }\n            return obj[IDENTITY_FIELD_NAME];\n        }\n        return null;\n    }\n    /**\n     * Deletes the ID from the given object or function.\n     */\n    static clear(obj) {\n        delete obj[IDENTITY_FIELD_NAME];\n    }\n}\n/**\n * Name of the field to be used to store the object ID.\n * @default {@IDENTITY_FIELD_NAME}\n */\nObjectIdentity.FIELD_NAME = IDENTITY_FIELD_NAME;\n/**\n * Current counter.\n */\nObjectIdentity.counter = 0;\nexport default ObjectIdentity;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport ObjectIdentity from './ObjectIdentity.js';\n/**\n * Recursively clones the specified object ignoring all field names in the\n * given array of transient fields. {@link ObjectIdentity#FIELD_NAME} is always\n * ignored by this function.\n *\n * @param obj Object to be cloned.\n * @param transients Optional array of strings representing the fieldname to be\n * ignored.\n * @param shallow Optional boolean argument to specify if a shallow clone should\n * be created, that is, one where all object references are not cloned or,\n * in other words, one where only atomic (strings, numbers) values are\n * cloned. Default is false.\n */\nexport const clone = function _clone(obj, transients = null, shallow = false) {\n    shallow = shallow != null ? shallow : false;\n    let clone = null;\n    if (obj != null && typeof obj.constructor === 'function') {\n        clone = new obj.constructor();\n        for (const i in obj) {\n            if (i != ObjectIdentity.FIELD_NAME &&\n                (transients == null || transients.indexOf(i) < 0)) {\n                if (!shallow && typeof obj[i] === 'object') {\n                    clone[i] = _clone(obj[i]);\n                }\n                else {\n                    clone[i] = obj[i];\n                }\n            }\n        }\n    }\n    return clone;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { clone } from '../../util/cloneUtils.js';\nimport Point from '../geometry/Point.js';\nimport CellPath from './CellPath.js';\nimport { isElement, isNullish } from '../../internal/utils.js';\n/**\n * Cells are the elements of the graph model. They represent the state\n * of the groups, vertices and edges in a graph.\n *\n * ### Custom attributes\n * For custom attributes we recommend using an XML node as the value of a cell.\n * The following code can be used to create a cell with an XML node as the value:\n * ```javascript\n * const doc = xmlUtils.createXmlDocument();\n * const node = doc.createElement('MyNode')\n * node.setAttribute('label', 'MyLabel');\n * node.setAttribute('attribute1', 'value1');\n * graph.insertVertex({parent: graph.getDefaultParent(), value: node, position: [40, 40], size: [80, 30]});\n * ```\n *\n * For the label to work, {@link AbstractGraph.convertValueToString} and\n * {@link AbstractGraph.cellLabelChanged} should be overridden as follows:\n *\n * ```javascript\n * graph.convertValueToString(cell) {\n *   if (domUtils.isNode(cell.value)) {\n *     return cell.getAttribute('label', '')\n *   }\n * };\n *\n * const cellLabelChanged = graph.cellLabelChanged;\n * graph.cellLabelChanged(cell, newValue, autoSize) {\n *   if (domUtils.isNode(cell.value)) {\n *     // Clones the value for correct undo/redo\n *     const elt = cell.value.cloneNode(true);\n *     elt.setAttribute('label', newValue);\n *     newValue = elt;\n *   }\n *\n *   cellLabelChanged.apply(this, arguments);\n * };\n * ```\n */\nexport class Cell {\n    constructor(value = null, geometry = null, style = {}) {\n        // TODO: Document me!\n        // used by invalidate() of GraphView\n        this.invalidating = false;\n        this.onInit = null;\n        // used by addCellOverlay() of mxGraph\n        this.overlays = [];\n        /**\n         * Holds the identifier of the Cell.\n         * @default null\n         */\n        this.id = null;\n        /**\n         * Holds the user object.\n         * @default null\n         */\n        this.value = null;\n        /**\n         * Holds the {@link Geometry}.\n         * @default null\n         */\n        this.geometry = null;\n        /**\n         * Holds the style of the Cell.\n         * @default {}\n         */\n        this.style = {};\n        /**\n         * Specifies whether the cell is a vertex.\n         * @default false\n         */\n        this.vertex = false;\n        /**\n         * Specifies whether the cell is an edge.\n         * @default false\n         */\n        this.edge = false;\n        /**\n         * Specifies whether the cell is connectable.\n         * @default true\n         */\n        this.connectable = true;\n        /**\n         * Specifies whether the cell is visible.\n         * @default true\n         */\n        this.visible = true;\n        /**\n         * Specifies whether the cell is collapsed.\n         * @default false\n         */\n        this.collapsed = false;\n        /**\n         * Reference to the parent cell.\n         * @default null\n         */\n        this.parent = null;\n        /**\n         * Reference to the source terminal.\n         * @default null\n         */\n        this.source = null;\n        /**\n         * Reference to the target terminal.\n         * @default null\n         */\n        this.target = null;\n        /**\n         * Holds the child cells.\n         * @default []\n         */\n        this.children = [];\n        /**\n         * Holds the edges.\n         * @default []\n         */\n        this.edges = [];\n        /**\n         * List of members that should not be cloned inside {@link clone}. This field is\n         * passed to {@link utils.clone} and is not made persistent in {@link CellCodec}.\n         * This is not a convention for all classes, it is only used in this class\n         * to mark transient fields since transient modifiers are not supported by\n         * the language.\n         */\n        this.mxTransient = [\n            'id',\n            'value',\n            'parent',\n            'source',\n            'target',\n            'children',\n            'edges',\n        ];\n        this.value = value;\n        this.setGeometry(geometry);\n        this.setStyle(style);\n        if (this.onInit) {\n            this.onInit();\n        }\n    }\n    // TODO: Document me!!!\n    getChildren() {\n        return this.children || [];\n    }\n    /**\n     * Returns the Id of the cell as a string.\n     */\n    getId() {\n        return this.id;\n    }\n    /**\n     * Sets the Id of the cell to the given string.\n     */\n    setId(id) {\n        this.id = id;\n    }\n    /**\n     * Returns the user object of the cell. The user\n     * object is stored in <value>.\n     */\n    getValue() {\n        return this.value;\n    }\n    /**\n     * Sets the user object of the cell. The user object\n     * is stored in <value>.\n     */\n    setValue(value) {\n        this.value = value;\n    }\n    /**\n     * Changes the user object after an in-place edit\n     * and returns the previous value. This implementation\n     * replaces the user object with the given value and\n     * returns the old user object.\n     */\n    valueChanged(newValue) {\n        const previous = this.getValue();\n        this.setValue(newValue);\n        return previous;\n    }\n    /**\n     * Returns the {@link Geometry} that describes the <geometry>.\n     */\n    getGeometry() {\n        return this.geometry;\n    }\n    /**\n     * Sets the {@link Geometry} to be used as the <geometry>.\n     */\n    setGeometry(geometry) {\n        this.geometry = geometry;\n    }\n    /**\n     * Returns a string that describes the {@link style}.\n     *\n     * **IMPORTANT**: if you want to get the style object to later update it and propagate changes to the view, use {@link getClonedStyle} instead.\n     */\n    getStyle() {\n        return this.style;\n    }\n    /**\n     * Use this method to get the style object to later update it and propagate changes to the view.\n     *\n     * See {@link GraphDataModel.setStyle} for more details.\n     */\n    getClonedStyle() {\n        return clone(this.getStyle());\n    }\n    /**\n     * Sets the string to be used as the {@link style}.\n     */\n    setStyle(style) {\n        this.style = style;\n    }\n    /**\n     * Returns true if the cell is a vertex.\n     */\n    isVertex() {\n        return this.vertex;\n    }\n    /**\n     * Specifies if the cell is a vertex. This should only be assigned at\n     * construction of the cell and not be changed during its lifecycle.\n     *\n     * @param vertex Boolean that specifies if the cell is a vertex.\n     */\n    setVertex(vertex) {\n        this.vertex = vertex;\n    }\n    /**\n     * Returns true if the cell is an edge.\n     */\n    isEdge() {\n        return this.edge;\n    }\n    /**\n     * Specifies if the cell is an edge. This should only be assigned at\n     * construction of the cell and not be changed during its lifecycle.\n     *\n     * @param edge Boolean that specifies if the cell is an edge.\n     */\n    setEdge(edge) {\n        this.edge = edge;\n    }\n    /**\n     * Returns true if the cell is connectable.\n     */\n    isConnectable() {\n        return this.connectable;\n    }\n    /**\n     * Sets the connectable state.\n     *\n     * @param connectable Boolean that specifies the new connectable state.\n     */\n    setConnectable(connectable) {\n        this.connectable = connectable;\n    }\n    /**\n     * Returns true if the cell is visibile.\n     */\n    isVisible() {\n        return this.visible;\n    }\n    /**\n     * Specifies if the cell is visible.\n     *\n     * @param visible Boolean that specifies the new visible state.\n     */\n    setVisible(visible) {\n        this.visible = visible;\n    }\n    /**\n     * Returns true if the cell is collapsed.\n     */\n    isCollapsed() {\n        return this.collapsed;\n    }\n    /**\n     * Sets the collapsed state.\n     *\n     * @param collapsed Boolean that specifies the new collapsed state.\n     */\n    setCollapsed(collapsed) {\n        this.collapsed = collapsed;\n    }\n    /**\n     * Returns the cell's parent.\n     */\n    getParent() {\n        return this.parent;\n    }\n    /**\n     * Sets the parent cell.\n     *\n     * @param parent<Cell> that represents the new parent.\n     */\n    setParent(parent) {\n        this.parent = parent;\n    }\n    /**\n     * Returns the source or target terminal.\n     *\n     * @param source Boolean that specifies if the source terminal should be\n     * returned.\n     */\n    getTerminal(source = false) {\n        return source ? this.source : this.target;\n    }\n    /**\n     * Sets the source or target terminal and returns the new terminal.\n     *\n     * @param terminal  Cell that represents the new source or target terminal.\n     * @param isSource  boolean that specifies if the source or target terminal should be set.\n     */\n    setTerminal(terminal, isSource) {\n        if (isSource) {\n            this.source = terminal;\n        }\n        else {\n            this.target = terminal;\n        }\n        return terminal;\n    }\n    /**\n     * Returns the number of child cells.\n     */\n    getChildCount() {\n        return this.children.length;\n    }\n    /**\n     * Returns the index of the specified child in the child array.\n     *\n     * @param child Child whose index should be returned.\n     */\n    getIndex(child) {\n        if (child === null)\n            return -1;\n        return this.children.indexOf(child);\n    }\n    /**\n     * Returns the child at the specified index.\n     *\n     * @param index Integer that specifies the child to be returned.\n     */\n    getChildAt(index) {\n        return this.children[index];\n    }\n    /**\n     * Inserts the specified child into the child array at the specified index and updates the parent reference of the child.\n     * If not index is specified, then the child is appended to the child array.\n     * Returns the inserted child.\n     *\n     * @param child {@link Cell} to be inserted or appended to the child array.\n     * @param index Optional integer that specifies the index at which the child should be inserted into the child array.\n     */\n    insert(child, index) {\n        if (index === undefined) {\n            index = this.getChildCount();\n            if (child.getParent() === this) {\n                index--;\n            }\n        }\n        child.removeFromParent();\n        child.setParent(this);\n        this.children.splice(index, 0, child);\n        return child;\n    }\n    /**\n     * Removes the child at the specified index from the child array and returns the child that was removed.\n     * Will remove the parent reference of the child.\n     *\n     * @param index Integer that specifies the index of the child to be removed.\n     */\n    remove(index) {\n        let child = null;\n        if (index >= 0) {\n            child = this.getChildAt(index);\n            if (child) {\n                this.children.splice(index, 1);\n                child.setParent(null);\n            }\n        }\n        return child;\n    }\n    /**\n     * Removes the cell from its parent.\n     */\n    removeFromParent() {\n        if (this.parent) {\n            const index = this.parent.getIndex(this);\n            this.parent.remove(index);\n        }\n    }\n    /**\n     * Returns the number of edges in the edge array.\n     */\n    getEdgeCount() {\n        return this.edges.length;\n    }\n    /**\n     * Returns the index of the specified edge in {@link edges}.\n     *\n     * @param edge {@link Cell} whose index in {@link edges} should be returned.\n     */\n    getEdgeIndex(edge) {\n        return this.edges.indexOf(edge);\n    }\n    /**\n     * Returns the edge at the specified index in {@link edges}.\n     *\n     * @param index Integer that specifies the index of the edge to be returned.\n     */\n    getEdgeAt(index) {\n        return this.edges[index];\n    }\n    /**\n     * Inserts the specified edge into the edge array and returns the edge.\n     * Will update the respective terminal reference of the edge.\n     *\n     * @param edge {@link Cell} to be inserted into the edge array.\n     * @param isOutgoing Boolean that specifies if the edge is outgoing.\n     */\n    insertEdge(edge, isOutgoing = false) {\n        edge.removeFromTerminal(isOutgoing);\n        edge.setTerminal(this, isOutgoing);\n        if (this.edges.length === 0 ||\n            edge.getTerminal(!isOutgoing) !== this ||\n            this.edges.indexOf(edge) < 0) {\n            this.edges.push(edge);\n        }\n        return edge;\n    }\n    /**\n     * Removes the specified edge from the edge array and returns the edge.\n     * Will remove the respective terminal reference from the edge.\n     *\n     * @param edge {@link Cell} to be removed from the edge array.\n     * @param isOutgoing Boolean that specifies if the edge is outgoing.\n     */\n    removeEdge(edge, isOutgoing = false) {\n        if (edge != null) {\n            if (edge.getTerminal(!isOutgoing) !== this && this.edges != null) {\n                const index = this.getEdgeIndex(edge);\n                if (index >= 0) {\n                    this.edges.splice(index, 1);\n                }\n            }\n            edge.setTerminal(null, isOutgoing);\n        }\n        return edge;\n    }\n    /**\n     * Removes the edge from its source or target terminal.\n     *\n     * @param isSource Boolean that specifies if the edge should be removed from its source or target terminal.\n     */\n    removeFromTerminal(isSource) {\n        const terminal = this.getTerminal(isSource);\n        if (terminal) {\n            terminal.removeEdge(this, isSource);\n        }\n    }\n    /**\n     * Returns true if the user object is an XML node that contains the given attribute.\n     *\n     * @param name Name nameName of the attribute.\n     */\n    hasAttribute(name) {\n        const userObject = this.getValue();\n        return isElement(userObject) && userObject.hasAttribute\n            ? userObject.hasAttribute(name)\n            : !isNullish(userObject.getAttribute?.(name));\n    }\n    /**\n     * Returns the specified attribute from the user object if it is an XML node.\n     *\n     * @param name Name of the attribute whose value should be returned.\n     * @param defaultValue Optional default value to use if the attribute has no\n     * value.\n     */\n    getAttribute(name, defaultValue) {\n        const userObject = this.getValue();\n        const val = isElement(userObject) ? userObject.getAttribute?.(name) : null;\n        return val ?? defaultValue;\n    }\n    /**\n     * Sets the specified attribute on the user object if it is an XML node.\n     *\n     * @param name Name of the attribute whose value should be set.\n     * @param value New value of the attribute.\n     */\n    setAttribute(name, value) {\n        const userObject = this.getValue();\n        if (isElement(userObject)) {\n            userObject.setAttribute?.(name, value);\n        }\n    }\n    /**\n     * Returns a clone of the cell.\n     *\n     * Uses {@link cloneValue} to clone the user object.\n     *\n     * All fields in {@link mxTransient} are ignored during the cloning.\n     */\n    clone() {\n        const c = clone(this, this.mxTransient);\n        c.setValue(this.cloneValue());\n        return c;\n    }\n    /**\n     * Returns a clone of the cell's user object.\n     */\n    cloneValue() {\n        let value = this.getValue();\n        if (!isNullish(value)) {\n            if (typeof value.clone === 'function') {\n                value = value.clone();\n            }\n            else if (!isNullish(value.nodeType) && value.cloneNode) {\n                value = value.cloneNode(true);\n            }\n        }\n        return value;\n    }\n    /**\n     * Returns the nearest common ancestor for the specified cells to `this`.\n     *\n     * @param {Cell} cell2 that specifies the second cell in the tree.\n     */\n    getNearestCommonAncestor(cell2) {\n        // Creates the cell path for the second cell\n        let path = CellPath.create(cell2);\n        if (path.length > 0) {\n            // Bubbles through the ancestors of the first cell to find the nearest common ancestor.\n            // eslint-disable-next-line @typescript-eslint/no-this-alias -- we need to use `this` to refer to the instance to start processing\n            let cell = this;\n            let current = CellPath.create(cell);\n            // Inverts arguments\n            if (path.length < current.length) {\n                cell = cell2;\n                const tmp = current;\n                current = path;\n                path = tmp;\n            }\n            while (cell && current) {\n                const parent = cell.getParent();\n                // Checks if the cell path is equal to the beginning of the given cell path\n                if (path.indexOf(current + CellPath.PATH_SEPARATOR) === 0 && parent) {\n                    return cell;\n                }\n                current = CellPath.getParentPath(current);\n                cell = parent;\n            }\n        }\n        return null;\n    }\n    /**\n     * Returns true if the given parent is an ancestor of the given child. Note\n     * returns true if child == parent.\n     *\n     * @param {Cell} child  that specifies the child.\n     */\n    isAncestor(child) {\n        while (child && child !== this) {\n            child = child.getParent();\n        }\n        return child === this;\n    }\n    /**\n     * Returns the child vertices of the given parent.\n     */\n    getChildVertices() {\n        return this.getChildCells(true, false);\n    }\n    /**\n     * Returns the child edges of the given parent.\n     */\n    getChildEdges() {\n        return this.getChildCells(false, true);\n    }\n    /**\n     * Returns the children of the given cell that are vertices and/or edges\n     * depending on the arguments.\n     *\n     * @param vertices  Boolean indicating if child vertices should be returned.\n     * Default is false.\n     * @param edges  Boolean indicating if child edges should be returned.\n     * Default is false.\n     */\n    getChildCells(vertices = false, edges = false) {\n        const childCount = this.getChildCount();\n        const result = [];\n        for (let i = 0; i < childCount; i += 1) {\n            const child = this.getChildAt(i);\n            if ((!edges && !vertices) ||\n                (edges && child.isEdge()) ||\n                (vertices && child.isVertex())) {\n                result.push(child);\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns the number of incoming or outgoing edges, ignoring the given\n     * edge.\n     *\n     * @param outgoing  Boolean that specifies if the number of outgoing or\n     * incoming edges should be returned.\n     * @param {Cell} ignoredEdge  that represents an edge to be ignored.\n     */\n    getDirectedEdgeCount(outgoing, ignoredEdge = null) {\n        let count = 0;\n        const edgeCount = this.getEdgeCount();\n        for (let i = 0; i < edgeCount; i += 1) {\n            const edge = this.getEdgeAt(i);\n            if (edge !== ignoredEdge && edge && edge.getTerminal(outgoing) === this) {\n                count += 1;\n            }\n        }\n        return count;\n    }\n    /**\n     * Returns all edges of the given cell without loops.\n     */\n    getConnections() {\n        return this.getEdges(true, true, false);\n    }\n    /**\n     * Returns the incoming edges of the given cell without loops.\n     */\n    getIncomingEdges() {\n        return this.getEdges(true, false, false);\n    }\n    /**\n     * Returns the outgoing edges of the given cell without loops.\n     */\n    getOutgoingEdges() {\n        return this.getEdges(false, true, false);\n    }\n    /**\n     * Returns all distinct edges connected to this cell as a new array of\n     * {@link Cell}. If at least one of incoming or outgoing is true, then loops\n     * are ignored, otherwise if both are false, then all edges connected to\n     * the given cell are returned including loops.\n     *\n     * @param incoming  Optional boolean that specifies if incoming edges should be\n     * returned. Default is true.\n     * @param outgoing  Optional boolean that specifies if outgoing edges should be\n     * returned. Default is true.\n     * @param includeLoops  Optional boolean that specifies if loops should be returned.\n     * Default is true.\n     */\n    getEdges(incoming = true, outgoing = true, includeLoops = true) {\n        const edgeCount = this.getEdgeCount();\n        const result = [];\n        for (let i = 0; i < edgeCount; i += 1) {\n            const edge = this.getEdgeAt(i);\n            const source = edge.getTerminal(true);\n            const target = edge.getTerminal(false);\n            if ((includeLoops && source === target) ||\n                (source !== target &&\n                    ((incoming && target === this) || (outgoing && source === this)))) {\n                result.push(edge);\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns the absolute, accumulated origin for the children inside the\n     * given parent as an {@link Point}.\n     */\n    getOrigin() {\n        let result = new Point();\n        const parent = this.getParent();\n        if (parent) {\n            result = parent.getOrigin();\n            if (!this.isEdge()) {\n                const geo = this.getGeometry();\n                if (geo) {\n                    result.x += geo.x;\n                    result.y += geo.y;\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns all descendants of the given cell and the cell itself in an array.\n     */\n    getDescendants() {\n        return this.filterDescendants(null);\n    }\n    /**\n     * Visits all cells recursively and applies the specified filter function\n     * to each cell. If the function returns true then the cell is added\n     * to the resulting array. The parent and result paramters are optional.\n     * If parent is not specified then the recursion starts at {@link root}.\n     *\n     * Example:\n     * The following example extracts all vertices from a given model:\n     * ```javascript\n     * var filter(cell)\n     * {\n     * \treturn model.isVertex(cell);\n     * }\n     * var vertices = model.filterDescendants(filter);\n     * ```\n     *\n     * @param filter  JavaScript function that takes an {@link Cell} as an argument\n     * and returns a boolean.\n     */\n    filterDescendants(filter) {\n        // Creates a new array for storing the result\n        let result = [];\n        // Checks if the filter returns true for the cell\n        // and adds it to the result array\n        if (filter === null || filter(this)) {\n            result.push(this);\n        }\n        // Visits the children of the cell\n        const childCount = this.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = this.getChildAt(i);\n            result = result.concat(child.filterDescendants(filter));\n        }\n        return result;\n    }\n    /**\n     * Returns the root of the model or the topmost parent of the given cell.\n     */\n    getRoot() {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias -- we need to use `this` to refer to the instance to start processing\n        let cell = this;\n        let root = cell;\n        while (cell) {\n            root = cell;\n            cell = cell.getParent();\n        }\n        return root;\n    }\n}\nexport default Cell;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to add or remove a child in a model.\n *\n * @category Change\n */\nexport class ChildChange {\n    constructor(model, parent, child, index = 0) {\n        this.model = model;\n        this.parent = parent;\n        this.previous = parent;\n        this.child = child;\n        this.index = index;\n        this.previousIndex = index;\n    }\n    /**\n     * Changes the parent of {@link child} using {@link GraphDataModel.parentForCellChanged} and removes or restores the cell's connections.\n     */\n    execute() {\n        let tmp = this.child.getParent();\n        const tmp2 = tmp ? tmp.getIndex(this.child) : 0;\n        if (!this.previous) {\n            this.connect(this.child, false);\n        }\n        tmp = this.model.parentForCellChanged(this.child, this.previous, this.previousIndex);\n        if (this.previous) {\n            this.connect(this.child, true);\n        }\n        this.parent = this.previous;\n        this.previous = tmp;\n        this.index = this.previousIndex;\n        this.previousIndex = tmp2;\n    }\n    /**\n     * Connects the source and the target of the given cell.\n     *\n     * If {@link isConnect} is true, the source and target terminals are referenced  as such in the model. Otherwise, they are removed.\n     */\n    connect(cell, isConnect = true) {\n        const source = cell.getTerminal(true);\n        const target = cell.getTerminal(false);\n        if (source) {\n            if (isConnect) {\n                this.model.terminalForCellChanged(cell, source, true);\n            }\n            else {\n                this.model.terminalForCellChanged(cell, null, true);\n            }\n        }\n        if (target) {\n            if (isConnect) {\n                this.model.terminalForCellChanged(cell, target, false);\n            }\n            else {\n                this.model.terminalForCellChanged(cell, null, false);\n            }\n        }\n        cell.setTerminal(source, true);\n        cell.setTerminal(target, false);\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            this.connect(cell.getChildAt(i), isConnect);\n        }\n    }\n}\nexport default ChildChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a cell's geometry in a model.\n *\n * @category Change\n */\nclass GeometryChange {\n    constructor(model, cell, geometry) {\n        this.model = model;\n        this.cell = cell;\n        this.geometry = geometry;\n        this.previous = geometry;\n    }\n    /**\n     * Changes the geometry of {@link cell} to {@link previous} using{@link GraphDataModel.geometryForCellChanged}.\n     */\n    execute() {\n        this.geometry = this.previous;\n        this.previous = this.model.geometryForCellChanged(this.cell, this.previous);\n    }\n}\nexport default GeometryChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change the root in a model.\n *\n * @category Change\n */\nexport class RootChange {\n    constructor(model, root) {\n        this.model = model;\n        this.root = root;\n        this.previous = root;\n    }\n    /**\n     * Carries out a change of the root using {@link GraphDataModel.rootChanged}.\n     */\n    execute() {\n        this.root = this.previous;\n        this.previous = this.model.rootChanged(this.previous);\n    }\n}\nexport default RootChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a cell's style in a model.\n *\n * @category Change\n */\nclass StyleChange {\n    constructor(model, cell, style) {\n        this.model = model;\n        this.cell = cell;\n        this.style = style;\n        this.previous = style;\n    }\n    /**\n     * Changes the style of {@link cell} to {@link previous} using {@link GraphDataModel.styleForCellChanged}.\n     */\n    execute() {\n        this.style = this.previous;\n        this.previous = this.model.styleForCellChanged(this.cell, this.previous);\n    }\n}\nexport default StyleChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a terminal in a model.\n *\n * @category Change\n */\nexport class TerminalChange {\n    constructor(model, cell, terminal, source) {\n        this.model = model;\n        this.cell = cell;\n        this.terminal = terminal;\n        this.previous = terminal;\n        this.source = source;\n    }\n    /**\n     * Changes the terminal of {@link cell} to {@link previous} using {@link GraphDataModel.terminalForCellChanged}.\n     */\n    execute() {\n        this.terminal = this.previous;\n        this.previous = this.model.terminalForCellChanged(this.cell, this.previous, this.source);\n    }\n}\nexport default TerminalChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a user object in a model.\n *\n * @category Change\n */\nclass ValueChange {\n    constructor(model, cell, value) {\n        this.model = model;\n        this.cell = cell;\n        this.value = value;\n        this.previous = value;\n    }\n    /**\n     * Changes the value of {@link cell} to {@link previous} using {@link GraphDataModel.valueForCellChanged}.\n     */\n    execute() {\n        this.value = this.previous;\n        this.previous = this.model.valueForCellChanged(this.cell, this.previous);\n    }\n}\nexport default ValueChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../geometry/Point.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { NONE } from '../../util/Constants.js';\n/**\n * Represents the current state of a cell in a given {@link GraphView}.\n *\n * For edges, the edge label position is stored in {@link absoluteOffset}.\n *\n * The size for oversize labels can be retrieved using the `boundingBox` property of the {@link text} field as shown below.\n *\n * ```javascript\n * const bbox = state.text?.boundingBox ?? null;\n * ```\n */\nclass CellState extends Rectangle {\n    /**\n     * Constructs a new object that represents the current state of the given Cell in the specified view.\n     *\n     * @param view {@link GraphView} that contains the state.\n     * @param cell {@link Cell} that this state represents.\n     * @param style the style of the Cell.\n     */\n    constructor(view = null, cell = null, style = null) {\n        super();\n        // referenced in CellRenderer\n        this.node = null;\n        // TODO: Document me!!\n        this.cellBounds = null;\n        this.paintBounds = null;\n        this.boundingBox = null;\n        // Used by CellRenderer.createControl\n        this.control = null;\n        // Used by CellRenderer.createCellOverlays\n        this.overlays = new Map();\n        /**\n         * Specifies if the style is invalid.\n         * @default false\n         */\n        this.invalidStyle = false;\n        /**\n         * Specifies if the state is invalid.\n         * @default true\n         */\n        this.invalid = true;\n        /**\n         * Holds an array of {@link Point} that represent the absolute points of an edge.\n         */\n        this.absolutePoints = [];\n        /**\n         * Caches the visible source terminal state.\n         */\n        this.visibleSourceState = null;\n        /**\n         * Caches the visible target terminal state.\n         */\n        this.visibleTargetState = null;\n        /**\n         * Caches the distance between the end points for an edge.\n         */\n        this.terminalDistance = 0;\n        /**\n         * Caches the length of an edge.\n         */\n        this.length = 0;\n        /**\n         * Array of numbers that represent the cached length of each segment of the edge.\n         */\n        this.segments = [];\n        /**\n         * Holds the {@link Shape} that represents the cell graphically.\n         */\n        this.shape = null;\n        /**\n         * Holds the {@link Text} that represents the label of the cell.\n         * This may be `null` if the cell has no label.\n         */\n        this.text = null;\n        /**\n         * Holds the unscaled width of the state.\n         */\n        this.unscaledWidth = 0;\n        /**\n         * Holds the unscaled height of the state.\n         */\n        this.unscaledHeight = 0;\n        this.parentHighlight = null;\n        this.point = null;\n        if (view) {\n            this.view = view;\n        }\n        if (cell) {\n            this.cell = cell;\n        }\n        this.style = style ?? {};\n        this.origin = new Point();\n        this.absoluteOffset = new Point();\n    }\n    /**\n     * Returns the {@link Rectangle} that should be used as the perimeter of the cell.\n     *\n     * @param border Optional border to be added around the perimeter bounds.\n     * @param bounds Optional {@link Rectangle} to be used as the initial bounds.\n     */\n    getPerimeterBounds(border = 0, bounds = new Rectangle(this.x, this.y, this.width, this.height)) {\n        if (this.shape?.stencil?.aspect === 'fixed') {\n            const aspect = this.shape.stencil.computeAspect(this.shape, bounds.x, bounds.y, bounds.width, bounds.height);\n            bounds.x = aspect.x;\n            bounds.y = aspect.y;\n            bounds.width = this.shape.stencil.w0 * aspect.width;\n            bounds.height = this.shape.stencil.h0 * aspect.height;\n        }\n        if (border !== 0) {\n            bounds.grow(border);\n        }\n        return bounds;\n    }\n    /**\n     * Sets the first or last point in <absolutePoints> depending on isSource.\n     *\n     * @param point {@link Point} that represents the terminal point.\n     * @param isSource Boolean that specifies if the first or last point should be assigned.\n     */\n    setAbsoluteTerminalPoint(point, isSource = false) {\n        if (isSource) {\n            if (this.absolutePoints.length === 0) {\n                this.absolutePoints.push(point);\n            }\n            else {\n                this.absolutePoints[0] = point;\n            }\n        }\n        else if (this.absolutePoints.length === 0) {\n            this.absolutePoints.push(null);\n            this.absolutePoints.push(point);\n        }\n        else if (this.absolutePoints.length === 1) {\n            this.absolutePoints.push(point);\n        }\n        else {\n            this.absolutePoints[this.absolutePoints.length - 1] = point;\n        }\n    }\n    /**\n     * Sets the given cursor on the shape and text shape.\n     */\n    setCursor(cursor) {\n        if (this.shape) {\n            this.shape.setCursor(cursor);\n        }\n        if (this.text) {\n            this.text.setCursor(cursor);\n        }\n    }\n    /**\n     * Returns the visible source or target terminal cell.\n     *\n     * @param source Boolean that specifies if the source or target cell should be returned.\n     */\n    getVisibleTerminal(source = false) {\n        return this.getVisibleTerminalState(source)?.cell ?? null;\n    }\n    /**\n     * Returns the visible source or target terminal state.\n     *\n     * @param source Boolean that specifies if the source or target state should be returned.\n     */\n    getVisibleTerminalState(source = false) {\n        return source ? this.visibleSourceState : this.visibleTargetState;\n    }\n    /**\n     * Sets the visible source or target terminal state.\n     *\n     * @param terminalState {@link CellState} that represents the terminal.\n     * @param source Boolean that specifies if the source or target state should be set.\n     */\n    setVisibleTerminalState(terminalState, source = false) {\n        if (source) {\n            this.visibleSourceState = terminalState;\n        }\n        else {\n            this.visibleTargetState = terminalState;\n        }\n    }\n    /**\n     * Returns the unscaled, untranslated bounds.\n     */\n    getCellBounds() {\n        return this.cellBounds;\n    }\n    /**\n     * Returns the unscaled, untranslated paint bounds.\n     *\n     * This is the same as {@link getCellBounds} but with a 90-degrees rotation if the  {@link Shape.isPaintBoundsInverted} returns `true`.\n     */\n    getPaintBounds() {\n        return this.paintBounds;\n    }\n    /**\n     * Updates the {@link cellBounds} and {@link paintBounds}.\n     */\n    updateCachedBounds() {\n        const view = this.view;\n        const tr = view.translate;\n        const s = view.scale;\n        this.cellBounds = new Rectangle(this.x / s - tr.x, this.y / s - tr.y, this.width / s, this.height / s);\n        this.paintBounds = Rectangle.fromRectangle(this.cellBounds);\n        if (this.shape && this.shape.isPaintBoundsInverted()) {\n            this.paintBounds.rotate90();\n        }\n    }\n    /**\n     * Copies all fields from the given state to this state.\n     */\n    setState(state) {\n        this.view = state.view;\n        this.cell = state.cell;\n        this.style = state.style;\n        this.absolutePoints = state.absolutePoints;\n        this.origin = state.origin;\n        this.absoluteOffset = state.absoluteOffset;\n        this.boundingBox = state.boundingBox;\n        this.terminalDistance = state.terminalDistance;\n        this.segments = state.segments;\n        this.length = state.length;\n        this.x = state.x;\n        this.y = state.y;\n        this.width = state.width;\n        this.height = state.height;\n        this.unscaledWidth = state.unscaledWidth;\n        this.unscaledHeight = state.unscaledHeight;\n    }\n    /**\n     * Returns a clone of this {@link Point}.\n     */\n    clone() {\n        const clone = new CellState(this.view, this.cell, this.style);\n        // Clones the absolute points\n        for (let i = 0; i < this.absolutePoints.length; i += 1) {\n            const p = this.absolutePoints[i];\n            clone.absolutePoints[i] = p ? p.clone() : null;\n        }\n        if (this.origin) {\n            clone.origin = this.origin.clone();\n        }\n        if (this.absoluteOffset) {\n            clone.absoluteOffset = this.absoluteOffset.clone();\n        }\n        if (this.boundingBox) {\n            clone.boundingBox = this.boundingBox.clone();\n        }\n        clone.terminalDistance = this.terminalDistance;\n        clone.segments = this.segments;\n        clone.length = this.length;\n        clone.x = this.x;\n        clone.y = this.y;\n        clone.width = this.width;\n        clone.height = this.height;\n        clone.unscaledWidth = this.unscaledWidth;\n        clone.unscaledHeight = this.unscaledHeight;\n        return clone;\n    }\n    /**\n     * Destroys the state and all associated resources.\n     */\n    destroy() {\n        this.view.graph.cellRenderer.destroy(this);\n    }\n    /**\n     * Returns `true` if the given cell state is a loop.\n     *\n     * @param state {@link CellState} that represents a potential loop.\n     */\n    isLoop(state) {\n        const src = this.getVisibleTerminalState(true);\n        return src && src === this.getVisibleTerminalState(false);\n    }\n    /*****************************************************************************\n     * Group: Graph appearance\n     *****************************************************************************/\n    /**\n     * Returns the vertical alignment for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.verticalAlign}\n     * property of {@link style}.\n     */\n    getVerticalAlign() {\n        return this.style.verticalAlign ?? 'middle';\n    }\n    /**\n     * Returns `true` if the given state has no stroke, no fill color and no image.\n     */\n    isTransparentState() {\n        return ((this.style.strokeColor ?? NONE) === NONE &&\n            (this.style.fillColor ?? NONE) === NONE &&\n            !this.getImageSrc());\n    }\n    /**\n     * Returns the image URL for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.image} property\n     * of {@link style}.\n     */\n    getImageSrc() {\n        return this.style.image || null;\n    }\n    /**\n     * Returns the indicator color for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.indicatorColor}\n     * property of {@link style}.\n     */\n    getIndicatorColor() {\n        return this.style.indicatorColor || null;\n    }\n    /**\n     * Returns the indicator gradient color for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.gradientColor}\n     * property of {@link style}.\n     */\n    getIndicatorGradientColor() {\n        return this.style.gradientColor || null;\n    }\n    /**\n     * Returns the indicator shape for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.indicatorShape}\n     * property of {@link style}.\n     */\n    getIndicatorShape() {\n        return this.style.indicatorShape || null;\n    }\n    /**\n     * Returns the indicator image for the given cell state.\n     * This implementation returns the value stored in the {@link CellStateStyle.indicatorImage}\n     * property of {@link style}.\n     */\n    getIndicatorImageSrc() {\n        return this.style.indicatorImage || null;\n    }\n}\nexport default CellState;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { DIRECTION_MASK } from './Constants.js';\nimport Point from '../view/geometry/Point.js';\nimport Rectangle from '../view/geometry/Rectangle.js';\nimport { isNullish } from '../internal/utils.js';\n/**\n * Converts the given degree to radians.\n */\nexport const toRadians = (deg) => {\n    return (Math.PI * deg) / 180;\n};\n/**\n * Converts the given radians to degree.\n */\nexport const toDegree = (rad) => {\n    return (rad * 180) / Math.PI;\n};\n/**\n * Converts the given arc to a series of curves.\n */\nexport const arcToCurves = (x0, y0, r1, r2, angle, largeArcFlag, sweepFlag, x, y) => {\n    x -= x0;\n    y -= y0;\n    if (r1 === 0 || r2 === 0) {\n        return [];\n    }\n    const fS = sweepFlag;\n    const psai = angle;\n    r1 = Math.abs(r1);\n    r2 = Math.abs(r2);\n    const ctx = -x / 2;\n    const cty = -y / 2;\n    const cpsi = Math.cos((psai * Math.PI) / 180);\n    const spsi = Math.sin((psai * Math.PI) / 180);\n    const rxd = cpsi * ctx + spsi * cty;\n    const ryd = -1 * spsi * ctx + cpsi * cty;\n    const rxdd = rxd * rxd;\n    const rydd = ryd * ryd;\n    const r1x = r1 * r1;\n    const r2y = r2 * r2;\n    const lamda = rxdd / r1x + rydd / r2y;\n    let sds;\n    if (lamda > 1) {\n        r1 = Math.sqrt(lamda) * r1;\n        r2 = Math.sqrt(lamda) * r2;\n        sds = 0;\n    }\n    else {\n        let seif = 1;\n        if (largeArcFlag === fS) {\n            seif = -1;\n        }\n        sds =\n            seif * Math.sqrt((r1x * r2y - r1x * rydd - r2y * rxdd) / (r1x * rydd + r2y * rxdd));\n    }\n    const txd = (sds * r1 * ryd) / r2;\n    const tyd = (-1 * sds * r2 * rxd) / r1;\n    const tx = cpsi * txd - spsi * tyd + x / 2;\n    const ty = spsi * txd + cpsi * tyd + y / 2;\n    let rad = Math.atan2((ryd - tyd) / r2, (rxd - txd) / r1) - Math.atan2(0, 1);\n    let s1 = rad >= 0 ? rad : 2 * Math.PI + rad;\n    rad =\n        Math.atan2((-ryd - tyd) / r2, (-rxd - txd) / r1) -\n            Math.atan2((ryd - tyd) / r2, (rxd - txd) / r1);\n    let dr = rad >= 0 ? rad : 2 * Math.PI + rad;\n    if (!fS && dr > 0) {\n        dr -= 2 * Math.PI;\n    }\n    else if (fS && dr < 0) {\n        dr += 2 * Math.PI;\n    }\n    const sse = (dr * 2) / Math.PI;\n    const seg = Math.ceil(sse < 0 ? -1 * sse : sse);\n    const segr = dr / seg;\n    const t = ((8 / 3) * Math.sin(segr / 4) * Math.sin(segr / 4)) / Math.sin(segr / 2);\n    const cpsir1 = cpsi * r1;\n    const cpsir2 = cpsi * r2;\n    const spsir1 = spsi * r1;\n    const spsir2 = spsi * r2;\n    let mc = Math.cos(s1);\n    let ms = Math.sin(s1);\n    let x2 = -t * (cpsir1 * ms + spsir2 * mc);\n    let y2 = -t * (spsir1 * ms - cpsir2 * mc);\n    let x3 = 0;\n    let y3 = 0;\n    const result = [];\n    for (let n = 0; n < seg; ++n) {\n        s1 += segr;\n        mc = Math.cos(s1);\n        ms = Math.sin(s1);\n        x3 = cpsir1 * mc - spsir2 * ms + tx;\n        y3 = spsir1 * mc + cpsir2 * ms + ty;\n        const dx = -t * (cpsir1 * ms + spsir2 * mc);\n        const dy = -t * (spsir1 * ms - cpsir2 * mc);\n        // CurveTo updates x0, y0 so need to restore it\n        const index = n * 6;\n        result[index] = Number(x2 + x0);\n        result[index + 1] = Number(y2 + y0);\n        result[index + 2] = Number(x3 - dx + x0);\n        result[index + 3] = Number(y3 - dy + y0);\n        result[index + 4] = Number(x3 + x0);\n        result[index + 5] = Number(y3 + y0);\n        x2 = x3 + dx;\n        y2 = y3 + dy;\n    }\n    return result;\n};\n/**\n * Returns the bounding box for the rotated rectangle.\n *\n * @param rect {@link Rectangle} to be rotated.\n * @param angle Number that represents the angle (in degrees).\n * @param cx Optional {@link Point} that represents the rotation center. If no\n * rotation center is given then the center of rect is used.\n */\nexport const getBoundingBox = (rect, rotation, cx = null) => {\n    let result = null;\n    if (rect && rotation !== 0) {\n        const rad = toRadians(rotation);\n        const cos = Math.cos(rad);\n        const sin = Math.sin(rad);\n        cx = cx != null ? cx : new Point(rect.x + rect.width / 2, rect.y + rect.height / 2);\n        let p1 = new Point(rect.x, rect.y);\n        let p2 = new Point(rect.x + rect.width, rect.y);\n        let p3 = new Point(p2.x, rect.y + rect.height);\n        let p4 = new Point(rect.x, p3.y);\n        p1 = getRotatedPoint(p1, cos, sin, cx);\n        p2 = getRotatedPoint(p2, cos, sin, cx);\n        p3 = getRotatedPoint(p3, cos, sin, cx);\n        p4 = getRotatedPoint(p4, cos, sin, cx);\n        result = new Rectangle(p1.x, p1.y, 0, 0);\n        result.add(new Rectangle(p2.x, p2.y, 0, 0));\n        result.add(new Rectangle(p3.x, p3.y, 0, 0));\n        result.add(new Rectangle(p4.x, p4.y, 0, 0));\n    }\n    return result;\n};\n/**\n * Rotates the given point by the given cos and sin.\n */\nexport const getRotatedPoint = (pt, cos, sin, c = new Point()) => {\n    const x = pt.x - c.x;\n    const y = pt.y - c.y;\n    const x1 = x * cos - y * sin;\n    const y1 = y * cos + x * sin;\n    return new Point(x1 + c.x, y1 + c.y);\n};\n/**\n * Returns an integer mask of the port constraints for the given terminal and edge.\n *\n * @param terminal {@link CellState} that represents the terminal.\n * @param edge {@link CellState} that represents the edge.\n * @param source Boolean that specifies if the terminal is the source terminal.\n * @param defaultValue Default value to be returned if no port constraint is defined in the terminal.\n * @return the mask of port constraint directions\n */\nexport const getPortConstraints = (terminal, edge, source, defaultValue) => {\n    const value = terminal.style.portConstraint ??\n        (source ? edge.style.sourcePortConstraint : edge.style.targetPortConstraint);\n    if (isNullish(value)) {\n        return defaultValue;\n    }\n    // The implementation here is derived from the mxGraph implementation\n    // In mxGraph, the configuration of several directions was done by concatenating them in a string without separator like in \"portConstraint=northsouth\"\n    // See https://github.com/jgraph/mxgraph/blob/v4.2.2/javascript/examples/orthogonal.html#L101-L102\n    // Other examples exist in draw.io: https://github.com/jgraph/drawio/blob/acd938b1/src/main/webapp/js/diagramly/Dialogs.js#L2302-L2305\n    // The implementation here still supports the string concatenation of several directions to allow import of mxGraph XML models without additional transformations.\n    const directions = value.toString();\n    let returnValue = DIRECTION_MASK.NONE;\n    const constraintRotationEnabled = terminal.style.portConstraintRotation ?? false;\n    const rotation = constraintRotationEnabled ? (terminal.style.rotation ?? 0) : 0;\n    let quad = 0;\n    if (rotation > 45) {\n        quad = 1;\n        if (rotation >= 135) {\n            quad = 2;\n        }\n    }\n    else if (rotation < -45) {\n        quad = 3;\n        if (rotation <= -135) {\n            quad = 2;\n        }\n    }\n    if (directions.indexOf('north') >= 0) {\n        switch (quad) {\n            case 0:\n                returnValue |= DIRECTION_MASK.NORTH;\n                break;\n            case 1:\n                returnValue |= DIRECTION_MASK.EAST;\n                break;\n            case 2:\n                returnValue |= DIRECTION_MASK.SOUTH;\n                break;\n            case 3:\n                returnValue |= DIRECTION_MASK.WEST;\n                break;\n        }\n    }\n    if (directions.indexOf('west') >= 0) {\n        switch (quad) {\n            case 0:\n                returnValue |= DIRECTION_MASK.WEST;\n                break;\n            case 1:\n                returnValue |= DIRECTION_MASK.NORTH;\n                break;\n            case 2:\n                returnValue |= DIRECTION_MASK.EAST;\n                break;\n            case 3:\n                returnValue |= DIRECTION_MASK.SOUTH;\n                break;\n        }\n    }\n    if (directions.indexOf('south') >= 0) {\n        switch (quad) {\n            case 0:\n                returnValue |= DIRECTION_MASK.SOUTH;\n                break;\n            case 1:\n                returnValue |= DIRECTION_MASK.WEST;\n                break;\n            case 2:\n                returnValue |= DIRECTION_MASK.NORTH;\n                break;\n            case 3:\n                returnValue |= DIRECTION_MASK.EAST;\n                break;\n        }\n    }\n    if (directions.indexOf('east') >= 0) {\n        switch (quad) {\n            case 0:\n                returnValue |= DIRECTION_MASK.EAST;\n                break;\n            case 1:\n                returnValue |= DIRECTION_MASK.SOUTH;\n                break;\n            case 2:\n                returnValue |= DIRECTION_MASK.WEST;\n                break;\n            case 3:\n                returnValue |= DIRECTION_MASK.NORTH;\n                break;\n        }\n    }\n    return returnValue;\n};\n/**\n * Reverse the port constraint bitmask. For example, north | east\n * becomes south | west\n */\nexport const reversePortConstraints = (constraint) => {\n    let result = 0;\n    result = (constraint & DIRECTION_MASK.WEST) << 3;\n    result |= (constraint & DIRECTION_MASK.NORTH) << 1;\n    result |= (constraint & DIRECTION_MASK.SOUTH) >> 1;\n    result |= (constraint & DIRECTION_MASK.EAST) >> 3;\n    return result;\n};\n/**\n * Finds the index of the nearest segment on the given cell state for\n * the specified coordinate pair.\n */\nexport const findNearestSegment = (state, x, y) => {\n    let index = -1;\n    if (state.absolutePoints.length > 0) {\n        let last = state.absolutePoints[0];\n        let min = null;\n        for (let i = 1; i < state.absolutePoints.length; i += 1) {\n            const current = state.absolutePoints[i];\n            if (!last || !current)\n                continue;\n            const dist = ptSegDistSq(last.x, last.y, current.x, current.y, x, y);\n            if (min == null || dist < min) {\n                min = dist;\n                index = i - 1;\n            }\n            last = current;\n        }\n    }\n    return index;\n};\n/**\n * Adds the given margins to the given rectangle and rotates and flips the\n * rectangle according to the respective styles in style.\n */\nexport const getDirectedBounds = (rect, m, style, flipH, flipV) => {\n    const d = style?.direction ?? 'east';\n    flipH ?? (flipH = style?.flipH ?? false);\n    flipV ?? (flipV = style?.flipV ?? false);\n    m.x = Math.round(Math.max(0, Math.min(rect.width, m.x)));\n    m.y = Math.round(Math.max(0, Math.min(rect.height, m.y)));\n    m.width = Math.round(Math.max(0, Math.min(rect.width, m.width)));\n    m.height = Math.round(Math.max(0, Math.min(rect.height, m.height)));\n    if ((flipV && (d === 'south' || d === 'north')) ||\n        (flipH && (d === 'east' || d === 'west'))) {\n        const tmp = m.x;\n        m.x = m.width;\n        m.width = tmp;\n    }\n    if ((flipH && (d === 'south' || d === 'north')) ||\n        (flipV && (d === 'east' || d === 'west'))) {\n        const tmp = m.y;\n        m.y = m.height;\n        m.height = tmp;\n    }\n    const m2 = Rectangle.fromRectangle(m);\n    if (d === 'south') {\n        m2.y = m.x;\n        m2.x = m.height;\n        m2.width = m.y;\n        m2.height = m.width;\n    }\n    else if (d === 'west') {\n        m2.y = m.height;\n        m2.x = m.width;\n        m2.width = m.x;\n        m2.height = m.y;\n    }\n    else if (d === 'north') {\n        m2.y = m.width;\n        m2.x = m.y;\n        m2.width = m.height;\n        m2.height = m.x;\n    }\n    return new Rectangle(rect.x + m2.x, rect.y + m2.y, rect.width - m2.width - m2.x, rect.height - m2.height - m2.y);\n};\n/**\n * Returns the intersection between the polygon defined by the array of\n * points and the line between center and point.\n */\nexport const getPerimeterPoint = (pts, center, point) => {\n    let min = null;\n    for (let i = 0; i < pts.length - 1; i += 1) {\n        const pt = intersection(pts[i].x, pts[i].y, pts[i + 1].x, pts[i + 1].y, center.x, center.y, point.x, point.y);\n        if (pt != null) {\n            const dx = point.x - pt.x;\n            const dy = point.y - pt.y;\n            const ip = { p: pt, distSq: dy * dy + dx * dx };\n            if (ip != null && (min == null || min.distSq > ip.distSq)) {\n                min = ip;\n            }\n        }\n    }\n    return min != null ? min.p : null;\n};\n/**\n * Returns true if the given rectangle intersects the given segment.\n *\n * @param bounds {@link Rectangle} that represents the rectangle.\n * @param p1 {@link Point} that represents the first point of the segment.\n * @param p2 {@link Point} that represents the second point of the segment.\n */\nexport const rectangleIntersectsSegment = (bounds, p1, p2) => {\n    const top = bounds.y;\n    const left = bounds.x;\n    const bottom = top + bounds.height;\n    const right = left + bounds.width;\n    // Find min and max X for the segment\n    let minX = p1.x;\n    let maxX = p2.x;\n    if (p1.x > p2.x) {\n        minX = p2.x;\n        maxX = p1.x;\n    }\n    // Find the intersection of the segment's and rectangle's x-projections\n    if (maxX > right) {\n        maxX = right;\n    }\n    if (minX < left) {\n        minX = left;\n    }\n    if (minX > maxX) {\n        // If their projections do not intersect return false\n        return false;\n    }\n    // Find corresponding min and max Y for min and max X we found before\n    let minY = p1.y;\n    let maxY = p2.y;\n    const dx = p2.x - p1.x;\n    if (Math.abs(dx) > 0.0000001) {\n        const a = (p2.y - p1.y) / dx;\n        const b = p1.y - a * p1.x;\n        minY = a * minX + b;\n        maxY = a * maxX + b;\n    }\n    if (minY > maxY) {\n        const tmp = maxY;\n        maxY = minY;\n        minY = tmp;\n    }\n    // Find the intersection of the segment's and rectangle's y-projections\n    if (maxY > bottom) {\n        maxY = bottom;\n    }\n    if (minY < top) {\n        minY = top;\n    }\n    if (minY > maxY) {\n        // If Y-projections do not intersect return false\n        return false;\n    }\n    return true;\n};\n/**\n * Returns true if the specified point (x, y) is contained in the given rectangle.\n *\n * @param bounds {@link Rectangle} that represents the area.\n * @param x X-coordinate of the point.\n * @param y Y-coordinate of the point.\n */\nexport const contains = (bounds, x, y) => {\n    return (bounds.x <= x &&\n        bounds.x + bounds.width >= x &&\n        bounds.y <= y &&\n        bounds.y + bounds.height >= y);\n};\n/**\n * Returns true if the two rectangles intersect.\n *\n * @param a {@link Rectangle} to be checked for intersection.\n * @param b {@link Rectangle} to be checked for intersection.\n */\nexport const intersects = (a, b) => {\n    let tw = a.width;\n    let th = a.height;\n    let rw = b.width;\n    let rh = b.height;\n    if (rw <= 0 || rh <= 0 || tw <= 0 || th <= 0) {\n        return false;\n    }\n    const tx = a.x;\n    const ty = a.y;\n    const rx = b.x;\n    const ry = b.y;\n    rw += rx;\n    rh += ry;\n    tw += tx;\n    th += ty;\n    return ((rw < rx || rw > tx) &&\n        (rh < ry || rh > ty) &&\n        (tw < tx || tw > rx) &&\n        (th < ty || th > ry));\n};\n/**\n * Returns true if the state and the hotspot intersect.\n *\n * @param state <CellState>\n * @param x X-coordinate.\n * @param y Y-coordinate.\n * @param hotspot Optional size of the hostpot.\n * @param min Optional min size of the hostpot.\n * @param max Optional max size of the hostpot.\n */\nexport const intersectsHotspot = (state, x, y, hotspot, min, max) => {\n    hotspot = hotspot != null ? hotspot : 1;\n    min = min != null ? min : 0;\n    max = max != null ? max : 0;\n    if (hotspot > 0) {\n        let cx = state.getCenterX();\n        let cy = state.getCenterY();\n        let w = state.width;\n        let h = state.height;\n        const style = state.style;\n        const start = (style?.startSize ?? 0) * state.view.scale;\n        if (start > 0) {\n            if (style?.horizontal ?? true) {\n                cy = state.y + start / 2;\n                h = start;\n            }\n            else {\n                cx = state.x + start / 2;\n                w = start;\n            }\n        }\n        w = Math.max(min, w * hotspot);\n        h = Math.max(min, h * hotspot);\n        if (max > 0) {\n            w = Math.min(w, max);\n            h = Math.min(h, max);\n        }\n        const rect = new Rectangle(cx - w / 2, cy - h / 2, w, h);\n        const alpha = toRadians(style?.rotation ?? 0);\n        if (alpha != 0) {\n            const cos = Math.cos(-alpha);\n            const sin = Math.sin(-alpha);\n            const cx = new Point(state.getCenterX(), state.getCenterY());\n            const pt = getRotatedPoint(new Point(x, y), cos, sin, cx);\n            x = pt.x;\n            y = pt.y;\n        }\n        return contains(rect, x, y);\n    }\n    return true;\n};\n/**\n * Returns true if the specified value is numeric, that is, if it is not\n * null, not an empty string, not a HEX number and isNaN returns false.\n *\n * @param n String representing the possibly numeric value.\n */\nexport const isNumeric = (n) => {\n    return (!Number.isNaN(parseFloat(n)) &&\n        isFinite(+n) &&\n        (typeof n !== 'string' || n.toLowerCase().indexOf('0x') < 0));\n};\n/**\n * Returns true if the given value is an valid integer number.\n *\n * @param n String representing the possibly numeric value.\n */\nexport const isInteger = (n) => {\n    return String(parseInt(n)) === String(n);\n};\n/**\n * Returns the remainder of division of n by m. You should use this instead\n * of the built-in operation as the built-in operation does not properly\n * handle negative numbers.\n */\nexport const mod = (n, m) => {\n    return ((n % m) + m) % m;\n};\n/**\n * Returns the intersection of two lines as an {@link Point}.\n *\n * @param x0 X-coordinate of the first line's startpoint.\n * @param y0 X-coordinate of the first line's startpoint.\n * @param x1 X-coordinate of the first line's endpoint.\n * @param y1 Y-coordinate of the first line's endpoint.\n * @param x2 X-coordinate of the second line's startpoint.\n * @param y2 Y-coordinate of the second line's startpoint.\n * @param x3 X-coordinate of the second line's endpoint.\n * @param y3 Y-coordinate of the second line's endpoint.\n */\nexport const intersection = (x0, y0, x1, y1, x2, y2, x3, y3) => {\n    const denom = (y3 - y2) * (x1 - x0) - (x3 - x2) * (y1 - y0);\n    const nume_a = (x3 - x2) * (y0 - y2) - (y3 - y2) * (x0 - x2);\n    const nume_b = (x1 - x0) * (y0 - y2) - (y1 - y0) * (x0 - x2);\n    const ua = nume_a / denom;\n    const ub = nume_b / denom;\n    if (ua >= 0.0 && ua <= 1.0 && ub >= 0.0 && ub <= 1.0) {\n        // Get the intersection point\n        const x = x0 + ua * (x1 - x0);\n        const y = y0 + ua * (y1 - y0);\n        return new Point(x, y);\n    }\n    // No intersection\n    return null;\n};\n/**\n * Returns the square distance between a segment and a point. To get the\n * distance between a point and a line (with infinite length) use\n * {@link Utils#ptLineDist}.\n *\n * @param x1 X-coordinate of the startpoint of the segment.\n * @param y1 Y-coordinate of the startpoint of the segment.\n * @param x2 X-coordinate of the endpoint of the segment.\n * @param y2 Y-coordinate of the endpoint of the segment.\n * @param px X-coordinate of the point.\n * @param py Y-coordinate of the point.\n */\nexport const ptSegDistSq = (x1, y1, x2, y2, px, py) => {\n    x2 -= x1;\n    y2 -= y1;\n    px -= x1;\n    py -= y1;\n    let dotprod = px * x2 + py * y2;\n    let projlenSq;\n    if (dotprod <= 0.0) {\n        projlenSq = 0.0;\n    }\n    else {\n        px = x2 - px;\n        py = y2 - py;\n        dotprod = px * x2 + py * y2;\n        if (dotprod <= 0.0) {\n            projlenSq = 0.0;\n        }\n        else {\n            projlenSq = (dotprod * dotprod) / (x2 * x2 + y2 * y2);\n        }\n    }\n    let lenSq = px * px + py * py - projlenSq;\n    if (lenSq < 0) {\n        lenSq = 0;\n    }\n    return lenSq;\n};\n/**\n * Returns the distance between a line defined by two points and a point.\n * To get the distance between a point and a segment (with a specific\n * length) use {@link Utils#ptSeqDistSq}.\n *\n * @param x1 X-coordinate of point 1 of the line.\n * @param y1 Y-coordinate of point 1 of the line.\n * @param x2 X-coordinate of point 1 of the line.\n * @param y2 Y-coordinate of point 1 of the line.\n * @param px X-coordinate of the point.\n * @param py Y-coordinate of the point.\n */\nexport const ptLineDist = (x1, y1, x2, y2, px, py) => {\n    return (Math.abs((y2 - y1) * px - (x2 - x1) * py + x2 * y1 - y2 * x1) /\n        Math.sqrt((y2 - y1) * (y2 - y1) + (x2 - x1) * (x2 - x1)));\n};\n/**\n * Returns 1 if the given point on the right side of the segment, 0 if its\n * on the segment, and -1 if the point is on the left side of the segment.\n *\n * @param x1 X-coordinate of the startpoint of the segment.\n * @param y1 Y-coordinate of the startpoint of the segment.\n * @param x2 X-coordinate of the endpoint of the segment.\n * @param y2 Y-coordinate of the endpoint of the segment.\n * @param px X-coordinate of the point.\n * @param py Y-coordinate of the point.\n */\nexport const relativeCcw = (x1, y1, x2, y2, px, py) => {\n    x2 -= x1;\n    y2 -= y1;\n    px -= x1;\n    py -= y1;\n    let ccw = px * y2 - py * x2;\n    if (ccw == 0.0) {\n        ccw = px * x2 + py * y2;\n        if (ccw > 0.0) {\n            px -= x2;\n            py -= y2;\n            ccw = px * x2 + py * y2;\n            if (ccw < 0.0) {\n                ccw = 0.0;\n            }\n        }\n    }\n    return ccw < 0.0 ? -1 : ccw > 0.0 ? 1 : 0;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellState from '../../cell/CellState.js';\nimport Point from '../../geometry/Point.js';\nimport { contains } from '../../../util/mathUtils.js';\n/**\n * Implements a horizontal elbow edge.\n *\n * This EdgeStyle is registered under `sideToSideEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'elbow'\n * - isOrthogonal: true\n */\nexport const SideToSide = (state, source, target, points, result) => {\n    const { view } = state;\n    let pt = points != null && points.length > 0 ? points[0] : null;\n    const pts = state.absolutePoints;\n    const p0 = pts[0];\n    const pe = pts[pts.length - 1];\n    if (pt != null) {\n        pt = view.transformControlPoint(state, pt);\n    }\n    if (p0 != null) {\n        source = new CellState();\n        source.x = p0.x;\n        source.y = p0.y;\n    }\n    if (pe != null) {\n        target = new CellState();\n        target.x = pe.x;\n        target.y = pe.y;\n    }\n    if (source != null && target != null) {\n        const l = Math.max(source.x, target.x);\n        const r = Math.min(source.x + source.width, target.x + target.width);\n        const x = pt != null ? pt.x : Math.round(r + (l - r) / 2);\n        let y1 = view.getRoutingCenterY(source);\n        let y2 = view.getRoutingCenterY(target);\n        if (pt != null) {\n            if (pt.y >= source.y && pt.y <= source.y + source.height) {\n                y1 = pt.y;\n            }\n            if (pt.y >= target.y && pt.y <= target.y + target.height) {\n                y2 = pt.y;\n            }\n        }\n        if (!contains(target, x, y1) && !contains(source, x, y1)) {\n            result.push(new Point(x, y1));\n        }\n        if (!contains(target, x, y2) && !contains(source, x, y2)) {\n            result.push(new Point(x, y2));\n        }\n        if (result.length === 1) {\n            if (pt != null) {\n                if (!contains(target, x, pt.y) && !contains(source, x, pt.y)) {\n                    result.push(new Point(x, pt.y));\n                }\n            }\n            else {\n                const t = Math.max(source.y, target.y);\n                const b = Math.min(source.y + source.height, target.y + target.height);\n                result.push(new Point(x, t + (b - t) / 2));\n            }\n        }\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellState from '../../cell/CellState.js';\nimport Point from '../../geometry/Point.js';\nimport { contains } from '../../../util/mathUtils.js';\n/**\n * Implements a vertical elbow edge.\n *\n * This EdgeStyle is registered under `topToBottomEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'elbow'\n * - isOrthogonal: true\n */\nexport const TopToBottom = (state, source, target, points, result) => {\n    const { view } = state;\n    let pt = points != null && points.length > 0 ? points[0] : null;\n    const pts = state.absolutePoints;\n    const p0 = pts[0];\n    const pe = pts[pts.length - 1];\n    if (pt != null) {\n        pt = view.transformControlPoint(state, pt);\n    }\n    if (p0 != null) {\n        source = new CellState();\n        source.x = p0.x;\n        source.y = p0.y;\n    }\n    if (pe != null) {\n        target = new CellState();\n        target.x = pe.x;\n        target.y = pe.y;\n    }\n    if (source != null && target != null) {\n        const t = Math.max(source.y, target.y);\n        const b = Math.min(source.y + source.height, target.y + target.height);\n        let x = view.getRoutingCenterX(source);\n        if (pt != null && pt.x >= source.x && pt.x <= source.x + source.width) {\n            x = pt.x;\n        }\n        const y = pt != null ? pt.y : Math.round(b + (t - b) / 2);\n        if (!contains(target, x, y) && !contains(source, x, y)) {\n            result.push(new Point(x, y));\n        }\n        if (pt != null && pt.x >= target.x && pt.x <= target.x + target.width) {\n            x = pt.x;\n        }\n        else {\n            x = view.getRoutingCenterX(target);\n        }\n        if (!contains(target, x, y) && !contains(source, x, y)) {\n            result.push(new Point(x, y));\n        }\n        if (result.length === 1) {\n            if (pt != null && result.length === 1) {\n                if (!contains(target, pt.x, y) && !contains(source, pt.x, y)) {\n                    result.push(new Point(pt.x, y));\n                }\n            }\n            else {\n                const l = Math.max(source.x, target.x);\n                const r = Math.min(source.x + source.width, target.x + target.width);\n                result.push(new Point(l + (r - l) / 2, y));\n            }\n        }\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { SideToSide } from './SideToSide.js';\nimport { TopToBottom } from './TopToBottom.js';\n/**\n * Uses either {@link SideToSide} or {@link TopToBottom} depending on the horizontal flag in the cell style.\n * {@link SideToSide} is used if horizontal is `true` or unspecified.\n *\n * This EdgeStyle is registered under `elbowEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'elbow'\n * - isOrthogonal: true\n */\nexport const ElbowConnector = (state, source, target, points, result) => {\n    let pt = points != null && points.length > 0 ? points[0] : null;\n    let vertical = false;\n    let horizontal = false;\n    if (source != null && target != null) {\n        if (pt != null) {\n            const left = Math.min(source.x, target.x);\n            const right = Math.max(source.x + source.width, target.x + target.width);\n            const top = Math.min(source.y, target.y);\n            const bottom = Math.max(source.y + source.height, target.y + target.height);\n            pt = state.view.transformControlPoint(state, pt);\n            vertical = pt.y < top || pt.y > bottom;\n            horizontal = pt.x < left || pt.x > right;\n        }\n        else {\n            const left = Math.max(source.x, target.x);\n            const right = Math.min(source.x + source.width, target.x + target.width);\n            vertical = left === right;\n            if (!vertical) {\n                const top = Math.max(source.y, target.y);\n                const bottom = Math.min(source.y + source.height, target.y + target.height);\n                horizontal = top === bottom;\n            }\n        }\n    }\n    if (!horizontal && (vertical || state.style.elbow === 'vertical')) {\n        TopToBottom(state, source, target, points, result);\n    }\n    else {\n        SideToSide(state, source, target, points, result);\n    }\n};\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { ENTITY_SEGMENT } from '../../util/Constants.js';\nimport { shallowCopy } from '../../internal/clone-utils.js';\n/**\n * Configure the {@link EntityRelation} connector.\n *\n * @experimental subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.15.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const EntityRelationConnectorConfig = {\n    /**\n     * Defines the length of the horizontal segment of an `Entity Relation`.\n     * This can be overridden using {@link CellStateStyle.segment} style.\n     * @default {@link ENTITY_SEGMENT}\n     */\n    segment: ENTITY_SEGMENT,\n};\n/**\n * Resets {@link EntityRelationConnectorConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.15.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const resetEntityRelationConnectorConfig = () => {\n    // implement the reset manually as there are a few properties for now\n    EntityRelationConnectorConfig.segment = ENTITY_SEGMENT;\n};\n/**\n * Configure the {@link OrthConnector}.\n *\n * @experimental subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.16.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const OrthogonalConnectorConfig = {\n    /**\n     * If the value is not set in {@link CellStateStyle.jettySize}, defines the jetty size of the connector.\n     *\n     * If the computed value of the jetty size coming from {@link CellStateStyle} is 'auto', it is used in the computation of the automatic jetty size.\n     * See the implementation of {@link OrthConnector} for more details.\n     *\n     * @default 10\n     */\n    buffer: 10,\n    /**\n     * See the implementation of {@link OrthConnector} for more details.\n     * @default true\n     */\n    pointsFallback: true,\n};\nconst originalOrthogonalConnectorConfig = { ...OrthogonalConnectorConfig };\n/**\n * Resets {@link OrthogonalConnectorConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.16.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const resetOrthogonalConnectorConfig = () => {\n    shallowCopy(originalOrthogonalConnectorConfig, OrthogonalConnectorConfig);\n};\nconst allDirections = () => {\n    return ['north', 'south', 'east', 'west'];\n};\n/**\n * Configure the {@link ManhattanConnector}.\n *\n * @experimental subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.16.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const ManhattanConnectorConfig = {\n    maxAllowedDirectionChange: 90,\n    maxLoops: 2000,\n    endDirections: allDirections(),\n    startDirections: allDirections(),\n    step: 12,\n};\nconst originalManhattanConnectorConfig = {};\nshallowCopy(ManhattanConnectorConfig, originalManhattanConnectorConfig);\n/**\n * Resets {@link ManhattanConnectorConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.16.0\n * @category Configuration\n * @category EdgeStyle\n */\nexport const resetManhattanConnectorConfig = () => {\n    shallowCopy(originalManhattanConnectorConfig, ManhattanConnectorConfig);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellState from '../../cell/CellState.js';\nimport Point from '../../geometry/Point.js';\nimport { DIRECTION_MASK } from '../../../util/Constants.js';\nimport { getPortConstraints } from '../../../util/mathUtils.js';\nimport { EntityRelationConnectorConfig } from '../config.js';\n/**\n * Implements an entity relation style for edges (as used in database schema diagrams).\n *\n * At the time the function is called, the result array contains a placeholder (`null`) for the first absolute point,\n * that is, the point where the edge and source terminal are connected.\n *\n * The implementation of the style then adds all intermediate waypoints except for the last point,\n * that is, the connection point between the edge and the target terminal.\n *\n * The first and the last point in the result array are then replaced with Point that take into account the terminal's perimeter and next point on the edge.\n *\n * This EdgeStyle is registered under `entityRelationEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'default' or unset\n * - isOrthogonal: true\n *\n * @param state {@link CellState} that represents the edge to be updated.\n * @param source {@link CellState} that represents the source terminal.\n * @param target {@link CellState} that represents the target terminal.\n * @param _points\n * @param result Array of {@link Point} that represent the actual points of the edge.\n */\nexport const EntityRelation = (state, source, target, _points, result) => {\n    const { view } = state;\n    const segment = (state.style?.segment ?? EntityRelationConnectorConfig.segment) * view.scale;\n    const pts = state.absolutePoints;\n    const p0 = pts[0];\n    const pe = pts[pts.length - 1];\n    let isSourceLeft = false;\n    if (source != null) {\n        const sourceGeometry = source.cell.getGeometry();\n        if (sourceGeometry.relative) {\n            isSourceLeft = sourceGeometry.x <= 0.5;\n        }\n        else if (target != null) {\n            isSourceLeft =\n                (pe != null ? pe.x : target.x + target.width) < (p0 != null ? p0.x : source.x);\n        }\n    }\n    if (p0 != null) {\n        source = new CellState();\n        source.x = p0.x;\n        source.y = p0.y;\n    }\n    else if (source != null) {\n        const constraint = getPortConstraints(source, state, true, DIRECTION_MASK.NONE);\n        if (constraint !== DIRECTION_MASK.NONE &&\n            constraint !== DIRECTION_MASK.WEST + DIRECTION_MASK.EAST) {\n            isSourceLeft = constraint === DIRECTION_MASK.WEST;\n        }\n    }\n    else {\n        return;\n    }\n    let isTargetLeft = true;\n    if (target != null) {\n        const targetGeometry = target.cell.getGeometry();\n        if (targetGeometry.relative) {\n            isTargetLeft = targetGeometry.x <= 0.5;\n        }\n        else if (source != null) {\n            isTargetLeft =\n                (p0 != null ? p0.x : source.x + source.width) < (pe != null ? pe.x : target.x);\n        }\n    }\n    if (pe != null) {\n        target = new CellState();\n        target.x = pe.x;\n        target.y = pe.y;\n    }\n    else if (target != null) {\n        const constraint = getPortConstraints(target, state, false, DIRECTION_MASK.NONE);\n        if (constraint !== DIRECTION_MASK.NONE &&\n            constraint != DIRECTION_MASK.WEST + DIRECTION_MASK.EAST) {\n            isTargetLeft = constraint === DIRECTION_MASK.WEST;\n        }\n    }\n    if (source != null && target != null) {\n        const x0 = isSourceLeft ? source.x : source.x + source.width;\n        const y0 = view.getRoutingCenterY(source);\n        const xe = isTargetLeft ? target.x : target.x + target.width;\n        const ye = view.getRoutingCenterY(target);\n        const seg = segment;\n        let dx = isSourceLeft ? -seg : seg;\n        const dep = new Point(x0 + dx, y0);\n        dx = isTargetLeft ? -seg : seg;\n        const arr = new Point(xe + dx, ye);\n        // Adds intermediate points if both go out on same side\n        if (isSourceLeft === isTargetLeft) {\n            const x = isSourceLeft ? Math.min(x0, xe) - segment : Math.max(x0, xe) + segment;\n            result.push(new Point(x, y0));\n            result.push(new Point(x, ye));\n        }\n        else if (dep.x < arr.x === isSourceLeft) {\n            const midY = y0 + (ye - y0) / 2;\n            result.push(dep);\n            result.push(new Point(dep.x, midY));\n            result.push(new Point(arr.x, midY));\n            result.push(arr);\n        }\n        else {\n            result.push(dep);\n            result.push(arr);\n        }\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport { contains } from '../../../util/mathUtils.js';\n/**\n * Implements a self-reference, aka. loop.\n *\n * This EdgeStyle is registered under `loopEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'elbow'\n * - isOrthogonal: false\n */\nexport const Loop = (state, source, _target, points, result) => {\n    const pts = state.absolutePoints;\n    const p0 = pts[0];\n    const pe = pts[pts.length - 1];\n    if (p0 != null && pe != null) {\n        if (points != null && points.length > 0) {\n            for (let i = 0; i < points.length; i += 1) {\n                let pt = points[i];\n                pt = state.view.transformControlPoint(state, pt);\n                result.push(new Point(pt.x, pt.y));\n            }\n        }\n        return;\n    }\n    if (source != null) {\n        const { view } = state;\n        const { graph } = view;\n        let pt = points != null && points.length > 0 ? points[0] : null;\n        if (pt != null) {\n            pt = view.transformControlPoint(state, pt);\n            if (contains(source, pt.x, pt.y)) {\n                pt = null;\n            }\n        }\n        let x = 0;\n        let dx = 0;\n        let y = 0;\n        let dy = 0;\n        const seg = (state.style.segment ?? graph.gridSize) * view.scale;\n        const dir = state.style?.direction ?? 'west';\n        if (dir === 'north' || dir === 'south') {\n            x = view.getRoutingCenterX(source);\n            dx = seg;\n        }\n        else {\n            y = view.getRoutingCenterY(source);\n            dy = seg;\n        }\n        if (pt == null || pt.x < source.x || pt.x > source.x + source.width) {\n            if (pt != null) {\n                x = pt.x;\n                dy = Math.max(Math.abs(y - pt.y), dy);\n            }\n            else if (dir === 'north') {\n                y = source.y - 2 * dx;\n            }\n            else if (dir === 'south') {\n                y = source.y + source.height + 2 * dx;\n            }\n            else if (dir === 'east') {\n                x = source.x - 2 * dy;\n            }\n            else {\n                x = source.x + source.width + 2 * dy;\n            }\n        }\n        else if (pt !== null) {\n            x = view.getRoutingCenterX(source);\n            dx = Math.max(Math.abs(x - pt.x), dy);\n            y = pt.y;\n            dy = 0;\n        }\n        result.push(new Point(x - dx, y - dy));\n        result.push(new Point(x + dx, y + dy));\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Removes all occurrences of the given object in the given array or\n * object. If there are multiple occurrences of the object, be they\n * associative or as an array entry, all occurrences are removed from\n * the array or deleted from the object. By removing the object from\n * the array, all elements following the removed element are shifted\n * by one step towards the beginning of the array.\n *\n * The length of arrays is not modified inside this function.\n *\n * @param obj Object to find in the given array.\n * @param array Array to check for the given obj.\n */\nexport const remove = (obj, array) => {\n    let result = null;\n    if (typeof array === 'object') {\n        let index = array.indexOf(obj);\n        while (index >= 0) {\n            array.splice(index, 1);\n            result = obj;\n            index = array.indexOf(obj);\n        }\n    }\n    for (const key in array) {\n        if (array[key] == obj) {\n            delete array[key];\n            result = obj;\n        }\n    }\n    return result;\n};\n/**\n * Compares all Point in the given lists.\n *\n * @param a Array of <Point> to be compared.\n * @param b Array of <Point> to be compared.\n */\nexport const equalPoints = (a, b) => {\n    if ((!a && b) || (a && !b) || (a && b && a.length != b.length)) {\n        return false;\n    }\n    if (a && b) {\n        for (let i = 0; i < a.length; i += 1) {\n            const p = a[i];\n            if (!p || (p && !p.equals(b[i])))\n                return false;\n        }\n    }\n    return true;\n};\n/**\n * Returns true if all properties of the given objects are equal. Values\n * with NaN are equal to NaN and unequal to any other value.\n *\n * @param a First object to be compared.\n * @param b Second object to be compared.\n */\nexport const equalEntries = (a, b) => {\n    // Counts keys in b to check if all values have been compared\n    let count = 0;\n    if ((!a && b) || (a && !b) || (a && b && a.length != b.length)) {\n        return false;\n    }\n    if (a && b) {\n        for (const key in b) {\n            count++;\n        }\n        for (const key in a) {\n            count--;\n            if ((!Number.isNaN(a[key]) || !Number.isNaN(b[key])) && a[key] !== b[key]) {\n                return false;\n            }\n        }\n    }\n    return count === 0;\n};\n/**\n * Removes all duplicates from the given array.\n */\nexport const removeDuplicates = (arr) => {\n    const coveredEntries = new Map();\n    const result = [];\n    for (let i = 0; i < arr.length; i += 1) {\n        if (!coveredEntries.get(arr[i])) {\n            result.push(arr[i]);\n            coveredEntries.set(arr[i], true);\n        }\n    }\n    return result;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from './Point.js';\nimport Rectangle from './Rectangle.js';\nimport { getRotatedPoint, toRadians } from '../../util/mathUtils.js';\nimport { equalPoints } from '../../util/arrayUtils.js';\nimport { clone } from '../../util/cloneUtils.js';\n/**\n * For vertices, the geometry consists of the x- and y-location, and the width\n * and height. For edges, the geometry consists of the optional terminal- and\n * control points. The terminal points are only required if an edge is\n * unconnected, and are stored in the {@link sourcePoint} and {@link targetPoint}\n * variables, respectively.\n *\n * ### Example\n *\n * If an edge is unconnected, that is, it has no source or target terminal,\n * then a geometry with terminal points for a new edge can be defined as\n * follows.\n *\n * ```javascript\n * geometry.setTerminalPoint(new Point(x1, y1), true);\n * geometry.points: [new Point(x2, y2)];\n * geometry.setTerminalPoint(new Point(x3, y3), false);\n * ```\n *\n * Control points are used regardless of the connected state of an edge and may\n * be ignored or interpreted differently depending on the edge's {@link edgeStyle}.\n *\n * To disable automatic reset of control points after a cell has been moved or\n * resized, {@link AbstractGraph.resetEdgesOnMove} and {@link AbstractGraph.resetEdgesOnResize} may be used.\n *\n * ### Edge Labels\n *\n * Using the x- and y-coordinates of a cell's geometry, it is possible to\n * position the label on edges on a specific location on the actual edge shape\n * as it appears on the screen. The x-coordinate of an edge's geometry is used\n * to describe the distance from the center of the edge from -1 to 1 with 0\n * being the center of the edge and the default value. The y-coordinate of an\n * edge's geometry is used to describe the absolute, orthogonal distance in\n * pixels from that point. In addition, the {@link Geometry.offset} is used as an\n * absolute offset vector from the resulting point.\n *\n * This coordinate system is applied if {@link relative} is true, otherwise the\n * offset defines the absolute vector from the edge's center point to the\n * label and the values for {@link x} and {@link y} are ignored.\n *\n * The width and height parameter for edge geometries can be used to set the\n * label width and height (eg. for word wrapping).\n *\n * ### Ports\n *\n * The term \"port\" refers to a relatively positioned, connectable child cell,\n * which is used to specify the connection between the parent and another cell\n * in the graph. Ports are typically modeled as vertices with relative\n * geometries.\n *\n * ### Offsets\n *\n * The {@link offset} field is interpreted in 3 different ways, depending on the cell\n * and the geometry. For edges, the offset defines the absolute offset for the\n * edge label. For relative geometries, the offset defines the absolute offset\n * for the origin (top, left corner) of the vertex, otherwise the offset\n * defines the absolute offset for the label inside the vertex or group.\n *\n * @category Geometry\n */\nclass Geometry extends Rectangle {\n    constructor(x = 0, y = 0, width = 0, height = 0) {\n        super(x, y, width, height);\n        /**\n         * Global switch to translate the points in translate. Default is true.\n         */\n        this.TRANSLATE_CONTROL_POINTS = true;\n        /**\n         * Stores alternate values for x, y, width and height in a rectangle.\n         * See {@link swap} to exchange the values. Default is null.\n         *\n         * @see {@link swap}\n         */\n        this.alternateBounds = null;\n        /**\n         * Defines the source {@link Point} of the edge. This is used if the\n         * corresponding edge does not have a source vertex. Otherwise, it is ignored.\n         * @default null\n         */\n        this.sourcePoint = null;\n        /**\n         * Defines the source {@link Point} of the edge. This is used if the\n         * corresponding edge does not have a target vertex. Otherwise, it is ignored.\n         * @default null\n         */\n        this.targetPoint = null;\n        /**\n         * Array of {@link Point} which specifies the control points along the edge.\n         * These points are the intermediate points on the edge, for the endpoints\n         * use {@link targetPoint} and {@link sourcePoint} or set the terminals of the edge to\n         * a non-null value.\n         * @default null\n         */\n        this.points = null;\n        /**\n         * For edges, this holds the offset (in pixels) from the position defined by {@link x} and {@link y} on the edge.\n         *\n         * For relative geometries (for vertices), this defines the absolute offset from the point defined by the relative\n         * coordinates.\n         *\n         * For absolute geometries (for vertices), this defines the offset for the label.\n         * @default null\n         */\n        this.offset = null;\n        /**\n         * Specifies if the coordinates in the geometry are to be interpreted as relative coordinates.\n         *\n         * For edges, this is used to define the location of the edge label relative to the edge\n         * as rendered on the display.\n         *\n         * For vertices, this specifies the relative location inside the bounds of the parent cell.\n         *\n         * If this is `false`, then the coordinates are relative to the origin of the parent cell or,\n         * for edges, the edge label position is relative to the center of the edge as rendered on screen.\n         *\n         * @default false.\n         */\n        this.relative = false;\n    }\n    setRelative(isRelative) {\n        this.relative = isRelative;\n    }\n    /**\n     * Swaps the x, y, width and height with the values stored in\n     * {@link alternateBounds} and puts the previous values into {@link alternateBounds} as\n     * a rectangle. This operation is carried-out in-place, that is, using the\n     * existing geometry instance. If this operation is called during a graph\n     * model transactional change, then the geometry should be cloned before\n     * calling this method and setting the geometry of the cell using\n     * {@link GraphDataModel.setGeometry}.\n     */\n    swap() {\n        if (this.alternateBounds) {\n            const old = new Rectangle(this.x, this.y, this.width, this.height);\n            this.x = this.alternateBounds.x;\n            this.y = this.alternateBounds.y;\n            this.width = this.alternateBounds.width;\n            this.height = this.alternateBounds.height;\n            this.alternateBounds = old;\n        }\n    }\n    /**\n     * Returns the {@link Point} representing the source or target point of this\n     * edge. This is only used if the edge has no source or target vertex.\n     *\n     * @param {Boolean} isSource that specifies if the source or target point should be returned.\n     */\n    getTerminalPoint(isSource) {\n        return isSource ? this.sourcePoint : this.targetPoint;\n    }\n    /**\n     * Sets the {@link sourcePoint} or {@link targetPoint} to the given {@link Point} and\n     * returns the new point.\n     *\n     * @param {Point} point to be used as the new source or target point.\n     * @param {Boolean} isSource that specifies if the source or target point should be set.\n     */\n    setTerminalPoint(point, isSource) {\n        if (isSource) {\n            this.sourcePoint = point;\n        }\n        else {\n            this.targetPoint = point;\n        }\n        return point;\n    }\n    /**\n     * Rotates the geometry by the given angle around the given center. That is,\n     * {@link x} and {@link y} of the geometry, the {@link sourcePoint}, {@link targetPoint} and all\n     * {@link points} are translated by the given amount. {@link x} and {@link y} are only\n     * translated if {@link relative} is false.\n     *\n     * @param {Number} angle that specifies the rotation angle in degrees.\n     * @param {Point} cx   that specifies the center of the rotation.\n     */\n    rotate(angle, cx) {\n        const rad = toRadians(angle);\n        const cos = Math.cos(rad);\n        const sin = Math.sin(rad);\n        // Rotates the geometry\n        if (!this.relative) {\n            const ct = new Point(this.getCenterX(), this.getCenterY());\n            const pt = getRotatedPoint(ct, cos, sin, cx);\n            this.x = Math.round(pt.x - this.width / 2);\n            this.y = Math.round(pt.y - this.height / 2);\n        }\n        // Rotates the source point\n        if (this.sourcePoint) {\n            const pt = getRotatedPoint(this.sourcePoint, cos, sin, cx);\n            this.sourcePoint.x = Math.round(pt.x);\n            this.sourcePoint.y = Math.round(pt.y);\n        }\n        // Translates the target point\n        if (this.targetPoint) {\n            const pt = getRotatedPoint(this.targetPoint, cos, sin, cx);\n            this.targetPoint.x = Math.round(pt.x);\n            this.targetPoint.y = Math.round(pt.y);\n        }\n        // Translate the control points\n        if (this.points) {\n            for (let i = 0; i < this.points.length; i += 1) {\n                if (this.points[i]) {\n                    const pt = getRotatedPoint(this.points[i], cos, sin, cx);\n                    this.points[i].x = Math.round(pt.x);\n                    this.points[i].y = Math.round(pt.y);\n                }\n            }\n        }\n    }\n    /**\n     * Translates the geometry by the specified amount. That is, {@link x} and {@link y} of the\n     * geometry, the {@link sourcePoint}, {@link targetPoint} and all {@link points} are translated\n     * by the given amount. {@link x} and {@link y} are only translated if {@link relative} is false.\n     * If {@link TRANSLATE_CONTROL_POINTS} is false, then {@link points} are not modified by\n     * this function.\n     *\n     * @param {Number} dx that specifies the x-coordinate of the translation.\n     * @param {Number} dy that specifies the y-coordinate of the translation.\n     */\n    translate(dx, dy) {\n        // Translates the geometry\n        if (!this.relative) {\n            this.x += dx;\n            this.y += dy;\n        }\n        // Translates the source point\n        if (this.sourcePoint) {\n            this.sourcePoint.x = this.sourcePoint.x + dx;\n            this.sourcePoint.y = this.sourcePoint.y + dy;\n        }\n        // Translates the target point\n        if (this.targetPoint) {\n            this.targetPoint.x = this.targetPoint.x + dx;\n            this.targetPoint.y = this.targetPoint.y + dy;\n        }\n        // Translate the control points\n        if (this.TRANSLATE_CONTROL_POINTS && this.points) {\n            for (let i = 0; i < this.points.length; i += 1) {\n                if (this.points[i]) {\n                    this.points[i].x = this.points[i].x + dx;\n                    this.points[i].y = this.points[i].y + dy;\n                }\n            }\n        }\n    }\n    /**\n     * Scales the geometry by the given amount. That is, {@link x} and {@link y} of the\n     * geometry, the {@link sourcePoint}, {@link targetPoint} and all {@link points} are scaled\n     * by the given amount. {@link x}, {@link y}, {@link width} and {@link height} are only scaled if\n     * {@link relative} is false. If {@link fixedAspect} is true, then the smaller value\n     * is used to scale the width and the height.\n     *\n     * @param {Number} sx that specifies the horizontal scale factor.\n     * @param {Number} sy that specifies the vertical scale factor.\n     * @param {Optional} fixedAspect boolean to keep the aspect ratio fixed.\n     */\n    scale(sx, sy, fixedAspect) {\n        // Translates the source point\n        if (this.sourcePoint) {\n            this.sourcePoint.x = this.sourcePoint.x * sx;\n            this.sourcePoint.y = this.sourcePoint.y * sy;\n        }\n        // Translates the target point\n        if (this.targetPoint) {\n            this.targetPoint.x = this.targetPoint.x * sx;\n            this.targetPoint.y = this.targetPoint.y * sy;\n        }\n        // Translate the control points\n        if (this.points) {\n            for (let i = 0; i < this.points.length; i += 1) {\n                if (this.points[i]) {\n                    this.points[i].x = this.points[i].x * sx;\n                    this.points[i].y = this.points[i].y * sy;\n                }\n            }\n        }\n        // Translates the geometry\n        if (!this.relative) {\n            this.x *= sx;\n            this.y *= sy;\n            if (fixedAspect) {\n                sy = sx = Math.min(sx, sy);\n            }\n            this.width *= sx;\n            this.height *= sy;\n        }\n    }\n    /**\n     * Returns true if the given object equals this geometry.\n     */\n    equals(geom) {\n        if (!geom)\n            return false;\n        return (super.equals(geom) &&\n            this.relative === geom.relative &&\n            ((this.sourcePoint === null && geom.sourcePoint === null) ||\n                !!this.sourcePoint?.equals(geom.sourcePoint)) &&\n            ((this.targetPoint === null && geom.targetPoint === null) ||\n                !!this.targetPoint?.equals(geom.targetPoint)) &&\n            equalPoints(this.points, geom.points) &&\n            ((this.alternateBounds === null && geom.alternateBounds === null) ||\n                !!this.alternateBounds?.equals(geom.alternateBounds)) &&\n            ((this.offset === null && geom.offset === null) ||\n                !!this.offset?.equals(geom.offset)));\n    }\n    clone() {\n        return clone(this);\n    }\n}\nexport default Geometry;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\n/**\n * Scales an array of {@link Point}\n *\n * @param points array of {@link Point} to scale\n * @param scale the scaling to divide by\n * @private\n * @internal\n */\nexport function scalePointArray(points, scale) {\n    let result = [];\n    if (points != null) {\n        for (let i = 0; i < points.length; i += 1) {\n            if (points[i] != null) {\n                result[i] = new Point(Math.round((points[i].x / scale) * 10) / 10, Math.round((points[i].y / scale) * 10) / 10);\n            }\n            else {\n                result[i] = null;\n            }\n        }\n    }\n    else {\n        result = null;\n    }\n    return result;\n}\n/**\n * Scales an {@link CellState}.\n *\n * @param state {@link CellState} to scale\n * @param scale the scaling to divide by\n */\nexport function scaleCellState(state, scale) {\n    let result = null;\n    if (state != null) {\n        result = state.clone();\n        result.setRect(Math.round((state.x / scale) * 10) / 10, Math.round((state.y / scale) * 10) / 10, Math.round((state.width / scale) * 10) / 10, Math.round((state.height / scale) * 10) / 10);\n    }\n    return result;\n}\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport { contains } from '../../../util/mathUtils.js';\nimport { scaleCellState, scalePointArray } from './shared.js';\n/**\n * Implements an orthogonal edge style.\n * Use {@link EdgeSegmentHandler} as an interactive handler for this style.\n *\n * This EdgeStyle is registered under `segmentEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'segment'\n * - isOrthogonal: true\n *\n * @param state {@link CellState} that represents the edge to be updated.\n * @param sourceScaled {@link CellState} that represents the source terminal.\n * @param targetScaled {@link CellState} that represents the target terminal.\n * @param controlHints List of relative control points.\n * @param result Array of {@link Point} that represent the actual points of the edge.\n */\nexport const SegmentConnector = (state, sourceScaled, targetScaled, controlHints, result) => {\n    // Creates array of all way- and terminal points\n    // TODO: Figure out what to do when there are nulls in `pts`!\n    const pts = scalePointArray(state.absolutePoints, state.view.scale);\n    const source = scaleCellState(sourceScaled, state.view.scale);\n    const target = scaleCellState(targetScaled, state.view.scale);\n    const tol = 1;\n    // Whether the first segment outgoing from the source end is horizontal\n    let lastPushed = result.length > 0 ? result[0] : null;\n    let horizontal = true;\n    let hint = null;\n    // Adds waypoints only if outside of tolerance\n    function pushPoint(pt) {\n        pt.x = Math.round(pt.x * state.view.scale * 10) / 10;\n        pt.y = Math.round(pt.y * state.view.scale * 10) / 10;\n        if (lastPushed == null ||\n            Math.abs(lastPushed.x - pt.x) >= tol ||\n            Math.abs(lastPushed.y - pt.y) >= Math.max(1, state.view.scale)) {\n            result.push(pt);\n            lastPushed = pt;\n        }\n        return lastPushed;\n    }\n    // Adds the first point\n    let pt = pts[0];\n    if (pt == null && source != null) {\n        pt = new Point(state.view.getRoutingCenterX(source), state.view.getRoutingCenterY(source));\n    }\n    else if (pt != null) {\n        pt = pt.clone();\n    }\n    const lastInx = pts.length - 1;\n    let pe = null;\n    // Adds the waypoints\n    if (controlHints != null && controlHints.length > 0) {\n        // Converts all hints and removes nulls\n        let hints = [];\n        for (let i = 0; i < controlHints.length; i += 1) {\n            const tmp = state.view.transformControlPoint(state, controlHints[i], true);\n            if (tmp != null) {\n                hints.push(tmp);\n            }\n        }\n        if (hints.length === 0) {\n            return;\n        }\n        // Aligns source and target hint to fixed points\n        if (pt != null && hints[0] != null) {\n            if (Math.abs(hints[0].x - pt.x) < tol) {\n                hints[0].x = pt.x;\n            }\n            if (Math.abs(hints[0].y - pt.y) < tol) {\n                hints[0].y = pt.y;\n            }\n        }\n        pe = pts[lastInx];\n        if (pe != null && hints[hints.length - 1] != null) {\n            if (Math.abs(hints[hints.length - 1].x - pe.x) < tol) {\n                hints[hints.length - 1].x = pe.x;\n            }\n            if (Math.abs(hints[hints.length - 1].y - pe.y) < tol) {\n                hints[hints.length - 1].y = pe.y;\n            }\n        }\n        hint = hints[0];\n        let currentTerm = source;\n        let currentPt = pts[0];\n        let hozChan = false;\n        let vertChan = false;\n        let currentHint = hint;\n        if (currentPt != null) {\n            currentTerm = null;\n        }\n        // Check for alignment with fixed points and with channels\n        // at source and target segments only\n        for (let i = 0; i < 2; i += 1) {\n            const fixedVertAlign = currentPt != null && currentPt.x === currentHint.x;\n            const fixedHozAlign = currentPt != null && currentPt.y === currentHint.y;\n            const inHozChan = currentTerm != null &&\n                currentHint.y >= currentTerm.y &&\n                currentHint.y <= currentTerm.y + currentTerm.height;\n            const inVertChan = currentTerm != null &&\n                currentHint.x >= currentTerm.x &&\n                currentHint.x <= currentTerm.x + currentTerm.width;\n            hozChan = fixedHozAlign || (currentPt == null && inHozChan);\n            vertChan = fixedVertAlign || (currentPt == null && inVertChan);\n            // If the current hint falls in both the hor and vert channels in the case\n            // of a floating port, or if the hint is exactly co-incident with a\n            // fixed point, ignore the source and try to work out the orientation\n            // from the target end\n            if (!(i == 0 && ((hozChan && vertChan) || (fixedVertAlign && fixedHozAlign)))) {\n                if (currentPt != null &&\n                    !fixedHozAlign &&\n                    !fixedVertAlign &&\n                    (inHozChan || inVertChan)) {\n                    horizontal = !inHozChan;\n                    break;\n                }\n                if (vertChan || hozChan) {\n                    horizontal = hozChan;\n                    if (i === 1) {\n                        // Work back from target end\n                        horizontal = hints.length % 2 === 0 ? hozChan : vertChan;\n                    }\n                    break;\n                }\n            }\n            currentTerm = target;\n            currentPt = pts[lastInx];\n            if (currentPt != null) {\n                currentTerm = null;\n            }\n            currentHint = hints[hints.length - 1];\n            if (fixedVertAlign && fixedHozAlign) {\n                hints = hints.slice(1);\n            }\n        }\n        if (horizontal &&\n            ((pts[0] != null && pts[0].y !== hint.y) ||\n                (pts[0] == null &&\n                    source != null &&\n                    (hint.y < source.y || hint.y > source.y + source.height)))) {\n            pushPoint(new Point(pt.x, hint.y));\n        }\n        else if (!horizontal &&\n            ((pts[0] != null && pts[0].x !== hint.x) ||\n                (pts[0] == null &&\n                    source != null &&\n                    (hint.x < source.x || hint.x > source.x + source.width)))) {\n            pushPoint(new Point(hint.x, pt.y));\n        }\n        if (horizontal) {\n            pt.y = hint.y;\n        }\n        else {\n            pt.x = hint.x;\n        }\n        for (let i = 0; i < hints.length; i += 1) {\n            horizontal = !horizontal;\n            hint = hints[i];\n            if (horizontal) {\n                pt.y = hint.y;\n            }\n            else {\n                pt.x = hint.x;\n            }\n            pushPoint(pt.clone());\n        }\n    }\n    else {\n        hint = pt;\n        // FIXME: First click in connect preview toggles orientation\n        horizontal = true;\n    }\n    // Adds the last point\n    pt = pts[lastInx];\n    if (pt == null && target != null) {\n        pt = new Point(state.view.getRoutingCenterX(target), state.view.getRoutingCenterY(target));\n    }\n    if (pt != null) {\n        if (hint != null) {\n            if (horizontal &&\n                ((pts[lastInx] != null && pts[lastInx].y !== hint.y) ||\n                    (pts[lastInx] == null &&\n                        target != null &&\n                        (hint.y < target.y || hint.y > target.y + target.height)))) {\n                pushPoint(new Point(pt.x, hint.y));\n            }\n            else if (!horizontal &&\n                ((pts[lastInx] != null && pts[lastInx].x !== hint.x) ||\n                    (pts[lastInx] == null &&\n                        target != null &&\n                        (hint.x < target.x || hint.x > target.x + target.width)))) {\n                pushPoint(new Point(hint.x, pt.y));\n            }\n        }\n    }\n    // Removes bends inside the source terminal for floating ports\n    if (pts[0] == null && source != null) {\n        while (result.length > 1 &&\n            result[1] != null &&\n            contains(source, result[1].x, result[1].y)) {\n            result.splice(1, 1);\n        }\n    }\n    // Removes bends inside the target terminal\n    if (pts[lastInx] == null && target != null) {\n        while (result.length > 1 &&\n            result[result.length - 1] != null &&\n            contains(target, result[result.length - 1].x, result[result.length - 1].y)) {\n            result.splice(result.length - 1, 1);\n        }\n    }\n    // Removes last point if inside tolerance with end point\n    if (pe != null &&\n        result[result.length - 1] != null &&\n        Math.abs(pe.x - result[result.length - 1].x) <= tol &&\n        Math.abs(pe.y - result[result.length - 1].y) <= tol) {\n        result.splice(result.length - 1, 1);\n        // Lines up second last point in result with end point\n        if (result[result.length - 1] != null) {\n            if (Math.abs(result[result.length - 1].x - pe.x) < tol) {\n                result[result.length - 1].x = pe.x;\n            }\n            if (Math.abs(result[result.length - 1].y - pe.y) < tol) {\n                result[result.length - 1].y = pe.y;\n            }\n        }\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { scaleCellState, scalePointArray } from './shared.js';\nimport { DEFAULT_MARKERSIZE, DIRECTION_MASK, NONE } from '../../../util/Constants.js';\nimport { getBoundingBox, getPortConstraints, reversePortConstraints, } from '../../../util/mathUtils.js';\nimport { OrthogonalConnectorConfig } from '../config.js';\nimport Point from '../../geometry/Point.js';\nimport Rectangle from '../../geometry/Rectangle.js';\nimport { SegmentConnector } from './Segment.js';\nconst dirVectors = [\n    [-1, 0],\n    [0, -1],\n    [1, 0],\n    [0, 1],\n    [-1, 0],\n    [0, -1],\n    [1, 0],\n];\nconst wayPoints1 = [\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n    [0, 0],\n];\nconst routePatterns = [\n    [\n        [513, 2308, 2081, 2562],\n        [513, 1090, 514, 2184, 2114, 2561],\n        [513, 1090, 514, 2564, 2184, 2562],\n        [513, 2308, 2561, 1090, 514, 2568, 2308],\n    ],\n    [\n        [514, 1057, 513, 2308, 2081, 2562],\n        [514, 2184, 2114, 2561],\n        [514, 2184, 2562, 1057, 513, 2564, 2184],\n        [514, 1057, 513, 2568, 2308, 2561],\n    ],\n    [\n        [1090, 514, 1057, 513, 2308, 2081, 2562],\n        [2114, 2561],\n        [1090, 2562, 1057, 513, 2564, 2184],\n        [1090, 514, 1057, 513, 2308, 2561, 2568],\n    ],\n    [\n        [2081, 2562],\n        [1057, 513, 1090, 514, 2184, 2114, 2561],\n        [1057, 513, 1090, 514, 2184, 2562, 2564],\n        [1057, 2561, 1090, 514, 2568, 2308],\n    ],\n];\nconst vertexSeparations = [];\nconst limits = [\n    [0, 0, 0, 0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0, 0, 0, 0],\n];\n// const LEFT_MASK = 32;\n//\n// const TOP_MASK = 64;\n//\n// const RIGHT_MASK = 128;\n//\n// const BOTTOM_MASK = 256;\n//\n// const LEFT = 1;\n//\n// const TOP = 2;\n//\n// const RIGHT = 4;\n//\n// const BOTTOM = 8;\n// TODO remove magic numbers\nconst SIDE_MASK = 480;\n// LEFT_MASK | TOP_MASK | RIGHT_MASK | BOTTOM_MASK,\nconst CENTER_MASK = 512;\nconst SOURCE_MASK = 1024;\nconst TARGET_MASK = 2048;\nconst VERTEX_MASK = 3072;\n// SOURCE_MASK | TARGET_MASK,\nfunction getJettySize(state, isSource) {\n    const buffer = OrthogonalConnectorConfig.buffer;\n    let value = (isSource ? state.style.sourceJettySize : state.style.targetJettySize) ??\n        state.style.jettySize ??\n        buffer;\n    if (value === 'auto') {\n        // Computes the automatic jetty size\n        const type = (isSource ? state.style.startArrow : state.style.endArrow) ?? NONE;\n        if (type !== NONE) {\n            const size = (isSource ? state.style.startSize : state.style.endSize) ?? DEFAULT_MARKERSIZE;\n            value = Math.max(2, Math.ceil((size + buffer) / buffer)) * buffer;\n        }\n        else {\n            value = 2 * buffer;\n        }\n    }\n    return value;\n}\n/**\n * Implements a local orthogonal router between the given cells.\n *\n * This EdgeStyle is registered under `orthogonalEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'segment'\n * - isOrthogonal: true\n *\n * @param state {@link CellState} that represents the edge to be updated.\n * @param sourceScaled {@link CellState} that represents the source terminal.\n * @param targetScaled {@link CellState} that represents the target terminal.\n * @param controlHints List of relative control {@link Point}s.\n * @param result Array of {@link Point}s that represent the actual points of the edge.\n */\nexport const OrthogonalConnector = (state, sourceScaled, targetScaled, controlHints, result) => {\n    // TODO: Figure out what to do when there are nulls in `pts`!\n    const pts = scalePointArray(state.absolutePoints, state.view.scale);\n    const source = scaleCellState(sourceScaled, state.view.scale);\n    const target = scaleCellState(targetScaled, state.view.scale);\n    const sourceEdge = source == null ? false : source.cell.isEdge();\n    const targetEdge = target == null ? false : target.cell.isEdge();\n    const p0 = pts[0];\n    const pe = pts[pts.length - 1];\n    let sourceX = source != null ? source.x : p0.x;\n    let sourceY = source != null ? source.y : p0.y;\n    let sourceWidth = source != null ? source.width : 0;\n    let sourceHeight = source != null ? source.height : 0;\n    let targetX = target != null ? target.x : pe.x;\n    let targetY = target != null ? target.y : pe.y;\n    let targetWidth = target != null ? target.width : 0;\n    let targetHeight = target != null ? target.height : 0;\n    let sourceBuffer = getJettySize(state, true);\n    let targetBuffer = getJettySize(state, false);\n    // Workaround for loop routing within buffer zone\n    if (source != null && target === source) {\n        targetBuffer = Math.max(sourceBuffer, targetBuffer);\n        sourceBuffer = targetBuffer;\n    }\n    const totalBuffer = targetBuffer + sourceBuffer;\n    let tooShort = false;\n    // Checks minimum distance for fixed points and falls back to segment connector\n    if (p0 != null && pe != null) {\n        const dx = pe.x - p0.x;\n        const dy = pe.y - p0.y;\n        tooShort = dx * dx + dy * dy < totalBuffer * totalBuffer;\n    }\n    if (tooShort ||\n        (OrthogonalConnectorConfig.pointsFallback &&\n            controlHints != null &&\n            controlHints.length > 0) ||\n        sourceEdge ||\n        targetEdge) {\n        SegmentConnector(state, sourceScaled, targetScaled, controlHints, result);\n        return;\n    }\n    // Determine the side(s) of the source and target vertices\n    // that the edge may connect to\n    // portConstraint [source, target]\n    const portConstraint = [DIRECTION_MASK.ALL, DIRECTION_MASK.ALL];\n    let rotation = 0;\n    if (source != null) {\n        portConstraint[0] = getPortConstraints(source, state, true, DIRECTION_MASK.ALL);\n        rotation = source.style.rotation ?? 0;\n        if (rotation !== 0) {\n            const newRect = (getBoundingBox(new Rectangle(sourceX, sourceY, sourceWidth, sourceHeight), rotation));\n            sourceX = newRect.x;\n            sourceY = newRect.y;\n            sourceWidth = newRect.width;\n            sourceHeight = newRect.height;\n        }\n    }\n    if (target != null) {\n        portConstraint[1] = getPortConstraints(target, state, false, DIRECTION_MASK.ALL);\n        rotation = target.style.rotation ?? 0;\n        if (rotation !== 0) {\n            const newRect = (getBoundingBox(new Rectangle(targetX, targetY, targetWidth, targetHeight), rotation));\n            targetX = newRect.x;\n            targetY = newRect.y;\n            targetWidth = newRect.width;\n            targetHeight = newRect.height;\n        }\n    }\n    const dir = [0, 0];\n    // Work out which faces of the vertices present against each other\n    // in a way that would allow a 3-segment connection if port constraints\n    // permitted.\n    // geo -> [source, target] [x, y, width, height]\n    const geo = [\n        [sourceX, sourceY, sourceWidth, sourceHeight],\n        [targetX, targetY, targetWidth, targetHeight],\n    ];\n    const buffer = [sourceBuffer, targetBuffer];\n    for (let i = 0; i < 2; i += 1) {\n        limits[i][1] = geo[i][0] - buffer[i];\n        limits[i][2] = geo[i][1] - buffer[i];\n        limits[i][4] = geo[i][0] + geo[i][2] + buffer[i];\n        limits[i][8] = geo[i][1] + geo[i][3] + buffer[i];\n    }\n    // Work out which quad the target is in\n    const sourceCenX = geo[0][0] + geo[0][2] / 2.0;\n    const sourceCenY = geo[0][1] + geo[0][3] / 2.0;\n    const targetCenX = geo[1][0] + geo[1][2] / 2.0;\n    const targetCenY = geo[1][1] + geo[1][3] / 2.0;\n    const dx = sourceCenX - targetCenX;\n    const dy = sourceCenY - targetCenY;\n    let quad = 0;\n    // 0 | 1\n    // -----\n    // 3 | 2\n    if (dx < 0) {\n        if (dy < 0) {\n            quad = 2;\n        }\n        else {\n            quad = 1;\n        }\n    }\n    else if (dy <= 0) {\n        quad = 3;\n        // Special case on x = 0 and negative y\n        if (dx === 0) {\n            quad = 2;\n        }\n    }\n    // Check for connection constraints\n    let currentTerm = null;\n    if (source != null) {\n        currentTerm = p0;\n    }\n    const constraint = [\n        [0.5, 0.5],\n        [0.5, 0.5],\n    ];\n    for (let i = 0; i < 2; i += 1) {\n        if (currentTerm != null) {\n            constraint[i][0] = (currentTerm.x - geo[i][0]) / geo[i][2];\n            if (Math.abs(currentTerm.x - geo[i][0]) <= 1) {\n                dir[i] = DIRECTION_MASK.WEST;\n            }\n            else if (Math.abs(currentTerm.x - geo[i][0] - geo[i][2]) <= 1) {\n                dir[i] = DIRECTION_MASK.EAST;\n            }\n            constraint[i][1] = (currentTerm.y - geo[i][1]) / geo[i][3];\n            if (Math.abs(currentTerm.y - geo[i][1]) <= 1) {\n                dir[i] = DIRECTION_MASK.NORTH;\n            }\n            else if (Math.abs(currentTerm.y - geo[i][1] - geo[i][3]) <= 1) {\n                dir[i] = DIRECTION_MASK.SOUTH;\n            }\n        }\n        currentTerm = null;\n        if (target != null) {\n            currentTerm = pe;\n        }\n    }\n    const sourceTopDist = geo[0][1] - (geo[1][1] + geo[1][3]);\n    const sourceLeftDist = geo[0][0] - (geo[1][0] + geo[1][2]);\n    const sourceBottomDist = geo[1][1] - (geo[0][1] + geo[0][3]);\n    const sourceRightDist = geo[1][0] - (geo[0][0] + geo[0][2]);\n    vertexSeparations[1] = Math.max(sourceLeftDist - totalBuffer, 0);\n    vertexSeparations[2] = Math.max(sourceTopDist - totalBuffer, 0);\n    vertexSeparations[4] = Math.max(sourceBottomDist - totalBuffer, 0);\n    vertexSeparations[3] = Math.max(sourceRightDist - totalBuffer, 0);\n    //= =============================================================\n    // Start of source and target direction determination\n    // Work through the preferred orientations by relative positioning\n    // of the vertices and list them in preferred and available order\n    const dirPref = [];\n    const horPref = [];\n    const vertPref = [];\n    horPref[0] =\n        sourceLeftDist >= sourceRightDist ? DIRECTION_MASK.WEST : DIRECTION_MASK.EAST;\n    vertPref[0] =\n        sourceTopDist >= sourceBottomDist ? DIRECTION_MASK.NORTH : DIRECTION_MASK.SOUTH;\n    horPref[1] = reversePortConstraints(horPref[0]);\n    vertPref[1] = reversePortConstraints(vertPref[0]);\n    const preferredHorizDist = sourceLeftDist >= sourceRightDist ? sourceLeftDist : sourceRightDist;\n    const preferredVertDist = sourceTopDist >= sourceBottomDist ? sourceTopDist : sourceBottomDist;\n    const prefOrdering = [\n        [0, 0],\n        [0, 0],\n    ];\n    let preferredOrderSet = false;\n    // If the preferred port isn't available, switch it\n    for (let i = 0; i < 2; i += 1) {\n        if (dir[i] !== 0x0) {\n            continue;\n        }\n        if ((horPref[i] & portConstraint[i]) === 0) {\n            horPref[i] = reversePortConstraints(horPref[i]);\n        }\n        if ((vertPref[i] & portConstraint[i]) === 0) {\n            vertPref[i] = reversePortConstraints(vertPref[i]);\n        }\n        prefOrdering[i][0] = vertPref[i];\n        prefOrdering[i][1] = horPref[i];\n    }\n    if (preferredVertDist > 0 && preferredHorizDist > 0) {\n        // Possibility of two segment edge connection\n        if ((horPref[0] & portConstraint[0]) > 0 && (vertPref[1] & portConstraint[1]) > 0) {\n            prefOrdering[0][0] = horPref[0];\n            prefOrdering[0][1] = vertPref[0];\n            prefOrdering[1][0] = vertPref[1];\n            prefOrdering[1][1] = horPref[1];\n            preferredOrderSet = true;\n        }\n        else if ((vertPref[0] & portConstraint[0]) > 0 &&\n            (horPref[1] & portConstraint[1]) > 0) {\n            prefOrdering[0][0] = vertPref[0];\n            prefOrdering[0][1] = horPref[0];\n            prefOrdering[1][0] = horPref[1];\n            prefOrdering[1][1] = vertPref[1];\n            preferredOrderSet = true;\n        }\n    }\n    if (preferredVertDist > 0 && !preferredOrderSet) {\n        prefOrdering[0][0] = vertPref[0];\n        prefOrdering[0][1] = horPref[0];\n        prefOrdering[1][0] = vertPref[1];\n        prefOrdering[1][1] = horPref[1];\n        preferredOrderSet = true;\n    }\n    if (preferredHorizDist > 0 && !preferredOrderSet) {\n        prefOrdering[0][0] = horPref[0];\n        prefOrdering[0][1] = vertPref[0];\n        prefOrdering[1][0] = horPref[1];\n        prefOrdering[1][1] = vertPref[1];\n        preferredOrderSet = true;\n    }\n    // The source and target prefs are now an ordered list of\n    // the preferred port selections\n    // If the list contains gaps, compact it\n    for (let i = 0; i < 2; i += 1) {\n        if (dir[i] !== 0x0) {\n            continue;\n        }\n        if ((prefOrdering[i][0] & portConstraint[i]) === 0) {\n            prefOrdering[i][0] = prefOrdering[i][1];\n        }\n        dirPref[i] = prefOrdering[i][0] & portConstraint[i];\n        dirPref[i] |= (prefOrdering[i][1] & portConstraint[i]) << 8;\n        dirPref[i] |= (prefOrdering[1 - i][i] & portConstraint[i]) << 16;\n        dirPref[i] |= (prefOrdering[1 - i][1 - i] & portConstraint[i]) << 24;\n        if ((dirPref[i] & 0xf) === 0) {\n            dirPref[i] = dirPref[i] << 8;\n        }\n        if ((dirPref[i] & 0xf00) === 0) {\n            dirPref[i] = (dirPref[i] & 0xf) | (dirPref[i] >> 8);\n        }\n        if ((dirPref[i] & 0xf0000) === 0) {\n            dirPref[i] = (dirPref[i] & 0xffff) | ((dirPref[i] & 0xf000000) >> 8);\n        }\n        dir[i] = dirPref[i] & 0xf;\n        if (portConstraint[i] === DIRECTION_MASK.WEST ||\n            portConstraint[i] === DIRECTION_MASK.NORTH ||\n            portConstraint[i] === DIRECTION_MASK.EAST ||\n            portConstraint[i] === DIRECTION_MASK.SOUTH) {\n            dir[i] = portConstraint[i];\n        }\n    }\n    //= =============================================================\n    // End of source and target direction determination\n    let sourceIndex = dir[0] === DIRECTION_MASK.EAST ? 3 : dir[0];\n    let targetIndex = dir[1] === DIRECTION_MASK.EAST ? 3 : dir[1];\n    sourceIndex -= quad;\n    targetIndex -= quad;\n    if (sourceIndex < 1) {\n        sourceIndex += 4;\n    }\n    if (targetIndex < 1) {\n        targetIndex += 4;\n    }\n    const routePattern = routePatterns[sourceIndex - 1][targetIndex - 1];\n    wayPoints1[0][0] = geo[0][0];\n    wayPoints1[0][1] = geo[0][1];\n    switch (dir[0]) {\n        case DIRECTION_MASK.WEST:\n            wayPoints1[0][0] -= sourceBuffer;\n            wayPoints1[0][1] += constraint[0][1] * geo[0][3];\n            break;\n        case DIRECTION_MASK.SOUTH:\n            wayPoints1[0][0] += constraint[0][0] * geo[0][2];\n            wayPoints1[0][1] += geo[0][3] + sourceBuffer;\n            break;\n        case DIRECTION_MASK.EAST:\n            wayPoints1[0][0] += geo[0][2] + sourceBuffer;\n            wayPoints1[0][1] += constraint[0][1] * geo[0][3];\n            break;\n        case DIRECTION_MASK.NORTH:\n            wayPoints1[0][0] += constraint[0][0] * geo[0][2];\n            wayPoints1[0][1] -= sourceBuffer;\n            break;\n    }\n    let currentIndex = 0;\n    // Orientation, 0 horizontal, 1 vertical\n    let lastOrientation = (dir[0] & (DIRECTION_MASK.EAST | DIRECTION_MASK.WEST)) > 0 ? 0 : 1;\n    const initialOrientation = lastOrientation;\n    let currentOrientation = 0;\n    for (let i = 0; i < routePattern.length; i += 1) {\n        const nextDirection = routePattern[i] & 0xf;\n        // Rotate the index of this direction by the quad\n        // to get the real direction\n        let directionIndex = nextDirection === DIRECTION_MASK.EAST ? 3 : nextDirection;\n        directionIndex += quad;\n        if (directionIndex > 4) {\n            directionIndex -= 4;\n        }\n        const direction = dirVectors[directionIndex - 1];\n        currentOrientation = directionIndex % 2 > 0 ? 0 : 1;\n        // Only update the current index if the point moved\n        // in the direction of the current segment move,\n        // otherwise the same point is moved until there is\n        // a segment direction change\n        if (currentOrientation !== lastOrientation) {\n            currentIndex++;\n            // Copy the previous way point into the new one\n            // We can't base the new position on index - 1\n            // because sometime elbows turn out not to exist,\n            // then we'd have to rewind.\n            wayPoints1[currentIndex][0] = wayPoints1[currentIndex - 1][0];\n            wayPoints1[currentIndex][1] = wayPoints1[currentIndex - 1][1];\n        }\n        const tar = (routePattern[i] & TARGET_MASK) > 0;\n        const sou = (routePattern[i] & SOURCE_MASK) > 0;\n        let side = (routePattern[i] & SIDE_MASK) >> 5;\n        side <<= quad;\n        if (side > 0xf) {\n            side >>= 4;\n        }\n        const center = (routePattern[i] & CENTER_MASK) > 0;\n        if ((sou || tar) && side < 9) {\n            let limit = 0;\n            const souTar = sou ? 0 : 1;\n            if (center && currentOrientation === 0) {\n                limit = geo[souTar][0] + constraint[souTar][0] * geo[souTar][2];\n            }\n            else if (center) {\n                limit = geo[souTar][1] + constraint[souTar][1] * geo[souTar][3];\n            }\n            else {\n                limit = limits[souTar][side];\n            }\n            if (currentOrientation === 0) {\n                const lastX = wayPoints1[currentIndex][0];\n                const deltaX = (limit - lastX) * direction[0];\n                if (deltaX > 0) {\n                    wayPoints1[currentIndex][0] += direction[0] * deltaX;\n                }\n            }\n            else {\n                const lastY = wayPoints1[currentIndex][1];\n                const deltaY = (limit - lastY) * direction[1];\n                if (deltaY > 0) {\n                    wayPoints1[currentIndex][1] += direction[1] * deltaY;\n                }\n            }\n        }\n        else if (center) {\n            // Which center we're travelling to depend on the current direction\n            wayPoints1[currentIndex][0] +=\n                direction[0] * Math.abs(vertexSeparations[directionIndex] / 2);\n            wayPoints1[currentIndex][1] +=\n                direction[1] * Math.abs(vertexSeparations[directionIndex] / 2);\n        }\n        if (currentIndex > 0 &&\n            wayPoints1[currentIndex][currentOrientation] ===\n                wayPoints1[currentIndex - 1][currentOrientation]) {\n            currentIndex--;\n        }\n        else {\n            lastOrientation = currentOrientation;\n        }\n    }\n    for (let i = 0; i <= currentIndex; i += 1) {\n        if (i === currentIndex) {\n            // Last point can cause last segment to be in\n            // same direction as jetty/approach. If so,\n            // check the number of points is consistent\n            // with the relative orientation of source and target\n            // jx. Same orientation requires an even\n            // number of turns (points), different requires\n            // odd.\n            const targetOrientation = (dir[1] & (DIRECTION_MASK.EAST | DIRECTION_MASK.WEST)) > 0 ? 0 : 1;\n            const sameOrient = targetOrientation === initialOrientation ? 0 : 1;\n            // (currentIndex + 1) % 2 is 0 for even number of points,\n            // 1 for odd\n            if (sameOrient !== (currentIndex + 1) % 2) {\n                // The last point isn't required\n                break;\n            }\n        }\n        result.push(new Point(Math.round(wayPoints1[i][0] * state.view.scale * 10) / 10, Math.round(wayPoints1[i][1] * state.view.scale * 10) / 10));\n    }\n    // Removes duplicates\n    let index = 1;\n    while (index < result.length) {\n        if (result[index - 1] == null ||\n            result[index] == null ||\n            result[index - 1].x !== result[index].x ||\n            result[index - 1].y !== result[index].y) {\n            index++;\n        }\n        else {\n            result.splice(index, 1);\n        }\n    }\n};\n","/*\nCopyright 2023-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport Rectangle from '../../geometry/Rectangle.js';\nimport { ManhattanConnectorConfig } from '../config.js';\nimport Geometry from '../../geometry/Geometry.js';\nimport { OrthogonalConnector } from './Orthogonal.js';\nimport { SegmentConnector } from './Segment.js';\n/**\n * ManhattanConnector code is based on code from https://github.com/mwangm/mxgraph-manhattan-connector\n *\n * Implements router to find the shortest route that avoids cells using manhattan distance as metric.\n *\n * This EdgeStyle is registered under `manhattanEdgeStyle` in {@link EdgeStyleRegistry} when using {@link Graph} or calling {@link registerDefaultEdgeStyles}.\n *\n * **IMPORTANT**: When registering it manually  in {@link EdgeStyleRegistry}, the following metadata must be used:\n * - handlerKind: 'segment'\n * - isOrthogonal: true\n */\nexport const ManhattanConnector = (state, source, target, points, result) => {\n    /**\n     * Adds all values from source geometry to target.\n     * Used to create padding box around cell geometry.\n     * @param target\n     * @param source\n     * @returns\n     */\n    function moveAndExpand(target, source) {\n        target.x += source.x || 0;\n        target.y += source.y || 0;\n        target.width += source.width || 0;\n        target.height += source.height || 0;\n        return target;\n    }\n    function snapCoordinateToGrid(value, gridSize) {\n        return gridSize * Math.round(value / gridSize);\n    }\n    function snapPointToGrid(p, gx, gy) {\n        p.x = snapCoordinateToGrid(p.x, gx);\n        p.y = snapCoordinateToGrid(p.y, gy || gx);\n        return p;\n    }\n    function isPointInRectangle(rect, p) {\n        return (p.x >= rect.x &&\n            p.x <= rect.x + rect.width &&\n            p.y >= rect.y &&\n            p.y <= rect.y + rect.height);\n    }\n    function getRectangleCenter(rect) {\n        return new Point(rect.x + rect.width / 2, rect.y + rect.height / 2);\n    }\n    function getDifferencePoint(p1, p2) {\n        return new Point(p1.x - p2.x, p1.y - p2.y);\n    }\n    function movePoint(p, moveX, moveY) {\n        p.x += moveX || 0;\n        p.y += moveY || 0;\n        return p;\n    }\n    function getPointTheta(p1, p2) {\n        const p = p2.clone();\n        const y = -(p.y - p1.y);\n        const x = p.x - p1.x;\n        const PRECISION = 10;\n        const rad = y.toFixed(PRECISION) == '0' && x.toFixed(PRECISION) == '0' ? 0 : Math.atan2(y, x);\n        return (180 * rad) / Math.PI;\n    }\n    function normalizePoint(point) {\n        return new Point(point.x === 0 ? 0 : Math.abs(point.x) / point.x, point.y === 0 ? 0 : Math.abs(point.y) / point.y);\n    }\n    function getManhattanDistance(p1, p2) {\n        return Math.abs(p2.x - p1.x) + Math.abs(p2.y - p1.y);\n    }\n    function toPointFromString(pointString) {\n        const xy = pointString.split(pointString.indexOf('@') === -1 ? ' ' : '@');\n        return new Point(parseInt(xy[0], 10), parseInt(xy[1], 10));\n    }\n    function pointToString(point) {\n        return `${point.x}@${point.y}`;\n    }\n    function getCellAbsoluteBounds(cellState) {\n        const graph = cellState.view.graph;\n        const cellBounds = graph.getCellBounds(cellState.cell, false, false)?.clone();\n        if (!cellBounds)\n            return undefined;\n        const view = graph.view;\n        const { scale, translate } = view;\n        const { x, y } = translate;\n        const round = (v) => Math.round(v * 10) / 10;\n        const res = new Rectangle(round(cellBounds.x / scale - x), round(cellBounds.y / scale - y), round(cellBounds.width / scale), round(cellBounds.height / scale));\n        return res;\n    }\n    const mStep = ManhattanConnectorConfig.step;\n    const config = {\n        // Padding applied on the element bounding boxes\n        paddingBox: new Geometry(-mStep, -mStep, mStep * 2, mStep * 2),\n        // An array of directions to find next points on the route\n        directions: [\n            {\n                offsetX: mStep,\n                offsetY: 0,\n                cost: mStep,\n                angle: normalizeAngle(getPointTheta(new Point(0, 0), new Point(mStep, 0))),\n            },\n            {\n                offsetX: 0,\n                offsetY: mStep,\n                cost: mStep,\n                angle: normalizeAngle(getPointTheta(new Point(0, 0), new Point(0, mStep))),\n            },\n            {\n                offsetX: -mStep,\n                offsetY: 0,\n                cost: mStep,\n                angle: normalizeAngle(getPointTheta(new Point(0, 0), new Point(-mStep, 0))),\n            },\n            {\n                offsetX: 0,\n                offsetY: -mStep,\n                cost: mStep,\n                angle: normalizeAngle(getPointTheta(new Point(0, 0), new Point(0, -mStep))),\n            },\n        ],\n        directionMap: {\n            east: { x: 1, y: 0 },\n            south: { x: 0, y: 1 },\n            west: { x: -1, y: 0 },\n            north: { x: 0, y: -1 },\n        },\n        // A penalty received for direction change\n        penaltiesGenerator: (angle) => {\n            if (angle == 45 || angle == 90 || angle == 180)\n                return mStep / 2;\n            return 0;\n        },\n        // If a function is provided, it's used to route the link while dragging an end\n        // i.e. function(from, to, opts) { return []; }\n        draggingRoute: null,\n        previousDirAngle: 0,\n    };\n    /**\n     * Map of obstacles\n     * Helper structure to identify whether a point lies in an obstacle.\n     */\n    class ObstacleMap {\n        constructor(opt) {\n            this.options = opt;\n            this.mapGridSize = 100;\n            this.map = new Map();\n        }\n        // Builds a map of all elements for quicker obstacle queries\n        // The svg is divided to  cells, where each of them holds an information which\n        // elements belong to it. When we query whether a point is in an obstacle we don't need\n        // to go through all obstacles, we check only those in a particular cell.\n        build(source, target) {\n            const graph = source?.view.graph || target?.view.graph;\n            if (!graph)\n                return;\n            return Array.from(graph.getView().getCellStates())\n                .filter((s) => s.cell && s.cell.isVertex() && !s.cell.isEdge())\n                .map((s) => getCellAbsoluteBounds(s))\n                .map((bbox) => (bbox ? moveAndExpand(bbox, this.options.paddingBox) : null))\n                .forEach((bbox) => {\n                if (!bbox)\n                    return;\n                const origin = snapPointToGrid(new Point(bbox.x, bbox.y), this.mapGridSize);\n                const corner = snapPointToGrid(new Point(bbox.x + bbox.width, bbox.y + bbox.height), this.mapGridSize);\n                for (let x = origin.x; x <= corner.x; x += this.mapGridSize) {\n                    for (let y = origin.y; y <= corner.y; y += this.mapGridSize) {\n                        const gridKey = x + '@' + y;\n                        const rectArr = this.map.get(gridKey) || [];\n                        if (!this.map.has(gridKey))\n                            this.map.set(gridKey, rectArr);\n                        rectArr.push(bbox);\n                    }\n                }\n            });\n        }\n        isPointAccessible(point) {\n            const mapKey = pointToString(snapPointToGrid(point.clone(), this.mapGridSize));\n            const obstacles = this.map.get(mapKey);\n            if (obstacles) {\n                return obstacles.every((obstacle) => !isPointInRectangle(obstacle, point));\n            }\n            return true;\n        }\n    }\n    class SortedSet {\n        constructor() {\n            this.items = [];\n            this.hash = new Map();\n        }\n        add(key, value) {\n            const hashItem = this.hash.get(key);\n            if (hashItem) {\n                hashItem.value = value;\n                this.items.splice(this.items.indexOf(key), 1);\n            }\n            else {\n                this.hash.set(key, {\n                    value,\n                    open: true,\n                });\n            }\n            this.items.push(key);\n            this.items.sort((i1, i2) => {\n                const hashItem1 = this.hash.get(i1);\n                const hashItem2 = this.hash.get(i2);\n                if (!hashItem1 || !hashItem2)\n                    return 0;\n                return hashItem1.value - hashItem2.value;\n            });\n        }\n        remove(key) {\n            const hashItem = this.hash.get(key);\n            if (hashItem)\n                hashItem.open = false;\n        }\n        isOpen(key) {\n            const hashItem = this.hash.get(key);\n            return hashItem && hashItem.open == true;\n        }\n        isClose(key) {\n            const hashItem = this.hash.get(key);\n            return hashItem && hashItem.open == false;\n        }\n        isEmpty() {\n            return this.items.length == 0;\n        }\n        pop() {\n            const key = this.items.shift();\n            if (key)\n                this.remove(key);\n            return key;\n        }\n    }\n    function reconstructRoute(parents, endPoint, startCenter, endCenter) {\n        const route = [];\n        let previousDirection = normalizePoint(getDifferencePoint(endCenter, endPoint));\n        let current = endPoint;\n        let parent;\n        while (parents[pointToString(current)]) {\n            parent = parents[pointToString(current)];\n            if (!parent)\n                continue;\n            const direction = normalizePoint(getDifferencePoint(current, parent));\n            // Add point in when direction change\n            if (!direction.equals(previousDirection)) {\n                route.unshift(current);\n                previousDirection = direction;\n            }\n            current = parent;\n        }\n        const startDirection = normalizePoint(getDifferencePoint(current, startCenter));\n        if (!startDirection.equals(previousDirection)) {\n            route.unshift(current);\n        }\n        return route;\n    }\n    function getRectPoints(bbox, directions, opt) {\n        const step = ManhattanConnectorConfig.step;\n        const center = getRectangleCenter(bbox);\n        const res = [];\n        for (const direction of directions) {\n            const directionPoint = opt.directionMap[direction];\n            const x = (directionPoint.x * bbox.width) / 2;\n            const y = (directionPoint.y * bbox.height) / 2;\n            const point = movePoint(center.clone(), x, y);\n            if (isPointInRectangle(bbox, point)) {\n                movePoint(point, directionPoint.x * step, directionPoint.y * step);\n            }\n            res.push(snapPointToGrid(point, step));\n        }\n        return res;\n    }\n    function normalizeAngle(angle) {\n        return (angle % 360) + (angle < 0 ? 360 : 0);\n    }\n    function getDirectionAngle(start, end, directionLength) {\n        const q = 360 / directionLength;\n        return Math.floor(normalizeAngle(getPointTheta(start, end) + q / 2) / q) * q;\n    }\n    function getDirectionChange(angle1, angle2) {\n        const dirChange = Math.abs(angle1 - angle2);\n        return dirChange > 180 ? 360 - dirChange : dirChange;\n    }\n    function estimateCost(from, endPoints) {\n        let min = Infinity;\n        for (let i = 0, len = endPoints.length; i < len; i++) {\n            const cost = getManhattanDistance(from, endPoints[i]);\n            if (cost < min)\n                min = cost;\n        }\n        return min;\n    }\n    function alignPointToCell(point, edgeState, cellState, isSourceCell) {\n        const cellBounds = getCellAbsoluteBounds(cellState);\n        const y = isSourceCell ? edgeState.style.exitY : edgeState.style.entryY;\n        const onlyHorizontalDirections = isSourceCell\n            ? ManhattanConnectorConfig.startDirections.every((d) => d != 'north' && d != 'south')\n            : ManhattanConnectorConfig.endDirections.every((d) => d != 'north' && d != 'south');\n        if (y != undefined && onlyHorizontalDirections) {\n            const cellHeight = cellBounds?.height || 0;\n            point.y =\n                cellBounds?.y != undefined\n                    ? cellBounds?.y + cellHeight * y\n                    : point.y - cellHeight / 2 + cellHeight * y;\n        }\n        const x = isSourceCell ? edgeState.style.exitX : edgeState.style.entryX;\n        const onlyVerticalDirections = isSourceCell\n            ? ManhattanConnectorConfig.startDirections.every((d) => d != 'west' && d != 'east')\n            : ManhattanConnectorConfig.endDirections.every((d) => d != 'west' && d != 'east');\n        if (x != undefined && onlyVerticalDirections) {\n            const cellWidth = cellBounds?.width || 0;\n            point.x =\n                cellBounds?.x != undefined\n                    ? cellBounds?.x + cellWidth * x\n                    : point.x - cellWidth / 2 + cellWidth * (x || 0);\n        }\n    }\n    function findRoute(start, end, obstacleMap, opt) {\n        // Calculate start points and end points\n        const step = ManhattanConnectorConfig.step;\n        const startPoints = getRectPoints(start, ManhattanConnectorConfig.startDirections, opt).filter((p) => obstacleMap.isPointAccessible(p));\n        const startCenter = snapPointToGrid(getRectangleCenter(start), step);\n        const endPoints = getRectPoints(end, ManhattanConnectorConfig.endDirections, opt).filter((p) => obstacleMap.isPointAccessible(p));\n        const endCenter = snapPointToGrid(getRectangleCenter(end), step);\n        if (startPoints.length > 0 && endPoints.length > 0) {\n            // The set of possible  points to be evaluated, initially containing the start points.\n            const openSet = new SortedSet();\n            // Keeps predecessor of given element.\n            const parents = {};\n            // Cost from start to a point along best known path.\n            const costs = {};\n            startPoints.forEach((p) => {\n                const key = pointToString(p);\n                openSet.add(key, estimateCost(p, endPoints));\n                costs[key] = 0;\n            });\n            let loopsRemain = ManhattanConnectorConfig.maxLoops;\n            const endPointsKeys = endPoints.map((p) => pointToString(p));\n            let currentDirectionAngle;\n            let previousDirectionAngle;\n            // Main route finding loop\n            while (!openSet.isEmpty() && loopsRemain > 0) {\n                const currentKey = openSet.pop();\n                if (currentKey == undefined) {\n                    continue;\n                }\n                const currentPoint = toPointFromString(currentKey);\n                const currentCost = costs[currentKey];\n                previousDirectionAngle = currentDirectionAngle;\n                currentDirectionAngle = parents[currentKey]\n                    ? getDirectionAngle(parents[currentKey], currentPoint, opt.directions.length)\n                    : opt.previousDirAngle != 0\n                        ? opt.previousDirAngle\n                        : getDirectionAngle(startCenter, currentPoint, opt.directions.length);\n                // if get the endpoint\n                if (endPointsKeys.indexOf(currentKey) >= 0) {\n                    // stop route to enter the end point in opposite direction.\n                    const directionChangedAngle = getDirectionChange(currentDirectionAngle, getDirectionAngle(currentPoint, endCenter, opt.directions.length));\n                    if (currentPoint.equals(endCenter) || directionChangedAngle < 180) {\n                        opt.previousDirAngle = currentDirectionAngle;\n                        return reconstructRoute(parents, currentPoint, startCenter, endCenter);\n                    }\n                }\n                // Go over all possible directions and find neighbors.\n                for (let i = 0; i < opt.directions.length; i++) {\n                    const direction = opt.directions[i];\n                    const directionChangedAngle = getDirectionChange(currentDirectionAngle, direction.angle);\n                    if (previousDirectionAngle &&\n                        directionChangedAngle > ManhattanConnectorConfig.maxAllowedDirectionChange) {\n                        continue;\n                    }\n                    const neighborPoint = movePoint(currentPoint.clone(), direction.offsetX, direction.offsetY);\n                    const neighborKey = pointToString(neighborPoint);\n                    if (openSet.isClose(neighborKey) ||\n                        !obstacleMap.isPointAccessible(neighborPoint)) {\n                        continue;\n                    }\n                    const costFromStart = currentCost + direction.cost + opt.penaltiesGenerator(directionChangedAngle);\n                    if (!openSet.isOpen(neighborKey) || costFromStart < costs[neighborKey]) {\n                        // Neighbor point has not been processed yet or the cost of the path\n                        // from start is lesser than previously calcluated.\n                        parents[neighborKey] = currentPoint;\n                        costs[neighborKey] = costFromStart;\n                        openSet.add(neighborKey, costFromStart + estimateCost(neighborPoint, endPoints));\n                    }\n                }\n                loopsRemain--;\n            }\n            return null;\n        }\n        return null;\n    }\n    function router(state, source, target, points, result, opt) {\n        // If edge is dragged after calculation, points will be filled, so fallback to SegmentConnector\n        if ((points != null && points.length > 0) || source == null || target == null) {\n            SegmentConnector(state, source, target, points, result);\n            return;\n        }\n        let sourceBBox = getCellAbsoluteBounds(source);\n        sourceBBox = sourceBBox ? moveAndExpand(sourceBBox, opt.paddingBox) : undefined;\n        let targetBBox = getCellAbsoluteBounds(target);\n        targetBBox = targetBBox ? moveAndExpand(targetBBox, opt.paddingBox) : undefined;\n        const obstacleMap = new ObstacleMap(opt);\n        obstacleMap.build(source, target);\n        if (!sourceBBox || !targetBBox) {\n            // Fallback to OrthogonalConnector\n            return OrthogonalConnector(state, source, target, points, result);\n        }\n        const routePoints = findRoute(sourceBBox, targetBBox, obstacleMap, opt);\n        if (routePoints == null || routePoints.length == 0) {\n            // Fallback to OrthogonalConnector\n            return OrthogonalConnector(state, source, target, points, result);\n        }\n        if (state.style) {\n            if (state.visibleSourceState && routePoints.length > 0) {\n                // If there are at least one point, align it to source cell\n                alignPointToCell(routePoints[0], state, state.visibleSourceState, true);\n            }\n            if (state.visibleTargetState && routePoints.length > 1) {\n                // If there are more than one point, align last point to target cell\n                alignPointToCell(routePoints[routePoints.length - 1], state, state.visibleTargetState, false);\n            }\n        }\n        // Scaling and translating result points\n        const scale = state.view.scale;\n        routePoints.forEach((pt) => result.push(new Point(Math.round((pt.x + state.view.translate.x) * scale * 10) / 10, Math.round((pt.y + state.view.translate.y) * scale * 10) / 10)));\n    }\n    router(state, source, target, points, result, config);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\n/**\n * This perimeter is registered under `ellipsePerimeter` in {@link PerimeterRegistry} when using {@link Graph} or calling {@link registerDefaultPerimeters}.\n *\n * @category Perimeter\n */\nexport const EllipsePerimeter = (bounds, _vertex, next, orthogonal = false) => {\n    const { x } = bounds;\n    const { y } = bounds;\n    const a = bounds.width / 2;\n    const b = bounds.height / 2;\n    const cx = x + a;\n    const cy = y + b;\n    const px = next.x;\n    const py = next.y;\n    // Calculates straight line equation through\n    // point and ellipse center y = d * x + h\n    const dx = parseInt(String(px - cx));\n    const dy = parseInt(String(py - cy));\n    if (dx === 0 && dy !== 0) {\n        return new Point(cx, cy + (b * dy) / Math.abs(dy));\n    }\n    if (dx === 0 && dy === 0) {\n        return new Point(px, py);\n    }\n    if (orthogonal) {\n        if (py >= y && py <= y + bounds.height) {\n            const ty = py - cy;\n            let tx = Math.sqrt(a * a * (1 - (ty * ty) / (b * b))) || 0;\n            if (px <= x) {\n                tx = -tx;\n            }\n            return new Point(cx + tx, py);\n        }\n        if (px >= x && px <= x + bounds.width) {\n            const tx = px - cx;\n            let ty = Math.sqrt(b * b * (1 - (tx * tx) / (a * a))) || 0;\n            if (py <= y) {\n                ty = -ty;\n            }\n            return new Point(px, cy + ty);\n        }\n    }\n    // Calculates intersection\n    const d = dy / dx;\n    const h = cy - d * cx;\n    const e = a * a * d * d + b * b;\n    const f = -2 * cx * e;\n    const g = a * a * d * d * cx * cx + b * b * cx * cx - a * a * b * b;\n    const det = Math.sqrt(f * f - 4 * e * g);\n    // Two solutions (perimeter points)\n    const xout1 = (-f + det) / (2 * e);\n    const xout2 = (-f - det) / (2 * e);\n    const yout1 = d * xout1 + h;\n    const yout2 = d * xout2 + h;\n    const dist1 = Math.sqrt(Math.pow(xout1 - px, 2) + Math.pow(yout1 - py, 2));\n    const dist2 = Math.sqrt(Math.pow(xout2 - px, 2) + Math.pow(yout2 - py, 2));\n    // Correct solution\n    let xout = 0;\n    let yout = 0;\n    if (dist1 < dist2) {\n        xout = xout1;\n        yout = yout1;\n    }\n    else {\n        xout = xout2;\n        yout = yout2;\n    }\n    return new Point(xout, yout);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport { intersection } from '../../../util/mathUtils.js';\n/**\n * This perimeter is registered under `hexagonPerimeter` in {@link PerimeterRegistry} when using {@link Graph} or calling {@link registerDefaultPerimeters}.\n *\n * @category Perimeter\n */\nexport const HexagonPerimeter = (bounds, vertex, next, orthogonal = false) => {\n    const { x } = bounds;\n    const { y } = bounds;\n    const w = bounds.width;\n    const h = bounds.height;\n    const cx = bounds.getCenterX();\n    const cy = bounds.getCenterY();\n    const px = next.x;\n    const py = next.y;\n    const dx = px - cx;\n    const dy = py - cy;\n    const alpha = -Math.atan2(dy, dx);\n    const pi = Math.PI;\n    const pi2 = Math.PI / 2;\n    let result = new Point(cx, cy);\n    const direction = vertex?.style?.direction ?? 'east';\n    const vertical = direction === 'north' || direction === 'south';\n    let a = new Point();\n    let b = new Point();\n    // Only consider corrects quadrants for the orthogonal case.\n    if ((px < x && py < y) ||\n        (px < x && py > y + h) ||\n        (px > x + w && py < y) ||\n        (px > x + w && py > y + h)) {\n        orthogonal = false;\n    }\n    if (orthogonal) {\n        if (vertical) {\n            // Special cases where intersects with hexagon corners\n            if (px === cx) {\n                if (py <= y) {\n                    return new Point(cx, y);\n                }\n                if (py >= y + h) {\n                    return new Point(cx, y + h);\n                }\n            }\n            else if (px < x) {\n                if (py === y + h / 4) {\n                    return new Point(x, y + h / 4);\n                }\n                if (py === y + (3 * h) / 4) {\n                    return new Point(x, y + (3 * h) / 4);\n                }\n            }\n            else if (px > x + w) {\n                if (py === y + h / 4) {\n                    return new Point(x + w, y + h / 4);\n                }\n                if (py === y + (3 * h) / 4) {\n                    return new Point(x + w, y + (3 * h) / 4);\n                }\n            }\n            else if (px === x) {\n                if (py < cy) {\n                    return new Point(x, y + h / 4);\n                }\n                if (py > cy) {\n                    return new Point(x, y + (3 * h) / 4);\n                }\n            }\n            else if (px === x + w) {\n                if (py < cy) {\n                    return new Point(x + w, y + h / 4);\n                }\n                if (py > cy) {\n                    return new Point(x + w, y + (3 * h) / 4);\n                }\n            }\n            if (py === y) {\n                return new Point(cx, y);\n            }\n            if (py === y + h) {\n                return new Point(cx, y + h);\n            }\n            if (px < cx) {\n                if (py > y + h / 4 && py < y + (3 * h) / 4) {\n                    a = new Point(x, y);\n                    b = new Point(x, y + h);\n                }\n                else if (py < y + h / 4) {\n                    a = new Point(x - Math.floor(0.5 * w), y + Math.floor(0.5 * h));\n                    b = new Point(x + w, y - Math.floor(0.25 * h));\n                }\n                else if (py > y + (3 * h) / 4) {\n                    a = new Point(x - Math.floor(0.5 * w), y + Math.floor(0.5 * h));\n                    b = new Point(x + w, y + Math.floor(1.25 * h));\n                }\n            }\n            else if (px > cx) {\n                if (py > y + h / 4 && py < y + (3 * h) / 4) {\n                    a = new Point(x + w, y);\n                    b = new Point(x + w, y + h);\n                }\n                else if (py < y + h / 4) {\n                    a = new Point(x, y - Math.floor(0.25 * h));\n                    b = new Point(x + Math.floor(1.5 * w), y + Math.floor(0.5 * h));\n                }\n                else if (py > y + (3 * h) / 4) {\n                    a = new Point(x + Math.floor(1.5 * w), y + Math.floor(0.5 * h));\n                    b = new Point(x, y + Math.floor(1.25 * h));\n                }\n            }\n        }\n        else {\n            // Special cases where intersects with hexagon corners\n            if (py === cy) {\n                if (px <= x) {\n                    return new Point(x, y + h / 2);\n                }\n                if (px >= x + w) {\n                    return new Point(x + w, y + h / 2);\n                }\n            }\n            else if (py < y) {\n                if (px === x + w / 4) {\n                    return new Point(x + w / 4, y);\n                }\n                if (px === x + (3 * w) / 4) {\n                    return new Point(x + (3 * w) / 4, y);\n                }\n            }\n            else if (py > y + h) {\n                if (px === x + w / 4) {\n                    return new Point(x + w / 4, y + h);\n                }\n                if (px === x + (3 * w) / 4) {\n                    return new Point(x + (3 * w) / 4, y + h);\n                }\n            }\n            else if (py === y) {\n                if (px < cx) {\n                    return new Point(x + w / 4, y);\n                }\n                if (px > cx) {\n                    return new Point(x + (3 * w) / 4, y);\n                }\n            }\n            else if (py === y + h) {\n                if (px < cx) {\n                    return new Point(x + w / 4, y + h);\n                }\n                if (py > cy) {\n                    return new Point(x + (3 * w) / 4, y + h);\n                }\n            }\n            if (px === x) {\n                return new Point(x, cy);\n            }\n            if (px === x + w) {\n                return new Point(x + w, cy);\n            }\n            if (py < cy) {\n                if (px > x + w / 4 && px < x + (3 * w) / 4) {\n                    a = new Point(x, y);\n                    b = new Point(x + w, y);\n                }\n                else if (px < x + w / 4) {\n                    a = new Point(x - Math.floor(0.25 * w), y + h);\n                    b = new Point(x + Math.floor(0.5 * w), y - Math.floor(0.5 * h));\n                }\n                else if (px > x + (3 * w) / 4) {\n                    a = new Point(x + Math.floor(0.5 * w), y - Math.floor(0.5 * h));\n                    b = new Point(x + Math.floor(1.25 * w), y + h);\n                }\n            }\n            else if (py > cy) {\n                if (px > x + w / 4 && px < x + (3 * w) / 4) {\n                    a = new Point(x, y + h);\n                    b = new Point(x + w, y + h);\n                }\n                else if (px < x + w / 4) {\n                    a = new Point(x - Math.floor(0.25 * w), y);\n                    b = new Point(x + Math.floor(0.5 * w), y + Math.floor(1.5 * h));\n                }\n                else if (px > x + (3 * w) / 4) {\n                    a = new Point(x + Math.floor(0.5 * w), y + Math.floor(1.5 * h));\n                    b = new Point(x + Math.floor(1.25 * w), y);\n                }\n            }\n        }\n        let tx = cx;\n        let ty = cy;\n        if (px >= x && px <= x + w) {\n            tx = px;\n            if (py < cy) {\n                ty = y + h;\n            }\n            else {\n                ty = y;\n            }\n        }\n        else if (py >= y && py <= y + h) {\n            ty = py;\n            if (px < cx) {\n                tx = x + w;\n            }\n            else {\n                tx = x;\n            }\n        }\n        result = intersection(tx, ty, next.x, next.y, a.x, a.y, b.x, b.y);\n    }\n    else {\n        if (vertical) {\n            const beta = Math.atan2(h / 4, w / 2);\n            // Special cases where intersects with hexagon corners\n            if (alpha === beta) {\n                return new Point(x + w, y + Math.floor(0.25 * h));\n            }\n            if (alpha === pi2) {\n                return new Point(x + Math.floor(0.5 * w), y);\n            }\n            if (alpha === pi - beta) {\n                return new Point(x, y + Math.floor(0.25 * h));\n            }\n            if (alpha === -beta) {\n                return new Point(x + w, y + Math.floor(0.75 * h));\n            }\n            if (alpha === -pi2) {\n                return new Point(x + Math.floor(0.5 * w), y + h);\n            }\n            if (alpha === -pi + beta) {\n                return new Point(x, y + Math.floor(0.75 * h));\n            }\n            if (alpha < beta && alpha > -beta) {\n                a = new Point(x + w, y);\n                b = new Point(x + w, y + h);\n            }\n            else if (alpha > beta && alpha < pi2) {\n                a = new Point(x, y - Math.floor(0.25 * h));\n                b = new Point(x + Math.floor(1.5 * w), y + Math.floor(0.5 * h));\n            }\n            else if (alpha > pi2 && alpha < pi - beta) {\n                a = new Point(x - Math.floor(0.5 * w), y + Math.floor(0.5 * h));\n                b = new Point(x + w, y - Math.floor(0.25 * h));\n            }\n            else if ((alpha > pi - beta && alpha <= pi) ||\n                (alpha < -pi + beta && alpha >= -pi)) {\n                a = new Point(x, y);\n                b = new Point(x, y + h);\n            }\n            else if (alpha < -beta && alpha > -pi2) {\n                a = new Point(x + Math.floor(1.5 * w), y + Math.floor(0.5 * h));\n                b = new Point(x, y + Math.floor(1.25 * h));\n            }\n            else if (alpha < -pi2 && alpha > -pi + beta) {\n                a = new Point(x - Math.floor(0.5 * w), y + Math.floor(0.5 * h));\n                b = new Point(x + w, y + Math.floor(1.25 * h));\n            }\n        }\n        else {\n            const beta = Math.atan2(h / 2, w / 4);\n            // Special cases where intersects with hexagon corners\n            if (alpha === beta) {\n                return new Point(x + Math.floor(0.75 * w), y);\n            }\n            if (alpha === pi - beta) {\n                return new Point(x + Math.floor(0.25 * w), y);\n            }\n            if (alpha === pi || alpha === -pi) {\n                return new Point(x, y + Math.floor(0.5 * h));\n            }\n            if (alpha === 0) {\n                return new Point(x + w, y + Math.floor(0.5 * h));\n            }\n            if (alpha === -beta) {\n                return new Point(x + Math.floor(0.75 * w), y + h);\n            }\n            if (alpha === -pi + beta) {\n                return new Point(x + Math.floor(0.25 * w), y + h);\n            }\n            if (alpha > 0 && alpha < beta) {\n                a = new Point(x + Math.floor(0.5 * w), y - Math.floor(0.5 * h));\n                b = new Point(x + Math.floor(1.25 * w), y + h);\n            }\n            else if (alpha > beta && alpha < pi - beta) {\n                a = new Point(x, y);\n                b = new Point(x + w, y);\n            }\n            else if (alpha > pi - beta && alpha < pi) {\n                a = new Point(x - Math.floor(0.25 * w), y + h);\n                b = new Point(x + Math.floor(0.5 * w), y - Math.floor(0.5 * h));\n            }\n            else if (alpha < 0 && alpha > -beta) {\n                a = new Point(x + Math.floor(0.5 * w), y + Math.floor(1.5 * h));\n                b = new Point(x + Math.floor(1.25 * w), y);\n            }\n            else if (alpha < -beta && alpha > -pi + beta) {\n                a = new Point(x, y + h);\n                b = new Point(x + w, y + h);\n            }\n            else if (alpha < -pi + beta && alpha > -pi) {\n                a = new Point(x - Math.floor(0.25 * w), y);\n                b = new Point(x + Math.floor(0.5 * w), y + Math.floor(1.5 * h));\n            }\n        }\n        result = intersection(cx, cy, next.x, next.y, a.x, a.y, b.x, b.y);\n    }\n    if (result == null) {\n        return new Point(cx, cy);\n    }\n    return result;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\n/**\n * Describes a rectangular perimeter for the given bounds.\n *\n * This perimeter is registered under `rectanglePerimeter` in {@link PerimeterRegistry} when using {@link Graph} or calling {@link registerDefaultPerimeters}.\n *\n * @category Perimeter\n */\nexport const RectanglePerimeter = (bounds, _vertex, next, orthogonal = false) => {\n    const cx = bounds.getCenterX();\n    const cy = bounds.getCenterY();\n    const dx = next.x - cx;\n    const dy = next.y - cy;\n    const alpha = Math.atan2(dy, dx);\n    const p = new Point(0, 0);\n    const pi = Math.PI;\n    const pi2 = Math.PI / 2;\n    const beta = pi2 - alpha;\n    const t = Math.atan2(bounds.height, bounds.width);\n    if (alpha < -pi + t || alpha > pi - t) {\n        // Left edge\n        p.x = bounds.x;\n        p.y = cy - (bounds.width * Math.tan(alpha)) / 2;\n    }\n    else if (alpha < -t) {\n        // Top Edge\n        p.y = bounds.y;\n        p.x = cx - (bounds.height * Math.tan(beta)) / 2;\n    }\n    else if (alpha < t) {\n        // Right Edge\n        p.x = bounds.x + bounds.width;\n        p.y = cy + (bounds.width * Math.tan(alpha)) / 2;\n    }\n    else {\n        // Bottom Edge\n        p.y = bounds.y + bounds.height;\n        p.x = cx + (bounds.height * Math.tan(beta)) / 2;\n    }\n    if (orthogonal) {\n        if (next.x >= bounds.x && next.x <= bounds.x + bounds.width) {\n            p.x = next.x;\n        }\n        else if (next.y >= bounds.y && next.y <= bounds.y + bounds.height) {\n            p.y = next.y;\n        }\n        if (next.x < bounds.x) {\n            p.x = bounds.x;\n        }\n        else if (next.x > bounds.x + bounds.width) {\n            p.x = bounds.x + bounds.width;\n        }\n        if (next.y < bounds.y) {\n            p.y = bounds.y;\n        }\n        else if (next.y > bounds.y + bounds.height) {\n            p.y = bounds.y + bounds.height;\n        }\n    }\n    return p;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport { intersection } from '../../../util/mathUtils.js';\n/**\n * This perimeter is registered under `rhombusPerimeter` in {@link PerimeterRegistry} when using {@link Graph} or calling {@link registerDefaultPerimeters}.\n *\n * @category Perimeter\n */\nexport const RhombusPerimeter = (bounds, _vertex, next, orthogonal = false) => {\n    const { x } = bounds;\n    const { y } = bounds;\n    const w = bounds.width;\n    const h = bounds.height;\n    const cx = x + w / 2;\n    const cy = y + h / 2;\n    const px = next.x;\n    const py = next.y;\n    // Special case for intersecting the diamond's corners\n    if (cx === px) {\n        if (cy > py) {\n            return new Point(cx, y); // top\n        }\n        return new Point(cx, y + h); // bottom\n    }\n    if (cy === py) {\n        if (cx > px) {\n            return new Point(x, cy); // left\n        }\n        return new Point(x + w, cy); // right\n    }\n    let tx = cx;\n    let ty = cy;\n    if (orthogonal) {\n        if (px >= x && px <= x + w) {\n            tx = px;\n        }\n        else if (py >= y && py <= y + h) {\n            ty = py;\n        }\n    }\n    // In which quadrant will the intersection be?\n    // set the slope and offset of the border line accordingly\n    if (px < cx) {\n        if (py < cy) {\n            return intersection(px, py, tx, ty, cx, y, x, cy);\n        }\n        return intersection(px, py, tx, ty, cx, y + h, x, cy);\n    }\n    if (py < cy) {\n        return intersection(px, py, tx, ty, cx, y, x + w, cy);\n    }\n    return intersection(px, py, tx, ty, cx, y + h, x + w, cy);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport { intersection } from '../../../util/mathUtils.js';\n/**\n * This perimeter is registered under `trianglePerimeter` in {@link PerimeterRegistry} when using {@link Graph} or calling {@link registerDefaultPerimeters}.\n *\n * @category Perimeter\n */\nexport const TrianglePerimeter = (bounds, vertex, next, orthogonal = false) => {\n    const direction = vertex != null ? vertex.style.direction : null;\n    const vertical = direction === 'north' || direction === 'south';\n    const { x } = bounds;\n    const { y } = bounds;\n    const w = bounds.width;\n    const h = bounds.height;\n    let cx = x + w / 2;\n    let cy = y + h / 2;\n    let start = new Point(x, y);\n    let corner = new Point(x + w, cy);\n    let end = new Point(x, y + h);\n    if (direction === 'north') {\n        start = end;\n        corner = new Point(cx, y);\n        end = new Point(x + w, y + h);\n    }\n    else if (direction === 'south') {\n        corner = new Point(cx, y + h);\n        end = new Point(x + w, y);\n    }\n    else if (direction === 'west') {\n        start = new Point(x + w, y);\n        corner = new Point(x, cy);\n        end = new Point(x + w, y + h);\n    }\n    let dx = next.x - cx;\n    let dy = next.y - cy;\n    const alpha = vertical ? Math.atan2(dx, dy) : Math.atan2(dy, dx);\n    const t = vertical ? Math.atan2(w, h) : Math.atan2(h, w);\n    let base = false;\n    if (direction === 'north' || direction === 'west') {\n        base = alpha > -t && alpha < t;\n    }\n    else {\n        base = alpha < -Math.PI + t || alpha > Math.PI - t;\n    }\n    let result = null;\n    if (base) {\n        if (orthogonal &&\n            ((vertical && next.x >= start.x && next.x <= end.x) ||\n                (!vertical && next.y >= start.y && next.y <= end.y))) {\n            if (vertical) {\n                result = new Point(next.x, start.y);\n            }\n            else {\n                result = new Point(start.x, next.y);\n            }\n        }\n        else if (direction === 'north') {\n            result = new Point(x + w / 2 + (h * Math.tan(alpha)) / 2, y + h);\n        }\n        else if (direction === 'south') {\n            result = new Point(x + w / 2 - (h * Math.tan(alpha)) / 2, y);\n        }\n        else if (direction === 'west') {\n            result = new Point(x + w, y + h / 2 + (w * Math.tan(alpha)) / 2);\n        }\n        else {\n            result = new Point(x, y + h / 2 - (w * Math.tan(alpha)) / 2);\n        }\n    }\n    else {\n        if (orthogonal) {\n            const pt = new Point(cx, cy);\n            if (next.y >= y && next.y <= y + h) {\n                pt.x = vertical ? cx : direction === 'west' ? x + w : x;\n                pt.y = next.y;\n            }\n            else if (next.x >= x && next.x <= x + w) {\n                pt.x = next.x;\n                pt.y = !vertical ? cy : direction === 'north' ? y + h : y;\n            }\n            // Compute angle\n            dx = next.x - pt.x;\n            dy = next.y - pt.y;\n            cx = pt.x;\n            cy = pt.y;\n        }\n        if ((vertical && next.x <= x + w / 2) || (!vertical && next.y <= y + h / 2)) {\n            result = intersection(next.x, next.y, cx, cy, start.x, start.y, corner.x, corner.y);\n        }\n        else {\n            result = intersection(next.x, next.y, cx, cy, corner.x, corner.y, end.x, end.y);\n        }\n    }\n    if (result == null) {\n        result = new Point(cx, cy);\n    }\n    return result;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nconst isClassicOrClassicThin = (type) => type === 'classic' || type === 'classicThin';\nconst isDiamond = (type) => type === 'diamond';\n/**\n * Generally used to create the \"classic\" and \"block\" marker factory methods.\n *\n * Here is an example the registration of a factory edge marker function with `createArrow`:\n * ```js\n * EdgeMarkerRegistry.add('classic', EdgeMarker.createArrow(2));\n * EdgeMarkerRegistry.add('blockThin', EdgeMarker.createArrow(3));\n * ```\n *\n * @since 0.18.0\n */\nexport const createArrow = (widthFactor) => (canvas, _shape, type, pe, unitX, unitY, size, _source, sw, filled) => {\n    // The angle of the forward facing arrow sides against the x axis is\n    // 26.565 degrees, 1/sin(26.565) = 2.236 / 2 = 1.118 ( / 2 allows for\n    // only half the strokewidth is processed ).\n    const endOffsetX = unitX * sw * 1.118;\n    const endOffsetY = unitY * sw * 1.118;\n    unitX *= size + sw;\n    unitY *= size + sw;\n    const pt = pe.clone();\n    pt.x -= endOffsetX;\n    pt.y -= endOffsetY;\n    const f = !isClassicOrClassicThin(type) ? 1 : 3 / 4;\n    pe.x += -unitX * f - endOffsetX;\n    pe.y += -unitY * f - endOffsetY;\n    return () => {\n        canvas.begin();\n        canvas.moveTo(pt.x, pt.y);\n        canvas.lineTo(pt.x - unitX - unitY / widthFactor, pt.y - unitY + unitX / widthFactor);\n        if (isClassicOrClassicThin(type)) {\n            canvas.lineTo(pt.x - (unitX * 3) / 4, pt.y - (unitY * 3) / 4);\n        }\n        canvas.lineTo(pt.x + unitY / widthFactor - unitX, pt.y - unitY - unitX / widthFactor);\n        canvas.close();\n        if (filled) {\n            canvas.fillAndStroke();\n        }\n        else {\n            canvas.stroke();\n        }\n    };\n};\n/**\n * Generally used to create the \"open\" and \"open thin\" marker factory methods.\n *\n * Here is an example the registration of a factory edge marker function with `createOpenArrow`:\n * ```js\n * EdgeMarkerRegistry.add('open', createOpenArrow(2));\n * ```\n *\n * @since 0.18.0\n */\nexport const createOpenArrow = (widthFactor) => (canvas, _shape, _type, pe, unitX, unitY, size, _source, sw, _filled) => {\n    // The angle of the forward facing arrow sides against the x axis is\n    // 26.565 degrees, 1/sin(26.565) = 2.236 / 2 = 1.118 ( / 2 allows for\n    // only half the strokewidth is processed ).\n    const endOffsetX = unitX * sw * 1.118;\n    const endOffsetY = unitY * sw * 1.118;\n    unitX *= size + sw;\n    unitY *= size + sw;\n    const pt = pe.clone();\n    pt.x -= endOffsetX;\n    pt.y -= endOffsetY;\n    pe.x += -endOffsetX * 2;\n    pe.y += -endOffsetY * 2;\n    return () => {\n        canvas.begin();\n        canvas.moveTo(pt.x - unitX - unitY / widthFactor, pt.y - unitY + unitX / widthFactor);\n        canvas.lineTo(pt.x, pt.y);\n        canvas.lineTo(pt.x + unitY / widthFactor - unitX, pt.y - unitY - unitX / widthFactor);\n        canvas.stroke();\n    };\n};\n/**\n * @since 0.18.0\n */\nexport const oval = (canvas, _shape, _type, pe, unitX, unitY, size, _source, _sw, filled) => {\n    const a = size / 2;\n    const pt = pe.clone();\n    pe.x -= unitX * a;\n    pe.y -= unitY * a;\n    return () => {\n        canvas.ellipse(pt.x - a, pt.y - a, size, size);\n        if (filled) {\n            canvas.fillAndStroke();\n        }\n        else {\n            canvas.stroke();\n        }\n    };\n};\n/**\n * Generally used to create the \"diamond\" and \"diamond thin\" marker factory methods.\n *\n * ```js\n * EdgeMarkerRegistry.add('diamond', diamond);\n * EdgeMarkerRegistry.add('diamondThin', diamond);\n * ```\n *\n * @since 0.18.0\n */\nexport const diamond = (canvas, _shape, type, pe, unitX, unitY, size, _source, sw, filled) => {\n    // The angle of the forward facing arrow sides against the x axis is\n    // 45 degrees, 1/sin(45) = 1.4142 / 2 = 0.7071 ( / 2 allows for\n    // only half the strokewidth is processed ). Or 0.9862 for thin diamond.\n    // Note these values and the tk variable below are dependent, update\n    // both together (saves trig hard coding it).\n    const swFactor = isDiamond(type) ? 0.7071 : 0.9862;\n    const endOffsetX = unitX * sw * swFactor;\n    const endOffsetY = unitY * sw * swFactor;\n    unitX *= size + sw;\n    unitY *= size + sw;\n    const pt = pe.clone();\n    pt.x -= endOffsetX;\n    pt.y -= endOffsetY;\n    pe.x += -unitX - endOffsetX;\n    pe.y += -unitY - endOffsetY;\n    // thickness factor for diamond\n    const tk = isDiamond(type) ? 2 : 3.4;\n    return () => {\n        canvas.begin();\n        canvas.moveTo(pt.x, pt.y);\n        canvas.lineTo(pt.x - unitX / 2 - unitY / tk, pt.y + unitX / tk - unitY / 2);\n        canvas.lineTo(pt.x - unitX, pt.y - unitY);\n        canvas.lineTo(pt.x - unitX / 2 + unitY / tk, pt.y - unitY / 2 - unitX / tk);\n        canvas.close();\n        if (filled) {\n            canvas.fillAndStroke();\n        }\n        else {\n            canvas.stroke();\n        }\n    };\n};\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Base implementation for all registries storing \"style\" configuration.\n * @private\n * @since 0.20.0\n */\nexport class BaseRegistry {\n    constructor() {\n        this.values = new Map();\n    }\n    add(name, value) {\n        this.values.set(name, value);\n    }\n    get(name) {\n        return this.values.get(name) ?? null;\n    }\n    getName(value) {\n        // Currently, the code performs a linear search through all entries.\n        // This implementation is straightforward and works well for small registries, but could become a performance bottleneck if the registry grows large.\n        // For the current use case of style registries, this is likely acceptable since the number of registered styles is typically small.\n        // If performance becomes an issue, consider maintaining a reverse lookup map.\n        for (const [name, style] of this.values.entries()) {\n            if (style === value) {\n                return name;\n            }\n        }\n        return null;\n    }\n    clear() {\n        this.values.clear();\n    }\n}\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { isNullish } from '../../../internal/utils.js';\nimport { BaseRegistry } from '../../../internal/BaseRegistry.js';\n/**\n * @private\n */\nclass EdgeStyleRegistryImpl extends BaseRegistry {\n    constructor() {\n        super(...arguments);\n        this.handlerMapping = new Map();\n        this.orthogonalStates = new Map();\n    }\n    add(name, edgeStyle, metaData) {\n        super.add(name, edgeStyle);\n        metaData?.handlerKind && this.handlerMapping.set(edgeStyle, metaData.handlerKind);\n        !isNullish(metaData?.isOrthogonal) &&\n            this.orthogonalStates.set(edgeStyle, metaData.isOrthogonal);\n    }\n    isOrthogonal(edgeStyle) {\n        return this.orthogonalStates.get(edgeStyle) ?? false;\n    }\n    getHandlerKind(edgeStyle) {\n        return this.handlerMapping.get(edgeStyle) ?? 'default';\n    }\n    clear() {\n        super.clear();\n        this.handlerMapping.clear();\n        this.orthogonalStates.clear();\n    }\n}\n/**\n * A registry that stores the {@link EdgeStyle}s and their configuration.\n *\n * @since 0.20.0\n * @category Style\n * @category Configuration\n */\nexport const EdgeStyleRegistry = new EdgeStyleRegistryImpl();\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { DEFAULT_VALID_COLOR, HIGHLIGHT_OPACITY, HIGHLIGHT_STROKEWIDTH, } from '../../util/Constants.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Rectangle from '../geometry/Rectangle.js';\n/**\n * A helper class to highlight cells. Here is an example for a given cell.\n *\n * ```javascript\n * const highlight = new CellHighlight(graph, '#ff0000', 2);\n * highlight.highlight(graph.view.getState(cell));\n * ```\n */\nclass CellHighlight {\n    constructor(graph, highlightColor, strokeWidth, dashed) {\n        this.strokeWidth = 0;\n        this.dashed = false;\n        this.opacity = 100;\n        this.shape = null;\n        /**\n         * Specifies if the highlights should appear on top of everything else in the overlay pane.\n         * @default false\n         */\n        this.keepOnTop = false;\n        /**\n         * Reference to the {@link CellState}.\n         * @default null\n         */\n        this.state = null;\n        /**\n         * Specifies the spacing between the highlight for vertices and the vertex.\n         * @default 2\n         */\n        this.spacing = 2;\n        this.graph = graph;\n        this.highlightColor = highlightColor ?? DEFAULT_VALID_COLOR;\n        this.strokeWidth = strokeWidth ?? HIGHLIGHT_STROKEWIDTH;\n        this.dashed = dashed ?? false;\n        this.opacity = HIGHLIGHT_OPACITY;\n        // Updates the marker if the graph changes\n        this.repaintHandler = () => {\n            // Updates reference to state\n            if (this.state) {\n                const tmp = this.graph.view.getState(this.state.cell);\n                if (!tmp) {\n                    this.hide();\n                }\n                else {\n                    this.state = tmp;\n                    this.repaint();\n                }\n            }\n        };\n        this.graph.getView().addListener(InternalEvent.SCALE, this.repaintHandler);\n        this.graph.getView().addListener(InternalEvent.TRANSLATE, this.repaintHandler);\n        this.graph\n            .getView()\n            .addListener(InternalEvent.SCALE_AND_TRANSLATE, this.repaintHandler);\n        this.graph.getDataModel().addListener(InternalEvent.CHANGE, this.repaintHandler);\n        // Hides the marker if the current root changes\n        this.resetHandler = () => {\n            this.hide();\n        };\n        this.graph.getView().addListener(InternalEvent.DOWN, this.resetHandler);\n        this.graph.getView().addListener(InternalEvent.UP, this.resetHandler);\n    }\n    /**\n     * Sets the color of the rectangle used to highlight drop targets.\n     *\n     * @param {string} color - String that represents the new highlight color.\n     */\n    setHighlightColor(color) {\n        this.highlightColor = color;\n        if (this.shape) {\n            this.shape.stroke = color;\n        }\n    }\n    /**\n     * Creates and returns the highlight shape for the given state.\n     */\n    drawHighlight() {\n        this.shape = this.createShape();\n        this.repaint();\n        if (this.shape) {\n            const node = this.shape.node;\n            if (!this.keepOnTop && node?.parentNode?.firstChild !== node && node.parentNode) {\n                node.parentNode.insertBefore(node, node.parentNode.firstChild);\n            }\n        }\n    }\n    /**\n     * Creates and returns the highlight shape for the given state.\n     */\n    createShape() {\n        if (!this.state)\n            return null;\n        const shape = this.graph.cellRenderer.createShape(this.state);\n        shape.svgStrokeTolerance = this.graph.getEventTolerance();\n        shape.points = this.state.absolutePoints;\n        shape.apply(this.state);\n        shape.stroke = this.highlightColor;\n        shape.opacity = this.opacity;\n        shape.isDashed = this.dashed;\n        shape.isShadow = false;\n        shape.dialect = 'svg';\n        shape.init(this.graph.getView().getOverlayPane());\n        InternalEvent.redirectMouseEvents(shape.node, this.graph, this.state);\n        if (this.graph.dialect !== 'svg') {\n            shape.pointerEvents = false;\n        }\n        else {\n            shape.svgPointerEvents = 'stroke';\n        }\n        return shape;\n    }\n    /**\n     * Updates the highlight after a change of the model or view.\n     */\n    getStrokeWidth(state = null) {\n        return this.strokeWidth;\n    }\n    /**\n     * Updates the highlight after a change of the model or view.\n     */\n    repaint() {\n        if (this.state && this.shape) {\n            this.shape.scale = this.state.view.scale;\n            if (this.state.cell.isEdge()) {\n                this.shape.strokeWidth = this.getStrokeWidth();\n                this.shape.points = this.state.absolutePoints;\n                this.shape.outline = false;\n            }\n            else {\n                this.shape.bounds = new Rectangle(this.state.x - this.spacing, this.state.y - this.spacing, this.state.width + 2 * this.spacing, this.state.height + 2 * this.spacing);\n                this.shape.rotation = this.state.style.rotation ?? 0;\n                this.shape.strokeWidth = this.getStrokeWidth() / this.state.view.scale;\n                this.shape.outline = true;\n            }\n            // Uses cursor from shape in highlight\n            if (this.state.shape) {\n                this.shape.setCursor(this.state.shape.getCursor());\n            }\n            this.shape.redraw();\n        }\n    }\n    /**\n     * Resets the state of the cell marker.\n     */\n    hide() {\n        this.highlight(null);\n    }\n    /**\n     * Marks the {@link arkedState} and fires a {@link ark} event.\n     */\n    highlight(state = null) {\n        if (this.state !== state) {\n            if (this.shape) {\n                this.shape.destroy();\n                this.shape = null;\n            }\n            this.state = state;\n            if (this.state) {\n                this.drawHighlight();\n            }\n        }\n    }\n    /**\n     * Returns true if this highlight is at the given position.\n     */\n    isHighlightAt(x, y) {\n        let hit = false;\n        if (this.shape && document.elementFromPoint) {\n            let elt = document.elementFromPoint(x, y);\n            while (elt) {\n                if (elt === this.shape.node) {\n                    hit = true;\n                    break;\n                }\n                elt = elt.parentNode;\n            }\n        }\n        return hit;\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    destroy() {\n        const graph = this.graph;\n        graph.getView().removeListener(this.resetHandler);\n        graph.getView().removeListener(this.repaintHandler);\n        graph.getDataModel().removeListener(this.repaintHandler);\n        if (this.shape) {\n            this.shape.destroy();\n            this.shape = null;\n        }\n    }\n}\nexport default CellHighlight;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../event/EventSource.js';\nimport { DEFAULT_HOTSPOT, DEFAULT_INVALID_COLOR, DEFAULT_VALID_COLOR, MAX_HOTSPOT_SIZE, MIN_HOTSPOT_SIZE, NONE, } from '../../util/Constants.js';\nimport CellHighlight from './CellHighlight.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { intersectsHotspot } from '../../util/mathUtils.js';\n/**\n * A helper class to process mouse locations and highlight cells.\n *\n * To add a cell marker to an existing graph for highlighting all cells, the following code is used:\n *\n * ```javascript\n * const marker = new CellMarker(graph);\n * graph.addMouseListener({\n *   mouseDown: ()=> {},\n *   mouseMove: (sender, me) => {\n *     marker.process(me);\n *   },\n *   mouseUp: ()=> {}\n * });\n * ```\n *\n * ### Events\n * **{@link InternalEvent.MARK}**\n *\n * Fires after a cell has been marked or unmarked. The `state` property contains the marked {@link CellState} or `null` if no state is marked.\n */\nclass CellMarker extends EventSource {\n    /**\n     * Constructs a new cell marker.\n     *\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     * @param validColor Optional marker color for valid states. Default is {@link DEFAULT_VALID_COLOR}.\n     * @param invalidColor Optional marker color for invalid states. Default is {@link DEFAULT_INVALID_COLOR}.\n     * @param hotspot Portion of the width and height where a state intersects a given coordinate pair. A value of 0 means always highlight. Default is {@link DEFAULT_HOTSPOT}.\n     */\n    constructor(graph, validColor = DEFAULT_VALID_COLOR, invalidColor = DEFAULT_INVALID_COLOR, hotspot = DEFAULT_HOTSPOT) {\n        super();\n        /**\n         * Specifies if the marker is enabled.\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * Specifies the portion of the width and height that should trigger a highlight.\n         *\n         * The area around the center of the cell to be marked is used as the hotspot. Possible values are between 0 and 1.\n         * @default DEFAULT_HOTSPOT\n         */\n        this.hotspot = DEFAULT_HOTSPOT;\n        /**\n         * Specifies if the hotspot is enabled.\n         * @default false\n         */\n        this.hotspotEnabled = false;\n        /**\n         * Holds the current marker color.\n         */\n        this.currentColor = NONE;\n        /**\n         * Holds the marked {@link CellState} if it is valid.\n         */\n        this.validState = null;\n        /**\n         * Holds the marked {@link CellState}.\n         */\n        this.markedState = null;\n        this.graph = graph;\n        this.validColor = validColor;\n        this.invalidColor = invalidColor;\n        this.hotspot = hotspot;\n        this.highlight = new CellHighlight(graph);\n    }\n    /**\n     * Enables or disables event handling.\n     * This implementation updates {@link enabled}.\n     *\n     * @param enabled Boolean that specifies the new enabled state.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Returns true if events are handled.\n     * This implementation returns {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Sets the {@link hotspot}.\n     */\n    setHotspot(hotspot) {\n        this.hotspot = hotspot;\n    }\n    /**\n     * Returns the {@link hotspot}.\n     */\n    getHotspot() {\n        return this.hotspot;\n    }\n    /**\n     * Specifies whether the hotspot should be used in <intersects>.\n     */\n    setHotspotEnabled(enabled) {\n        this.hotspotEnabled = enabled;\n    }\n    /**\n     * Returns true if hotspot is used in <intersects>.\n     */\n    isHotspotEnabled() {\n        return this.hotspotEnabled;\n    }\n    /**\n     * Returns true if {@link validState} is not `null`.\n     */\n    hasValidState() {\n        return !!this.validState;\n    }\n    /**\n     * Returns the {@link validState}.\n     */\n    getValidState() {\n        return this.validState;\n    }\n    /**\n     * Returns the {@link markedState}.\n     */\n    getMarkedState() {\n        return this.markedState;\n    }\n    /**\n     * Resets the state of the cell marker.\n     */\n    reset() {\n        this.validState = null;\n        if (this.markedState) {\n            this.markedState = null;\n            this.unmark();\n        }\n    }\n    /**\n     * Processes the given event and cell and marks the state returned by {@link getState} with the color returned by {@link getMarkerColor}.\n     * If the markerColor is not `null`, then the state is stored in {@link markedState}.\n     * If {@link isValidState} returns `true`, then the state is stored in {@link validState} regardless of the marker color.\n     * The state is returned regardless of the marker color and valid state.\n     */\n    process(me) {\n        let state = null;\n        if (this.isEnabled()) {\n            state = this.getState(me);\n            this.setCurrentState(state, me);\n        }\n        return state;\n    }\n    /**\n     * Sets and marks the current valid state.\n     */\n    setCurrentState(state, me, color) {\n        const isValid = state ? this.isValidState(state) : false;\n        color = color ?? this.getMarkerColor(me.getEvent(), state, isValid);\n        if (isValid) {\n            this.validState = state;\n        }\n        else {\n            this.validState = null;\n        }\n        if (state !== this.markedState || color !== this.currentColor) {\n            this.currentColor = color;\n            if (state && this.currentColor !== NONE) {\n                this.markedState = state;\n                this.mark();\n            }\n            else if (this.markedState) {\n                this.markedState = null;\n                this.unmark();\n            }\n        }\n    }\n    /**\n     * Marks the given cell using the given color, or {@link validColor} if no color is specified.\n     */\n    markCell(cell, color) {\n        const state = this.graph.getView().getState(cell);\n        if (state) {\n            this.currentColor = color ?? this.validColor;\n            this.markedState = state;\n            this.mark();\n        }\n    }\n    /**\n     * Marks the {@link markedState} and fires a {@link InternalEvent.MARK} event.\n     */\n    mark() {\n        this.highlight.setHighlightColor(this.currentColor);\n        this.highlight.highlight(this.markedState);\n        this.fireEvent(new EventObject(InternalEvent.MARK, 'state', this.markedState));\n    }\n    /**\n     * Hides the marker and fires a {@link InternalEvent.MARK} event.\n     */\n    unmark() {\n        this.mark();\n    }\n    /**\n     * Returns true if the given {@link CellState} is a valid state.\n     * If this returns `true`, then the state is stored in {@link validState}.\n     * The return value of this method is used as the argument for {@link getMarkerColor}.\n     */\n    isValidState(state) {\n        return true;\n    }\n    /**\n     * Returns the {@link validColor} or {@link invalidColor} depending on the value of {@link isValid}.\n     * The given {@link CellState} is ignored by this implementation.\n     */\n    getMarkerColor(evt, state, isValid) {\n        return isValid ? this.validColor : this.invalidColor;\n    }\n    /**\n     * Uses {@link getCell}, {@link getStateToMark} and {@link intersects} to return the {@link CellState} for the given {@link MouseEvent}.\n     */\n    getState(me) {\n        const view = this.graph.getView();\n        const cell = this.getCell(me);\n        if (!cell)\n            return null;\n        const state = this.getStateToMark(view.getState(cell));\n        return state && this.intersects(state, me) ? state : null;\n    }\n    /**\n     * Returns the {@link Cell} for the given event and cell.\n     * This implementation returns the given cell.\n     */\n    getCell(me) {\n        return me.getCell();\n    }\n    /**\n     * Returns the {@link CellState} to be marked for the given {@link CellState} under the mouse.\n     * This implementation returns the given state.\n     */\n    getStateToMark(state) {\n        return state;\n    }\n    /**\n     * Returns `true` if the given coordinate pair intersects the given state.\n     * This returns `true` if the {@link hotspot} is `0` or the coordinates are inside the hotspot for the given cell state.\n     */\n    intersects(state, me) {\n        const x = me.getGraphX();\n        const y = me.getGraphY();\n        if (this.hotspotEnabled) {\n            return intersectsHotspot(state, x, y, this.hotspot, MIN_HOTSPOT_SIZE, MAX_HOTSPOT_SIZE);\n        }\n        return true;\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    destroy() {\n        this.highlight.destroy();\n    }\n}\nexport default CellMarker;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Converts relative and absolute URLs to absolute URLs with protocol and domain.\n */\nclass UrlConverter {\n    constructor() {\n        /**\n         * Specifies if the converter is enabled. Default is true.\n         */\n        this.enabled = true;\n        /**\n         * Specifies the base URL to be used as a prefix for relative URLs.\n         */\n        this.baseUrl = null;\n        /**\n         * Specifies the base domain to be used as a prefix for absolute URLs.\n         */\n        this.baseDomain = null;\n        // Empty constructor\n    }\n    /**\n     * Private helper function to update the base URL.\n     */\n    updateBaseUrl() {\n        this.baseDomain = `${location.protocol}//${location.host}`;\n        this.baseUrl = this.baseDomain + location.pathname;\n        const tmp = this.baseUrl.lastIndexOf('/');\n        // Strips filename etc\n        if (tmp > 0) {\n            this.baseUrl = this.baseUrl.substring(0, tmp + 1);\n        }\n    }\n    /**\n     * Returns <enabled>.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Sets <enabled>.\n     */\n    setEnabled(value) {\n        this.enabled = value;\n    }\n    /**\n     * Returns <baseUrl>.\n     */\n    getBaseUrl() {\n        return this.baseUrl;\n    }\n    /**\n     * Sets <baseUrl>.\n     */\n    setBaseUrl(value) {\n        this.baseUrl = value;\n    }\n    /**\n     * Returns <baseDomain>.\n     */\n    getBaseDomain() {\n        return this.baseDomain;\n    }\n    /**\n     * Sets <baseDomain>.\n     */\n    setBaseDomain(value) {\n        this.baseDomain = value;\n    }\n    /**\n     * Returns true if the given URL is relative.\n     */\n    isRelativeUrl(url) {\n        return (url &&\n            url.substring(0, 2) !== '//' &&\n            url.substring(0, 7) !== 'http://' &&\n            url.substring(0, 8) !== 'https://' &&\n            url.substring(0, 10) !== 'data:image' &&\n            url.substring(0, 7) !== 'file://');\n    }\n    /**\n     * Converts the given URL to an absolute URL with protol and domain.\n     * Relative URLs are first converted to absolute URLs.\n     */\n    convert(url) {\n        if (this.isEnabled() && this.isRelativeUrl(url)) {\n            if (!this.getBaseUrl()) {\n                this.updateBaseUrl();\n            }\n            if (url.charAt(0) === '/') {\n                url = this.getBaseDomain() + url;\n            }\n            else {\n                url = this.getBaseUrl() + url;\n            }\n        }\n        return url;\n    }\n}\nexport default UrlConverter;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { arcToCurves, getRotatedPoint } from '../../util/mathUtils.js';\nimport { DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, NONE } from '../../util/Constants.js';\nimport UrlConverter from '../../util/UrlConverter.js';\nimport Point from '../geometry/Point.js';\nimport { clone } from '../../util/cloneUtils.js';\nimport { StyleDefaultsConfig } from '../../util/config.js';\n/**\n * Base class for all canvases.\n *\n * The following methods make up the public interface of the canvas 2D for all painting in mxGraph:\n *\n * - {@link save}, {@link restore}\n * - {@link scale}, {@link translate}, {@link rotate}\n * - {@link setAlpha}, {@link setFillAlpha}, {@link setStrokeAlpha}, {@link setFillColor}, {@link setGradient},\n *   {@link setStrokeColor}, {@link setStrokeWidth}, {@link setDashed}, {@link setDashPattern}, {@link setLineCap},\n *   {@link setLineJoin}, {@link setMiterLimit}\n * - {@link setFontColor}, {@link setFontBackgroundColor}, {@link setFontBorderColor}, {@link setFontSize},\n *   {@link setFontFamily}, {@link setFontStyle}\n * - {@link setShadow}, {@link setShadowColor}, {@link setShadowAlpha}, {@link setShadowOffset}\n * - {@link rect}, {@link roundrect}, {@link ellipse}, {@link image}, {@link text}\n * - {@link begin}, {@link moveTo}, {@link lineTo}, {@link quadTo}, {@link curveTo}\n * - {@link stroke}, {@link fill}, {@link fillAndStroke}\n *\n * {@link arcTo} is an additional method for drawing paths.\n * This is a synthetic method, meaning that it is turned into a sequence of curves by default.\n * Subclasses may add native support for arcs.\n *\n * All color values of {@link NONE} will be converted to null in the state.\n */\nclass AbstractCanvas2D {\n    constructor() {\n        /**\n         * Holds the current state.\n         */\n        this.state = this.createState();\n        /**\n         * Stack of states.\n         */\n        this.states = [];\n        /**\n         * Holds the current path as an array.\n         */\n        this.path = [];\n        /**\n         * Switch for rotation of HTML. Default is false.\n         */\n        this.rotateHtml = true;\n        /**\n         * Holds the last x coordinate.\n         */\n        this.lastX = 0;\n        /**\n         * Holds the last y coordinate.\n         */\n        this.lastY = 0;\n        /**\n         * Contains the string used for moving in paths. Default is 'M'.\n         */\n        this.moveOp = 'M';\n        /**\n         * Contains the string used for moving in paths. Default is 'L'.\n         */\n        this.lineOp = 'L';\n        /**\n         * Contains the string used for quadratic paths. Default is 'Q'.\n         */\n        this.quadOp = 'Q';\n        /**\n         * Contains the string used for bezier curves. Default is 'C'.\n         */\n        this.curveOp = 'C';\n        /**\n         * Holds the operator for closing curves. Default is 'Z'.\n         */\n        this.closeOp = 'Z';\n        /**\n         * Boolean value that specifies if events should be handled. Default is false.\n         */\n        this.pointerEvents = false;\n        // from Polyline (maybe from other shapes also)\n        this.pointerEventsValue = null;\n        /**\n         * Adds the given operation to the path.\n         */\n        this.addOp = (op, ...args) => {\n            this.path.push(op);\n            if (args.length > 1) {\n                const s = this.state;\n                for (let i = 1; i < args.length; i += 2) {\n                    this.lastX = args[i - 1];\n                    this.lastY = args[i];\n                    this.path.push(this.format((this.lastX + s.dx) * s.scale));\n                    this.path.push(this.format((this.lastY + s.dy) * s.scale));\n                }\n            }\n        };\n        this.converter = this.createUrlConverter();\n        this.reset();\n    }\n    /**\n     * Create a new <UrlConverter> and returns it.\n     */\n    createUrlConverter() {\n        return new UrlConverter();\n    }\n    /**\n     * Resets the state of this canvas.\n     */\n    reset() {\n        this.state = this.createState();\n        this.states = [];\n    }\n    /**\n     * Creates the state of the this canvas.\n     */\n    createState() {\n        return {\n            dx: 0,\n            dy: 0,\n            scale: 1,\n            alpha: 1,\n            fillAlpha: 1,\n            strokeAlpha: 1,\n            fillColor: NONE,\n            gradientFillAlpha: 1,\n            gradientColor: NONE,\n            gradientAlpha: 1,\n            gradientDirection: 'east',\n            strokeColor: NONE,\n            strokeWidth: 1,\n            dashed: false,\n            dashPattern: '3 3',\n            fixDash: false,\n            lineCap: 'flat',\n            lineJoin: 'miter',\n            miterLimit: 10,\n            fontColor: '#000000',\n            fontBackgroundColor: NONE,\n            fontBorderColor: NONE,\n            fontSize: DEFAULT_FONTSIZE,\n            fontFamily: DEFAULT_FONTFAMILY,\n            fontStyle: 0,\n            shadow: false,\n            shadowColor: StyleDefaultsConfig.shadowColor,\n            shadowAlpha: StyleDefaultsConfig.shadowOpacity,\n            shadowDx: StyleDefaultsConfig.shadowOffsetX,\n            shadowDy: StyleDefaultsConfig.shadowOffsetY,\n            rotation: 0,\n            rotationCx: 0,\n            rotationCy: 0,\n        };\n    }\n    /**\n     * Rounds all numbers to integers.\n     */\n    format(value) {\n        return Math.round(value);\n    }\n    /**\n     * Rotates the given point and returns the result as an {@link Point}.\n     */\n    rotatePoint(x, y, theta, cx, cy) {\n        const rad = theta * (Math.PI / 180);\n        return getRotatedPoint(new Point(x, y), Math.cos(rad), Math.sin(rad), new Point(cx, cy));\n    }\n    /**\n     * Saves the current state.\n     */\n    save() {\n        this.states.push(this.state);\n        this.state = clone(this.state);\n    }\n    /**\n     * Restores the current state.\n     */\n    restore() {\n        const state = this.states.pop();\n        if (state)\n            this.state = state;\n    }\n    /**\n     * Sets the current link. Hook for subclassers.\n     */\n    setLink(link) {\n        // nop\n    }\n    /**\n     * Scales the current state.\n     */\n    scale(value) {\n        this.state.scale *= value;\n        if (this.state.strokeWidth !== null)\n            this.state.strokeWidth *= value;\n    }\n    /**\n     * Translates the current state.\n     */\n    translate(dx, dy) {\n        this.state.dx += dx;\n        this.state.dy += dy;\n    }\n    /**\n     * Rotates the current state.\n     */\n    rotate(theta, flipH, flipV, cx, cy) {\n        // nop\n    }\n    /**\n     * Sets the current alpha.\n     */\n    setAlpha(value) {\n        this.state.alpha = value;\n    }\n    /**\n     * Sets the current solid fill alpha.\n     */\n    setFillAlpha(value) {\n        this.state.fillAlpha = value;\n    }\n    /**\n     * Sets the current stroke alpha.\n     */\n    setStrokeAlpha(value) {\n        this.state.strokeAlpha = value;\n    }\n    /**\n     * Sets the current fill color.\n     */\n    setFillColor(value) {\n        this.state.fillColor = value ?? NONE;\n        this.state.gradientColor = NONE;\n    }\n    /**\n     * Sets the current gradient.\n     */\n    setGradient(color1, color2, x, y, w, h, direction, alpha1 = 1, alpha2 = 1) {\n        const s = this.state;\n        s.fillColor = color1;\n        s.gradientFillAlpha = alpha1;\n        s.gradientColor = color2;\n        s.gradientAlpha = alpha2;\n        s.gradientDirection = direction;\n    }\n    /**\n     * Sets the current stroke color.\n     */\n    setStrokeColor(value) {\n        this.state.strokeColor = value ?? NONE;\n    }\n    /**\n     * Sets the current stroke width.\n     */\n    setStrokeWidth(value) {\n        this.state.strokeWidth = value;\n    }\n    /**\n     * Enables or disables dashed lines.\n     */\n    setDashed(value, fixDash = false) {\n        this.state.dashed = value;\n        this.state.fixDash = fixDash;\n    }\n    /**\n     * Sets the current dash pattern.\n     */\n    setDashPattern(value) {\n        this.state.dashPattern = value;\n    }\n    /**\n     * Sets the current line cap.\n     */\n    setLineCap(value) {\n        this.state.lineCap = value;\n    }\n    /**\n     * Sets the current line join.\n     */\n    setLineJoin(value) {\n        this.state.lineJoin = value;\n    }\n    /**\n     * Sets the current miter limit.\n     */\n    setMiterLimit(value) {\n        this.state.miterLimit = value;\n    }\n    /**\n     * Sets the current font color.\n     */\n    setFontColor(value) {\n        this.state.fontColor = value ?? NONE;\n    }\n    /**\n     * Sets the current font background color.\n     */\n    setFontBackgroundColor(value) {\n        this.state.fontBackgroundColor = value ?? NONE;\n    }\n    /**\n     * Sets the current font border color.\n     */\n    setFontBorderColor(value) {\n        this.state.fontBorderColor = value ?? NONE;\n    }\n    /**\n     * Sets the current font size.\n     */\n    setFontSize(value) {\n        this.state.fontSize = value;\n    }\n    /**\n     * Sets the current font family.\n     */\n    setFontFamily(value) {\n        this.state.fontFamily = value;\n    }\n    /**\n     * Sets the current font style.\n     */\n    setFontStyle(value) {\n        this.state.fontStyle = value;\n    }\n    /**\n     * Enables or disables and configures the current shadow.\n     */\n    setShadow(enabled) {\n        this.state.shadow = enabled;\n    }\n    /**\n     * Sets the current shadow color.\n     *\n     * @param value Hexadecimal representation of the color or `none`.\n     */\n    setShadowColor(value) {\n        this.state.shadowColor = value ?? NONE;\n    }\n    /**\n     * Sets the current shadow alpha.\n     *\n     * @param value Number that represents the new alpha. Possible values are between 1 (opaque) and 0 (transparent).\n     */\n    setShadowAlpha(value) {\n        this.state.shadowAlpha = value;\n    }\n    /**\n     * Sets the current shadow offset.\n     *\n     * @param dx Number that represents the horizontal offset of the shadow.\n     * @param dy Number that represents the vertical offset of the shadow.\n     */\n    setShadowOffset(dx, dy) {\n        this.state.shadowDx = dx;\n        this.state.shadowDy = dy;\n    }\n    /**\n     * Starts a new path.\n     */\n    begin() {\n        this.lastX = 0;\n        this.lastY = 0;\n        this.path = [];\n    }\n    /**\n     *  Moves the current path the given coordinates.\n     */\n    moveTo(x, y) {\n        this.addOp(this.moveOp, x, y);\n    }\n    /**\n     * Draws a line to the given coordinates. Uses moveTo with the op argument.\n     */\n    lineTo(x, y) {\n        this.addOp(this.lineOp, x, y);\n    }\n    /**\n     * Adds a quadratic curve to the current path.\n     */\n    quadTo(x1, y1, x2, y2) {\n        this.addOp(this.quadOp, x1, y1, x2, y2);\n    }\n    /**\n     * Adds a bezier curve to the current path.\n     */\n    curveTo(x1, y1, x2, y2, x3, y3) {\n        this.addOp(this.curveOp, x1, y1, x2, y2, x3, y3);\n    }\n    /**\n     * Adds the given arc to the current path. This is a synthetic operation that\n     * is broken down into curves.\n     * @param rx: The x distance between the current position\n     *            and the center of the ellipse around which to arc\n     * @param ry: The y distance between the current position\n     *            and the center of the ellipse around which to arc\n     * @param x: The x position of the end point of the arc\n     * @param y: The y position of the end point of the arc\n     */\n    arcTo(rx, ry, angle, largeArcFlag, sweepFlag, x, y) {\n        const curves = arcToCurves(this.lastX, this.lastY, rx, ry, angle, largeArcFlag, sweepFlag, x, y);\n        if (curves != null) {\n            for (let i = 0; i < curves.length; i += 6) {\n                this.curveTo(curves[i], curves[i + 1], curves[i + 2], curves[i + 3], curves[i + 4], curves[i + 5]);\n            }\n        }\n    }\n    /**\n     * Closes the current path.\n     */\n    close(x1, y1, x2, y2, x3, y3) {\n        this.addOp(this.closeOp);\n    }\n}\nexport default AbstractCanvas2D;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NODE_TYPE, NS_SVG } from './Constants.js';\nimport Point from '../view/geometry/Point.js';\nimport { htmlEntities, trim } from './StringUtils.js';\nimport TemporaryCellStates from '../view/cell/TemporaryCellStates.js';\nimport { getTextContent } from './domUtils.js';\nimport Codec from '../serialization/Codec.js';\nimport { isElement } from '../internal/utils.js';\n/**\n * Returns a new, empty XML document.\n */\nexport const createXmlDocument = () => {\n    return document.implementation.createDocument('', '', null);\n};\nexport const parseXml = (xmlString) => {\n    return new DOMParser().parseFromString(xmlString, 'text/xml');\n};\nexport const getViewXml = (graph, scale = 1, cells = null, x0 = 0, y0 = 0) => {\n    if (cells == null) {\n        const model = graph.getDataModel();\n        cells = [model.getRoot()];\n    }\n    const view = graph.getView();\n    let result = null;\n    // Disables events on the view\n    const eventsEnabled = view.isEventsEnabled();\n    view.setEventsEnabled(false);\n    // Workaround for label bounds not taken into account for image export.\n    // Creates a temporary draw pane which is used for rendering the text.\n    // Text rendering is required for finding the bounds of the labels.\n    const { drawPane } = view;\n    const { overlayPane } = view;\n    if (graph.dialect === 'svg') {\n        view.drawPane = document.createElementNS(NS_SVG, 'g');\n        view.canvas.appendChild(view.drawPane);\n        // Redirects cell overlays into temporary container\n        view.overlayPane = document.createElementNS(NS_SVG, 'g');\n        view.canvas.appendChild(view.overlayPane);\n    }\n    else {\n        view.drawPane = view.drawPane.cloneNode(false);\n        view.canvas.appendChild(view.drawPane);\n        // Redirects cell overlays into temporary container\n        view.overlayPane = view.overlayPane.cloneNode(false);\n        view.canvas.appendChild(view.overlayPane);\n    }\n    // Resets the translation\n    const translate = view.getTranslate();\n    view.translate = new Point(x0, y0);\n    // Creates the temporary cell states in the view\n    const temp = new TemporaryCellStates(graph.getView(), scale, cells);\n    try {\n        const enc = new Codec();\n        result = enc.encode(graph.getView());\n    }\n    finally {\n        temp.destroy();\n        view.translate = translate;\n        view.canvas.removeChild(view.drawPane);\n        view.canvas.removeChild(view.overlayPane);\n        view.drawPane = drawPane;\n        view.overlayPane = overlayPane;\n        view.setEventsEnabled(eventsEnabled);\n    }\n    return result;\n};\n/**\n * Returns the XML content of the specified node.\n *\n * All `\\n` are then replaced with the linefeed parameter value.\n *\n * @param node DOM node to return the XML for.\n * @param linefeed Optional string that linefeed are converted into. Default is `&#xa;`.\n */\nexport const getXml = (node, linefeed = '&#xa;') => {\n    const xmlSerializer = new XMLSerializer();\n    let xml = xmlSerializer.serializeToString(node);\n    // Replaces linefeed with HTML Entities.\n    xml = xml.replace(/\\n/g, linefeed);\n    return xml;\n};\n/**\n * Returns a pretty printed string that represents the XML tree for the\n * given node. This method should only be used to print XML for reading,\n * use <getXml> instead to obtain a string for processing.\n *\n * @param node DOM node to return the XML for.\n * @param tab Optional string that specifies the indentation for one level.\n * @param indent Optional string that represents the current indentation.\n * @param newline Optional string that represents a linefeed.\n * @param ns Optional string that represents the target namespace URI.\n */\nexport const getPrettyXml = (node, tab = '  ', indent = '', newline = '\\n', ns = null) => {\n    const result = [];\n    if (node != null) {\n        if (node.namespaceURI != null && node.namespaceURI !== ns) {\n            ns = node.namespaceURI;\n            if (node.getAttribute('xmlns') == null) {\n                node.setAttribute('xmlns', node.namespaceURI);\n            }\n        }\n        if (node.nodeType === NODE_TYPE.DOCUMENT) {\n            result.push(getPrettyXml(node.documentElement, tab, indent, newline, ns));\n        }\n        else if (node.nodeType === NODE_TYPE.DOCUMENT_FRAGMENT) {\n            let tmp = node.firstChild;\n            if (tmp != null) {\n                while (tmp != null) {\n                    result.push(getPrettyXml(tmp, tab, indent, newline, ns));\n                    tmp = tmp.nextSibling;\n                }\n            }\n        }\n        else if (node.nodeType === NODE_TYPE.COMMENT) {\n            const value = getTextContent(node);\n            if (value.length > 0) {\n                result.push(`${indent}<!--${value}-->${newline}`);\n            }\n        }\n        else if (node.nodeType === NODE_TYPE.TEXT) {\n            const value = trim(getTextContent(node));\n            if (value && value.length > 0) {\n                result.push(indent + htmlEntities(value, false) + newline);\n            }\n        }\n        else if (node.nodeType === NODE_TYPE.CDATA) {\n            const value = getTextContent(node);\n            if (value.length > 0) {\n                result.push(`${indent}<![CDATA[${value}]]${newline}`);\n            }\n        }\n        else {\n            result.push(`${indent}<${node.nodeName}`);\n            // Creates the string with the node attributes\n            // and converts all HTML entities in the values\n            const attrs = node.attributes;\n            if (attrs != null) {\n                for (let i = 0; i < attrs.length; i += 1) {\n                    const val = htmlEntities(attrs[i].value);\n                    result.push(` ${attrs[i].nodeName}=\"${val}\"`);\n                }\n            }\n            // Recursively creates the XML string for each child\n            // node and appends it here with an indentation\n            let tmp = node.firstChild;\n            if (tmp != null) {\n                result.push(`>${newline}`);\n                while (tmp != null) {\n                    result.push(getPrettyXml(tmp, tab, indent + tab, newline, ns));\n                    tmp = tmp.nextSibling;\n                }\n                result.push(`${indent}</${node.nodeName}>${newline}`);\n            }\n            else {\n                result.push(` />${newline}`);\n            }\n        }\n    }\n    return result.join('');\n};\n/**\n * Returns the first node where attr equals value.\n * This implementation does not use XPath.\n */\nexport const findNode = (node, attr, value) => {\n    if (isElement(node)) {\n        const tmp = node.getAttribute(attr);\n        if (tmp && tmp === value) {\n            return node;\n        }\n    }\n    node = node.firstChild;\n    while (node) {\n        const result = findNode(node, attr, value);\n        if (result) {\n            return result;\n        }\n        node = node.nextSibling;\n    }\n    return null;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { isNullish, matchBinaryMask } from '../../internal/utils.js';\nimport { mod } from '../../util/mathUtils.js';\nimport { getAlignmentAsPoint } from '../../util/styleUtils.js';\nimport Client from '../../Client.js';\nimport { ABSOLUTE_LINE_HEIGHT, DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, FONT_STYLE_MASK, LINE_HEIGHT, NONE, NS_SVG, NS_XLINK, WORD_WRAP, } from '../../util/Constants.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport AbstractCanvas2D from './AbstractCanvas2D.js';\nimport { getXml } from '../../util/xmlUtils.js';\nimport { isNode, write } from '../../util/domUtils.js';\nimport { htmlEntities, trim } from '../../util/StringUtils.js';\n// Activates workaround for gradient ID resolution if base tag is used.\nconst useAbsoluteIds = typeof DOMParser === 'function' &&\n    !Client.IS_CHROMEAPP &&\n    !Client.IS_EDGE &&\n    document.getElementsByTagName('base').length > 0;\n/**\n * Extends {@link AbstractCanvas2D} to implement a canvas for SVG.\n * This canvas writes all calls as SVG output to the given SVG root node.\n *\n * ```javascript\n * const svgDoc = mxUtils.createXmlDocument();\n * const root = (svgDoc.createElementNS != null) ?\n * \t\tsvgDoc.createElementNS(mxConstants.NS_SVG, 'svg') : svgDoc.createElement('svg');\n *\n * if (svgDoc.createElementNS == null) {\n *   root.setAttribute('xmlns', constants.NS_SVG);\n *   root.setAttribute('xmlns:xlink', constants.NS_XLINK);\n * } else {\n *   root.setAttributeNS('http://www.w3.org/2000/xmlns/', 'xmlns:xlink', constants.NS_XLINK);\n * }\n *\n * var bounds = graph.getGraphBounds();\n * root.setAttribute('width', (bounds.x + bounds.width + 4) + 'px');\n * root.setAttribute('height', (bounds.y + bounds.height + 4) + 'px');\n * root.setAttribute('version', '1.1');\n *\n * svgDoc.appendChild(root);\n *\n * var svgCanvas = new mxSvgCanvas2D(root);\n * ```\n *\n *\n * To disable anti-aliasing in the output, use the following code.\n * ```javascript\n * graph.view.canvas.ownerSVGElement.setAttribute('shape-rendering', 'crispEdges');\n * ```\n * Or set the respective attribute in the SVG element directly.\n */\nclass SvgCanvas2D extends AbstractCanvas2D {\n    constructor(root, styleEnabled) {\n        super();\n        this.defs = null;\n        this.styleEnabled = true;\n        /**\n         * Holds the current DOM node.\n         */\n        this.node = null;\n        /**\n         * Specifies if plain text output should match the vertical HTML alignment.\n         * @default true.\n         */\n        this.matchHtmlAlignment = true;\n        /**\n         * Specifies if text output should be enabled.\n         * @default true\n         */\n        this.textEnabled = true;\n        /**\n         * Specifies if use of foreignObject for HTML markup is allowed.\n         * @default true\n         */\n        this.foEnabled = true;\n        /**\n         * Specifies the fallback text for unsupported foreignObjects in exported documents.\n         * If this is set to `null` then no fallback text is added to the exported document.\n         * @default [Object]\n         */\n        this.foAltText = '[Object]';\n        /**\n         * Offset to be used for foreignObjects.\n         * @default 0\n         */\n        this.foOffset = 0;\n        /**\n         * Offset to be used for text elements.\n         * @default 0\n         */\n        this.textOffset = 0;\n        /**\n         * Offset to be used for image elements.\n         * @default 0\n         */\n        this.imageOffset = 0;\n        /**\n         * Adds transparent paths for strokes.\n         * @default 0\n         */\n        this.strokeTolerance = 0;\n        /**\n         * Minimum stroke width for output.\n         * @default 1\n         */\n        this.minStrokeWidth = 1;\n        /**\n         * Local counter for references in SVG export.\n         * @default 0\n         */\n        this.refCount = 0;\n        /**\n         * Correction factor for {@link LINE_HEIGHT} in HTML output.\n         * @default 1\n         */\n        this.lineHeightCorrection = 1;\n        /**\n         * Default value for active pointer events.\n         * @default all\n         */\n        this.pointerEventsValue = 'all';\n        /**\n         * Padding to be added for text that is not wrapped to account for differences in font metrics on different platforms in pixels.\n         * @default 10.\n         */\n        this.fontMetricsPadding = 10;\n        /**\n         * Specifies if offsetWidth and offsetHeight should be cached. This is used to speed up repaint of text in {@link updateText}.\n         * @default true\n         */\n        this.cacheOffsetSize = true;\n        this.originalRoot = null;\n        /**\n         * Reference to the container for the SVG content.\n         */\n        this.root = root;\n        /**\n         * Local cache of gradients for quick lookups.\n         */\n        this.gradients = {};\n        /**\n         * Reference to the defs section of the SVG document. Only for export.\n         */\n        this.defs = null;\n        /**\n         * Stores the value of styleEnabled passed to the constructor.\n         */\n        this.styleEnabled = styleEnabled != null ? styleEnabled : false;\n        let svg = null;\n        // Adds optional defs section for export\n        if (root.ownerDocument !== document) {\n            let node = root;\n            // Finds owner SVG element in XML DOM\n            while (node && node.nodeName !== 'svg') {\n                node = node.parentElement;\n            }\n            svg = node;\n        }\n        if (svg) {\n            // Tries to get existing defs section\n            const tmp = svg.getElementsByTagName('defs');\n            if (tmp.length > 0) {\n                this.defs = svg.getElementsByTagName('defs')[0];\n            }\n            // Adds defs section if none exists\n            if (!this.defs) {\n                this.defs = this.createElement('defs');\n                if (svg.firstChild != null) {\n                    svg.insertBefore(this.defs, svg.firstChild);\n                }\n                else {\n                    svg.appendChild(this.defs);\n                }\n            }\n            // Adds stylesheet\n            if (this.styleEnabled) {\n                this.defs.appendChild(this.createStyle());\n            }\n        }\n    }\n    /**\n     * Rounds all numbers to 2 decimal points.\n     */\n    format(value) {\n        return parseFloat(value.toFixed(2));\n    }\n    /**\n     * Returns the URL of the page without the hash part. This needs to use href to\n     * include any search part with no params (ie question mark alone). This is a\n     * workaround for the fact that window.location.search is empty if there is\n     * no search string behind the question mark.\n     */\n    getBaseUrl() {\n        let { href } = window.location;\n        const hash = href.lastIndexOf('#');\n        if (hash > 0) {\n            href = href.substring(0, hash);\n        }\n        return href;\n    }\n    /**\n     * Returns any offsets for rendering pixels.\n     */\n    reset() {\n        super.reset();\n        this.gradients = {};\n    }\n    end() {\n        return;\n    }\n    /**\n     * Creates the optional style section.\n     */\n    createStyle() {\n        const style = this.createElement('style');\n        style.setAttribute('type', 'text/css');\n        write(style, `svg{font-family:${DEFAULT_FONTFAMILY};font-size:${DEFAULT_FONTSIZE};fill:none;stroke-miterlimit:10}`);\n        return style;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    createElement(tagName, namespace) {\n        return this.root?.ownerDocument.createElementNS(namespace || NS_SVG, tagName);\n    }\n    /**\n     * Returns the alternate text string for the given foreignObject.\n     */\n    getAlternateText(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation) {\n        return !isNullish(str) ? this.foAltText : null;\n    }\n    /**\n     * Returns the alternate content for the given foreignObject.\n     */\n    createAlternateContent(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation) {\n        const text = this.getAlternateText(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation);\n        const s = this.state;\n        if (!isNullish(text) && s.fontSize > 0) {\n            const dy = valign === 'top' ? 1 : valign === 'bottom' ? 0 : 0.3;\n            const anchor = align === 'right' ? 'end' : align === 'left' ? 'start' : 'middle';\n            const alt = this.createElement('text');\n            alt.setAttribute('x', String(Math.round(x + s.dx)));\n            alt.setAttribute('y', String(Math.round(y + s.dy + dy * s.fontSize)));\n            alt.setAttribute('fill', s.fontColor || 'black');\n            alt.setAttribute('font-family', s.fontFamily);\n            alt.setAttribute('font-size', `${Math.round(s.fontSize)}px`);\n            // Text-anchor start is default in SVG\n            anchor !== 'start' && alt.setAttribute('text-anchor', anchor);\n            const fontStyle = s.fontStyle;\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.BOLD) &&\n                alt.setAttribute('font-weight', 'bold');\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.ITALIC) &&\n                alt.setAttribute('font-style', 'italic');\n            const txtDecor = [];\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.UNDERLINE) && txtDecor.push('underline');\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n                txtDecor.push('line-through');\n            txtDecor.length > 0 && alt.setAttribute('text-decoration', txtDecor.join(' '));\n            write(alt, text);\n            return alt;\n        }\n        return null;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    createGradientId(start, end, alpha1, alpha2, direction) {\n        // Removes illegal characters from gradient ID\n        if (start.charAt(0) === '#') {\n            start = start.substring(1);\n        }\n        if (end.charAt(0) === '#') {\n            end = end.substring(1);\n        }\n        // Workaround for gradient IDs not working in Safari 5 / Chrome 6\n        // if they contain uppercase characters\n        start = `${start.toLowerCase()}-${alpha1}`;\n        end = `${end.toLowerCase()}-${alpha2}`;\n        // Wrong gradient directions possible?\n        let dir = null;\n        if (direction == null || direction === 'south') {\n            dir = 's';\n        }\n        else if (direction === 'east') {\n            dir = 'e';\n        }\n        else {\n            const tmp = start;\n            start = end;\n            end = tmp;\n            if (direction === 'north') {\n                dir = 's';\n            }\n            else if (direction === 'west') {\n                dir = 'e';\n            }\n        }\n        return `mx-gradient-${start}-${end}-${dir}`;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    getSvgGradient(start, end, alpha1, alpha2, direction) {\n        const id = this.createGradientId(start, end, alpha1, alpha2, direction);\n        let gradient = this.gradients[id];\n        if (!gradient) {\n            const svg = this.root.ownerSVGElement;\n            let counter = 0;\n            let tmpId = `${id}-${counter}`;\n            if (svg) {\n                gradient = svg.ownerDocument.getElementById(tmpId);\n                while (gradient && gradient.ownerSVGElement !== svg) {\n                    tmpId = `${id}-${counter++}`;\n                    gradient = svg.ownerDocument.getElementById(tmpId);\n                }\n            }\n            else {\n                // Uses shorter IDs for export\n                tmpId = `id${++this.refCount}`;\n            }\n            if (!gradient) {\n                gradient = this.createSvgGradient(start, end, alpha1, alpha2, direction);\n                gradient.setAttribute('id', tmpId);\n                if (this.defs) {\n                    this.defs.appendChild(gradient);\n                }\n                else if (svg) {\n                    svg.appendChild(gradient);\n                }\n            }\n            this.gradients[id] = gradient;\n        }\n        return gradient.getAttribute('id');\n    }\n    /**\n     * Creates the given SVG gradient.\n     */\n    createSvgGradient(start, end, alpha1, alpha2, direction) {\n        const gradient = this.createElement('linearGradient');\n        gradient.setAttribute('x1', '0%');\n        gradient.setAttribute('y1', '0%');\n        gradient.setAttribute('x2', '0%');\n        gradient.setAttribute('y2', '0%');\n        if (direction == null || direction === 'south') {\n            gradient.setAttribute('y2', '100%');\n        }\n        else if (direction === 'east') {\n            gradient.setAttribute('x2', '100%');\n        }\n        else if (direction === 'north') {\n            gradient.setAttribute('y1', '100%');\n        }\n        else if (direction === 'west') {\n            gradient.setAttribute('x1', '100%');\n        }\n        let op = alpha1 < 1 ? `;stop-opacity:${alpha1}` : '';\n        let stop = this.createElement('stop');\n        stop.setAttribute('offset', '0%');\n        stop.setAttribute('style', `stop-color:${start}${op}`);\n        gradient.appendChild(stop);\n        op = alpha2 < 1 ? `;stop-opacity:${alpha2}` : '';\n        stop = this.createElement('stop');\n        stop.setAttribute('offset', '100%');\n        stop.setAttribute('style', `stop-color:${end}${op}`);\n        gradient.appendChild(stop);\n        return gradient;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    addNode(filled, stroked) {\n        const { node } = this;\n        const s = this.state;\n        if (node) {\n            if (node.nodeName === 'path') {\n                // Checks if the path is not empty\n                if (this.path && this.path.length > 0) {\n                    node.setAttribute('d', this.path.join(' '));\n                }\n                else {\n                    return;\n                }\n            }\n            if (filled && s.fillColor !== NONE) {\n                this.updateFill();\n            }\n            else if (!this.styleEnabled) {\n                // Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=814952\n                if (node.nodeName === 'ellipse' && Client.IS_FF) {\n                    node.setAttribute('fill', 'transparent');\n                }\n                else {\n                    node.setAttribute('fill', NONE);\n                }\n                // Sets the actual filled state for stroke tolerance\n                filled = false;\n            }\n            if (stroked && s.strokeColor !== NONE) {\n                this.updateStroke();\n            }\n            else if (!this.styleEnabled) {\n                node.setAttribute('stroke', NONE);\n            }\n            if (s.transform && s.transform.length > 0) {\n                node.setAttribute('transform', s.transform);\n            }\n            if (s.shadow) {\n                this.root.appendChild(this.createShadow(node));\n            }\n            // Adds stroke tolerance\n            if (this.strokeTolerance > 0 && !filled) {\n                this.root.appendChild(this.createTolerance(node));\n            }\n            // Adds pointer events\n            if (this.pointerEvents) {\n                node.setAttribute('pointer-events', this.pointerEventsValue);\n            }\n            // Enables clicks for nodes inside a link element\n            else if (!this.pointerEvents && !this.originalRoot) {\n                node.setAttribute('pointer-events', NONE);\n            }\n            // Removes invisible nodes from output if they don't handle events\n            if ((node.nodeName !== 'rect' &&\n                node.nodeName !== 'path' &&\n                node.nodeName !== 'ellipse') ||\n                (node.getAttribute('fill') !== NONE &&\n                    node.getAttribute('fill') !== 'transparent') ||\n                node.getAttribute('stroke') !== NONE ||\n                node.getAttribute('pointer-events') !== NONE) {\n                // LATER: Update existing DOM for performance\n                this.root.appendChild(node);\n            }\n            this.node = null;\n        }\n    }\n    /**\n     * Transfers the stroke attributes from <state> to <node>.\n     */\n    updateFill() {\n        const s = this.state;\n        if (s.alpha < 1 || s.fillAlpha < 1) {\n            this.node.setAttribute('fill-opacity', String(s.alpha * s.fillAlpha));\n        }\n        if (s.fillColor !== NONE) {\n            if (s.gradientColor !== NONE) {\n                const id = this.getSvgGradient(s.fillColor, s.gradientColor, s.gradientFillAlpha, s.gradientAlpha, s.gradientDirection);\n                if (this.root?.ownerDocument === document && useAbsoluteIds) {\n                    // Workaround for no fill with base tag in page (escape brackets)\n                    const base = this.getBaseUrl().replace(/([()])/g, '\\\\$1');\n                    this.node.setAttribute('fill', `url(${base}#${id})`);\n                }\n                else {\n                    this.node.setAttribute('fill', `url(#${id})`);\n                }\n            }\n            else {\n                this.node.setAttribute('fill', s.fillColor.toLowerCase());\n            }\n        }\n    }\n    /**\n     * Returns the current stroke width (>= 1), ie. max(1, this.format(this.state.strokeWidth * this.state.scale)).\n     */\n    getCurrentStrokeWidth() {\n        return Math.max(this.minStrokeWidth, Math.max(0.01, this.format(this.state.strokeWidth * this.state.scale)));\n    }\n    /**\n     * Transfers the stroke attributes from {@link mxAbstractCanvas2D.state} to {@link node}.\n     */\n    updateStroke() {\n        const s = this.state;\n        if (s.strokeColor && s.strokeColor !== NONE) {\n            this.node.setAttribute('stroke', s.strokeColor.toLowerCase());\n        }\n        if (s.alpha < 1 || s.strokeAlpha < 1) {\n            this.node.setAttribute('stroke-opacity', String(s.alpha * s.strokeAlpha));\n        }\n        const sw = this.getCurrentStrokeWidth();\n        if (sw !== 1) {\n            this.node.setAttribute('stroke-width', String(sw));\n        }\n        if (this.node.nodeName === 'path') {\n            this.updateStrokeAttributes();\n        }\n        if (s.dashed) {\n            this.node.setAttribute('stroke-dasharray', this.createDashPattern((s.fixDash ? 1 : s.strokeWidth) * s.scale));\n        }\n    }\n    /**\n     * Transfers the stroke attributes from {@link mxAbstractCanvas2D.state} to {@link node}.\n     */\n    updateStrokeAttributes() {\n        const s = this.state;\n        // Linejoin miter is default in SVG\n        if (s.lineJoin && s.lineJoin !== 'miter') {\n            this.node.setAttribute('stroke-linejoin', s.lineJoin);\n        }\n        if (s.lineCap) {\n            // flat is called butt in SVG\n            let value = s.lineCap;\n            if (value === 'flat') {\n                value = 'butt';\n            }\n            // Linecap butt is default in SVG\n            if (value !== 'butt') {\n                this.node.setAttribute('stroke-linecap', value);\n            }\n        }\n        // Miterlimit 10 is default in our document\n        if (s.miterLimit != null && (!this.styleEnabled || s.miterLimit !== 10)) {\n            this.node.setAttribute('stroke-miterlimit', String(s.miterLimit));\n        }\n    }\n    /**\n     * Creates the SVG dash pattern for the given state.\n     */\n    createDashPattern(scale) {\n        const pat = [];\n        if (typeof this.state.dashPattern === 'string') {\n            const dash = this.state.dashPattern.split(' ');\n            if (dash.length > 0) {\n                for (let i = 0; i < dash.length; i += 1) {\n                    pat[i] = Number(dash[i]) * scale;\n                }\n            }\n        }\n        return pat.join(' ');\n    }\n    /**\n     * Creates a hit detection tolerance shape for the given node.\n     */\n    createTolerance(node) {\n        const tol = node.cloneNode(true);\n        const sw = parseFloat(tol.getAttribute('stroke-width') || '1') + this.strokeTolerance;\n        tol.setAttribute('pointer-events', 'stroke');\n        tol.setAttribute('visibility', 'hidden');\n        tol.removeAttribute('stroke-dasharray');\n        tol.setAttribute('stroke-width', String(sw));\n        tol.setAttribute('fill', 'none');\n        tol.setAttribute('stroke', 'white');\n        return tol;\n    }\n    /**\n     * Creates a shadow for the given node.\n     */\n    createShadow(node) {\n        const shadow = node.cloneNode(true);\n        const s = this.state;\n        // Firefox uses transparent for no fill in ellipses\n        if (shadow.getAttribute('fill') !== 'none' &&\n            (!Client.IS_FF || shadow.getAttribute('fill') !== 'transparent')) {\n            shadow.setAttribute('fill', s.shadowColor);\n        }\n        if (shadow.getAttribute('stroke') !== 'none' &&\n            s.shadowColor &&\n            s.shadowColor !== NONE) {\n            shadow.setAttribute('stroke', s.shadowColor);\n        }\n        shadow.setAttribute('transform', `translate(${this.format(s.shadowDx * s.scale)},${this.format(s.shadowDy * s.scale)})${s.transform || ''}`);\n        shadow.setAttribute('opacity', String(s.shadowAlpha));\n        return shadow;\n    }\n    /**\n     * Experimental implementation for hyperlinks.\n     */\n    setLink(link) {\n        if (!link) {\n            this.root = this.originalRoot;\n        }\n        else {\n            this.originalRoot = this.root;\n            const node = this.createElement('a');\n            // Workaround for implicit namespace handling in HTML5 export, IE adds NS1 namespace so use code below\n            // in all IE versions except quirks mode. KNOWN: Adds xlink namespace to each image tag in output.\n            if (node.setAttributeNS == null || this.root.ownerDocument !== document) {\n                node.setAttribute('xlink:href', link);\n            }\n            else {\n                node.setAttributeNS(NS_XLINK, 'xlink:href', link);\n            }\n            this.root.appendChild(node);\n            this.root = node;\n        }\n    }\n    /**\n     * Sets the rotation of the canvas. Note that rotation cannot be concatenated.\n     */\n    rotate(theta, flipH, flipV, cx, cy) {\n        if (theta !== 0 || flipH || flipV) {\n            const s = this.state;\n            cx += s.dx;\n            cy += s.dy;\n            cx *= s.scale;\n            cy *= s.scale;\n            s.transform = s.transform || '';\n            // This implementation uses custom scale/translate and built-in rotation\n            // Rotation state is part of the AffineTransform in state.transform\n            if (flipH && flipV) {\n                theta += 180;\n            }\n            else if (flipH !== flipV) {\n                const tx = flipH ? cx : 0;\n                const sx = flipH ? -1 : 1;\n                const ty = flipV ? cy : 0;\n                const sy = flipV ? -1 : 1;\n                s.transform +=\n                    `translate(${this.format(tx)},${this.format(ty)})` +\n                        `scale(${this.format(sx)},${this.format(sy)})` +\n                        `translate(${this.format(-tx)},${this.format(-ty)})`;\n            }\n            if (flipH ? !flipV : flipV) {\n                theta *= -1;\n            }\n            if (theta !== 0) {\n                s.transform += `rotate(${this.format(theta)},${this.format(cx)},${this.format(cy)})`;\n            }\n            s.rotation += theta;\n            s.rotationCx = cx;\n            s.rotationCy = cy;\n        }\n    }\n    /**\n     * Extends superclass to create path.\n     */\n    begin() {\n        super.begin();\n        this.node = this.createElement('path');\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    rect(x, y, w, h) {\n        const s = this.state;\n        const n = this.createElement('rect');\n        n.setAttribute('x', String(this.format((x + s.dx) * s.scale)));\n        n.setAttribute('y', String(this.format((y + s.dy) * s.scale)));\n        n.setAttribute('width', String(this.format(w * s.scale)));\n        n.setAttribute('height', String(this.format(h * s.scale)));\n        this.node = n;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    roundrect(x, y, w, h, dx, dy) {\n        this.rect(x, y, w, h);\n        if (dx > 0) {\n            this.node.setAttribute('rx', String(this.format(dx * this.state.scale)));\n        }\n        if (dy > 0) {\n            this.node.setAttribute('ry', String(this.format(dy * this.state.scale)));\n        }\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    ellipse(x, y, w, h) {\n        const s = this.state;\n        const n = this.createElement('ellipse');\n        // No rounding for consistent output with 1.x\n        n.setAttribute('cx', String(this.format((x + w / 2 + s.dx) * s.scale)));\n        n.setAttribute('cy', String(this.format((y + h / 2 + s.dy) * s.scale)));\n        n.setAttribute('rx', String((w / 2) * s.scale));\n        n.setAttribute('ry', String((h / 2) * s.scale));\n        this.node = n;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    image(x, y, w, h, src, aspect = true, flipH = false, flipV = false) {\n        src = this.converter.convert(src);\n        const s = this.state;\n        x += s.dx;\n        y += s.dy;\n        const node = this.createElement('image');\n        node.setAttribute('x', String(this.format(x * s.scale) + this.imageOffset));\n        node.setAttribute('y', String(this.format(y * s.scale) + this.imageOffset));\n        node.setAttribute('width', String(this.format(w * s.scale)));\n        node.setAttribute('height', String(this.format(h * s.scale)));\n        // Workaround for missing namespace support\n        if (!node.setAttributeNS) {\n            node.setAttribute('xlink:href', src);\n        }\n        else {\n            node.setAttributeNS(NS_XLINK, 'xlink:href', src);\n        }\n        if (!aspect) {\n            node.setAttribute('preserveAspectRatio', 'none');\n        }\n        if (s.alpha < 1 || s.fillAlpha < 1) {\n            node.setAttribute('opacity', String(s.alpha * s.fillAlpha));\n        }\n        let tr = this.state.transform || '';\n        if (flipH || flipV) {\n            let sx = 1;\n            let sy = 1;\n            let dx = 0;\n            let dy = 0;\n            if (flipH) {\n                sx = -1;\n                dx = -w - 2 * x;\n            }\n            if (flipV) {\n                sy = -1;\n                dy = -h - 2 * y;\n            }\n            // Adds image transformation to existing transform\n            tr += `scale(${sx},${sy})translate(${dx * s.scale},${dy * s.scale})`;\n        }\n        if (tr.length > 0) {\n            node.setAttribute('transform', tr);\n        }\n        if (!this.pointerEvents) {\n            node.setAttribute('pointer-events', 'none');\n        }\n        this.root.appendChild(node);\n    }\n    /**\n     * Converts the given HTML string to XHTML.\n     */\n    convertHtml(val) {\n        const doc = new DOMParser().parseFromString(val, 'text/html');\n        if (doc != null) {\n            val = new XMLSerializer().serializeToString(doc.body);\n            // Extracts body content from DOM\n            if (val.substring(0, 5) === '<body') {\n                val = val.substring(val.indexOf('>', 5) + 1);\n            }\n            if (val.substring(val.length - 7, val.length) === '</body>') {\n                val = val.substring(0, val.length - 7);\n            }\n        }\n        return val;\n    }\n    /**\n     * Private helper function to create SVG elements\n     * Note: signature changed in mxgraph 4.1.0\n     */\n    createDiv(str) {\n        let val = str;\n        if (!isNode(val)) {\n            val = `<div><div>${this.convertHtml(val)}</div></div>`;\n        }\n        if (document.createElementNS) {\n            const div = document.createElementNS('http://www.w3.org/1999/xhtml', 'div');\n            if (isNode(val)) {\n                const n = val;\n                const div2 = document.createElement('div');\n                const div3 = div2.cloneNode(false);\n                // Creates a copy for export\n                if (this.root.ownerDocument !== document) {\n                    div2.appendChild(n.cloneNode(true));\n                }\n                else {\n                    div2.appendChild(n);\n                }\n                div3.appendChild(div2);\n                div.appendChild(div3);\n            }\n            else {\n                div.innerHTML = val;\n            }\n            return div;\n        }\n        if (isNode(val)) {\n            val = `<div><div>${getXml(val)}</div></div>`;\n        }\n        val = `<div xmlns=\"http://www.w3.org/1999/xhtml\">${val}</div>`;\n        // NOTE: FF 3.6 crashes if content CSS contains \"height:100%\"\n        return new DOMParser().parseFromString(val, 'text/xml').documentElement;\n    }\n    /**\n     * Updates existing DOM nodes for text rendering. LATER: Merge common parts with text function below.\n     */\n    updateText(x, y, w, h, align, valign, wrap, overflow, clip, rotation, node) {\n        if (node && node.firstChild && node.firstChild.firstChild) {\n            this.updateTextNodes(x, y, w, h, align, valign, wrap, overflow, clip, rotation, node.firstChild);\n        }\n    }\n    /**\n     * Creates a foreignObject for the given string and adds it to the given root.\n     */\n    addForeignObject(x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation, dir, div, root) {\n        const group = this.createElement('g');\n        const fo = this.createElement('foreignObject');\n        // Workarounds for print clipping and static position in Safari\n        fo.setAttribute('style', 'overflow: visible; text-align: left;');\n        fo.setAttribute('pointer-events', 'none');\n        fo.appendChild(div);\n        group.appendChild(fo);\n        this.updateTextNodes(x, y, w, h, align, valign, wrap, overflow, clip, rotation, group);\n        // Alternate content if foreignObject not supported\n        if (this.root?.ownerDocument !== document) {\n            const alt = this.createAlternateContent(fo, x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation);\n            if (alt != null) {\n                fo.setAttribute('requiredFeatures', 'http://www.w3.org/TR/SVG11/feature#Extensibility');\n                const sw = this.createElement('switch');\n                sw.appendChild(fo);\n                sw.appendChild(alt);\n                group.appendChild(sw);\n            }\n        }\n        root.appendChild(group);\n    }\n    /**\n     * Updates existing DOM nodes for text rendering.\n     */\n    updateTextNodes(x, y, w, h, align, valign, wrap, overflow, clip, rotation, g) {\n        const s = this.state.scale;\n        SvgCanvas2D.createCss(w + 2, h, align, valign, wrap, overflow, clip, this.state.fontBackgroundColor != null ? this.state.fontBackgroundColor : null, this.state.fontBorderColor != null ? this.state.fontBorderColor : null, `display: flex; align-items: unsafe ${valign === 'top' ? 'flex-start' : valign === 'bottom' ? 'flex-end' : 'center'}; ` +\n            `justify-content: unsafe ${align === 'left' ? 'flex-start' : align === 'right' ? 'flex-end' : 'center'}; `, this.getTextCss(), s, (dx, dy, flex, item, block) => {\n            x += this.state.dx;\n            y += this.state.dy;\n            const fo = g.firstChild;\n            const div = fo.firstChild;\n            const box = div.firstChild;\n            const text = box.firstChild;\n            const r = (this.rotateHtml ? this.state.rotation : 0) + (rotation != null ? rotation : 0);\n            let t = (this.foOffset !== 0 ? `translate(${this.foOffset} ${this.foOffset})` : '') +\n                (s !== 1 ? `scale(${s})` : '');\n            text.setAttribute('style', block);\n            box.setAttribute('style', item);\n            // Workaround for clipping in Webkit with scrolling and zoom\n            fo.setAttribute('width', `${Math.ceil((1 / Math.min(1, s)) * 100)}%`);\n            fo.setAttribute('height', `${Math.ceil((1 / Math.min(1, s)) * 100)}%`);\n            const yp = Math.round(y + dy);\n            // Allows for negative values which are causing problems with\n            // transformed content where the top edge of the foreignObject\n            // limits the text box being moved further up in the diagram.\n            // KNOWN: Possible clipping problems with zoom and scrolling\n            // but this is normally not used with scrollbars as the\n            // coordinates are always positive with scrollbars.\n            // Margin-top is ignored in Safari and no negative values allowed\n            // for padding.\n            if (yp < 0) {\n                fo.setAttribute('y', String(yp));\n            }\n            else {\n                fo.removeAttribute('y');\n                flex += `padding-top: ${yp}px; `;\n            }\n            div.setAttribute('style', `${flex}margin-left: ${Math.round(x + dx)}px;`);\n            t += r !== 0 ? `rotate(${r} ${x} ${y})` : '';\n            // Output allows for reflow but Safari cannot use absolute position,\n            // transforms or opacity. https://bugs.webkit.org/show_bug.cgi?id=23113\n            if (t !== '') {\n                g.setAttribute('transform', t);\n            }\n            else {\n                g.removeAttribute('transform');\n            }\n            if (this.state.alpha !== 1) {\n                g.setAttribute('opacity', String(this.state.alpha));\n            }\n            else {\n                g.removeAttribute('opacity');\n            }\n        });\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    getTextCss() {\n        const s = this.state;\n        const lh = ABSOLUTE_LINE_HEIGHT\n            ? `${s.fontSize * LINE_HEIGHT}px`\n            : LINE_HEIGHT * this.lineHeightCorrection;\n        let css = `display: inline-block; font-size: ${s.fontSize}px; ` +\n            `font-family: ${s.fontFamily}; color: ${s.fontColor}; line-height: ${lh}; pointer-events: ${this.pointerEvents ? this.pointerEventsValue : 'none'}; `;\n        const fontStyle = s.fontStyle;\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.BOLD) && (css += 'font-weight: bold; ');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.ITALIC) && (css += 'font-style: italic; ');\n        const txtDecor = [];\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.UNDERLINE) && txtDecor.push('underline');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n            txtDecor.push('line-through');\n        txtDecor.length > 0 && (css += `text-decoration: ${txtDecor.join(' ')}; `);\n        return css;\n    }\n    /**\n     * Paints the given text. Possible values for format are empty string for plain\n     * text and html for HTML markup. Note that HTML markup is only supported if\n     * foreignObject is supported and <foEnabled> is true. (This means IE9 and later\n     * does currently not support HTML text as part of shapes.)\n     */\n    text(x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation = 0, dir) {\n        if (this.textEnabled && str != null) {\n            rotation = rotation != null ? rotation : 0;\n            if (this.foEnabled && format === 'html') {\n                const div = this.createDiv(str);\n                // Ignores invalid XHTML labels\n                if (div != null) {\n                    if (dir != null) {\n                        div.setAttribute('dir', dir);\n                    }\n                    this.addForeignObject(x, y, w, h, str, align, valign, wrap, format, overflow, clip, rotation, dir, div, this.root);\n                }\n            }\n            else {\n                this.plainText(x + this.state.dx, y + this.state.dy, w, h, str, align, valign, wrap, overflow, clip, rotation, dir);\n            }\n        }\n    }\n    /**\n     * Creates a clip for the given coordinates.\n     */\n    createClip(x, y, w, h) {\n        x = Math.round(x);\n        y = Math.round(y);\n        w = Math.round(w);\n        h = Math.round(h);\n        const id = `mx-clip-${x}-${y}-${w}-${h}`;\n        let counter = 0;\n        let tmp = `${id}-${counter}`;\n        // Resolves ID conflicts\n        while (document.getElementById(tmp) != null) {\n            tmp = `${id}-${++counter}`;\n        }\n        const clip = this.createElement('clipPath');\n        clip.setAttribute('id', tmp);\n        const rect = this.createElement('rect');\n        rect.setAttribute('x', String(x));\n        rect.setAttribute('y', String(y));\n        rect.setAttribute('width', String(w));\n        rect.setAttribute('height', String(h));\n        clip.appendChild(rect);\n        return clip;\n    }\n    /**\n     * Paints the given text. Possible values for format are empty string for\n     * plain text and html for HTML markup.\n     */\n    plainText(x, y, w, h, str, align, valign, wrap, overflow, clip, rotation = 0, dir) {\n        const s = this.state;\n        const size = s.fontSize;\n        const node = this.createElement('g');\n        let tr = s.transform || '';\n        this.updateFont(node);\n        // Ignores pointer events\n        if (!this.pointerEvents && this.originalRoot == null) {\n            node.setAttribute('pointer-events', 'none');\n        }\n        // Non-rotated text\n        if (rotation !== 0) {\n            tr += `rotate(${rotation},${this.format(x * s.scale)},${this.format(y * s.scale)})`;\n        }\n        if (dir != null) {\n            node.setAttribute('direction', dir);\n        }\n        if (clip && w > 0 && h > 0) {\n            let cx = x;\n            let cy = y;\n            if (align === 'center') {\n                cx -= w / 2;\n            }\n            else if (align === 'right') {\n                cx -= w;\n            }\n            if (overflow !== 'fill') {\n                if (valign === 'middle') {\n                    cy -= h / 2;\n                }\n                else if (valign === 'bottom') {\n                    cy -= h;\n                }\n            }\n            // LATER: Remove spacing from clip rectangle\n            const c = this.createClip(cx * s.scale - 2, cy * s.scale - 2, w * s.scale + 4, h * s.scale + 4);\n            if (this.defs != null) {\n                this.defs.appendChild(c);\n            }\n            else {\n                // Makes sure clip is removed with referencing node\n                this.root.appendChild(c);\n            }\n            if (!Client.IS_CHROMEAPP &&\n                !Client.IS_EDGE &&\n                this.root.ownerDocument === document) {\n                // Workaround for potential base tag\n                const base = this.getBaseUrl().replace(/([()])/g, '\\\\$1');\n                node.setAttribute('clip-path', `url(${base}#${c.getAttribute('id')})`);\n            }\n            else {\n                node.setAttribute('clip-path', `url(#${c.getAttribute('id')})`);\n            }\n        }\n        // Default is left\n        const anchor = align === 'right' ? 'end' : align === 'center' ? 'middle' : 'start';\n        // Text-anchor start is default in SVG\n        if (anchor !== 'start') {\n            node.setAttribute('text-anchor', anchor);\n        }\n        if (!this.styleEnabled || size !== DEFAULT_FONTSIZE) {\n            node.setAttribute('font-size', `${size * s.scale}px`);\n        }\n        if (tr.length > 0) {\n            node.setAttribute('transform', tr);\n        }\n        if (s.alpha < 1) {\n            node.setAttribute('opacity', String(s.alpha));\n        }\n        const lines = str.split('\\n');\n        const lh = Math.round(size * LINE_HEIGHT);\n        const textHeight = size + (lines.length - 1) * lh;\n        let cy = y + size - 1;\n        if (valign === 'middle') {\n            if (overflow === 'fill') {\n                cy -= h / 2;\n            }\n            else {\n                const dy = (this.matchHtmlAlignment && clip && h > 0\n                    ? Math.min(textHeight, h)\n                    : textHeight) / 2;\n                cy -= dy;\n            }\n        }\n        else if (valign === 'bottom') {\n            if (overflow === 'fill') {\n                cy -= h;\n            }\n            else {\n                const dy = this.matchHtmlAlignment && clip && h > 0 ? Math.min(textHeight, h) : textHeight;\n                cy -= dy + 1;\n            }\n        }\n        for (let i = 0; i < lines.length; i += 1) {\n            const line = trim(lines[i]);\n            // Workaround for bounding box of empty lines and spaces\n            if (line) {\n                const text = this.createElement('text');\n                // LATER: Match horizontal HTML alignment\n                text.setAttribute('x', String(this.format(x * s.scale) + this.textOffset));\n                text.setAttribute('y', String(this.format(cy * s.scale) + this.textOffset));\n                write(text, line);\n                node.appendChild(text);\n            }\n            cy += lh;\n        }\n        this.root.appendChild(node);\n        this.addTextBackground(node, str, x, y, w, overflow === 'fill' ? h : textHeight, align, valign, overflow);\n    }\n    /**\n     * Updates the text properties for the given node. (NOTE: For this to work in\n     * IE, the given node must be a text or tspan element.)\n     */\n    updateFont(node) {\n        const s = this.state;\n        if (s.fontColor && s.fontColor !== NONE) {\n            node.setAttribute('fill', s.fontColor);\n        }\n        if (!this.styleEnabled || s.fontFamily !== DEFAULT_FONTFAMILY) {\n            node.setAttribute('font-family', s.fontFamily);\n        }\n        const fontStyle = s.fontStyle;\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.BOLD) &&\n            node.setAttribute('font-weight', 'bold');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.ITALIC) &&\n            node.setAttribute('font-style', 'italic');\n        const txtDecor = [];\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.UNDERLINE) && txtDecor.push('underline');\n        matchBinaryMask(fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n            txtDecor.push('line-through');\n        txtDecor.length > 0 && node.setAttribute('text-decoration', txtDecor.join(' '));\n    }\n    /**\n     * Background color and border\n     */\n    addTextBackground(node, str, x, y, w, h, align, valign, overflow) {\n        const s = this.state;\n        if (s.fontBackgroundColor != null || s.fontBorderColor != null) {\n            let bbox = null;\n            if (overflow === 'fill' || overflow === 'width') {\n                if (align === 'center') {\n                    x -= w / 2;\n                }\n                else if (align === 'right') {\n                    x -= w;\n                }\n                if (valign === 'middle') {\n                    y -= h / 2;\n                }\n                else if (valign === 'bottom') {\n                    y -= h;\n                }\n                bbox = new Rectangle((x + 1) * s.scale, y * s.scale, (w - 2) * s.scale, (h + 2) * s.scale);\n                // @ts-ignore check for getBBox\n            }\n            else if (node.getBBox != null && this.root.ownerDocument === document) {\n                // Uses getBBox only if inside document for correct size\n                try {\n                    // @ts-ignore getBBox exists\n                    bbox = node.getBBox();\n                    bbox = new Rectangle(bbox.x, bbox.y + 1, bbox.width, bbox.height + 0);\n                }\n                catch (e) {\n                    // Ignores NS_ERROR_FAILURE in FF if container display is none.\n                }\n            }\n            if (bbox == null || bbox.width === 0 || bbox.height === 0) {\n                // Computes size if not in document or no getBBox available\n                const div = document.createElement('div');\n                // Wrapping and clipping can be ignored here\n                div.style.lineHeight = ABSOLUTE_LINE_HEIGHT\n                    ? `${s.fontSize * LINE_HEIGHT}px`\n                    : String(LINE_HEIGHT);\n                div.style.fontSize = `${s.fontSize}px`;\n                div.style.fontFamily = s.fontFamily;\n                div.style.whiteSpace = 'nowrap';\n                div.style.position = 'absolute';\n                div.style.visibility = 'hidden';\n                div.style.display = 'inline-block';\n                matchBinaryMask(s.fontStyle, FONT_STYLE_MASK.BOLD) &&\n                    (div.style.fontWeight = 'bold');\n                matchBinaryMask(s.fontStyle, FONT_STYLE_MASK.ITALIC) &&\n                    (div.style.fontStyle = 'italic');\n                str = htmlEntities(str, false);\n                div.innerHTML = str.replace(/\\n/g, '<br/>');\n                document.body.appendChild(div);\n                const w = div.offsetWidth;\n                const h = div.offsetHeight;\n                document.body.removeChild(div);\n                if (align === 'center') {\n                    x -= w / 2;\n                }\n                else if (align === 'right') {\n                    x -= w;\n                }\n                if (valign === 'middle') {\n                    y -= h / 2;\n                }\n                else if (valign === 'bottom') {\n                    y -= h;\n                }\n                bbox = new Rectangle((x + 1) * s.scale, (y + 2) * s.scale, w * s.scale, (h + 1) * s.scale);\n            }\n            if (bbox != null) {\n                const n = this.createElement('rect');\n                n.setAttribute('fill', s.fontBackgroundColor || 'none');\n                n.setAttribute('stroke', s.fontBorderColor || 'none');\n                n.setAttribute('x', String(Math.floor(bbox.x - 1)));\n                n.setAttribute('y', String(Math.floor(bbox.y - 1)));\n                n.setAttribute('width', String(Math.ceil(bbox.width + 2)));\n                n.setAttribute('height', String(Math.ceil(bbox.height)));\n                const sw = s.fontBorderColor ? Math.max(1, this.format(s.scale)) : 0;\n                n.setAttribute('stroke-width', String(sw));\n                // Workaround for crisp rendering - only required if not exporting\n                if (this.root?.ownerDocument === document && mod(sw, 2) === 1) {\n                    n.setAttribute('transform', 'translate(0.5, 0.5)');\n                }\n                node.insertBefore(n, node.firstChild);\n            }\n        }\n    }\n    /**\n     * Paints the outline of the current path.\n     */\n    stroke() {\n        this.addNode(false, true);\n    }\n    /**\n     * Fills the current path.\n     */\n    fill() {\n        this.addNode(true, false);\n    }\n    /**\n     * Fills and paints the outline of the current path.\n     */\n    fillAndStroke() {\n        this.addNode(true, true);\n    }\n}\n/**\n * Updates existing DOM nodes for text rendering.\n */\nSvgCanvas2D.createCss = (w, h, align, valign, wrap, overflow, clip, bg, border, flex, block, scale, callback) => {\n    let item = `box-sizing: border-box; font-size: 0; text-align: ${align === 'left' ? 'left' : align === 'right' ? 'right' : 'center'}; `;\n    const pt = getAlignmentAsPoint(align, valign);\n    let ofl = 'overflow: hidden; ';\n    let fw = 'width: 1px; ';\n    let fh = 'height: 1px; ';\n    let dx = pt.x * w;\n    let dy = pt.y * h;\n    if (clip) {\n        fw = `width: ${Math.round(w)}px; `;\n        item += `max-height: ${Math.round(h)}px; `;\n        dy = 0;\n    }\n    else if (overflow === 'fill') {\n        fw = `width: ${Math.round(w)}px; `;\n        fh = `height: ${Math.round(h)}px; `;\n        block += 'width: 100%; height: 100%; ';\n        item += fw + fh;\n    }\n    else if (overflow === 'width') {\n        fw = `width: ${Math.round(w)}px; `;\n        block += 'width: 100%; ';\n        item += fw;\n        dy = 0;\n        if (h > 0) {\n            item += `max-height: ${Math.round(h)}px; `;\n        }\n    }\n    else {\n        ofl = '';\n        dy = 0;\n    }\n    let bgc = '';\n    if (bg) {\n        bgc += `background-color: ${bg}; `;\n    }\n    if (border) {\n        bgc += `border: 1px solid ${border}; `;\n    }\n    if (ofl == '' || clip) {\n        block += bgc;\n    }\n    else {\n        item += bgc;\n    }\n    if (wrap && w > 0) {\n        block += `white-space: normal; word-wrap: ${WORD_WRAP}; `;\n        fw = `width: ${Math.round(w)}px; `;\n        if (ofl !== '' && overflow !== 'fill') {\n            dy = 0;\n        }\n    }\n    else {\n        block += 'white-space: nowrap; ';\n        if (ofl === '') {\n            dx = 0;\n        }\n    }\n    callback(dx, dy, flex + fw + fh, item + ofl, block, ofl);\n};\nexport default SvgCanvas2D;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../geometry/Rectangle.js';\nimport { isNullish } from '../../internal/utils.js';\nimport { getBoundingBox, getDirectedBounds, mod } from '../../util/mathUtils.js';\nimport { LINE_ARCSIZE, NONE, NS_SVG, RECTANGLE_ROUNDING_FACTOR, } from '../../util/Constants.js';\nimport Point from '../geometry/Point.js';\nimport SvgCanvas2D from '../canvas/SvgCanvas2D.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Client from '../../Client.js';\nimport { StyleDefaultsConfig } from '../../util/config.js';\n/**\n * Base class for all shapes.\n * A shape in maxGraph is a separate implementation for SVG, VML and HTML.\n * Which implementation to use is controlled by the dialect property which\n * is assigned from within the CellRenderer when the shape is created.\n * The dialect must be assigned for a shape, and it does normally depend on\n * the browser and the configuration of the graph (see maxGraph rendering hint).\n *\n * For each supported shape in SVG and VML, a corresponding shape exists in\n * maxGraph, namely for text, image, rectangle, rhombus, ellipse and polyline.\n * The other shapes are a combination of these shapes (e.g. label and swimlane)\n * or they consist of one or more (filled) path objects (e.g. actor and cylinder).\n * The HTML implementation is optional but may be required for a HTML-only view\n * of the graph.\n *\n * ### Custom Shapes\n * To extend from this class, the basic code looks as follows.\n * In the special case where the custom shape consists only of one filled region\n * or one filled region and an additional stroke the mxActor and mxCylinder\n * should be subclassed, respectively.\n * ```javascript\n * function CustomShape() { }\n *\n * CustomShape.prototype = new mxShape();\n * CustomShape.prototype.constructor = CustomShape;\n * ```\n * To register a custom shape in an existing graph instance, one must register the\n * shape under a new name in the graphs cell renderer as follows:\n * ```javascript\n * ShapeRegistry.add('customShape', CustomShape);\n * ```\n * The second argument is the name of the constructor.\n * In order to use the shape you can refer to the given name above in a stylesheet.\n * For example, to change the shape for the default vertex style, the following code\n * is used:\n * ```javascript\n * const style = graph.getStylesheet().getDefaultVertexStyle();\n * style.shape = 'customShape';\n * ```\n *\n * @category Shape\n */\nclass Shape {\n    constructor(stencil = null) {\n        /**\n         * Switch to preserve image aspect.\n         * @default false\n         */\n        this.preserveImageAspect = false;\n        this.overlay = null;\n        this.indicator = null;\n        this.indicatorShape = null;\n        /** @see CellHighlight */\n        this.opacity = 100;\n        this.isDashed = false;\n        this.fill = NONE;\n        this.gradient = NONE;\n        this.gradientDirection = 'east';\n        this.fillOpacity = 100;\n        this.strokeOpacity = 100;\n        this.stroke = NONE;\n        this.strokeWidth = 1;\n        this.spacing = 0;\n        this.startSize = 1;\n        this.endSize = 1;\n        this.startArrow = NONE;\n        this.endArrow = NONE;\n        this.direction = 'east';\n        this.flipH = false;\n        this.flipV = false;\n        this.isShadow = false;\n        this.isRounded = false;\n        this.rotation = 0;\n        this.cursor = '';\n        this.verticalTextRotation = 0;\n        this.oldGradients = {};\n        this.glass = false;\n        /**\n         * Holds the dialect in which the shape is to be painted.\n         */\n        this.dialect = null;\n        /**\n         * Holds the scale in which the shape is being painted.\n         */\n        this.scale = 1;\n        /**\n         * Rendering hint for configuring the canvas.\n         */\n        this.antiAlias = true;\n        /**\n         * Minimum stroke width for SVG output.\n         */\n        this.minSvgStrokeWidth = 1;\n        /**\n         * Holds the {@link Rectangle} that specifies the bounds of this shape.\n         */\n        this.bounds = null;\n        /**\n         * Holds the array of <Point> that specify the points of this shape.\n         */\n        this.points = [];\n        /**\n         * Optional reference to the corresponding <CellState>.\n         */\n        this.state = null;\n        /**\n         * Optional reference to the style of the corresponding <CellState>.\n         */\n        this.style = null;\n        /**\n         * Contains the bounding box of the shape, that is, the smallest rectangle\n         * that includes all pixels of the shape.\n         */\n        this.boundingBox = null;\n        /**\n         * Holds the {@link StencilShape} that defines the shape.\n         */\n        this.stencil = null;\n        /**\n         * Event-tolerance for SVG strokes (in px).\n         * This is only passed to the canvas in {@link createSvgCanvas} if {@link pointerEvents} is `true`.\n         * @default 8\n         */\n        this.svgStrokeTolerance = 8;\n        /**\n         * Specifies if pointer events should be handled. Default is true.\n         */\n        this.pointerEvents = true;\n        this.originalPointerEvents = null;\n        /**\n         * Specifies if pointer events should be handled. Default is true.\n         */\n        this.svgPointerEvents = 'all';\n        /**\n         * Specifies if pointer events outside of shape should be handled. Default\n         * is false.\n         */\n        this.shapePointerEvents = false;\n        /**\n         * Specifies if pointer events outside of stencils should be handled. Default\n         * is false. Set this to true for backwards compatibility with the 1.x branch.\n         */\n        this.stencilPointerEvents = false;\n        /**\n         * Specifies if the shape should be drawn as an outline. This disables all\n         * fill colors and can be used to disable other drawing states that should\n         * not be painted for outlines. Default is false. This should be set before\n         * calling <apply>.\n         */\n        this.outline = false;\n        /**\n         * Specifies if the shape is visible. Default is true.\n         */\n        this.visible = true;\n        /**\n         * Allows to use the SVG bounding box in SVG. Default is false for performance\n         * reasons.\n         */\n        this.useSvgBoundingBox = true;\n        this.image = null;\n        this.imageSrc = null;\n        this.indicatorColor = NONE;\n        this.indicatorStrokeColor = NONE;\n        this.indicatorGradientColor = NONE;\n        this.indicatorDirection = 'east';\n        this.indicatorImageSrc = null;\n        // `stencil` is not null when instantiated directly,\n        // but can be null when instantiated through a child class.\n        if (stencil) {\n            this.stencil = stencil;\n        }\n        // moved from init()\n        this.node = this.create();\n    }\n    /**\n     * Initializes the shape by adding it into the given container if the node of the shape doesn't already have a parent.\n     *\n     * @param container DOM node that will contain the shape.\n     */\n    init(container) {\n        if (!this.node.parentNode) {\n            container.appendChild(this.node);\n        }\n    }\n    /**\n     * Sets the styles to their default values.\n     */\n    initStyles() {\n        this.strokeWidth = 1;\n        this.rotation = 0;\n        this.opacity = 100;\n        this.fillOpacity = 100;\n        this.strokeOpacity = 100;\n        this.flipH = false;\n        this.flipV = false;\n    }\n    /**\n     * Returns true if HTML is allowed for this shape. This implementation always returns `false`.\n     */\n    isHtmlAllowed() {\n        return false;\n    }\n    /**\n     * Returns 0, or 0.5 if {@link strokeWidth} % 2 == 1.\n     */\n    getSvgScreenOffset() {\n        const sw = this.stencil && this.stencil.strokeWidthValue !== 'inherit'\n            ? Number(this.stencil.strokeWidthValue)\n            : (this.strokeWidth ?? 0);\n        return mod(Math.max(1, Math.round(sw * this.scale)), 2) === 1 ? 0.5 : 0;\n    }\n    /**\n     * Creates and returns the DOM node for the shape.\n     * This implementation assumes that `maxGraph` produces SVG elements.\n     */\n    create() {\n        return document.createElementNS(NS_SVG, 'g');\n    }\n    redraw() {\n        this.updateBoundsFromPoints();\n        if (this.visible && this.checkBounds()) {\n            this.node.style.visibility = 'visible';\n            this.clear();\n            this.redrawShape();\n            this.updateBoundingBox();\n        }\n        else {\n            this.node.style.visibility = 'hidden';\n            this.boundingBox = null;\n        }\n    }\n    /**\n     * Removes all child nodes and resets all CSS.\n     */\n    clear() {\n        while (this.node.lastChild) {\n            this.node.removeChild(this.node.lastChild);\n        }\n    }\n    /**\n     * Updates the bounds based on the points.\n     */\n    updateBoundsFromPoints() {\n        const pts = this.points;\n        if (pts.length > 0 && pts[0]) {\n            this.bounds = new Rectangle(Math.round(pts[0].x), Math.round(pts[0].y), 1, 1);\n            for (const pt of pts) {\n                if (pt) {\n                    this.bounds.add(new Rectangle(Math.round(pt.x), Math.round(pt.y), 1, 1));\n                }\n            }\n        }\n    }\n    /**\n     * Returns the {@link Rectangle} for the label bounds of this shape, based on the\n     * given scaled and translated bounds of the shape. This method should not\n     * change the rectangle in-place. This implementation returns the given rect.\n     */\n    getLabelBounds(rect) {\n        const d = this.style?.direction ?? 'east';\n        let bounds = rect.clone();\n        // Normalizes argument for getLabelMargins hook\n        if (d !== 'south' &&\n            d !== 'north' &&\n            this.state &&\n            this.state.text &&\n            this.state.text.isPaintBoundsInverted()) {\n            bounds = bounds.clone();\n            [bounds.width, bounds.height] = [bounds.height, bounds.width];\n        }\n        let labelMargins = this.getLabelMargins(bounds);\n        if (labelMargins) {\n            labelMargins = labelMargins.clone();\n            let flipH = this.style?.flipH ?? false;\n            let flipV = this.style?.flipV ?? false;\n            // Handles special case for vertical labels\n            if (this.state && this.state.text && this.state.text.isPaintBoundsInverted()) {\n                const tmp = labelMargins.x;\n                labelMargins.x = labelMargins.height;\n                labelMargins.height = labelMargins.width;\n                labelMargins.width = labelMargins.y;\n                labelMargins.y = tmp;\n                [flipH, flipV] = [flipV, flipH];\n            }\n            return getDirectedBounds(rect, labelMargins, this.style, flipH, flipV);\n        }\n        return rect;\n    }\n    /**\n     * Returns the scaled top, left, bottom and right margin to be used for\n     * computing the label bounds as an {@link Rectangle}, where the bottom and right\n     * margin are defined in the width and height of the rectangle, respectively.\n     */\n    getLabelMargins(rect) {\n        return null;\n    }\n    /**\n     * Returns true if the bounds are not null and all of its variables are numeric.\n     */\n    checkBounds() {\n        return (!Number.isNaN(this.scale) &&\n            Number.isFinite(this.scale) &&\n            this.scale > 0 &&\n            this.bounds &&\n            !Number.isNaN(this.bounds.x) &&\n            !Number.isNaN(this.bounds.y) &&\n            !Number.isNaN(this.bounds.width) &&\n            !Number.isNaN(this.bounds.height) &&\n            this.bounds.width > 0 &&\n            this.bounds.height > 0);\n    }\n    /**\n     * Updates the SVG or VML shape.\n     */\n    redrawShape() {\n        const canvas = this.createCanvas();\n        if (canvas) {\n            // Specifies if events should be handled\n            canvas.pointerEvents = this.pointerEvents;\n            this.beforePaint(canvas);\n            this.paint(canvas);\n            this.afterPaint(canvas);\n            if (this.node !== canvas.root && canvas.root) {\n                // Forces parsing in IE8 standards mode - slow! avoid\n                this.node.insertAdjacentHTML('beforeend', canvas.root.outerHTML);\n            }\n            this.destroyCanvas(canvas);\n        }\n    }\n    /**\n     * Creates a new canvas for drawing this shape. May return null.\n     */\n    createCanvas() {\n        const canvas = this.createSvgCanvas();\n        if (canvas && this.outline) {\n            canvas.setStrokeWidth(this.strokeWidth);\n            canvas.setStrokeColor(this.stroke);\n            if (this.isDashed) {\n                canvas.setDashed(this.isDashed);\n            }\n            canvas.setStrokeWidth = () => {\n                return;\n            };\n            canvas.setStrokeColor = () => {\n                return;\n            };\n            canvas.setFillColor = () => {\n                return;\n            };\n            canvas.setGradient = () => {\n                return;\n            };\n            canvas.setDashed = () => {\n                return;\n            };\n            canvas.text = () => {\n                return;\n            };\n        }\n        return canvas;\n    }\n    /**\n     * Creates and returns an {@link SvgCanvas2D} for rendering this shape.\n     */\n    createSvgCanvas() {\n        if (!this.node)\n            return null;\n        const canvas = new SvgCanvas2D(this.node, false);\n        canvas.strokeTolerance = this.pointerEvents ? this.svgStrokeTolerance : 0;\n        canvas.pointerEventsValue = this.svgPointerEvents;\n        const off = this.getSvgScreenOffset();\n        if (off !== 0) {\n            this.node.setAttribute('transform', `translate(${off},${off})`);\n        }\n        else {\n            this.node.removeAttribute('transform');\n        }\n        canvas.minStrokeWidth = this.minSvgStrokeWidth;\n        if (!this.antiAlias) {\n            // Rounds all numbers in the SVG output to integers\n            canvas.format = (value) => {\n                return Math.round(value);\n            };\n        }\n        return canvas;\n    }\n    /**\n     * Destroys the given canvas which was used for drawing. This implementation\n     * increments the reference counts on all shared gradients used in the canvas.\n     */\n    destroyCanvas(canvas) {\n        // Manages reference counts\n        if (canvas instanceof SvgCanvas2D) {\n            // Increments ref counts\n            for (const key in canvas.gradients) {\n                const gradient = canvas.gradients[key];\n                if (gradient) {\n                    gradient.mxRefCount = (gradient.mxRefCount || 0) + 1;\n                }\n            }\n            this.releaseSvgGradients(this.oldGradients);\n            this.oldGradients = canvas.gradients;\n        }\n    }\n    /**\n     * Invoked before paint is called.\n     */\n    beforePaint(c) {\n        return;\n    }\n    /**\n     * Invokes after paint was called.\n     */\n    afterPaint(c) {\n        return;\n    }\n    /**\n     * Generic rendering code.\n     */\n    paint(c) {\n        let strokeDrawn = false;\n        if (c && this.outline) {\n            const { stroke } = c;\n            c.stroke = (...args) => {\n                strokeDrawn = true;\n                stroke.apply(c, args);\n            };\n            const { fillAndStroke } = c;\n            c.fillAndStroke = (...args) => {\n                strokeDrawn = true;\n                fillAndStroke.apply(c, args);\n            };\n        }\n        // Scale is passed-through to canvas\n        const s = this.scale;\n        const bounds = this.bounds;\n        if (bounds) {\n            let x = bounds.x / s;\n            let y = bounds.y / s;\n            let w = bounds.width / s;\n            let h = bounds.height / s;\n            if (this.isPaintBoundsInverted()) {\n                const t = (w - h) / 2;\n                x += t;\n                y -= t;\n                const tmp = w;\n                w = h;\n                h = tmp;\n            }\n            this.updateTransform(c, x, y, w, h);\n            this.configureCanvas(c, x, y, w, h);\n            // Adds background rectangle to capture events\n            let bg = null;\n            if ((!this.stencil && this.points.length === 0 && this.shapePointerEvents) ||\n                (this.stencil && this.stencilPointerEvents)) {\n                const bb = this.createBoundingBox();\n                if (bb && this.node) {\n                    bg = this.createTransparentSvgRectangle(bb.x, bb.y, bb.width, bb.height);\n                    this.node.appendChild(bg);\n                }\n            }\n            if (this.stencil) {\n                this.stencil.drawShape(c, this, x, y, w, h);\n            }\n            else {\n                // Stencils have separate strokewidth\n                c.setStrokeWidth(this.strokeWidth);\n                if (this.points.length > 0) {\n                    // Paints edge shape\n                    const pts = [];\n                    for (let i = 0; i < this.points.length; i += 1) {\n                        const p = this.points[i];\n                        if (p) {\n                            pts.push(new Point(p.x / s, p.y / s));\n                        }\n                    }\n                    this.paintEdgeShape(c, pts);\n                }\n                else {\n                    // Paints vertex shape\n                    this.paintVertexShape(c, x, y, w, h);\n                }\n            }\n            if (bg && c.state && !isNullish(c.state.transform)) {\n                bg.setAttribute('transform', c.state.transform);\n            }\n            // Draws highlight rectangle if no stroke was used\n            if (c && this.outline && !strokeDrawn) {\n                c.rect(x, y, w, h);\n                c.stroke();\n            }\n        }\n    }\n    /**\n     * Sets the state of the canvas for drawing the shape.\n     */\n    configureCanvas(c, x, y, w, h) {\n        let dash = null;\n        if (this.style && this.style.dashPattern != null) {\n            dash = this.style.dashPattern;\n        }\n        c.setAlpha(this.opacity / 100);\n        c.setFillAlpha(this.fillOpacity / 100);\n        c.setStrokeAlpha(this.strokeOpacity / 100);\n        // Sets alpha, colors and gradients\n        if (this.isShadow) {\n            c.setShadow(this.isShadow);\n        }\n        // Dash pattern\n        if (this.isDashed) {\n            c.setDashed(this.isDashed, this.style?.fixDash ?? false);\n        }\n        if (dash) {\n            c.setDashPattern(dash);\n        }\n        if (this.fill !== NONE && this.gradient !== NONE) {\n            const b = this.getGradientBounds(c, x, y, w, h);\n            c.setGradient(this.fill, this.gradient, b.x, b.y, b.width, b.height, this.gradientDirection);\n        }\n        else {\n            c.setFillColor(this.fill);\n        }\n        c.setStrokeColor(this.stroke);\n    }\n    /**\n     * Returns the bounding box for the gradient box for this shape.\n     */\n    getGradientBounds(c, x, y, w, h) {\n        return new Rectangle(x, y, w, h);\n    }\n    /**\n     * Sets the scale and rotation on the given canvas.\n     */\n    updateTransform(c, x, y, w, h) {\n        // NOTE: Currently, scale is implemented in state and canvas. This will\n        // move to canvas in a later version, so that the states are unscaled\n        // and untranslated and do not need an update after zooming or panning.\n        c.scale(this.scale);\n        c.rotate(this.getShapeRotation(), this.flipH, this.flipV, x + w / 2, y + h / 2);\n    }\n    /**\n     * Paints the vertex shape.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        this.paintBackground(c, x, y, w, h);\n        if (!this.outline || !this.style || !(this.style.backgroundOutline ?? false)) {\n            c.setShadow(false);\n            this.paintForeground(c, x, y, w, h);\n        }\n    }\n    /**\n     * Hook for subclassers. This implementation is empty.\n     */\n    paintBackground(c, x, y, w, h) {\n        return;\n    }\n    /**\n     * Hook for subclassers. This implementation is empty.\n     */\n    paintForeground(c, x, y, w, h) {\n        return;\n    }\n    /**\n     * Hook for subclassers. This implementation is empty.\n     */\n    paintEdgeShape(c, pts) {\n        return;\n    }\n    /**\n     * Base arc size for the shape, taken from the style.\n     * @since 0.21.0\n     */\n    getBaseArcSize() {\n        return (this.style?.arcSize ?? LINE_ARCSIZE) / 2;\n    }\n    /**\n     * Returns the arc size for the given dimension.\n     */\n    getArcSize(w, h) {\n        if (this.style?.absoluteArcSize) {\n            return Math.min(this.getBaseArcSize(), Math.min(h, w) / 2);\n        }\n        const roundingFactor = (this.style?.arcSize ?? RECTANGLE_ROUNDING_FACTOR * 100) / 100;\n        return Math.min(w, h) * roundingFactor;\n    }\n    /**\n     * Paints the glass gradient effect.\n     */\n    paintGlassEffect(c, x, y, w, h, arc) {\n        const sw = Math.ceil((this.strokeWidth ?? 0) / 2);\n        const size = 0.4;\n        c.setGradient('#ffffff', '#ffffff', x, y, w, h * 0.6, 'south', 0.9, 0.1);\n        c.begin();\n        arc += 2 * sw;\n        if (this.isRounded) {\n            c.moveTo(x - sw + arc, y - sw);\n            c.quadTo(x - sw, y - sw, x - sw, y - sw + arc);\n            c.lineTo(x - sw, y + h * size);\n            c.quadTo(x + w * 0.5, y + h * 0.7, x + w + sw, y + h * size);\n            c.lineTo(x + w + sw, y - sw + arc);\n            c.quadTo(x + w + sw, y - sw, x + w + sw - arc, y - sw);\n        }\n        else {\n            c.moveTo(x - sw, y - sw);\n            c.lineTo(x - sw, y + h * size);\n            c.quadTo(x + w * 0.5, y + h * 0.7, x + w + sw, y + h * size);\n            c.lineTo(x + w + sw, y - sw);\n        }\n        c.close();\n        c.fill();\n    }\n    /**\n     * Paints the given points with rounded corners.\n     */\n    addPoints(c, pts, rounded = false, arcSize, close = false, exclude = [], initialMove = true) {\n        if (pts.length > 0) {\n            const pe = pts[pts.length - 1];\n            // Adds virtual waypoint in the center between start and end point\n            if (close && rounded) {\n                pts = pts.slice();\n                const p0 = pts[0];\n                const wp = new Point(pe.x + (p0.x - pe.x) / 2, pe.y + (p0.y - pe.y) / 2);\n                pts.splice(0, 0, wp);\n            }\n            let pt = pts[0];\n            let i = 1;\n            // Draws the line segments\n            if (initialMove) {\n                c.moveTo(pt.x, pt.y);\n            }\n            else {\n                c.lineTo(pt.x, pt.y);\n            }\n            while (i < (close ? pts.length : pts.length - 1)) {\n                let tmp = pts[mod(i, pts.length)];\n                let dx = pt.x - tmp.x;\n                let dy = pt.y - tmp.y;\n                if (rounded && (dx !== 0 || dy !== 0) && exclude.indexOf(i - 1) < 0) {\n                    // Draws a line from the last point to the current\n                    // point with a spacing of size off the current point\n                    // into direction of the last point\n                    let dist = Math.sqrt(dx * dx + dy * dy);\n                    const nx1 = (dx * Math.min(arcSize, dist / 2)) / dist;\n                    const ny1 = (dy * Math.min(arcSize, dist / 2)) / dist;\n                    const x1 = tmp.x + nx1;\n                    const y1 = tmp.y + ny1;\n                    c.lineTo(x1, y1);\n                    // Draws a curve from the last point to the current\n                    // point with a spacing of size off the current point\n                    // into direction of the next point\n                    let next = pts[mod(i + 1, pts.length)];\n                    // Uses next non-overlapping point\n                    while (i < pts.length - 2 &&\n                        Math.round(next.x - tmp.x) === 0 &&\n                        Math.round(next.y - tmp.y) === 0) {\n                        next = pts[mod(i + 2, pts.length)];\n                        i++;\n                    }\n                    dx = next.x - tmp.x;\n                    dy = next.y - tmp.y;\n                    dist = Math.max(1, Math.sqrt(dx * dx + dy * dy));\n                    const nx2 = (dx * Math.min(arcSize, dist / 2)) / dist;\n                    const ny2 = (dy * Math.min(arcSize, dist / 2)) / dist;\n                    const x2 = tmp.x + nx2;\n                    const y2 = tmp.y + ny2;\n                    c.quadTo(tmp.x, tmp.y, x2, y2);\n                    tmp = new Point(x2, y2);\n                }\n                else {\n                    c.lineTo(tmp.x, tmp.y);\n                }\n                pt = tmp;\n                i += 1;\n            }\n            if (close) {\n                c.close();\n            }\n            else {\n                c.lineTo(pe.x, pe.y);\n            }\n        }\n    }\n    /**\n     * Resets all styles.\n     */\n    resetStyles() {\n        this.initStyles();\n        this.spacing = 0;\n        this.fill = NONE;\n        this.gradient = NONE;\n        this.gradientDirection = 'east';\n        this.stroke = NONE;\n        this.startSize = 1;\n        this.endSize = 1;\n        this.startArrow = NONE;\n        this.endArrow = NONE;\n        this.direction = 'east';\n        this.isShadow = false;\n        this.isDashed = false;\n        this.isRounded = false;\n        this.glass = false;\n    }\n    /**\n     * Applies the style of the given <CellState> to the shape. This\n     * implementation assigns the following styles to local fields:\n     *\n     * - <'fillColor'> => fill\n     * - <'gradientColor'> => gradient\n     * - <'gradientDirection'> => gradientDirection\n     * - <'opacity'> => opacity\n     * - {@link Constants#STYLE_FILL_OPACITY} => fillOpacity\n     * - {@link Constants#STYLE_STROKE_OPACITY} => strokeOpacity\n     * - <'strokeColor'> => stroke\n     * - <'strokeWidth'> => strokewidth\n     * - <'shadow'> => isShadow\n     * - <'dashed'> => isDashed\n     * - <'spacing'> => spacing\n     * - <'startSize'> => startSize\n     * - <'endSize'> => endSize\n     * - <'rounded'> => isRounded\n     * - <'startArrow'> => startArrow\n     * - <'endArrow'> => endArrow\n     * - <'rotation'> => rotation\n     * - <'direction'> => direction\n     * - <'glass'> => glass\n     *\n     * This keeps a reference to the <style>. If you need to keep a reference to\n     * the cell, you can override this method and store a local reference to\n     * state.cell or the <CellState> itself. If <outline> should be true, make\n     * sure to set it before calling this method.\n     *\n     * @param state <CellState> of the corresponding cell.\n     */\n    apply(state) {\n        this.state = state;\n        this.style = state.style;\n        if (this.style) {\n            this.fill = this.style.fillColor ?? this.fill;\n            this.gradient = this.style.gradientColor ?? this.gradient;\n            this.gradientDirection = this.style.gradientDirection ?? this.gradientDirection;\n            this.opacity = this.style.opacity ?? this.opacity;\n            this.fillOpacity = this.style.fillOpacity ?? this.fillOpacity;\n            this.strokeOpacity = this.style.strokeOpacity ?? this.strokeOpacity;\n            this.stroke = this.style.strokeColor ?? this.stroke;\n            this.strokeWidth = this.style.strokeWidth ?? this.strokeWidth;\n            this.spacing = this.style.spacing ?? this.spacing;\n            this.startSize = this.style.startSize ?? this.startSize;\n            this.endSize = this.style.endSize ?? this.endSize;\n            this.startArrow = this.style.startArrow ?? this.startArrow;\n            this.endArrow = this.style.endArrow ?? this.endArrow;\n            this.rotation = this.style.rotation ?? this.rotation;\n            this.direction = this.style.direction ?? this.direction;\n            this.flipH = !!this.style.flipH;\n            this.flipV = !!this.style.flipV;\n            if (this.direction === 'north' || this.direction === 'south') {\n                const tmp = this.flipH;\n                this.flipH = this.flipV;\n                this.flipV = tmp;\n            }\n            this.isShadow = this.style.shadow ?? this.isShadow;\n            this.isDashed = this.style.dashed ?? this.isDashed;\n            this.isRounded = this.style.rounded ?? this.isRounded;\n            this.glass = this.style.glass ?? this.glass;\n        }\n    }\n    /**\n     * Sets the cursor on the given shape.\n     *\n     * @param cursor The cursor to be used.\n     */\n    setCursor(cursor) {\n        this.cursor = cursor;\n        this.node.style.cursor = cursor;\n    }\n    /**\n     * Returns the current cursor.\n     */\n    getCursor() {\n        return this.cursor;\n    }\n    /**\n     * Hook for subclassers. This implementation returns `false`.\n     */\n    isRoundable(c, x, y, w, h) {\n        return false;\n    }\n    /**\n     * Updates the <boundingBox> for this shape using <createBoundingBox> and\n     * <augmentBoundingBox> and stores the result in <boundingBox>.\n     */\n    updateBoundingBox() {\n        // Tries to get bounding box from SVG subsystem\n        // LATER: Use getBoundingClientRect for fallback in VML\n        if (this.useSvgBoundingBox && this.node.ownerSVGElement) {\n            try {\n                const b = this.node.getBBox();\n                if (b.width > 0 && b.height > 0) {\n                    this.boundingBox = new Rectangle(b.x, b.y, b.width, b.height);\n                    // Adds strokeWidth\n                    this.boundingBox.grow(((this.strokeWidth ?? 0) * this.scale) / 2);\n                    return;\n                }\n            }\n            catch (e) {\n                // fallback to code below\n            }\n        }\n        if (this.bounds) {\n            let bbox = this.createBoundingBox();\n            if (bbox) {\n                this.augmentBoundingBox(bbox);\n                const rot = this.getShapeRotation();\n                if (rot !== 0) {\n                    bbox = getBoundingBox(bbox, rot);\n                }\n            }\n            this.boundingBox = bbox;\n        }\n    }\n    /**\n     * Returns a new rectangle that represents the bounding box of the bare shape\n     * with no shadows or strokewidths.\n     */\n    createBoundingBox() {\n        if (!this.bounds)\n            return null;\n        const bb = this.bounds.clone();\n        if ((this.stencil && (this.direction === 'north' || this.direction === 'south')) ||\n            this.isPaintBoundsInverted()) {\n            bb.rotate90();\n        }\n        return bb;\n    }\n    /**\n     * Augments the bounding box with the strokewidth and shadow offsets.\n     */\n    augmentBoundingBox(bbox) {\n        if (this.isShadow) {\n            bbox.width += Math.ceil(StyleDefaultsConfig.shadowOffsetX * this.scale);\n            bbox.height += Math.ceil(StyleDefaultsConfig.shadowOffsetX * this.scale);\n        }\n        // Adds strokeWidth\n        bbox.grow(((this.strokeWidth ?? 0) * this.scale) / 2);\n    }\n    /**\n     * Returns true if the bounds should be inverted.\n     */\n    isPaintBoundsInverted() {\n        // Stencil implements inversion via aspect\n        return !this.stencil && (this.direction === 'north' || this.direction === 'south');\n    }\n    /**\n     * Returns the rotation from the style.\n     */\n    getRotation() {\n        return this.rotation ?? 0;\n    }\n    /**\n     * Returns the rotation for the text label.\n     */\n    getTextRotation() {\n        let rot = this.getRotation();\n        if (!(this.style?.horizontal ?? true)) {\n            rot += this.verticalTextRotation || -90; // WARNING WARNING!!!! ===============================================================================================\n        }\n        return rot;\n    }\n    /**\n     * Returns the actual rotation of the shape.\n     */\n    getShapeRotation() {\n        let rot = this.getRotation();\n        if (this.direction === 'north') {\n            rot += 270;\n        }\n        else if (this.direction === 'west') {\n            rot += 180;\n        }\n        else if (this.direction === 'south') {\n            rot += 90;\n        }\n        return rot;\n    }\n    /**\n     * Adds a transparent rectangle that catches all events.\n     */\n    createTransparentSvgRectangle(x, y, w, h) {\n        const rect = document.createElementNS(NS_SVG, 'rect');\n        rect.setAttribute('x', String(x));\n        rect.setAttribute('y', String(y));\n        rect.setAttribute('width', String(w));\n        rect.setAttribute('height', String(h));\n        rect.setAttribute('fill', NONE);\n        rect.setAttribute('stroke', NONE);\n        rect.setAttribute('pointer-events', 'all');\n        return rect;\n    }\n    redrawHtmlShape() {\n        return;\n    }\n    /**\n     * Sets a transparent background CSS style to catch all events.\n     *\n     * Paints the line shape.\n     */\n    setTransparentBackgroundImage(node) {\n        node.style.backgroundImage = `url('${Client.imageBasePath}/transparent.gif')`;\n    }\n    /**\n     * Paints the line shape.\n     */\n    releaseSvgGradients(grads) {\n        for (const key in grads) {\n            const gradient = grads[key];\n            if (gradient) {\n                gradient.mxRefCount = (gradient.mxRefCount || 0) - 1;\n                if (gradient.mxRefCount === 0 && gradient.parentNode) {\n                    gradient.parentNode.removeChild(gradient);\n                }\n            }\n        }\n    }\n    /**\n     * Destroys the shape by removing it from the DOM and releasing the DOM\n     * node associated with the shape using {@link Event#release}.\n     */\n    destroy() {\n        InternalEvent.release(this.node);\n        if (this.node.parentNode) {\n            this.node.parentNode.removeChild(this.node);\n        }\n        this.node.innerHTML = '';\n        // Decrements refCount and removes unused\n        this.releaseSvgGradients(this.oldGradients);\n        this.oldGradients = {};\n    }\n}\nexport default Shape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\n/**\n * Extends {@link Shape} to implement an ellipse shape.\n *\n * This shape is registered under `ellipse` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass EllipseShape extends Shape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Paints the ellipse shape.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        c.ellipse(x, y, w, h);\n        c.fillAndStroke();\n    }\n}\nexport default EllipseShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NONE } from '../../../util/Constants.js';\nimport Shape from '../Shape.js';\n/**\n * Extends {@link Shape} to implement a rectangle shape.\n *\n * This shape is registered under `rectangle` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass RectangleShape extends Shape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Returns true for non-rounded, non-rotated shapes with no glass gradient.\n     */\n    isHtmlAllowed() {\n        let events = true;\n        if (this.style && this.style.pointerEvents != null) {\n            events = this.style.pointerEvents;\n        }\n        return (!this.isRounded &&\n            !this.glass &&\n            this.rotation === 0 &&\n            (events || this.fill !== NONE));\n    }\n    /**\n     * Generic background painting implementation.\n     */\n    paintBackground(c, x, y, w, h) {\n        let events = true;\n        if (this.style && this.style.pointerEvents != null) {\n            events = this.style.pointerEvents;\n        }\n        if (events || this.fill !== NONE || this.stroke !== NONE) {\n            if (!events && this.fill === NONE) {\n                c.pointerEvents = false;\n            }\n            if (this.isRounded) {\n                const r = this.getArcSize(w, h);\n                c.roundrect(x, y, w, h, r, r);\n            }\n            else {\n                c.rect(x, y, w, h);\n            }\n            c.fillAndStroke();\n        }\n    }\n    /**\n     * Adds roundable support.\n     */\n    isRoundable(c, x, y, w, h) {\n        return true;\n    }\n    /**\n     * Generic background painting implementation.\n     */\n    paintForeground(c, x, y, w, h) {\n        if (this.glass && !this.outline && this.fill !== NONE) {\n            this.paintGlassEffect(c, x, y, w, h, this.getArcSize(w + this.strokeWidth, h + this.strokeWidth));\n        }\n    }\n}\nexport default RectangleShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport RectangleShape from './RectangleShape.js';\nimport { NONE } from '../../../util/Constants.js';\n/**\n * Extends {@link RectangleShape} to implement an image shape.\n *\n * This shape is registered under `image` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass ImageShape extends RectangleShape {\n    constructor(bounds, imageSrc, fill = '#FFFFFF', stroke = '#000000', strokeWidth = 1) {\n        super(bounds, fill, stroke, strokeWidth);\n        this.imageSrc = imageSrc;\n        this.shadow = false;\n        this.preserveImageAspect = true;\n    }\n    /**\n     * Disables offset in IE9 for crisper image output.\n     */\n    getSvgScreenOffset() {\n        return 0;\n    }\n    /**\n     * Overrides to replace the fill and stroke colors with the respective values from {@link imageBackground} and {@link imageBorder}.\n     *\n     * Applies the style of the given {@link CellState} to the shape. This implementation assigns the following styles to local fields:\n     *\n     * - {@link imageBackground} => fill\n     * - {@link imageBorder} => stroke\n     *\n     * @param {CellState} state   {@link CellState} of the corresponding cell.\n     */\n    apply(state) {\n        super.apply(state);\n        this.fill = NONE;\n        this.stroke = NONE;\n        this.gradient = NONE;\n        if (this.style && this.style.imageAspect != null) {\n            this.preserveImageAspect = this.style.imageAspect;\n        }\n    }\n    /**\n     * Returns true if HTML is allowed for this shape. This implementation always\n     * returns false.\n     */\n    isHtmlAllowed() {\n        return !this.preserveImageAspect;\n    }\n    /**\n     * Disables inherited roundable support.\n     */\n    isRoundable(c, x, y, w, h) {\n        return false;\n    }\n    /**\n     * Generic background painting implementation.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        if (this.imageSrc) {\n            const fill = this.style?.imageBackground ?? NONE;\n            const stroke = this.style?.imageBorder ?? NONE;\n            if (fill !== NONE) {\n                // Stroke rendering required for shadow\n                c.setFillColor(fill);\n                c.setStrokeColor(stroke);\n                c.rect(x, y, w, h);\n                c.fillAndStroke();\n            }\n            // FlipH/V are implicit via mxShape.updateTransform\n            c.image(x, y, w, h, this.imageSrc, this.preserveImageAspect, false, false);\n            if (stroke !== NONE) {\n                c.setShadow(false);\n                c.setStrokeColor(stroke);\n                c.rect(x, y, w, h);\n                c.stroke();\n            }\n        }\n        else {\n            this.paintBackground(c, x, y, w, h);\n        }\n    }\n}\nexport default ImageShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Defines an object that contains the constraints about how to connect one side of an edge to its terminal.\n */\nclass ConnectionConstraint {\n    constructor(point, perimeter = true, name = null, dx = 0, dy = 0) {\n        /**\n         * Boolean that specifies if the point should be projected onto the perimeter\n         * of the terminal.\n         */\n        this.perimeter = true;\n        /**\n         * Optional string that specifies the name of the constraint.\n         */\n        this.name = null;\n        /**\n         * Optional float that specifies the horizontal offset of the constraint.\n         */\n        this.dx = 0;\n        /**\n         * Optional float that specifies the vertical offset of the constraint.\n         */\n        this.dy = 0;\n        this.point = point;\n        this.perimeter = perimeter;\n        this.name = name;\n        this.dx = dx;\n        this.dy = dy;\n    }\n}\nexport default ConnectionConstraint;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Image from '../image/ImageBox.js';\nimport Client from '../../Client.js';\nimport { DEFAULT_VALID_COLOR, HIGHLIGHT_OPACITY, HIGHLIGHT_SIZE, HIGHLIGHT_STROKEWIDTH, } from '../../util/Constants.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { intersects } from '../../util/mathUtils.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport ImageShape from '../shape/node/ImageShape.js';\nimport RectangleShape from '../shape/node/RectangleShape.js';\nimport { isShiftDown } from '../../util/EventUtils.js';\n/**\n * Handles constraints on connection targets. This class is in charge of\n * showing fixed points when the mouse is over a vertex and handles constraints\n * to establish new connections.\n *\n */\nclass ConstraintHandler {\n    constructor(graph) {\n        /**\n         * {@link Image} to be used as the image for fixed connection points.\n         */\n        this.pointImage = new Image(`${Client.imageBasePath}/point.gif`, 5, 5);\n        this.currentFocus = null;\n        this.currentFocusArea = null;\n        this.focusIcons = [];\n        this.constraints = null;\n        this.currentConstraint = null;\n        this.focusHighlight = null;\n        this.focusPoints = [];\n        this.currentPoint = null;\n        /**\n         * Specifies if events are handled. Default is true.\n         */\n        this.enabled = true;\n        /**\n         * Specifies the color for the highlight. Default is {@link DEFAULT_VALID_COLOR}.\n         */\n        this.highlightColor = DEFAULT_VALID_COLOR;\n        this.mouseleaveHandler = null;\n        this.graph = graph;\n        // Adds a graph model listener to update the current focus on changes\n        this.resetHandler = () => {\n            if (this.currentFocus && !this.graph.view.getState(this.currentFocus.cell)) {\n                this.reset();\n            }\n            else {\n                this.redraw();\n            }\n        };\n        this.graph.model.addListener(InternalEvent.CHANGE, this.resetHandler);\n        this.graph.view.addListener(InternalEvent.SCALE_AND_TRANSLATE, this.resetHandler);\n        this.graph.view.addListener(InternalEvent.TRANSLATE, this.resetHandler);\n        this.graph.view.addListener(InternalEvent.SCALE, this.resetHandler);\n        this.graph.addListener(InternalEvent.ROOT, this.resetHandler);\n    }\n    /**\n     * Returns true if events are handled. This implementation\n     * returns {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling. This implementation\n     * updates {@link enabled}.\n     *\n     * @param {boolean} enabled - Boolean that specifies the new enabled state.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Resets the state of this handler.\n     */\n    reset() {\n        for (let i = 0; i < this.focusIcons.length; i += 1) {\n            this.focusIcons[i].destroy();\n        }\n        this.focusIcons = [];\n        if (this.focusHighlight) {\n            this.focusHighlight.destroy();\n            this.focusHighlight = null;\n        }\n        this.currentConstraint = null;\n        this.currentFocusArea = null;\n        this.currentPoint = null;\n        this.currentFocus = null;\n        this.focusPoints = [];\n    }\n    /**\n     * Returns the tolerance to be used for intersecting connection points. This\n     * implementation returns {@link mxGraph.tolerance}.\n     *\n     * @param me {@link mxMouseEvent} whose tolerance should be returned.\n     */\n    getTolerance(me) {\n        return this.graph.getEventTolerance();\n    }\n    /**\n     * Returns the tolerance to be used for intersecting connection points.\n     */\n    getImageForConstraint(state, constraint, point) {\n        return this.pointImage;\n    }\n    /**\n     * Returns true if the given {@link mxMouseEvent} should be ignored in {@link update}. This\n     * implementation always returns false.\n     */\n    isEventIgnored(me, source = false) {\n        return false;\n    }\n    /**\n     * Returns true if the given state should be ignored. This always returns false.\n     */\n    isStateIgnored(state, source = false) {\n        return false;\n    }\n    /**\n     * Destroys the {@link focusIcons} if they exist.\n     */\n    destroyIcons() {\n        for (let i = 0; i < this.focusIcons.length; i += 1) {\n            this.focusIcons[i].destroy();\n        }\n        this.focusIcons = [];\n        this.focusPoints = [];\n    }\n    /**\n     * Destroys the {@link focusHighlight} if one exists.\n     */\n    destroyFocusHighlight() {\n        if (this.focusHighlight) {\n            this.focusHighlight.destroy();\n            this.focusHighlight = null;\n        }\n    }\n    /**\n     * Returns true if the current focused state should not be changed for the given event.\n     * This returns true if shift and alt are pressed.\n     */\n    isKeepFocusEvent(me) {\n        return isShiftDown(me.getEvent());\n    }\n    /**\n     * Returns the cell for the given event.\n     */\n    getCellForEvent(me, point) {\n        let cell = me.getCell();\n        // Gets cell under actual point if different from event location\n        if (!cell && point && (me.getGraphX() !== point.x || me.getGraphY() !== point.y)) {\n            cell = this.graph.getCellAt(point.x, point.y);\n        }\n        // Uses connectable parent vertex if one exists\n        if (cell && !cell.isConnectable()) {\n            const parent = cell.getParent();\n            if (parent && parent.isVertex() && parent.isConnectable()) {\n                cell = parent;\n            }\n        }\n        if (cell) {\n            return this.graph.isCellLocked(cell) ? null : cell;\n        }\n        else {\n            return null;\n        }\n    }\n    /**\n     * Updates the state of this handler based on the given {@link mxMouseEvent}.\n     * Source is a boolean indicating if the cell is a source or target.\n     */\n    update(me, source, existingEdge, point) {\n        if (this.isEnabled() && !this.isEventIgnored(me)) {\n            // Lazy installation of mouseleave handler\n            if (!this.mouseleaveHandler && this.graph.container) {\n                this.mouseleaveHandler = () => {\n                    this.reset();\n                };\n                InternalEvent.addListener(this.graph.container, 'mouseleave', this.resetHandler);\n            }\n            const tol = this.getTolerance(me);\n            const x = point ? point.x : me.getGraphX();\n            const y = point ? point.y : me.getGraphY();\n            const grid = new Rectangle(x - tol, y - tol, 2 * tol, 2 * tol);\n            const mouse = new Rectangle(me.getGraphX() - tol, me.getGraphY() - tol, 2 * tol, 2 * tol);\n            const state = this.graph.view.getState(this.getCellForEvent(me, point));\n            // Keeps focus icons visible while over vertex bounds and no other cell under mouse or shift is pressed\n            if (!this.isKeepFocusEvent(me) &&\n                (!this.currentFocusArea ||\n                    !this.currentFocus ||\n                    state ||\n                    !this.currentFocus.cell.isVertex() ||\n                    !intersects(this.currentFocusArea, mouse)) &&\n                state !== this.currentFocus) {\n                this.currentFocusArea = null;\n                this.currentFocus = null;\n                this.setFocus(me, state, source);\n            }\n            this.currentConstraint = null;\n            this.currentPoint = null;\n            let minDistSq = null;\n            let tmp;\n            if (this.focusIcons.length > 0 &&\n                this.constraints &&\n                (!state || this.currentFocus === state)) {\n                const cx = mouse.getCenterX();\n                const cy = mouse.getCenterY();\n                for (let i = 0; i < this.focusIcons.length; i += 1) {\n                    const dx = cx - this.focusIcons[i].bounds.getCenterX();\n                    const dy = cy - this.focusIcons[i].bounds.getCenterY();\n                    tmp = dx * dx + dy * dy;\n                    if ((this.intersects(this.focusIcons[i], mouse, source, existingEdge) ||\n                        (point &&\n                            this.intersects(this.focusIcons[i], grid, source, existingEdge))) &&\n                        (minDistSq === null || tmp < minDistSq)) {\n                        this.currentConstraint = this.constraints[i];\n                        this.currentPoint = this.focusPoints[i];\n                        minDistSq = tmp;\n                        tmp = this.focusIcons[i].bounds.clone();\n                        tmp.grow(HIGHLIGHT_SIZE + 1);\n                        tmp.width -= 1;\n                        tmp.height -= 1;\n                        if (!this.focusHighlight) {\n                            const hl = this.createHighlightShape();\n                            hl.dialect = 'svg';\n                            hl.pointerEvents = false;\n                            hl.init(this.graph.getView().getOverlayPane());\n                            this.focusHighlight = hl;\n                            const getState = () => {\n                                return this.currentFocus ? this.currentFocus : state;\n                            };\n                            InternalEvent.redirectMouseEvents(hl.node, this.graph, getState);\n                        }\n                        this.focusHighlight.bounds = tmp;\n                        this.focusHighlight.redraw();\n                    }\n                }\n            }\n            if (!this.currentConstraint) {\n                this.destroyFocusHighlight();\n            }\n        }\n        else {\n            this.currentConstraint = null;\n            this.currentFocus = null;\n            this.currentPoint = null;\n        }\n    }\n    /**\n     * Transfers the focus to the given state as a source or target terminal. If\n     * the handler is not enabled then the outline is painted, but the constraints\n     * are ignored.\n     */\n    redraw() {\n        if (this.currentFocus && this.constraints && this.focusIcons.length > 0) {\n            const state = this.graph.view.getState(this.currentFocus.cell);\n            this.currentFocus = state;\n            this.currentFocusArea = new Rectangle(state.x, state.y, state.width, state.height);\n            for (let i = 0; i < this.constraints.length; i += 1) {\n                const cp = this.graph.getConnectionPoint(state, this.constraints[i]);\n                const img = this.getImageForConstraint(state, this.constraints[i], cp);\n                const bounds = new Rectangle(Math.round(cp.x - img.width / 2), Math.round(cp.y - img.height / 2), img.width, img.height);\n                this.focusIcons[i].bounds = bounds;\n                this.focusIcons[i].redraw();\n                this.currentFocusArea.add(this.focusIcons[i].bounds);\n                this.focusPoints[i] = cp;\n            }\n        }\n    }\n    /**\n     * Transfers the focus to the given state as a source or target terminal. If\n     * the handler is not enabled then the outline is painted, but the constraints\n     * are ignored.\n     */\n    setFocus(me, state, source) {\n        this.constraints =\n            state && !this.isStateIgnored(state, source) && state.cell.isConnectable()\n                ? this.isEnabled()\n                    ? (this.graph.getAllConnectionConstraints(state, source) ?? [])\n                    : []\n                : null;\n        // Only uses cells which have constraints\n        if (this.constraints && state) {\n            this.currentFocus = state;\n            this.currentFocusArea = new Rectangle(state.x, state.y, state.width, state.height);\n            for (let i = 0; i < this.focusIcons.length; i += 1) {\n                this.focusIcons[i].destroy();\n            }\n            this.focusIcons = [];\n            this.focusPoints = [];\n            for (let i = 0; i < this.constraints.length; i += 1) {\n                const cp = this.graph.getConnectionPoint(state, this.constraints[i]);\n                const img = this.getImageForConstraint(state, this.constraints[i], cp);\n                const { src } = img;\n                const bounds = new Rectangle(Math.round(cp.x - img.width / 2), Math.round(cp.y - img.height / 2), img.width, img.height);\n                const icon = new ImageShape(bounds, src);\n                icon.dialect = this.graph.dialect !== 'svg' ? 'mixedHtml' : 'svg';\n                icon.preserveImageAspect = false;\n                icon.init(this.graph.getView().getDecoratorPane());\n                // Move the icon behind all other overlays\n                if (icon.node.previousSibling) {\n                    icon.node.parentNode?.insertBefore(icon.node, icon.node.parentNode.firstChild);\n                }\n                const getState = () => {\n                    return this.currentFocus ? this.currentFocus : state;\n                };\n                icon.redraw();\n                InternalEvent.redirectMouseEvents(icon.node, this.graph, getState);\n                this.currentFocusArea.add(icon.bounds);\n                this.focusIcons.push(icon);\n                this.focusPoints.push(cp);\n            }\n            this.currentFocusArea.grow(this.getTolerance(me));\n        }\n        else {\n            this.destroyIcons();\n            this.destroyFocusHighlight();\n        }\n    }\n    /**\n     * Create the shape used to paint the highlight.\n     *\n     * Returns true if the given icon intersects the given point.\n     */\n    createHighlightShape() {\n        const hl = new RectangleShape(new Rectangle(), this.highlightColor, this.highlightColor, HIGHLIGHT_STROKEWIDTH);\n        hl.opacity = HIGHLIGHT_OPACITY;\n        return hl;\n    }\n    /**\n     * Returns `true` if the given icon intersects the given rectangle.\n     */\n    intersects(icon, rectangle, source, existingEdge) {\n        return intersects(icon.bounds, rectangle);\n    }\n    /**\n     * Destroy this handler.\n     */\n    onDestroy() {\n        this.reset();\n        this.graph.model.removeListener(this.resetHandler);\n        this.graph.view.removeListener(this.resetHandler);\n        this.graph.removeListener(this.resetHandler);\n        if (this.mouseleaveHandler && this.graph.container) {\n            InternalEvent.removeListener(this.graph.container, 'mouseleave', this.mouseleaveHandler);\n            this.mouseleaveHandler = null;\n        }\n    }\n}\nexport default ConstraintHandler;\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { CONNECT_HANDLE_FILLCOLOR, EDGE_SELECTION_COLOR, EDGE_SELECTION_DASHED, EDGE_SELECTION_STROKEWIDTH, HANDLE_FILLCOLOR, HANDLE_SIZE, HANDLE_STROKECOLOR, LABEL_HANDLE_FILLCOLOR, LABEL_HANDLE_SIZE, VERTEX_SELECTION_COLOR, VERTEX_SELECTION_DASHED, VERTEX_SELECTION_STROKEWIDTH, } from '../../util/Constants.js';\nimport { shallowCopy } from '../../internal/clone-utils.js';\n/**\n * Global configuration for {@link EdgeHandler} (including subclasses).\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const EdgeHandlerConfig = {\n    addBendOnShiftClickEnabled: false,\n    connectFillColor: CONNECT_HANDLE_FILLCOLOR,\n    cursorBend: 'crosshair',\n    cursorMovable: 'move',\n    cursorTerminal: 'pointer',\n    cursorVirtualBend: 'crosshair',\n    handleShape: 'square',\n    removeBendOnShiftClickEnabled: false,\n    selectionColor: EDGE_SELECTION_COLOR,\n    selectionDashed: EDGE_SELECTION_DASHED,\n    selectionStrokeWidth: EDGE_SELECTION_STROKEWIDTH,\n    virtualBendOpacity: 20,\n    virtualBendsEnabled: false,\n};\nconst defaultEdgeHandlerConfig = { ...EdgeHandlerConfig };\n/**\n * Resets {@link EdgeHandlerConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const resetEdgeHandlerConfig = () => {\n    shallowCopy(defaultEdgeHandlerConfig, EdgeHandlerConfig);\n};\n/**\n * Global configuration for handles, used {@link VertexHandler} and {@link EdgeHandler} (including subclasses).\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const HandleConfig = {\n    /**\n     * Defines the default color to be used for the handle fill color. Use `none` for no color.\n     * @default {@link HANDLE_FILLCOLOR}\n     */\n    fillColor: HANDLE_FILLCOLOR,\n    /**\n     * Defines the cursor to be used for the label handle.\n     * @default 'default'\n     * @since 0.20.0\n     */\n    labelCursor: 'default',\n    /**\n     * Defines the color to be used for the label handle fill color. Use `none` for no color.\n     * @default {@link LABEL_HANDLE_FILLCOLOR}\n     */\n    labelFillColor: LABEL_HANDLE_FILLCOLOR,\n    /**\n     * Defines the default size for label handles.\n     * @default {@link LABEL_HANDLE_SIZE}\n     */\n    labelSize: LABEL_HANDLE_SIZE,\n    /**\n     * Defines the default size for handles.\n     * @default {@link HANDLE_SIZE}\n     */\n    size: HANDLE_SIZE,\n    /**\n     * Defines the default color to be used for the handle stroke color. Use `none` for no color.\n     * @default {@link HANDLE_STROKECOLOR}\n     */\n    strokeColor: HANDLE_STROKECOLOR,\n};\nconst defaultHandleConfig = { ...HandleConfig };\n/**\n * Resets {@link HandleConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const resetHandleConfig = () => {\n    shallowCopy(defaultHandleConfig, HandleConfig);\n};\n/**\n * Global configuration for {@link VertexHandler}.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.12.0\n * @category Configuration\n */\nexport const VertexHandlerConfig = {\n    /**\n     * Defines the cursor for a movable vertex.\n     * @since 0.20.0\n     */\n    cursorMovable: 'move',\n    /**\n     * Enable rotation handle\n     * @default false\n     */\n    rotationEnabled: false,\n    /**\n     * Defines the default color to be used for the selection border of vertices. Use `none` for no color.\n     * @default {@link VERTEX_SELECTION_COLOR}\n     * @since 0.14.0\n     */\n    selectionColor: VERTEX_SELECTION_COLOR,\n    /**\n     * Defines the default stroke width to be used for vertex selections.\n     * @default {@link VERTEX_SELECTION_STROKEWIDTH}\n     * @since 0.14.0\n     */\n    selectionStrokeWidth: VERTEX_SELECTION_STROKEWIDTH,\n    /**\n     * Defines the default dashed state to be used for the vertex selection border.\n     * @default {@link VERTEX_SELECTION_DASHED}\n     * @since 0.14.0\n     */\n    selectionDashed: VERTEX_SELECTION_DASHED,\n};\nconst defaultVertexHandlerConfig = { ...VertexHandlerConfig };\n/**\n * Resets {@link VertexHandlerConfig} to default values.\n *\n * @experimental Subject to change or removal. maxGraph's global configuration may be modified in the future without prior notice.\n * @since 0.14.0\n * @category Configuration\n */\nexport const resetVertexHandlerConfig = () => {\n    shallowCopy(defaultVertexHandlerConfig, VertexHandlerConfig);\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellMarker from '../cell/CellMarker.js';\nimport Point from '../geometry/Point.js';\nimport { DEFAULT_HOTSPOT, DEFAULT_INVALID_COLOR, DEFAULT_VALID_COLOR, HIGHLIGHT_STROKEWIDTH, LOCKED_HANDLE_FILLCOLOR, NONE, OUTLINE_HIGHLIGHT_COLOR, OUTLINE_HIGHLIGHT_STROKEWIDTH, } from '../../util/Constants.js';\nimport { contains, findNearestSegment, intersects, ptSegDistSq, } from '../../util/mathUtils.js';\nimport { convertPoint, getOffset, setOpacity } from '../../util/styleUtils.js';\nimport EllipseShape from '../shape/node/EllipseShape.js';\nimport ImageShape from '../shape/node/ImageShape.js';\nimport RectangleShape from '../shape/node/RectangleShape.js';\nimport ConnectionConstraint from '../other/ConnectionConstraint.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport ConstraintHandler from './ConstraintHandler.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport Client from '../../Client.js';\nimport { EdgeStyle } from '../style/builtin-style-elements.js';\nimport { getClientX, getClientY, isAltDown, isMouseEvent, isShiftDown, } from '../../util/EventUtils.js';\nimport { equalPoints } from '../../util/arrayUtils.js';\nimport { EdgeHandlerConfig, HandleConfig } from './config.js';\n/**\n * Graph event handler that reconnects edges, modifies control points and the edge label location.\n *\n * Uses {@link CellMarker} for finding and highlighting new source and target vertices.\n *\n * This handler is automatically created in {@link AbstractGraph.createHandler} for each selected edge.\n *\n * Some elements of this handler and its subclasses can be configured using {@link EdgeHandlerConfig}.\n */\nclass EdgeHandler {\n    constructor(state) {\n        /**\n         * Holds the current validation error while a connection is being changed.\n         */\n        this.error = null;\n        /**\n         * Holds the {@link Shape}s that represent the points.\n         */\n        this.bends = [];\n        /**\n         * Specifies if cloning by control-drag is enabled.\n         * @default true\n         */\n        this.cloneEnabled = true;\n        /**\n         * Specifies if removing bends by double click is enabled.\n         * @default false\n         */\n        this.dblClickRemoveEnabled = false;\n        /**\n         * Specifies if removing bends by dropping them on other bends is enabled.\n         * @default false\n         */\n        this.mergeRemoveEnabled = false;\n        /**\n         * Specifies if removing bends by creating straight segments should be enabled.\n         * If enabled, this can be overridden by holding down the alt key while moving.\n         * @default false\n         */\n        this.straightRemoveEnabled = false;\n        /**\n         * Specifies if the parent should be highlighted if a child cell is selected.\n         * @default false\n         */\n        this.parentHighlightEnabled = false;\n        /**\n         * Specifies if bends should be added to the graph container.\n         * This is updated in {@link constructor} based on whether the edge or one of its terminals has an HTML label in the container.\n         */\n        this.preferHtml = false;\n        /**\n         * Specifies if the bounds of handles should be used for hit-detection in IE.\n         * @default true\n         */\n        this.allowHandleBoundsCheck = true;\n        /**\n         * Specifies if waypoints should snap to the routing centers of terminals.\n         * @default false\n         */\n        this.snapToTerminals = false;\n        /**\n         * Optional {@link Image} to be used as handles.\n         * @default null\n         */\n        this.handleImage = null;\n        this.labelHandleImage = null;\n        /**\n         * Optional tolerance for hit-detection in {@link getHandleForEvent}.\n         * @default 0\n         */\n        this.tolerance = 0;\n        /**\n         * Specifies if connections to the outline of a highlighted target should be\n         * enabled. This will allow to place the connection point along the outline of\n         * the highlighted target.\n         * @default false\n         */\n        this.outlineConnect = false;\n        /**\n         * Specifies if the label handle should be moved if it intersects with another\n         * handle. Uses {@link checkLabelHandle} for checking and moving.\n         * @default false\n         */\n        this.manageLabelHandle = false;\n        this.currentPoint = null;\n        this.parentHighlight = null;\n        this.index = null;\n        this.isSource = false;\n        this.isTarget = false;\n        this.isLabel = false;\n        this.points = [];\n        this.snapPoint = null;\n        this.abspoints = [];\n        this.startX = 0;\n        this.startY = 0;\n        this.outline = true;\n        this.active = true;\n        // `state.shape` must exists.\n        this.state = state;\n        this.graph = this.state.view.graph;\n        this.marker = this.createMarker();\n        this.constraintHandler = this.createConstraintHandler();\n        // Clones the original points from the cell\n        // and makes sure at least one point exists\n        this.points = [];\n        // Uses the absolute points of the state\n        // for the initial configuration and preview\n        this.abspoints = this.getSelectionPoints(this.state);\n        this.shape = this.createSelectionShape(this.abspoints);\n        this.shape.dialect = this.graph.dialect !== 'svg' ? 'mixedHtml' : 'svg';\n        this.shape.init(this.graph.getView().getOverlayPane());\n        this.shape.pointerEvents = false;\n        this.shape.setCursor(EdgeHandlerConfig.cursorMovable);\n        InternalEvent.redirectMouseEvents(this.shape.node, this.graph, this.state);\n        // Updates preferHtml\n        this.preferHtml =\n            this.state.text != null && this.state.text.node.parentNode === this.graph.container;\n        if (!this.preferHtml) {\n            // Checks source terminal\n            const sourceState = this.state.getVisibleTerminalState(true);\n            if (sourceState != null) {\n                this.preferHtml =\n                    sourceState.text != null &&\n                        sourceState.text.node.parentNode === this.graph.container;\n            }\n            if (!this.preferHtml) {\n                // Checks target terminal\n                const targetState = this.state.getVisibleTerminalState(false);\n                if (targetState != null) {\n                    this.preferHtml =\n                        targetState.text != null &&\n                            targetState.text.node.parentNode === this.graph.container;\n                }\n            }\n        }\n        const selectionHandler = this.graph.getPlugin('SelectionHandler');\n        // Creates bends for the non-routed absolute points\n        // or bends that don't correspond to points\n        if (selectionHandler &&\n            (this.graph.getSelectionCount() < selectionHandler.maxCells ||\n                selectionHandler.maxCells <= 0)) {\n            this.bends = this.createBends();\n            if (this.isVirtualBendsEnabled()) {\n                this.virtualBends = this.createVirtualBends();\n            }\n        }\n        // Adds a rectangular handle for the label position\n        this.label = new Point(this.state.absoluteOffset.x, this.state.absoluteOffset.y);\n        this.labelShape = this.createLabelHandleShape();\n        this.initBend(this.labelShape);\n        this.labelShape.setCursor(HandleConfig.labelCursor);\n        this.customHandles = this.createCustomHandles();\n        this.updateParentHighlight();\n        this.redraw();\n        // Handles escape keystrokes\n        this.escapeHandler = (_sender, _evt) => {\n            const dirty = this.index != null;\n            this.reset();\n            if (dirty) {\n                this.graph.cellRenderer.redraw(this.state, false, state.view.isRendering());\n            }\n        };\n        this.state.view.graph.addListener(InternalEvent.ESCAPE, this.escapeHandler);\n    }\n    /**\n     * Hook for subclasses to change the implementation of {@link ConstraintHandler} used here.\n     * @since 0.21.0\n     */\n    createConstraintHandler() {\n        return new ConstraintHandler(this.graph);\n    }\n    /**\n     * Returns true if the parent highlight should be visible. This implementation\n     * always returns true.\n     */\n    isParentHighlightVisible() {\n        const parent = this.state.cell.getParent();\n        return parent ? !this.graph.isCellSelected(parent) : null;\n    }\n    /**\n     * Updates the highlight of the parent if {@link parentHighlightEnabled} is true.\n     */\n    updateParentHighlight() {\n        if (!this.isDestroyed()) {\n            const visible = this.isParentHighlightVisible();\n            const parent = this.state.cell.getParent();\n            const pstate = parent ? this.graph.view.getState(parent) : null;\n            if (this.parentHighlight) {\n                if (parent && parent.isVertex() && visible) {\n                    const b = this.parentHighlight.bounds;\n                    if (pstate &&\n                        b &&\n                        (b.x !== pstate.x ||\n                            b.y !== pstate.y ||\n                            b.width !== pstate.width ||\n                            b.height !== pstate.height)) {\n                        this.parentHighlight.bounds = Rectangle.fromRectangle(pstate);\n                        this.parentHighlight.redraw();\n                    }\n                }\n                else {\n                    if (pstate && pstate.parentHighlight === this.parentHighlight) {\n                        pstate.parentHighlight = null;\n                    }\n                    this.parentHighlight.destroy();\n                    this.parentHighlight = null;\n                }\n            }\n            else if (this.parentHighlightEnabled && visible) {\n                if (parent && parent.isVertex() && pstate && !pstate.parentHighlight) {\n                    this.parentHighlight = this.createParentHighlightShape(pstate);\n                    // VML dialect required here for event transparency in IE\n                    this.parentHighlight.dialect = 'svg';\n                    this.parentHighlight.pointerEvents = false;\n                    if (pstate.style.rotation) {\n                        this.parentHighlight.rotation = pstate.style.rotation;\n                    }\n                    this.parentHighlight.init(this.graph.getView().getOverlayPane());\n                    this.parentHighlight.redraw();\n                    // Shows highlight once per parent\n                    pstate.parentHighlight = this.parentHighlight;\n                }\n            }\n        }\n    }\n    /**\n     * Returns an array of custom handles. This implementation returns an empty array.\n     */\n    createCustomHandles() {\n        return [];\n    }\n    /**\n     * Returns true if virtual bends should be added. This returns true if\n     * {@link virtualBendsEnabled} is true and the current style allows and\n     * renders custom waypoints.\n     */\n    isVirtualBendsEnabled(evt) {\n        return (EdgeHandlerConfig.virtualBendsEnabled &&\n            (this.state.style.edgeStyle == null ||\n                this.state.style.edgeStyle === NONE ||\n                this.state.style.noEdgeStyle) &&\n            this.state.style.shape !== 'arrow');\n    }\n    /**\n     * Returns true if the given cell allows new connections to be created. This implementation\n     * always returns true.\n     */\n    isCellEnabled(cell) {\n        return true;\n    }\n    /**\n     * Returns true if the given event is a trigger to add a new Point. This\n     * implementation returns true if shift is pressed.\n     */\n    isAddPointEvent(evt) {\n        return isShiftDown(evt);\n    }\n    /**\n     * Returns true if the given event is a trigger to remove a point. This\n     * implementation returns true if shift is pressed.\n     */\n    isRemovePointEvent(evt) {\n        return isShiftDown(evt);\n    }\n    /**\n     * Returns the list of points that defines the selection stroke.\n     */\n    getSelectionPoints(state) {\n        return state.absolutePoints;\n    }\n    /**\n     * Creates the shape used to draw the selection border.\n     */\n    createParentHighlightShape(bounds) {\n        const shape = new RectangleShape(Rectangle.fromRectangle(bounds), NONE, this.getSelectionColor());\n        shape.strokeWidth = this.getSelectionStrokeWidth();\n        shape.isDashed = this.isSelectionDashed();\n        return shape;\n    }\n    /**\n     * Creates the shape used to draw the selection border.\n     */\n    createSelectionShape(points) {\n        const c = this.state.shape.constructor;\n        const shape = new c();\n        shape.outline = true;\n        shape.apply(this.state);\n        shape.isDashed = this.isSelectionDashed();\n        shape.stroke = this.getSelectionColor();\n        shape.isShadow = false;\n        return shape;\n    }\n    /**\n     * Returns {@link EdgeHandlerConfig.selectionColor}.\n     */\n    getSelectionColor() {\n        return EdgeHandlerConfig.selectionColor;\n    }\n    /**\n     * Returns {@link EdgeHandlerConfig.selectionStrokeWidth}.\n     */\n    getSelectionStrokeWidth() {\n        return EdgeHandlerConfig.selectionStrokeWidth;\n    }\n    /**\n     * Returns {@link EdgeHandlerConfig.selectionDashed}.\n     */\n    isSelectionDashed() {\n        return EdgeHandlerConfig.selectionDashed;\n    }\n    /**\n     * Returns true if the given cell is connectable. This is a hook to\n     * disable floating connections. This implementation returns true.\n     */\n    isConnectableCell(cell) {\n        return true;\n    }\n    /**\n     * Creates and returns the {@link CellMarker} used in {@link marker}.\n     */\n    getCellAt(x, y) {\n        return !this.outlineConnect ? this.graph.getCellAt(x, y) : null;\n    }\n    /**\n     * Creates and returns the {@link CellMarker} used in {@link marker}.\n     */\n    createMarker() {\n        return new EdgeHandlerCellMarker(this.graph, this);\n    }\n    /**\n     * Returns the error message or an empty string if the connection for the\n     * given source, target pair is not valid. Otherwise, it returns null. This\n     * implementation uses {@link AbstractGraph.getEdgeValidationError}.\n     *\n     * @param source {@link Cell} that represents the source terminal.\n     * @param target {@link Cell} that represents the target terminal.\n     */\n    validateConnection(source, target) {\n        return this.graph.getEdgeValidationError(this.state.cell, source, target);\n    }\n    /**\n     * Creates and returns the bends used for modifying the edge. This is\n     * typically an array of {@link RectangleShape}.\n     */\n    createBends() {\n        const { cell } = this.state;\n        const bends = [];\n        for (let i = 0; i < this.abspoints.length; i += 1) {\n            if (this.isHandleVisible(i)) {\n                const source = i === 0;\n                const target = i === this.abspoints.length - 1;\n                const terminal = source || target;\n                if (terminal || this.graph.isCellBendable(cell)) {\n                    ((index) => {\n                        const bend = this.createHandleShape(index);\n                        this.initBend(bend, () => {\n                            if (this.dblClickRemoveEnabled) {\n                                this.removePoint(this.state, index);\n                            }\n                        });\n                        if (this.isHandleEnabled(i)) {\n                            bend.setCursor(terminal ? EdgeHandlerConfig.cursorTerminal : EdgeHandlerConfig.cursorBend);\n                        }\n                        bends.push(bend);\n                        if (!terminal) {\n                            this.points.push(new Point(0, 0));\n                            bend.node.style.visibility = 'hidden';\n                        }\n                    })(i);\n                }\n            }\n        }\n        return bends;\n    }\n    /**\n     * Creates and returns the bends used for modifying the edge. This is\n     * typically an array of {@link RectangleShape}.\n     */\n    createVirtualBends() {\n        const { cell } = this.state;\n        const last = this.abspoints[0];\n        const bends = [];\n        if (this.graph.isCellBendable(cell)) {\n            for (let i = 1; i < this.abspoints.length; i += 1) {\n                ((bend) => {\n                    this.initBend(bend);\n                    bend.setCursor(EdgeHandlerConfig.cursorVirtualBend);\n                    bends.push(bend);\n                })(this.createHandleShape());\n            }\n        }\n        return bends;\n    }\n    /**\n     * Creates the shape used to display the given bend.\n     */\n    isHandleEnabled(index) {\n        return true;\n    }\n    /**\n     * Returns true if the handle at the given index is visible.\n     */\n    isHandleVisible(index) {\n        const source = this.state.getVisibleTerminalState(true);\n        const target = this.state.getVisibleTerminalState(false);\n        const geo = this.state.cell.getGeometry();\n        const edgeStyle = geo\n            ? this.graph.view.getEdgeStyle(this.state, geo.points || undefined, source, target)\n            : null;\n        return (edgeStyle !== EdgeStyle.EntityRelation ||\n            index === 0 ||\n            index === this.abspoints.length - 1);\n    }\n    /**\n     * Creates the shape used to display the given bend.\n     * Note that the index\n     * - may be `null` for special cases, such as when called from {@link ElbowEdgeHandler.createVirtualBend}.\n     * - is `null` for virtual handles.\n     *\n     * Only images and rectangles should be returned if support for HTML labels with not foreign objects is required.\n     */\n    createHandleShape(_index) {\n        if (this.handleImage) {\n            const shape = new ImageShape(new Rectangle(0, 0, this.handleImage.width, this.handleImage.height), this.handleImage.src);\n            // Allows HTML rendering of the images\n            shape.preserveImageAspect = false;\n            return shape;\n        }\n        let s = HandleConfig.size;\n        if (this.preferHtml) {\n            s -= 1;\n        }\n        const shapeConstructor = EdgeHandlerConfig.handleShape === 'circle' ? EllipseShape : RectangleShape;\n        return new shapeConstructor(new Rectangle(0, 0, s, s), HandleConfig.fillColor, HandleConfig.strokeColor);\n    }\n    /**\n     * Creates the shape used to display the label handle.\n     */\n    createLabelHandleShape() {\n        if (this.labelHandleImage) {\n            const shape = new ImageShape(new Rectangle(0, 0, this.labelHandleImage.width, this.labelHandleImage.height), this.labelHandleImage.src);\n            // Allows HTML rendering of the images\n            shape.preserveImageAspect = false;\n            return shape;\n        }\n        const s = HandleConfig.labelSize;\n        return new RectangleShape(new Rectangle(0, 0, s, s), HandleConfig.labelFillColor, HandleConfig.strokeColor);\n    }\n    /**\n     * Helper method to initialize the given bend.\n     *\n     * @param bend {@link Shape} that represents the bend to be initialized.\n     * @param dblClick Optional function to be called on double click.\n     */\n    initBend(bend, dblClick) {\n        if (this.preferHtml) {\n            bend.dialect = 'strictHtml';\n            bend.init(this.graph.container);\n        }\n        else {\n            bend.dialect = this.graph.dialect !== 'svg' ? 'mixedHtml' : 'svg';\n            bend.init(this.graph.getView().getOverlayPane());\n        }\n        InternalEvent.redirectMouseEvents(bend.node, this.graph, this.state, null, null, null, dblClick);\n        if (Client.IS_TOUCH) {\n            bend.node.setAttribute('pointer-events', 'none');\n        }\n    }\n    /**\n     * Returns the index of the handle for the given event.\n     */\n    getHandleForEvent(me) {\n        let result = null;\n        // Connection highlight may consume events before they reach sizer handle\n        const tol = !isMouseEvent(me.getEvent()) ? this.tolerance : 1;\n        const hit = this.allowHandleBoundsCheck && tol > 0\n            ? new Rectangle(me.getGraphX() - tol, me.getGraphY() - tol, 2 * tol, 2 * tol)\n            : null;\n        let minDistSq = Number.POSITIVE_INFINITY;\n        function checkShape(shape) {\n            if (shape &&\n                shape.bounds &&\n                shape.node &&\n                shape.node.style.display !== 'none' &&\n                shape.node.style.visibility !== 'hidden' &&\n                (me.isSource(shape) || (hit && intersects(shape.bounds, hit)))) {\n                const dx = me.getGraphX() - shape.bounds.getCenterX();\n                const dy = me.getGraphY() - shape.bounds.getCenterY();\n                const tmp = dx * dx + dy * dy;\n                if (tmp <= minDistSq) {\n                    minDistSq = tmp;\n                    return true;\n                }\n            }\n            return false;\n        }\n        if (this.isCustomHandleEvent(me) && this.customHandles) {\n            // Inverse loop order to match display order\n            for (let i = this.customHandles.length - 1; i >= 0; i--) {\n                if (checkShape(this.customHandles[i].shape)) {\n                    // LATER: Return reference to active shape\n                    return InternalEvent.CUSTOM_HANDLE - i;\n                }\n            }\n        }\n        if (me.isSource(this.state.text) || checkShape(this.labelShape)) {\n            result = InternalEvent.LABEL_HANDLE;\n        }\n        for (let i = 0; i < this.bends.length; i += 1) {\n            if (checkShape(this.bends[i])) {\n                result = i;\n            }\n        }\n        if (this.virtualBends && this.isAddVirtualBendEvent(me)) {\n            for (let i = 0; i < this.virtualBends.length; i += 1) {\n                if (checkShape(this.virtualBends[i])) {\n                    result = InternalEvent.VIRTUAL_HANDLE - i;\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Returns true if the given event allows virtual bends to be added. This\n     * implementation returns true.\n     */\n    isAddVirtualBendEvent(me) {\n        return true;\n    }\n    /**\n     * Returns true if the given event allows custom handles to be changed. This\n     * implementation returns true.\n     */\n    isCustomHandleEvent(me) {\n        return true;\n    }\n    /**\n     * Handles the event by checking if a special element of the handler\n     * was clicked, in which case the index parameter is non-null. The\n     * indices may be one of {@link InternalEvent.LABEL_HANDLE} or the number of the respective\n     * control point. The source and target points are used for reconnecting\n     * the edge.\n     */\n    mouseDown(_sender, me) {\n        const handle = this.getHandleForEvent(me);\n        if (handle !== null && this.bends[handle]) {\n            const b = this.bends[handle].bounds;\n            if (b)\n                this.snapPoint = new Point(b.getCenterX(), b.getCenterY());\n        }\n        if (EdgeHandlerConfig.addBendOnShiftClickEnabled &&\n            handle === null &&\n            this.isAddPointEvent(me.getEvent())) {\n            this.addPoint(this.state, me.getEvent());\n            me.consume();\n        }\n        else if (handle !== null && !me.isConsumed() && this.graph.isEnabled()) {\n            const cell = me.getCell();\n            if (EdgeHandlerConfig.removeBendOnShiftClickEnabled &&\n                this.isRemovePointEvent(me.getEvent())) {\n                this.removePoint(this.state, handle);\n            }\n            else if (handle !== InternalEvent.LABEL_HANDLE ||\n                (cell && this.graph.isLabelMovable(cell))) {\n                if (this.virtualBends && handle <= InternalEvent.VIRTUAL_HANDLE) {\n                    setOpacity(this.virtualBends[InternalEvent.VIRTUAL_HANDLE - handle].node, 100);\n                }\n                this.start(me.getX(), me.getY(), handle);\n            }\n            me.consume();\n        }\n    }\n    /**\n     * Starts the handling of the mouse gesture.\n     */\n    start(x, y, index) {\n        this.startX = x;\n        this.startY = y;\n        this.isSource = this.bends.length === 0 ? false : index === 0;\n        this.isTarget = this.bends.length === 0 ? false : index === this.bends.length - 1;\n        this.isLabel = index === InternalEvent.LABEL_HANDLE;\n        if (this.isSource || this.isTarget) {\n            const { cell } = this.state;\n            const terminal = cell.getTerminal(this.isSource);\n            if ((terminal == null && this.graph.isTerminalPointMovable(cell, this.isSource)) ||\n                (terminal != null &&\n                    this.graph.isCellDisconnectable(cell, terminal, this.isSource))) {\n                this.index = index;\n            }\n        }\n        else {\n            this.index = index;\n        }\n        // Hides other custom handles\n        if (this.index !== null &&\n            this.index <= InternalEvent.CUSTOM_HANDLE &&\n            this.index > InternalEvent.VIRTUAL_HANDLE) {\n            if (this.customHandles != null) {\n                for (let i = 0; i < this.customHandles.length; i += 1) {\n                    if (i !== InternalEvent.CUSTOM_HANDLE - this.index) {\n                        this.customHandles[i].setVisible(false);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Returns a clone of the current preview state for the given point and terminal.\n     */\n    clonePreviewState(point, terminal) {\n        return this.state.clone();\n    }\n    /**\n     * Returns the tolerance for the guides. Default value is\n     * gridSize * scale / 2.\n     */\n    getSnapToTerminalTolerance() {\n        return (this.graph.getGridSize() * this.graph.getView().scale) / 2;\n    }\n    /**\n     * Hook for subclassers do show details while the handler is active.\n     */\n    updateHint(me, point) {\n        return;\n    }\n    /**\n     * Hooks for subclassers to hide details when the handler gets inactive.\n     */\n    removeHint() {\n        return;\n    }\n    /**\n     * Hook for rounding the unscaled width or height. This uses Math.round.\n     */\n    roundLength(length) {\n        return Math.round(length);\n    }\n    /**\n     * Returns true if {@link snapToTerminals} is true and if alt is not pressed.\n     */\n    isSnapToTerminalsEvent(me) {\n        return this.snapToTerminals && !isAltDown(me.getEvent());\n    }\n    /**\n     * Returns the point for the given event.\n     */\n    getPointForEvent(me) {\n        const view = this.graph.getView();\n        const { scale } = view;\n        const point = new Point(this.roundLength(me.getGraphX() / scale) * scale, this.roundLength(me.getGraphY() / scale) * scale);\n        const tt = this.getSnapToTerminalTolerance();\n        let overrideX = false;\n        let overrideY = false;\n        if (tt > 0 && this.isSnapToTerminalsEvent(me)) {\n            const snapToPoint = (pt) => {\n                if (pt) {\n                    const { x } = pt;\n                    if (Math.abs(point.x - x) < tt) {\n                        point.x = x;\n                        overrideX = true;\n                    }\n                    const { y } = pt;\n                    if (Math.abs(point.y - y) < tt) {\n                        point.y = y;\n                        overrideY = true;\n                    }\n                }\n            };\n            // Temporary function\n            const snapToTerminal = (terminal) => {\n                if (terminal) {\n                    snapToPoint(new Point(view.getRoutingCenterX(terminal), view.getRoutingCenterY(terminal)));\n                }\n            };\n            snapToTerminal(this.state.getVisibleTerminalState(true));\n            snapToTerminal(this.state.getVisibleTerminalState(false));\n            for (let i = 0; i < this.state.absolutePoints.length; i += 1) {\n                snapToPoint(this.state.absolutePoints[i]);\n            }\n        }\n        if (this.graph.isGridEnabledEvent(me.getEvent())) {\n            const tr = view.translate;\n            if (!overrideX) {\n                point.x = (this.graph.snap(point.x / scale - tr.x) + tr.x) * scale;\n            }\n            if (!overrideY) {\n                point.y = (this.graph.snap(point.y / scale - tr.y) + tr.y) * scale;\n            }\n        }\n        return point;\n    }\n    /**\n     * Updates the given preview state taking into account the state of the constraint handler.\n     */\n    getPreviewTerminalState(me) {\n        this.constraintHandler.update(me, this.isSource, true, me.isSource(this.marker.highlight.shape) ? null : this.currentPoint);\n        if (this.constraintHandler.currentFocus && this.constraintHandler.currentConstraint) {\n            // Handles special case where grid is large and connection point is at actual point in which\n            // case the outline is not followed as long as we're < gridSize / 2 away from that point\n            if (this.marker.highlight &&\n                this.marker.highlight.shape &&\n                this.marker.highlight.state &&\n                this.marker.highlight.state.cell === this.constraintHandler.currentFocus.cell) {\n                // Direct repaint needed if cell already highlighted\n                if (this.marker.highlight.shape.stroke !== 'transparent') {\n                    this.marker.highlight.shape.stroke = 'transparent';\n                    this.marker.highlight.repaint();\n                }\n            }\n            else {\n                this.marker.markCell(this.constraintHandler.currentFocus.cell, 'transparent');\n            }\n            const other = this.graph.view.getTerminalPort(this.state, this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)), !this.isSource);\n            const otherCell = other ? other.cell : null;\n            const source = this.isSource ? this.constraintHandler.currentFocus.cell : otherCell;\n            const target = this.isSource ? otherCell : this.constraintHandler.currentFocus.cell;\n            // Updates the error message of the handler\n            this.error = this.validateConnection(source, target);\n            let result = null;\n            if (this.error === null) {\n                result = this.constraintHandler.currentFocus;\n            }\n            if (this.error !== null || (result && !this.isCellEnabled(result.cell))) {\n                this.constraintHandler.reset();\n            }\n            return result;\n        }\n        if (!this.graph.isIgnoreTerminalEvent(me.getEvent())) {\n            this.marker.process(me);\n            const state = this.marker.getValidState();\n            if (state && !this.isCellEnabled(state.cell)) {\n                this.constraintHandler.reset();\n                this.marker.reset();\n            }\n            return this.marker.getValidState();\n        }\n        this.marker.reset();\n        return null;\n    }\n    /**\n     * Updates the given preview state taking into account the state of the constraint handler.\n     *\n     * @param pt {@link Point} that contains the current pointer position.\n     * @param me Optional {@link MouseEvent} that contains the current event.\n     */\n    getPreviewPoints(pt, me) {\n        const geometry = this.state.cell.getGeometry();\n        if (!geometry)\n            return null;\n        let points = (geometry.points || []).slice();\n        const point = new Point(pt.x, pt.y);\n        let result = null;\n        if (!this.isSource && !this.isTarget && this.index !== null) {\n            this.convertPoint(point, false);\n            // Adds point from virtual bend\n            if (this.index <= InternalEvent.VIRTUAL_HANDLE) {\n                points.splice(InternalEvent.VIRTUAL_HANDLE - this.index, 0, point);\n            }\n            // Removes point if dragged on terminal point\n            if (!this.isSource && !this.isTarget) {\n                for (let i = 0; i < this.bends.length; i += 1) {\n                    if (i !== this.index) {\n                        const bend = this.bends[i];\n                        if (bend && contains(bend.bounds, pt.x, pt.y)) {\n                            if (this.index <= InternalEvent.VIRTUAL_HANDLE) {\n                                points.splice(InternalEvent.VIRTUAL_HANDLE - this.index, 1);\n                            }\n                            else {\n                                points.splice(this.index - 1, 1);\n                            }\n                            result = points;\n                        }\n                    }\n                }\n                // Removes point if user tries to straighten a segment\n                if (!result && this.straightRemoveEnabled && (!me || !isAltDown(me.getEvent()))) {\n                    const tol = this.graph.getEventTolerance() * this.graph.getEventTolerance();\n                    const abs = this.state.absolutePoints.slice();\n                    abs[this.index] = pt;\n                    // Handes special case where removing waypoint affects tolerance (flickering)\n                    const src = this.state.getVisibleTerminalState(true);\n                    if (src != null) {\n                        const c = this.graph.getConnectionConstraint(this.state, src, true);\n                        // Checks if point is not fixed\n                        if (c == null || this.graph.getConnectionPoint(src, c) == null) {\n                            abs[0] = new Point(src.view.getRoutingCenterX(src), src.view.getRoutingCenterY(src));\n                        }\n                    }\n                    const trg = this.state.getVisibleTerminalState(false);\n                    if (trg != null) {\n                        const c = this.graph.getConnectionConstraint(this.state, trg, false);\n                        // Checks if point is not fixed\n                        if (c == null || this.graph.getConnectionPoint(trg, c) == null) {\n                            abs[abs.length - 1] = new Point(trg.view.getRoutingCenterX(trg), trg.view.getRoutingCenterY(trg));\n                        }\n                    }\n                    const checkRemove = (idx, tmp) => {\n                        if (idx > 0 &&\n                            idx < abs.length - 1 &&\n                            ptSegDistSq(abs[idx - 1].x, abs[idx - 1].y, abs[idx + 1].x, abs[idx + 1].y, tmp.x, tmp.y) < tol) {\n                            points.splice(idx - 1, 1);\n                            result = points;\n                        }\n                    };\n                    // LATER: Check if other points can be removed if a segment is made straight\n                    checkRemove(this.index, pt);\n                }\n            }\n            // Updates existing point\n            if (result == null && this.index > InternalEvent.VIRTUAL_HANDLE) {\n                points[this.index - 1] = point;\n            }\n        }\n        else if (this.graph.isResetEdgesOnConnect()) {\n            points = [];\n        }\n        return result != null ? result : points;\n    }\n    /**\n     * Returns true if {@link outlineConnect} is true and the source of the event is the outline shape\n     * or shift is pressed.\n     */\n    isOutlineConnectEvent(me) {\n        if (!this.currentPoint)\n            return false;\n        const offset = getOffset(this.graph.container);\n        const evt = me.getEvent();\n        const clientX = getClientX(evt);\n        const clientY = getClientY(evt);\n        const doc = document.documentElement;\n        const left = (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);\n        const top = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);\n        const gridX = this.currentPoint.x - this.graph.container.scrollLeft + offset.x - left;\n        const gridY = this.currentPoint.y - this.graph.container.scrollTop + offset.y - top;\n        return (this.outlineConnect &&\n            !isShiftDown(me.getEvent()) &&\n            (me.isSource(this.marker.highlight.shape) ||\n                (isAltDown(me.getEvent()) && me.getState() != null) ||\n                this.marker.highlight.isHighlightAt(clientX, clientY) ||\n                ((gridX !== clientX || gridY !== clientY) &&\n                    me.getState() == null &&\n                    this.marker.highlight.isHighlightAt(gridX, gridY))));\n    }\n    /**\n     * Updates the given preview state taking into account the state of the constraint handler.\n     */\n    updatePreviewState(edgeState, point, terminalState, me, outline = false) {\n        // Computes the points for the edge style and terminals\n        const sourceState = this.isSource\n            ? terminalState\n            : this.state.getVisibleTerminalState(true);\n        const targetState = this.isTarget\n            ? terminalState\n            : this.state.getVisibleTerminalState(false);\n        let sourceConstraint = this.graph.getConnectionConstraint(edgeState, sourceState, true);\n        let targetConstraint = this.graph.getConnectionConstraint(edgeState, targetState, false);\n        let constraint = this.constraintHandler.currentConstraint;\n        if (constraint == null && outline) {\n            if (terminalState != null) {\n                // Handles special case where mouse is on outline away from actual end point\n                // in which case the grid is ignored and mouse point is used instead\n                if (me.isSource(this.marker.highlight.shape)) {\n                    point = new Point(me.getGraphX(), me.getGraphY());\n                }\n                constraint = this.graph.getOutlineConstraint(point, terminalState, me);\n                this.constraintHandler.setFocus(me, terminalState, this.isSource);\n                this.constraintHandler.currentConstraint = constraint;\n                this.constraintHandler.currentPoint = point;\n            }\n            else {\n                constraint = new ConnectionConstraint(null);\n            }\n        }\n        if (this.outlineConnect &&\n            this.marker.highlight != null &&\n            this.marker.highlight.shape != null) {\n            const s = this.graph.view.scale;\n            if (this.constraintHandler.currentConstraint != null &&\n                this.constraintHandler.currentFocus != null) {\n                this.marker.highlight.shape.stroke = outline\n                    ? OUTLINE_HIGHLIGHT_COLOR\n                    : 'transparent';\n                this.marker.highlight.shape.strokeWidth = OUTLINE_HIGHLIGHT_STROKEWIDTH / s / s;\n                this.marker.highlight.repaint();\n            }\n            else if (this.marker.hasValidState()) {\n                const cell = me.getCell();\n                this.marker.highlight.shape.stroke =\n                    cell && cell.isConnectable() && this.marker.getValidState() !== me.getState()\n                        ? 'transparent'\n                        : DEFAULT_VALID_COLOR;\n                this.marker.highlight.shape.strokeWidth = HIGHLIGHT_STROKEWIDTH / s / s;\n                this.marker.highlight.repaint();\n            }\n        }\n        if (this.isSource) {\n            sourceConstraint = constraint;\n        }\n        else if (this.isTarget) {\n            targetConstraint = constraint;\n        }\n        if (this.isSource || this.isTarget) {\n            if (constraint != null && constraint.point != null) {\n                edgeState.style[this.isSource ? 'exitX' : 'entryX'] = constraint.point.x;\n                edgeState.style[this.isSource ? 'exitY' : 'entryY'] = constraint.point.y;\n            }\n            else {\n                delete edgeState.style[this.isSource ? 'exitX' : 'entryX'];\n                delete edgeState.style[this.isSource ? 'exitY' : 'entryY'];\n            }\n        }\n        edgeState.setVisibleTerminalState(sourceState, true);\n        edgeState.setVisibleTerminalState(targetState, false);\n        if (!this.isSource || sourceState != null) {\n            edgeState.view.updateFixedTerminalPoint(edgeState, sourceState, true, sourceConstraint);\n        }\n        if (!this.isTarget || targetState != null) {\n            edgeState.view.updateFixedTerminalPoint(edgeState, targetState, false, targetConstraint);\n        }\n        if ((this.isSource || this.isTarget) && terminalState == null) {\n            edgeState.setAbsoluteTerminalPoint(point, this.isSource);\n            if (this.marker.getMarkedState() == null) {\n                this.error = this.graph.isAllowDanglingEdges() ? null : '';\n            }\n        }\n        edgeState.view.updatePoints(edgeState, this.points, sourceState, targetState);\n        edgeState.view.updateFloatingTerminalPoints(edgeState, sourceState, targetState);\n    }\n    /**\n     * Handles the event by updating the preview.\n     */\n    mouseMove(_sender, me) {\n        if (this.index != null && this.marker != null) {\n            this.currentPoint = this.getPointForEvent(me);\n            this.error = null;\n            // Uses the current point from the constraint handler if available\n            if (!this.graph.isIgnoreTerminalEvent(me.getEvent()) &&\n                isShiftDown(me.getEvent()) &&\n                this.snapPoint != null) {\n                if (Math.abs(this.snapPoint.x - this.currentPoint.x) <\n                    Math.abs(this.snapPoint.y - this.currentPoint.y)) {\n                    this.currentPoint.x = this.snapPoint.x;\n                }\n                else {\n                    this.currentPoint.y = this.snapPoint.y;\n                }\n            }\n            if (this.index <= InternalEvent.CUSTOM_HANDLE &&\n                this.index > InternalEvent.VIRTUAL_HANDLE) {\n                if (this.customHandles != null) {\n                    this.customHandles[InternalEvent.CUSTOM_HANDLE - this.index].processEvent(me);\n                    this.customHandles[InternalEvent.CUSTOM_HANDLE - this.index].positionChanged();\n                    if (this.shape != null && this.shape.node != null) {\n                        this.shape.node.style.display = 'none';\n                    }\n                }\n            }\n            else if (this.isLabel && this.label) {\n                this.label.x = this.currentPoint.x;\n                this.label.y = this.currentPoint.y;\n            }\n            else {\n                this.points = this.getPreviewPoints(this.currentPoint, me);\n                let terminalState = this.isSource || this.isTarget ? this.getPreviewTerminalState(me) : null;\n                if (this.constraintHandler.currentConstraint != null &&\n                    this.constraintHandler.currentFocus != null &&\n                    this.constraintHandler.currentPoint != null) {\n                    this.currentPoint = this.constraintHandler.currentPoint.clone();\n                }\n                else if (this.outlineConnect) {\n                    // Need to check outline before cloning terminal state\n                    const outline = this.isSource || this.isTarget ? this.isOutlineConnectEvent(me) : false;\n                    if (outline) {\n                        terminalState = this.marker.highlight.state;\n                    }\n                    else if (terminalState != null &&\n                        terminalState !== me.getState() &&\n                        me.getCell()?.isConnectable() &&\n                        this.marker.highlight.shape != null) {\n                        this.marker.highlight.shape.stroke = 'transparent';\n                        this.marker.highlight.repaint();\n                        terminalState = null;\n                    }\n                }\n                if (terminalState != null && !this.isCellEnabled(terminalState.cell)) {\n                    terminalState = null;\n                    this.marker.reset();\n                }\n                if (this.currentPoint) {\n                    const clone = this.clonePreviewState(this.currentPoint, terminalState != null ? terminalState.cell : null);\n                    this.updatePreviewState(clone, this.currentPoint, terminalState, me, this.outline);\n                    // Sets the color of the preview to valid or invalid, updates the\n                    // points of the preview and redraws\n                    const color = this.error == null ? this.marker.validColor : this.marker.invalidColor;\n                    this.setPreviewColor(color);\n                    this.abspoints = clone.absolutePoints;\n                    this.active = true;\n                    this.updateHint(me, this.currentPoint);\n                }\n            }\n            // This should go before calling isOutlineConnectEvent above. As a workaround\n            // we add an offset of gridSize to the hint to avoid problem with hit detection\n            // in highlight.isHighlightAt (which uses comonentFromPoint)\n            this.drawPreview();\n            InternalEvent.consume(me.getEvent());\n            me.consume();\n        }\n    }\n    /**\n     * Handles the event to applying the previewed changes on the edge by\n     * using {@link moveLabel}, {@link connect} or {@link changePoints}.\n     */\n    mouseUp(_sender, me) {\n        // Workaround for wrong event source in Webkit\n        if (this.index != null && this.marker != null) {\n            if (this.shape != null && this.shape.node != null) {\n                this.shape.node.style.display = '';\n            }\n            let edge = this.state.cell;\n            const { index } = this;\n            this.index = null;\n            // Ignores event if mouse has not been moved\n            if (me.getX() !== this.startX || me.getY() !== this.startY) {\n                const clone = !this.graph.isIgnoreTerminalEvent(me.getEvent()) &&\n                    this.graph.isCloneEvent(me.getEvent()) &&\n                    this.cloneEnabled &&\n                    this.graph.isCellsCloneable();\n                // Displays the reason for not carriying out the change\n                // if there is an error message with non-zero length\n                if (this.error != null) {\n                    if (this.error.length > 0) {\n                        this.graph.validationAlert(this.error);\n                    }\n                }\n                else if (index <= InternalEvent.CUSTOM_HANDLE &&\n                    index > InternalEvent.VIRTUAL_HANDLE) {\n                    if (this.customHandles != null) {\n                        const model = this.graph.getDataModel();\n                        model.beginUpdate();\n                        try {\n                            this.customHandles[InternalEvent.CUSTOM_HANDLE - index].execute(me);\n                            if (this.shape != null && this.shape.node != null) {\n                                this.shape.apply(this.state);\n                                this.shape.redraw();\n                            }\n                        }\n                        finally {\n                            model.endUpdate();\n                        }\n                    }\n                }\n                else if (this.isLabel && this.label) {\n                    this.moveLabel(this.state, this.label.x, this.label.y);\n                }\n                else if (this.isSource || this.isTarget) {\n                    let terminal = null;\n                    if (this.constraintHandler.currentConstraint != null &&\n                        this.constraintHandler.currentFocus != null) {\n                        terminal = this.constraintHandler.currentFocus.cell;\n                    }\n                    if (!terminal &&\n                        this.marker.hasValidState() &&\n                        this.marker.highlight != null &&\n                        this.marker.highlight.shape != null &&\n                        this.marker.highlight.shape.stroke !== 'transparent' &&\n                        this.marker.highlight.shape.stroke !== 'white') {\n                        terminal = this.marker.validState.cell;\n                    }\n                    if (terminal) {\n                        const model = this.graph.getDataModel();\n                        const parent = edge.getParent();\n                        model.beginUpdate();\n                        try {\n                            // Clones and adds the cell\n                            if (clone) {\n                                let geo = edge.getGeometry();\n                                const cloned = this.graph.cloneCell(edge);\n                                model.add(parent, cloned, parent.getChildCount());\n                                if (geo != null) {\n                                    geo = geo.clone();\n                                    model.setGeometry(cloned, geo);\n                                }\n                                const other = edge.getTerminal(!this.isSource);\n                                this.graph.connectCell(cloned, other, !this.isSource);\n                                edge = cloned;\n                            }\n                            edge = this.connect(edge, terminal, this.isSource, clone, me);\n                        }\n                        finally {\n                            model.endUpdate();\n                        }\n                    }\n                    else if (this.graph.isAllowDanglingEdges()) {\n                        const pt = this.abspoints[this.isSource ? 0 : this.abspoints.length - 1];\n                        pt.x = this.roundLength(pt.x / this.graph.view.scale - this.graph.view.translate.x);\n                        pt.y = this.roundLength(pt.y / this.graph.view.scale - this.graph.view.translate.y);\n                        const parent = edge.getParent();\n                        const pstate = parent ? this.graph.getView().getState(parent) : null;\n                        if (pstate != null) {\n                            pt.x -= pstate.origin.x;\n                            pt.y -= pstate.origin.y;\n                        }\n                        pt.x -= this.graph.getPanDx() / this.graph.view.scale;\n                        pt.y -= this.graph.getPanDy() / this.graph.view.scale;\n                        // Destroys and recreates this handler\n                        edge = this.changeTerminalPoint(edge, pt, this.isSource, clone);\n                    }\n                }\n                else if (this.active) {\n                    edge = this.changePoints(edge, this.points, clone);\n                }\n                else {\n                    this.graph.getView().invalidate(this.state.cell);\n                    this.graph.getView().validate(this.state.cell);\n                }\n            }\n            else if (this.graph.isToggleEvent(me.getEvent())) {\n                this.graph.selectCellForEvent(this.state.cell, me.getEvent());\n            }\n            // Resets the preview color the state of the handler if this\n            // handler has not been recreated\n            if (this.marker != null) {\n                this.reset();\n                // Updates the selection if the edge has been cloned\n                if (edge !== this.state.cell) {\n                    this.graph.setSelectionCell(edge);\n                }\n            }\n            me.consume();\n        }\n    }\n    /**\n     * Resets the state of this handler.\n     */\n    reset() {\n        if (this.active) {\n            this.refresh();\n        }\n        this.error = null;\n        this.index = null;\n        this.points = [];\n        this.snapPoint = null;\n        this.isLabel = false;\n        this.isSource = false;\n        this.isTarget = false;\n        this.active = false;\n        if (this.marker) {\n            this.marker.reset();\n        }\n        this.constraintHandler.reset();\n        if (this.customHandles) {\n            for (let i = 0; i < this.customHandles.length; i += 1) {\n                this.customHandles[i].reset();\n            }\n        }\n        this.setPreviewColor(EdgeHandlerConfig.selectionColor);\n        this.removeHint();\n        this.redraw();\n    }\n    /**\n     * Sets the color of the preview to the given value.\n     */\n    setPreviewColor(color) {\n        this.shape.stroke = color;\n    }\n    /**\n     * Converts the given point in-place from screen to unscaled, untranslated\n     * graph coordinates and applies the grid. Returns the given, modified\n     * point instance.\n     *\n     * @param point {@link Point} to be converted.\n     * @param gridEnabled Boolean that specifies if the grid should be applied.\n     */\n    convertPoint(point, gridEnabled) {\n        const scale = this.graph.getView().getScale();\n        const tr = this.graph.getView().getTranslate();\n        if (gridEnabled) {\n            point.x = this.graph.snap(point.x);\n            point.y = this.graph.snap(point.y);\n        }\n        point.x = Math.round(point.x / scale - tr.x);\n        point.y = Math.round(point.y / scale - tr.y);\n        const parent = this.state.cell.getParent();\n        const pstate = parent ? this.graph.getView().getState(parent) : parent;\n        if (pstate) {\n            point.x -= pstate.origin.x;\n            point.y -= pstate.origin.y;\n        }\n        return point;\n    }\n    /**\n     * Changes the coordinates for the label of the given edge.\n     *\n     * @param edge {@link Cell} that represents the edge.\n     * @param x Integer that specifies the x-coordinate of the new location.\n     * @param y Integer that specifies the y-coordinate of the new location.\n     */\n    moveLabel(edgeState, x, y) {\n        const model = this.graph.getDataModel();\n        let geometry = edgeState.cell.getGeometry();\n        if (geometry != null) {\n            const { scale } = this.graph.getView();\n            geometry = geometry.clone();\n            if (geometry.relative) {\n                // Resets the relative location stored inside the geometry\n                let pt = this.graph.getView().getRelativePoint(edgeState, x, y);\n                geometry.x = Math.round(pt.x * 10000) / 10000;\n                geometry.y = Math.round(pt.y);\n                // Resets the offset inside the geometry to find the offset\n                // from the resulting point\n                geometry.offset = new Point(0, 0);\n                pt = this.graph.view.getPoint(edgeState, geometry);\n                geometry.offset = new Point(Math.round((x - pt.x) / scale), Math.round((y - pt.y) / scale));\n            }\n            else {\n                const points = edgeState.absolutePoints;\n                const p0 = points[0];\n                const pe = points[points.length - 1];\n                if (p0 != null && pe != null) {\n                    const cx = p0.x + (pe.x - p0.x) / 2;\n                    const cy = p0.y + (pe.y - p0.y) / 2;\n                    geometry.offset = new Point(Math.round((x - cx) / scale), Math.round((y - cy) / scale));\n                    geometry.x = 0;\n                    geometry.y = 0;\n                }\n            }\n            model.setGeometry(edgeState.cell, geometry);\n        }\n    }\n    /**\n     * Changes the terminal or terminal point of the given edge in the graph model.\n     *\n     * @param edge {@link Cell} that represents the edge to be reconnected.\n     * @param terminal {@link Cell} that represents the new terminal.\n     * @param isSource Boolean indicating if the new terminal is the source or target terminal.\n     * @param _isClone Boolean indicating if the new connection should be a clone of the old edge.\n     * @param _me {@link MouseEvent} that contains the mouse up event.\n     */\n    connect(edge, terminal, isSource, _isClone, _me) {\n        const parent = edge.getParent();\n        this.graph.batchUpdate(() => {\n            let constraint = this.constraintHandler.currentConstraint;\n            if (constraint == null) {\n                constraint = new ConnectionConstraint(null);\n            }\n            this.graph.connectCell(edge, terminal, isSource, constraint);\n        });\n        return edge;\n    }\n    /**\n     * Changes the terminal point of the given edge.\n     */\n    changeTerminalPoint(edge, point, isSource, clone) {\n        const model = this.graph.getDataModel();\n        model.batchUpdate(() => {\n            if (clone) {\n                const parent = edge.getParent();\n                const terminal = edge.getTerminal(!isSource);\n                edge = this.graph.cloneCell(edge);\n                model.add(parent, edge, parent.getChildCount());\n                model.setTerminal(edge, terminal, !isSource);\n            }\n            let geo = edge.getGeometry();\n            if (geo != null) {\n                geo = geo.clone();\n                geo.setTerminalPoint(point, isSource);\n                model.setGeometry(edge, geo);\n                this.graph.connectCell(edge, null, isSource, new ConnectionConstraint(null));\n            }\n        });\n        return edge;\n    }\n    /**\n     * Changes the control points of the given edge in the graph model.\n     */\n    changePoints(edge, points, clone) {\n        const model = this.graph.getDataModel();\n        model.batchUpdate(() => {\n            if (clone) {\n                const parent = edge.getParent();\n                const source = edge.getTerminal(true);\n                const target = edge.getTerminal(false);\n                edge = this.graph.cloneCell(edge);\n                model.add(parent, edge, parent.getChildCount());\n                model.setTerminal(edge, source, true);\n                model.setTerminal(edge, target, false);\n            }\n            let geo = edge.getGeometry();\n            if (geo != null) {\n                geo = geo.clone();\n                geo.points = points;\n                model.setGeometry(edge, geo);\n            }\n        });\n        return edge;\n    }\n    /**\n     * Adds a control point for the given state and event.\n     */\n    addPoint(state, evt) {\n        const pt = convertPoint(this.graph.container, getClientX(evt), getClientY(evt));\n        const gridEnabled = this.graph.isGridEnabledEvent(evt);\n        this.convertPoint(pt, gridEnabled);\n        this.addPointAt(state, pt.x, pt.y);\n        InternalEvent.consume(evt);\n    }\n    /**\n     * Adds a control point at the given point.\n     */\n    addPointAt(state, x, y) {\n        let geo = state.cell.getGeometry();\n        const pt = new Point(x, y);\n        if (geo != null) {\n            geo = geo.clone();\n            const t = this.graph.view.translate;\n            const s = this.graph.view.scale;\n            let offset = new Point(t.x * s, t.y * s);\n            const parent = this.state.cell.getParent();\n            if (parent && parent.isVertex()) {\n                const pState = this.graph.view.getState(parent);\n                if (pState)\n                    offset = new Point(pState.x, pState.y);\n            }\n            const index = findNearestSegment(state, pt.x * s + offset.x, pt.y * s + offset.y);\n            if (geo.points == null) {\n                geo.points = [pt];\n            }\n            else {\n                geo.points.splice(index, 0, pt);\n            }\n            this.graph.getDataModel().setGeometry(state.cell, geo);\n            this.refresh();\n            this.redraw();\n        }\n    }\n    /**\n     * Removes the control point at the given index from the given state.\n     */\n    removePoint(state, index) {\n        if (index > 0 && index < this.abspoints.length - 1) {\n            let geo = this.state.cell.getGeometry();\n            if (geo != null && geo.points != null) {\n                geo = geo.clone();\n                (geo.points || []).splice(index - 1, 1);\n                this.graph.getDataModel().setGeometry(state.cell, geo);\n                this.refresh();\n                this.redraw();\n            }\n        }\n    }\n    /**\n     * Returns the fillcolor for the handle at the given index.\n     */\n    getHandleFillColor(index) {\n        const isSource = index === 0;\n        const { cell } = this.state;\n        const terminal = cell.getTerminal(isSource);\n        let color = HandleConfig.fillColor;\n        if ((terminal != null && !this.graph.isCellDisconnectable(cell, terminal, isSource)) ||\n            (terminal == null && !this.graph.isTerminalPointMovable(cell, isSource))) {\n            color = LOCKED_HANDLE_FILLCOLOR;\n        }\n        else if (terminal != null &&\n            this.graph.isCellDisconnectable(cell, terminal, isSource)) {\n            color = EdgeHandlerConfig.connectFillColor;\n        }\n        return color;\n    }\n    /**\n     * Redraws the preview, and the bends- and label control points.\n     */\n    redraw(ignoreHandles) {\n        this.abspoints = this.state.absolutePoints.slice();\n        const g = this.state.cell.getGeometry();\n        if (g) {\n            const pts = g.points;\n            if (this.bends != null && this.bends.length > 0) {\n                if (pts != null) {\n                    if (this.points == null) {\n                        this.points = [];\n                    }\n                    for (let i = 1; i < this.bends.length - 1; i += 1) {\n                        if (this.bends[i] != null && this.abspoints[i] != null) {\n                            this.points[i - 1] = pts[i - 1];\n                        }\n                    }\n                }\n            }\n        }\n        this.drawPreview();\n        if (!ignoreHandles) {\n            this.redrawHandles();\n        }\n    }\n    /**\n     * Redraws the handles.\n     */\n    redrawHandles() {\n        const { cell } = this.state;\n        // Updates the handle for the label position\n        let b = this.labelShape.bounds;\n        this.label = new Point(this.state.absoluteOffset.x, this.state.absoluteOffset.y);\n        this.labelShape.bounds = new Rectangle(Math.round(this.label.x - b.width / 2), Math.round(this.label.y - b.height / 2), b.width, b.height);\n        // Shows or hides the label handle depending on the label\n        const lab = this.graph.getLabel(cell);\n        this.labelShape.visible =\n            lab != null && lab.length > 0 && this.graph.isLabelMovable(cell);\n        if (this.bends != null && this.bends.length > 0) {\n            const n = this.abspoints.length - 1;\n            const p0 = this.abspoints[0];\n            const x0 = p0.x;\n            const y0 = p0.y;\n            b = this.bends[0].bounds;\n            this.bends[0].bounds = new Rectangle(Math.floor(x0 - b.width / 2), Math.floor(y0 - b.height / 2), b.width, b.height);\n            this.bends[0].fill = this.getHandleFillColor(0);\n            this.bends[0].redraw();\n            if (this.manageLabelHandle) {\n                this.checkLabelHandle(this.bends[0].bounds);\n            }\n            const pe = this.abspoints[n];\n            const xn = pe.x;\n            const yn = pe.y;\n            const bn = this.bends.length - 1;\n            b = this.bends[bn].bounds;\n            this.bends[bn].bounds = new Rectangle(Math.floor(xn - b.width / 2), Math.floor(yn - b.height / 2), b.width, b.height);\n            this.bends[bn].fill = this.getHandleFillColor(bn);\n            this.bends[bn].redraw();\n            if (this.manageLabelHandle) {\n                this.checkLabelHandle(this.bends[bn].bounds);\n            }\n            this.redrawInnerBends(p0, pe);\n        }\n        if (this.virtualBends && this.virtualBends.length > 0) {\n            let last = this.abspoints[0];\n            for (let i = 0; i < this.virtualBends.length; i += 1) {\n                if (this.virtualBends[i] != null && this.abspoints[i + 1] != null) {\n                    const pt = this.abspoints[i + 1];\n                    const b = this.virtualBends[i];\n                    const x = last.x + (pt.x - last.x) / 2;\n                    const y = last.y + (pt.y - last.y) / 2;\n                    if (b.bounds) {\n                        b.bounds = new Rectangle(Math.floor(x - b.bounds.width / 2), Math.floor(y - b.bounds.height / 2), b.bounds.width, b.bounds.height);\n                        b.redraw();\n                    }\n                    setOpacity(b.node, EdgeHandlerConfig.virtualBendOpacity);\n                    last = pt;\n                    if (this.manageLabelHandle) {\n                        this.checkLabelHandle(b.bounds);\n                    }\n                }\n            }\n        }\n        this.labelShape.redraw();\n        if (this.customHandles) {\n            for (let i = 0; i < this.customHandles.length; i += 1) {\n                const shape = this.customHandles[i].shape;\n                if (shape) {\n                    const temp = shape.node.style.display;\n                    this.customHandles[i].redraw();\n                    shape.node.style.display = temp;\n                    // Hides custom handles during text editing\n                    shape.node.style.visibility = this.isCustomHandleVisible(this.customHandles[i])\n                        ? ''\n                        : 'hidden';\n                }\n            }\n        }\n    }\n    /**\n     * Returns true if the given custom handle is visible.\n     */\n    isCustomHandleVisible(handle) {\n        return !this.graph.isEditing() && this.state.view.graph.getSelectionCount() === 1;\n    }\n    /**\n     * Shortcut to {@link hideSizers}.\n     */\n    setHandlesVisible(visible) {\n        for (let i = 0; i < this.bends.length; i += 1) {\n            this.bends[i].node.style.display = visible ? '' : 'none';\n        }\n        if (this.virtualBends) {\n            for (let i = 0; i < this.virtualBends.length; i += 1) {\n                this.virtualBends[i].node.style.display = visible ? '' : 'none';\n            }\n        }\n        this.labelShape.node.style.display = visible ? '' : 'none';\n        if (this.customHandles) {\n            for (let i = 0; i < this.customHandles.length; i += 1) {\n                this.customHandles[i].setVisible(visible);\n            }\n        }\n    }\n    /**\n     * Updates and redraws the inner bends.\n     *\n     * @param p0 {@link Point} that represents the location of the first point.\n     * @param pe {@link Point} that represents the location of the last point.\n     */\n    redrawInnerBends(p0, pe) {\n        for (let i = 1; i < this.bends.length - 1; i += 1) {\n            if (this.bends[i] != null) {\n                if (this.abspoints[i] != null) {\n                    const { x } = this.abspoints[i];\n                    const { y } = this.abspoints[i];\n                    const b = this.bends[i].bounds;\n                    this.bends[i].node.style.visibility = 'visible';\n                    this.bends[i].bounds = new Rectangle(Math.round(x - b.width / 2), Math.round(y - b.height / 2), b.width, b.height);\n                    if (this.manageLabelHandle) {\n                        this.checkLabelHandle(this.bends[i].bounds);\n                    }\n                    else if (this.handleImage == null &&\n                        this.labelShape.visible &&\n                        intersects(this.bends[i].bounds, this.labelShape.bounds)) {\n                        const w = HandleConfig.size + 3;\n                        const h = w;\n                        this.bends[i].bounds = new Rectangle(Math.round(x - w / 2), Math.round(y - h / 2), w, h);\n                    }\n                    this.bends[i].redraw();\n                }\n                else {\n                    this.bends[i].destroy();\n                }\n            }\n        }\n    }\n    /**\n     * Checks if the label handle intersects the given bounds and moves it if it\n     * intersects.\n     */\n    checkLabelHandle(b) {\n        const b2 = this.labelShape.bounds;\n        if (intersects(b, b2)) {\n            if (b.getCenterY() < b2.getCenterY()) {\n                b2.y = b.y + b.height;\n            }\n            else {\n                b2.y = b.y - b2.height;\n            }\n        }\n    }\n    /**\n     * Redraws the preview.\n     */\n    drawPreview() {\n        try {\n            if (this.isLabel) {\n                const b = this.labelShape.bounds;\n                const bounds = new Rectangle(Math.round(this.label.x - b.width / 2), Math.round(this.label.y - b.height / 2), b.width, b.height);\n                if (!b.equals(bounds)) {\n                    this.labelShape.bounds = bounds;\n                    this.labelShape.redraw();\n                }\n            }\n            if (this.shape != null && !equalPoints(this.shape.points, this.abspoints)) {\n                this.shape.apply(this.state);\n                this.shape.points = this.abspoints.slice();\n                this.shape.scale = this.state.view.scale;\n                this.shape.isDashed = this.isSelectionDashed();\n                this.shape.stroke = this.getSelectionColor();\n                this.shape.strokeWidth =\n                    this.getSelectionStrokeWidth() / this.shape.scale / this.shape.scale;\n                this.shape.isShadow = false;\n                this.shape.redraw();\n            }\n            this.updateParentHighlight();\n        }\n        catch (e) {\n            // ignore\n        }\n    }\n    /**\n     * Refreshes the bends of this handler.\n     */\n    refresh() {\n        if (this.state != null) {\n            this.abspoints = this.getSelectionPoints(this.state);\n            this.points = [];\n            this.destroyBends(this.bends);\n            this.bends = this.createBends();\n            if (this.virtualBends) {\n                this.destroyBends(this.virtualBends);\n                this.virtualBends = this.createVirtualBends();\n            }\n            if (this.customHandles) {\n                this.destroyBends(this.customHandles);\n                this.customHandles = this.createCustomHandles();\n            }\n            // Puts label node on top of bends\n            if (this.labelShape != null &&\n                this.labelShape.node != null &&\n                this.labelShape.node.parentNode != null) {\n                this.labelShape.node.parentNode.appendChild(this.labelShape.node);\n            }\n        }\n    }\n    /**\n     * Returns true if {@link destroy} was called.\n     */\n    isDestroyed() {\n        return this.shape == null;\n    }\n    /**\n     * Destroys all elements in {@link bends}.\n     */\n    destroyBends(bends) {\n        if (bends != null) {\n            for (let i = 0; i < bends.length; i += 1) {\n                if (bends[i] != null) {\n                    bends[i].destroy();\n                }\n            }\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes. This does\n     * normally not need to be called as handlers are destroyed automatically\n     * when the corresponding cell is deselected.\n     */\n    onDestroy() {\n        this.state.view.graph.removeListener(this.escapeHandler);\n        this.marker.destroy();\n        // @ts-expect-error Can be null when destroyed.\n        this.marker = null;\n        this.shape.destroy();\n        // @ts-expect-error Can be null when destroyed.\n        this.shape = null;\n        if (this.parentHighlight) {\n            const parent = this.state.cell.getParent();\n            const pstate = parent ? this.graph.view.getState(parent) : null;\n            if (pstate && pstate.parentHighlight === this.parentHighlight) {\n                pstate.parentHighlight = null;\n            }\n            this.parentHighlight.destroy();\n            this.parentHighlight = null;\n        }\n        this.labelShape.destroy();\n        // @ts-expect-error Can be null when destroyed.\n        this.labelShape = null;\n        this.constraintHandler.onDestroy();\n        // @ts-expect-error Can be null when destroyed.\n        this.constraintHandler = null;\n        if (this.virtualBends) {\n            this.destroyBends(this.virtualBends);\n            this.virtualBends = [];\n        }\n        if (this.customHandles) {\n            this.destroyBends(this.customHandles);\n            this.customHandles = [];\n        }\n        this.destroyBends(this.bends);\n        this.bends = [];\n        this.removeHint();\n    }\n}\nclass EdgeHandlerCellMarker extends CellMarker {\n    constructor(graph, edgeHandler, validColor = DEFAULT_VALID_COLOR, invalidColor = DEFAULT_INVALID_COLOR, hotspot = DEFAULT_HOTSPOT) {\n        super(graph, validColor, invalidColor, hotspot);\n        // Only returns edges if they are connectable and never returns\n        // the edge that is currently being modified\n        this.getCell = (me) => {\n            let cell = super.getCell(me);\n            // Checks for cell at preview point (with grid)\n            if ((cell === this.edgeHandler.state.cell || !cell) &&\n                this.edgeHandler.currentPoint) {\n                cell = this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x, this.edgeHandler.currentPoint.y);\n            }\n            // Uses connectable parent vertex if one exists\n            if (cell && !cell.isConnectable()) {\n                const parent = cell.getParent();\n                if (parent && parent.isVertex() && parent.isConnectable()) {\n                    cell = parent;\n                }\n            }\n            if (cell) {\n                if ((this.graph.isSwimlane(cell) &&\n                    this.edgeHandler.currentPoint &&\n                    this.graph.hitsSwimlaneContent(cell, this.edgeHandler.currentPoint.x, this.edgeHandler.currentPoint.y)) ||\n                    !this.edgeHandler.isConnectableCell(cell) ||\n                    cell === this.edgeHandler.state.cell ||\n                    (cell && !this.edgeHandler.graph.connectableEdges && cell.isEdge()) ||\n                    this.edgeHandler.state.cell.isAncestor(cell)) {\n                    cell = null;\n                }\n            }\n            if (cell && !cell.isConnectable()) {\n                cell = null;\n            }\n            return cell;\n        };\n        // Sets the highlight color according to validateConnection\n        this.isValidState = (state) => {\n            const cell = this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource);\n            const cellState = this.edgeHandler.graph.view.getState(cell);\n            const other = this.edgeHandler.graph.view.getTerminalPort(state, cellState, !this.edgeHandler.isSource);\n            const otherCell = other ? other.cell : null;\n            const source = this.edgeHandler.isSource ? state.cell : otherCell;\n            const target = this.edgeHandler.isSource ? otherCell : state.cell;\n            // Updates the error message of the handler\n            this.edgeHandler.error = this.edgeHandler.validateConnection(source, target);\n            return !this.edgeHandler.error;\n        };\n        this.edgeHandler = edgeHandler;\n    }\n}\nexport default EdgeHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../geometry/Rectangle.js';\nimport { NONE } from '../../util/Constants.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport RectangleShape from '../shape/node/RectangleShape.js';\nimport ImageShape from '../shape/node/ImageShape.js';\nimport EllipseShape from '../shape/node/EllipseShape.js';\nimport Point from '../geometry/Point.js';\nimport { getRotatedPoint, intersects, mod, toRadians } from '../../util/mathUtils.js';\nimport Client from '../../Client.js';\nimport { isMouseEvent, isShiftDown } from '../../util/EventUtils.js';\nimport { HandleConfig, VertexHandlerConfig } from './config.js';\n/**\n * Event handler for resizing cells.\n *\n * This handler is automatically created in {@link AbstractGraph.createHandler}.\n *\n * Some elements of this handler and its subclasses can be configured using {@link EdgeHandlerConfig}.\n */\nclass VertexHandler {\n    /**\n     * Specifies if a rotation handle should be visible.\n     *\n     * This implementation returns {@link VertexHandlerConfig.rotationEnabled}.\n     * @since 0.12.0\n     */\n    isRotationEnabled() {\n        return VertexHandlerConfig.rotationEnabled;\n    }\n    /**\n     * Constructs an event handler that allows to resize vertices and groups.\n     *\n     * @param state {@link CellState} of the cell to be resized.\n     */\n    constructor(state) {\n        this.sizers = [];\n        /**\n         * Specifies if only one sizer handle at the bottom, right corner should be used.\n         * @default false\n         */\n        this.singleSizer = false;\n        /**\n         * Holds the index of the current handle.\n         */\n        this.index = null;\n        /**\n         * Specifies if the bounds of handles should be used for hit-detection in IE or if {@link tolerance} > 0.\n         * @default true\n         */\n        this.allowHandleBoundsCheck = true;\n        /**\n         * Optional {@link Image} to be used as handles.\n         * @default null\n         */\n        this.handleImage = null;\n        /**\n         * If handles are currently visible.\n         * @default true\n         */\n        this.handlesVisible = true;\n        /**\n         * Optional tolerance for hit-detection in {@link getHandleForEvent}.\n         * @default 0\n         */\n        this.tolerance = 0;\n        /**\n         * Specifies if the parent should be highlighted if a child cell is selected.\n         * @default false\n         */\n        this.parentHighlightEnabled = false;\n        /**\n         * Specifies if rotation steps should be \"rasterized\" depending on the distance to the handle.\n         * @default true\n         */\n        this.rotationRaster = true;\n        /**\n         * Specifies the cursor for the rotation handle.\n         * @default 'crosshair'.\n         */\n        this.rotationCursor = 'crosshair';\n        /**\n         * Specifies if resize should change the cell in-place. This is an experimental\n         * feature for non-touch devices.\n         * @default false\n         */\n        this.livePreview = false;\n        /**\n         * Specifies if the live preview should be moved to the front.\n         * @default false\n         */\n        this.movePreviewToFront = false;\n        /**\n         * Specifies if sizers should be hidden and spaced if the vertex is small.\n         * @default false\n         */\n        this.manageSizers = false;\n        /**\n         * Specifies if the size of groups should be constrained by the children.\n         * @default false\n         */\n        this.constrainGroupByChildren = false;\n        /**\n         * Vertical spacing for rotation icon.\n         * @default -16\n         */\n        this.rotationHandleVSpacing = -16;\n        /**\n         * The horizontal offset for the handles. This is updated in {@link redrawHandles}\n         * if {@link manageSizers} is `true` and the sizers are offset horizontally.\n         */\n        this.horizontalOffset = 0;\n        /**\n         * The horizontal offset for the handles. This is updated in <redrawHandles>\n         * if {@link manageSizers} is true and the sizers are offset vertically.\n         */\n        this.verticalOffset = 0;\n        this.minBounds = null;\n        this.x0 = 0;\n        this.y0 = 0;\n        this.customHandles = [];\n        this.inTolerance = false;\n        this.startX = 0;\n        this.startY = 0;\n        this.rotationShape = null;\n        this.currentAlpha = null;\n        this.startAngle = 0;\n        this.startDist = 0;\n        this.ghostPreview = null;\n        this.livePreviewActive = false;\n        this.childOffsetX = 0;\n        this.childOffsetY = 0;\n        this.parentState = null;\n        this.parentHighlight = null;\n        this.unscaledBounds = null;\n        this.preview = null;\n        this.labelShape = null;\n        this.edgeHandlers = [];\n        this.EMPTY_POINT = new Point();\n        this.state = state;\n        this.graph = this.state.view.graph;\n        this.selectionBounds = this.getSelectionBounds(this.state);\n        this.bounds = new Rectangle(this.selectionBounds.x, this.selectionBounds.y, this.selectionBounds.width, this.selectionBounds.height);\n        this.selectionBorder = this.createSelectionShape(this.bounds);\n        // VML dialect required here for event transparency in IE\n        this.selectionBorder.dialect = 'svg';\n        this.selectionBorder.pointerEvents = false;\n        this.selectionBorder.rotation = this.state.style.rotation ?? 0;\n        this.selectionBorder.init(this.graph.getView().getOverlayPane());\n        InternalEvent.redirectMouseEvents(this.selectionBorder.node, this.graph, this.state);\n        if (this.graph.isCellMovable(this.state.cell)) {\n            this.selectionBorder.setCursor(VertexHandlerConfig.cursorMovable);\n        }\n        const selectionHandler = this.getSelectionHandler();\n        // Adds the sizer handles\n        if (selectionHandler &&\n            (selectionHandler.maxCells <= 0 ||\n                this.graph.getSelectionCount() < selectionHandler.maxCells)) {\n            const resizable = this.graph.isCellResizable(this.state.cell);\n            this.sizers = [];\n            if (resizable ||\n                (this.graph.isLabelMovable(this.state.cell) &&\n                    this.state.width >= 2 &&\n                    this.state.height >= 2)) {\n                let i = 0;\n                if (resizable) {\n                    if (!this.singleSizer) {\n                        this.sizers.push(this.createSizer('nw-resize', i++));\n                        this.sizers.push(this.createSizer('n-resize', i++));\n                        this.sizers.push(this.createSizer('ne-resize', i++));\n                        this.sizers.push(this.createSizer('w-resize', i++));\n                        this.sizers.push(this.createSizer('e-resize', i++));\n                        this.sizers.push(this.createSizer('sw-resize', i++));\n                        this.sizers.push(this.createSizer('s-resize', i++));\n                    }\n                    this.sizers.push(this.createSizer('se-resize', i++));\n                }\n                const geo = this.state.cell.getGeometry();\n                if (geo != null &&\n                    !geo.relative &&\n                    !this.graph.isSwimlane(this.state.cell) &&\n                    this.graph.isLabelMovable(this.state.cell)) {\n                    // Marks this as the label handle for getHandleForEvent\n                    this.labelShape = this.createSizer(HandleConfig.labelCursor, InternalEvent.LABEL_HANDLE, HandleConfig.labelSize, HandleConfig.labelFillColor);\n                    this.sizers.push(this.labelShape);\n                }\n            }\n            else if (this.graph.isCellMovable(this.state.cell) &&\n                !this.graph.isCellResizable(this.state.cell) &&\n                this.state.width < 2 &&\n                this.state.height < 2) {\n                this.labelShape = this.createSizer(VertexHandlerConfig.cursorMovable, InternalEvent.LABEL_HANDLE, undefined, HandleConfig.labelFillColor);\n                this.sizers.push(this.labelShape);\n            }\n        }\n        // Adds the rotation handler\n        if (this.isRotationHandleVisible()) {\n            this.rotationShape = this.createSizer(this.rotationCursor, InternalEvent.ROTATION_HANDLE, HandleConfig.size + 3, HandleConfig.fillColor);\n            this.sizers.push(this.rotationShape);\n        }\n        this.customHandles = this.createCustomHandles();\n        this.redraw();\n        if (this.constrainGroupByChildren) {\n            this.updateMinBounds();\n        }\n        // Handles escape keystrokes\n        this.escapeHandler = (_sender, _evt) => {\n            if (this.livePreview && this.index != null) {\n                // Redraws the live preview\n                this.state.view.graph.cellRenderer.redraw(this.state, true);\n                // Redraws connected edges\n                this.state.view.invalidate(this.state.cell);\n                this.state.invalid = false;\n                this.state.view.validate();\n            }\n            this.reset();\n        };\n        this.state.view.graph.addListener(InternalEvent.ESCAPE, this.escapeHandler);\n    }\n    getSelectionHandler() {\n        return this.graph.getPlugin('SelectionHandler');\n    }\n    /**\n     * Returns `true` if the rotation handle should be showing.\n     */\n    isRotationHandleVisible() {\n        const selectionHandler = this.getSelectionHandler();\n        const selectionHandlerCheck = selectionHandler\n            ? selectionHandler.maxCells <= 0 ||\n                this.graph.getSelectionCount() < selectionHandler.maxCells\n            : true;\n        return (this.graph.isEnabled() &&\n            this.isRotationEnabled() &&\n            this.graph.isCellRotatable(this.state.cell) &&\n            selectionHandlerCheck);\n    }\n    /**\n     * Returns `true` if the aspect ratio if the cell should be maintained.\n     */\n    isConstrainedEvent(me) {\n        return isShiftDown(me.getEvent()) || this.state.style.aspect === 'fixed';\n    }\n    /**\n     * Returns `true` if the center of the vertex should be maintained during the resize.\n     */\n    isCenteredEvent(state, me) {\n        return false;\n    }\n    /**\n     * Returns an array of custom handles.\n     *\n     * This implementation returns an empty array.\n     */\n    createCustomHandles() {\n        return [];\n    }\n    /**\n     * Initializes the shapes required for this vertex handler.\n     */\n    updateMinBounds() {\n        const children = this.graph.getChildCells(this.state.cell);\n        if (children.length > 0) {\n            this.minBounds = this.graph.view.getBounds(children);\n            if (this.minBounds) {\n                const s = this.state.view.scale;\n                const t = this.state.view.translate;\n                this.minBounds.x -= this.state.x;\n                this.minBounds.y -= this.state.y;\n                this.minBounds.x /= s;\n                this.minBounds.y /= s;\n                this.minBounds.width /= s;\n                this.minBounds.height /= s;\n                this.x0 = this.state.x / s - t.x;\n                this.y0 = this.state.y / s - t.y;\n            }\n        }\n    }\n    /**\n     * Returns the Rectangle that defines the bounds of the selection border.\n     */\n    getSelectionBounds(state) {\n        return new Rectangle(Math.round(state.x), Math.round(state.y), Math.round(state.width), Math.round(state.height));\n    }\n    /**\n     * Creates the shape used to draw the selection border.\n     */\n    createParentHighlightShape(bounds) {\n        return this.createSelectionShape(bounds);\n    }\n    /**\n     * Creates the shape used to draw the selection border.\n     */\n    createSelectionShape(bounds) {\n        const shape = new RectangleShape(Rectangle.fromRectangle(bounds), NONE, this.getSelectionColor());\n        shape.strokeWidth = this.getSelectionStrokeWidth();\n        shape.isDashed = this.isSelectionDashed();\n        return shape;\n    }\n    /**\n     * Returns {@link VertexHandlerConfig.selectionColor}.\n     */\n    getSelectionColor() {\n        return VertexHandlerConfig.selectionColor;\n    }\n    /**\n     * Returns {@link VertexHandlerConfig.selectionStrokeWidth}.\n     */\n    getSelectionStrokeWidth() {\n        return VertexHandlerConfig.selectionStrokeWidth;\n    }\n    /**\n     * Returns {@link VertexHandlerConfig.selectionDashed}.\n     */\n    isSelectionDashed() {\n        return VertexHandlerConfig.selectionDashed;\n    }\n    /**\n     * Creates a sizer handle for the specified cursor and index and returns\n     * the new {@link RectangleShape} that represents the handle.\n     */\n    createSizer(cursor, index, size = HandleConfig.size, fillColor = HandleConfig.fillColor) {\n        const bounds = new Rectangle(0, 0, size, size);\n        const sizer = this.createSizerShape(bounds, index, fillColor);\n        if (sizer.bounds &&\n            sizer.isHtmlAllowed() &&\n            this.state.text &&\n            this.state.text.node.parentNode === this.graph.container) {\n            sizer.bounds.height -= 1;\n            sizer.bounds.width -= 1;\n            sizer.dialect = 'strictHtml';\n            sizer.init(this.graph.container);\n        }\n        else {\n            sizer.dialect = this.graph.dialect !== 'svg' ? 'mixedHtml' : 'svg';\n            sizer.init(this.graph.getView().getOverlayPane());\n        }\n        InternalEvent.redirectMouseEvents(sizer.node, this.graph, this.state);\n        if (this.graph.isEnabled()) {\n            sizer.setCursor(cursor);\n        }\n        if (!this.isSizerVisible(index)) {\n            sizer.visible = false;\n        }\n        return sizer;\n    }\n    /**\n     * Returns `true` if the sizer for the given index is visible.\n     *\n     * This implementation returns `true` for all given indices.\n     */\n    isSizerVisible(_index) {\n        return true;\n    }\n    /**\n     * Creates the shape used for the sizer handle for the specified bounds an\n     * index. Only images and rectangles should be returned if support for HTML\n     * labels with not foreign objects is required.\n     */\n    createSizerShape(bounds, index, fillColor = HandleConfig.fillColor) {\n        if (this.handleImage) {\n            bounds = new Rectangle(bounds.x, bounds.y, this.handleImage.width, this.handleImage.height);\n            const shape = new ImageShape(bounds, this.handleImage.src);\n            // Allows HTML rendering of the images\n            shape.preserveImageAspect = false;\n            return shape;\n        }\n        const strokeColor = HandleConfig.strokeColor;\n        if (index === InternalEvent.ROTATION_HANDLE) {\n            return new EllipseShape(bounds, fillColor, strokeColor);\n        }\n        return new RectangleShape(bounds, fillColor, strokeColor);\n    }\n    /**\n     * Helper method to create an {@link Rectangle} around the given center point\n     * with a width and height of 2*s or 6, if no s is given.\n     */\n    moveSizerTo(shape, x, y) {\n        if (shape && shape.bounds) {\n            shape.bounds.x = Math.floor(x - shape.bounds.width / 2);\n            shape.bounds.y = Math.floor(y - shape.bounds.height / 2);\n            // Fixes visible inactive handles in VML\n            if (shape.node && shape.node.style.display !== 'none') {\n                shape.redraw();\n            }\n        }\n    }\n    /**\n     * Returns the index of the handle for the given event. This returns the index\n     * of the sizer from where the event originated or {@link InternalEvent.LABEL_HANDLE}.\n     */\n    getHandleForEvent(me) {\n        // Connection highlight may consume events before they reach sizer handle\n        const tol = !isMouseEvent(me.getEvent()) ? this.tolerance : 1;\n        const hit = this.allowHandleBoundsCheck && tol > 0\n            ? new Rectangle(me.getGraphX() - tol, me.getGraphY() - tol, 2 * tol, 2 * tol)\n            : null;\n        const checkShape = (shape) => {\n            const st = shape && shape.constructor !== ImageShape && this.allowHandleBoundsCheck\n                ? shape.strokeWidth + shape.svgStrokeTolerance\n                : null;\n            const real = st\n                ? new Rectangle(me.getGraphX() - Math.floor(st / 2), me.getGraphY() - Math.floor(st / 2), st, st)\n                : hit;\n            return (shape &&\n                shape.bounds &&\n                (me.isSource(shape) ||\n                    (real &&\n                        intersects(shape.bounds, real) &&\n                        shape.node.style.display !== 'none' &&\n                        shape.node.style.visibility !== 'hidden')));\n        };\n        if (checkShape(this.rotationShape)) {\n            return InternalEvent.ROTATION_HANDLE;\n        }\n        if (checkShape(this.labelShape)) {\n            return InternalEvent.LABEL_HANDLE;\n        }\n        for (let i = 0; i < this.sizers.length; i += 1) {\n            if (checkShape(this.sizers[i])) {\n                return i;\n            }\n        }\n        if (this.customHandles != null && this.isCustomHandleEvent(me)) {\n            // Inverse loop order to match display order\n            for (let i = this.customHandles.length - 1; i >= 0; i--) {\n                if (checkShape(this.customHandles[i].shape)) {\n                    // LATER: Return reference to active shape\n                    return InternalEvent.CUSTOM_HANDLE - i;\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Returns `true` if the given event allows custom handles to be changed.\n     *\n     * This implementation returns `true`.\n     */\n    isCustomHandleEvent(me) {\n        return true;\n    }\n    /**\n     * Handles the event if a handle has been clicked. By consuming the\n     * event all subsequent events of the gesture are redirected to this\n     * handler.\n     */\n    mouseDown(_sender, me) {\n        if (!me.isConsumed() && this.graph.isEnabled()) {\n            const handle = this.getHandleForEvent(me);\n            if (handle) {\n                this.start(me.getGraphX(), me.getGraphY(), handle);\n                me.consume();\n            }\n        }\n    }\n    /**\n     * Called if {@link livePreview} is enabled to check if a border should be painted.\n     *\n     * This implementation returns `true` if the shape is transparent.\n     */\n    isLivePreviewBorder() {\n        return (this.state.shape &&\n            this.state.shape.fill === NONE &&\n            this.state.shape.stroke === NONE);\n    }\n    /**\n     * Starts the handling of the mouse gesture.\n     */\n    start(x, y, index) {\n        this.livePreviewActive = this.livePreview && this.state.cell.getChildCount() === 0;\n        this.inTolerance = true;\n        this.childOffsetX = 0;\n        this.childOffsetY = 0;\n        this.index = index;\n        this.startX = x;\n        this.startY = y;\n        if (this.index <= InternalEvent.CUSTOM_HANDLE && this.isGhostPreview()) {\n            this.ghostPreview = this.createGhostPreview();\n        }\n        else {\n            // Saves reference to parent state\n            const parent = this.state.cell.getParent();\n            if (this.state.view.currentRoot !== parent &&\n                parent &&\n                (parent.isVertex() || parent.isEdge())) {\n                this.parentState = this.state.view.graph.view.getState(parent);\n            }\n            // Creates a preview that can be on top of any HTML label\n            this.selectionBorder.node.style.display =\n                index === InternalEvent.ROTATION_HANDLE ? 'inline' : 'none';\n            // Creates the border that represents the new bounds\n            if (!this.livePreviewActive || this.isLivePreviewBorder()) {\n                this.preview = this.createSelectionShape(this.bounds);\n                if (!(Client.IS_SVG && (this.state.style.rotation ?? 0) != 0) &&\n                    this.state.text != null &&\n                    this.state.text.node.parentNode === this.graph.container) {\n                    this.preview.dialect = 'strictHtml';\n                    this.preview.init(this.graph.container);\n                }\n                else {\n                    this.preview.dialect = 'svg';\n                    this.preview.init(this.graph.view.getOverlayPane());\n                }\n            }\n            if (index === InternalEvent.ROTATION_HANDLE) {\n                // With the rotation handle in a corner, need the angle and distance\n                const pos = this.getRotationHandlePosition();\n                const dx = pos.x - this.state.getCenterX();\n                const dy = pos.y - this.state.getCenterY();\n                this.startAngle = dx !== 0 ? (Math.atan(dy / dx) * 180) / Math.PI + 90 : 0;\n                this.startDist = Math.sqrt(dx * dx + dy * dy);\n            }\n            // Prepares the handles for live preview\n            if (this.livePreviewActive) {\n                this.hideSizers();\n                if (index === InternalEvent.ROTATION_HANDLE && this.rotationShape) {\n                    this.rotationShape.node.style.display = '';\n                }\n                else if (index === InternalEvent.LABEL_HANDLE && this.labelShape) {\n                    this.labelShape.node.style.display = '';\n                }\n                else if (this.sizers[index]) {\n                    this.sizers[index].node.style.display = '';\n                }\n                else if (index <= InternalEvent.CUSTOM_HANDLE) {\n                    this.customHandles[InternalEvent.CUSTOM_HANDLE - index].setVisible(true);\n                }\n                // Gets the array of connected edge handlers for redrawing\n                const edges = this.state.cell.getEdges();\n                this.edgeHandlers = [];\n                const selectionCellsHandler = this.graph.getPlugin('SelectionCellsHandler');\n                for (let i = 0; i < edges.length; i += 1) {\n                    const handler = selectionCellsHandler?.getHandler(edges[i]);\n                    if (handler) {\n                        this.edgeHandlers.push(handler);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Starts the handling of the mouse gesture.\n     */\n    createGhostPreview() {\n        const shape = this.graph.cellRenderer.createShape(this.state);\n        shape.init(this.graph.view.getOverlayPane());\n        shape.scale = this.state.view.scale;\n        shape.bounds = this.bounds;\n        shape.outline = true;\n        return shape;\n    }\n    /**\n     * Shortcut to {@link hideSizers}.\n     */\n    setHandlesVisible(visible) {\n        this.handlesVisible = visible;\n        for (let i = 0; i < this.sizers.length; i += 1) {\n            this.sizers[i].node.style.display = visible ? '' : 'none';\n        }\n        for (let i = 0; i < this.customHandles.length; i += 1) {\n            this.customHandles[i].setVisible(visible);\n        }\n    }\n    /**\n     * Hides all sizers except.\n     *\n     * Starts the handling of the mouse gesture.\n     */\n    hideSizers() {\n        this.setHandlesVisible(false);\n    }\n    /**\n     * Checks if the coordinates for the given event are within the\n     * {@link AbstractGraph.tolerance}. If the event is a mouse event then the tolerance is\n     * ignored.\n     */\n    checkTolerance(me) {\n        if (this.inTolerance && this.startX !== null && this.startY !== null) {\n            if (isMouseEvent(me.getEvent()) ||\n                Math.abs(me.getGraphX() - this.startX) > this.graph.getEventTolerance() ||\n                Math.abs(me.getGraphY() - this.startY) > this.graph.getEventTolerance()) {\n                this.inTolerance = false;\n            }\n        }\n    }\n    /**\n     * Hook for subclasses do show details while the handler is active.\n     */\n    updateHint(me) {\n        return;\n    }\n    /**\n     * Hooks for subclasses to hide details when the handler gets inactive.\n     */\n    removeHint() {\n        return;\n    }\n    /**\n     * Hook for rounding the angle. This uses {@link Math.round}.\n     */\n    roundAngle(angle) {\n        return Math.round(angle * 10) / 10;\n    }\n    /**\n     * Hook for rounding the unscaled width or height. This uses {@link Math.round}.\n     */\n    roundLength(length) {\n        return Math.round(length * 100) / 100;\n    }\n    /**\n     * Handles the event by updating the preview.\n     */\n    mouseMove(_sender, me) {\n        if (!me.isConsumed() && this.index != null) {\n            // Checks tolerance for ignoring single clicks\n            this.checkTolerance(me);\n            if (!this.inTolerance) {\n                if (this.index <= InternalEvent.CUSTOM_HANDLE) {\n                    if (this.customHandles != null) {\n                        this.customHandles[InternalEvent.CUSTOM_HANDLE - this.index].processEvent(me);\n                        this.customHandles[InternalEvent.CUSTOM_HANDLE - this.index].active = true;\n                        if (this.ghostPreview != null) {\n                            this.ghostPreview.apply(this.state);\n                            this.ghostPreview.strokeWidth =\n                                this.getSelectionStrokeWidth() /\n                                    this.ghostPreview.scale /\n                                    this.ghostPreview.scale;\n                            this.ghostPreview.isDashed = this.isSelectionDashed();\n                            this.ghostPreview.stroke = this.getSelectionColor();\n                            this.ghostPreview.redraw();\n                            if (this.selectionBounds != null) {\n                                this.selectionBorder.node.style.display = 'none';\n                            }\n                        }\n                        else {\n                            if (this.movePreviewToFront) {\n                                this.moveToFront();\n                            }\n                            this.customHandles[InternalEvent.CUSTOM_HANDLE - this.index].positionChanged();\n                        }\n                    }\n                }\n                else if (this.index === InternalEvent.LABEL_HANDLE) {\n                    this.moveLabel(me);\n                }\n                else {\n                    if (this.index === InternalEvent.ROTATION_HANDLE) {\n                        this.rotateVertex(me);\n                    }\n                    else {\n                        this.resizeVertex(me);\n                    }\n                    this.updateHint(me);\n                }\n            }\n            me.consume();\n        }\n        // Workaround for disabling the connect highlight when over handle\n        else if (!this.graph.isMouseDown && this.getHandleForEvent(me)) {\n            me.consume(false);\n        }\n    }\n    /**\n     * Returns `true` if a ghost preview should be used for custom handles.\n     */\n    isGhostPreview() {\n        return this.state.cell.getChildCount() > 0;\n    }\n    /**\n     * Moves the vertex.\n     */\n    moveLabel(me) {\n        const point = new Point(me.getGraphX(), me.getGraphY());\n        const tr = this.graph.view.translate;\n        const { scale } = this.graph.view;\n        if (this.graph.isGridEnabledEvent(me.getEvent())) {\n            point.x = (this.graph.snap(point.x / scale - tr.x) + tr.x) * scale;\n            point.y = (this.graph.snap(point.y / scale - tr.y) + tr.y) * scale;\n        }\n        const index = this.rotationShape ? this.sizers.length - 2 : this.sizers.length - 1;\n        this.moveSizerTo(this.sizers[index], point.x, point.y);\n    }\n    /**\n     * Rotates the vertex.\n     */\n    rotateVertex(me) {\n        const point = new Point(me.getGraphX(), me.getGraphY());\n        let dx = this.state.x + this.state.width / 2 - point.x;\n        let dy = this.state.y + this.state.height / 2 - point.y;\n        this.currentAlpha =\n            dx !== 0 ? (Math.atan(dy / dx) * 180) / Math.PI + 90 : dy < 0 ? 180 : 0;\n        if (dx > 0) {\n            this.currentAlpha -= 180;\n        }\n        this.currentAlpha -= this.startAngle;\n        // Rotation raster\n        if (this.rotationRaster && this.graph.isGridEnabledEvent(me.getEvent())) {\n            let raster;\n            dx = point.x - this.state.getCenterX();\n            dy = point.y - this.state.getCenterY();\n            const dist = Math.sqrt(dx * dx + dy * dy);\n            if (dist - this.startDist < 2) {\n                raster = 15;\n            }\n            else if (dist - this.startDist < 25) {\n                raster = 5;\n            }\n            else {\n                raster = 1;\n            }\n            this.currentAlpha = Math.round(this.currentAlpha / raster) * raster;\n        }\n        else {\n            this.currentAlpha = this.roundAngle(this.currentAlpha);\n        }\n        this.selectionBorder.rotation = this.currentAlpha;\n        this.selectionBorder.redraw();\n        if (this.livePreviewActive) {\n            this.redrawHandles();\n        }\n    }\n    /**\n     * Resizes the vertex.\n     */\n    resizeVertex(me) {\n        const ct = new Point(this.state.getCenterX(), this.state.getCenterY());\n        const alpha = toRadians(this.state.style.rotation ?? 0);\n        const point = new Point(me.getGraphX(), me.getGraphY());\n        const tr = this.graph.view.translate;\n        const { scale } = this.graph.view;\n        let cos = Math.cos(-alpha);\n        let sin = Math.sin(-alpha);\n        let dx = point.x - this.startX;\n        let dy = point.y - this.startY;\n        // Rotates vector for mouse gesture\n        const tx = cos * dx - sin * dy;\n        const ty = sin * dx + cos * dy;\n        dx = tx;\n        dy = ty;\n        const geo = this.state.cell.getGeometry();\n        if (geo && this.index !== null) {\n            this.unscaledBounds = this.union(geo, dx / scale, dy / scale, this.index, this.graph.isGridEnabledEvent(me.getEvent()), 1, new Point(0, 0), this.isConstrainedEvent(me), this.isCenteredEvent(this.state, me));\n        }\n        // Keeps vertex within maximum graph or parent bounds\n        if (geo && !geo.relative) {\n            let max = this.graph.getMaximumGraphBounds();\n            // Handles child cells\n            if (max != null && this.parentState != null) {\n                max = Rectangle.fromRectangle(max);\n                max.x -= (this.parentState.x - tr.x * scale) / scale;\n                max.y -= (this.parentState.y - tr.y * scale) / scale;\n            }\n            if (this.graph.isConstrainChild(this.state.cell)) {\n                let tmp = this.graph.getCellContainmentArea(this.state.cell);\n                if (tmp != null) {\n                    const overlap = this.graph.getOverlap(this.state.cell);\n                    if (overlap > 0) {\n                        tmp = Rectangle.fromRectangle(tmp);\n                        tmp.x -= tmp.width * overlap;\n                        tmp.y -= tmp.height * overlap;\n                        tmp.width += 2 * tmp.width * overlap;\n                        tmp.height += 2 * tmp.height * overlap;\n                    }\n                    if (!max) {\n                        max = tmp;\n                    }\n                    else {\n                        max = Rectangle.fromRectangle(max);\n                        max.intersect(tmp);\n                    }\n                }\n            }\n            if (max && this.unscaledBounds) {\n                if (this.unscaledBounds.x < max.x) {\n                    this.unscaledBounds.width -= max.x - this.unscaledBounds.x;\n                    this.unscaledBounds.x = max.x;\n                }\n                if (this.unscaledBounds.y < max.y) {\n                    this.unscaledBounds.height -= max.y - this.unscaledBounds.y;\n                    this.unscaledBounds.y = max.y;\n                }\n                if (this.unscaledBounds.x + this.unscaledBounds.width > max.x + max.width) {\n                    this.unscaledBounds.width -=\n                        this.unscaledBounds.x + this.unscaledBounds.width - max.x - max.width;\n                }\n                if (this.unscaledBounds.y + this.unscaledBounds.height > max.y + max.height) {\n                    this.unscaledBounds.height -=\n                        this.unscaledBounds.y + this.unscaledBounds.height - max.y - max.height;\n                }\n            }\n        }\n        if (this.unscaledBounds) {\n            const old = this.bounds;\n            this.bounds = new Rectangle((this.parentState ? this.parentState.x : tr.x * scale) +\n                this.unscaledBounds.x * scale, (this.parentState ? this.parentState.y : tr.y * scale) +\n                this.unscaledBounds.y * scale, this.unscaledBounds.width * scale, this.unscaledBounds.height * scale);\n            if (geo && geo.relative && this.parentState) {\n                this.bounds.x += this.state.x - this.parentState.x;\n                this.bounds.y += this.state.y - this.parentState.y;\n            }\n            cos = Math.cos(alpha);\n            sin = Math.sin(alpha);\n            const c2 = new Point(this.bounds.getCenterX(), this.bounds.getCenterY());\n            dx = c2.x - ct.x;\n            dy = c2.y - ct.y;\n            const dx2 = cos * dx - sin * dy;\n            const dy2 = sin * dx + cos * dy;\n            const dx3 = dx2 - dx;\n            const dy3 = dy2 - dy;\n            const dx4 = this.bounds.x - this.state.x;\n            const dy4 = this.bounds.y - this.state.y;\n            const dx5 = cos * dx4 - sin * dy4;\n            const dy5 = sin * dx4 + cos * dy4;\n            this.bounds.x += dx3;\n            this.bounds.y += dy3;\n            // Rounds unscaled bounds to int\n            this.unscaledBounds.x = this.roundLength(this.unscaledBounds.x + dx3 / scale);\n            this.unscaledBounds.y = this.roundLength(this.unscaledBounds.y + dy3 / scale);\n            this.unscaledBounds.width = this.roundLength(this.unscaledBounds.width);\n            this.unscaledBounds.height = this.roundLength(this.unscaledBounds.height);\n            // Shifts the children according to parent offset\n            if (!this.state.cell.isCollapsed() && (dx3 !== 0 || dy3 !== 0)) {\n                this.childOffsetX = this.state.x - this.bounds.x + dx5;\n                this.childOffsetY = this.state.y - this.bounds.y + dy5;\n            }\n            else {\n                this.childOffsetX = 0;\n                this.childOffsetY = 0;\n            }\n            if (!old.equals(this.bounds)) {\n                if (this.livePreviewActive) {\n                    this.updateLivePreview(me);\n                }\n                if (this.preview != null) {\n                    this.drawPreview();\n                }\n                else {\n                    this.updateParentHighlight();\n                }\n            }\n        }\n    }\n    /**\n     * Repaints the live preview.\n     */\n    updateLivePreview(me) {\n        // TODO: Apply child offset to children in live preview\n        const { scale } = this.graph.view;\n        const tr = this.graph.view.translate;\n        // Saves current state\n        const tempState = this.state.clone();\n        // Temporarily changes size and origin\n        this.state.x = this.bounds.x;\n        this.state.y = this.bounds.y;\n        this.state.origin = new Point(this.state.x / scale - tr.x, this.state.y / scale - tr.y);\n        this.state.width = this.bounds.width;\n        this.state.height = this.bounds.height;\n        // Redraws cell and handles\n        let off = this.state.absoluteOffset;\n        off = new Point(off.x, off.y);\n        // Required to store and reset absolute offset for updating label position\n        this.state.absoluteOffset.x = 0;\n        this.state.absoluteOffset.y = 0;\n        const geo = this.state.cell.getGeometry();\n        if (geo != null) {\n            const offset = geo.offset || this.EMPTY_POINT;\n            if (offset != null && !geo.relative) {\n                this.state.absoluteOffset.x = this.state.view.scale * offset.x;\n                this.state.absoluteOffset.y = this.state.view.scale * offset.y;\n            }\n            this.state.view.updateVertexLabelOffset(this.state);\n        }\n        // Draws the live preview\n        this.state.view.graph.cellRenderer.redraw(this.state, true);\n        // Redraws connected edges TODO: Include child edges\n        this.state.view.invalidate(this.state.cell);\n        this.state.invalid = false;\n        this.state.view.validate();\n        this.redrawHandles();\n        // Moves live preview to front\n        if (this.movePreviewToFront) {\n            this.moveToFront();\n        }\n        // Hides folding icon\n        if (this.state.control != null && this.state.control.node != null) {\n            this.state.control.node.style.visibility = 'hidden';\n        }\n        // Restores current state\n        this.state.setState(tempState);\n    }\n    /**\n     * Handles the event by applying the changes to the geometry.\n     */\n    moveToFront() {\n        if ((this.state.text && this.state.text.node && this.state.text.node.nextSibling) ||\n            (this.state.shape &&\n                this.state.shape.node &&\n                this.state.shape.node.nextSibling &&\n                (!this.state.text || this.state.shape.node.nextSibling !== this.state.text.node))) {\n            if (this.state.shape && this.state.shape.node && this.state.shape.node.parentNode) {\n                this.state.shape.node.parentNode.appendChild(this.state.shape.node);\n            }\n            if (this.state.text && this.state.text.node && this.state.text.node.parentNode) {\n                this.state.text.node.parentNode.appendChild(this.state.text.node);\n            }\n        }\n    }\n    /**\n     * Handles the event by applying the changes to the geometry.\n     */\n    mouseUp(_sender, me) {\n        if (this.index != null && this.state != null) {\n            const point = new Point(me.getGraphX(), me.getGraphY());\n            const { index } = this;\n            this.index = null;\n            if (this.ghostPreview == null) {\n                // Required to restore order in case of no change\n                this.state.view.invalidate(this.state.cell, false, false);\n                this.state.view.validate();\n            }\n            this.graph.batchUpdate(() => {\n                if (index <= InternalEvent.CUSTOM_HANDLE) {\n                    if (this.customHandles != null) {\n                        // Creates style before changing cell state\n                        const style = this.state.view.graph.getCellStyle(this.state.cell);\n                        this.customHandles[InternalEvent.CUSTOM_HANDLE - index].active = false;\n                        this.customHandles[InternalEvent.CUSTOM_HANDLE - index].execute(me);\n                        // Sets style and apply on shape to force repaint and\n                        // check if execute has removed custom handles\n                        if (this.customHandles != null &&\n                            this.customHandles[InternalEvent.CUSTOM_HANDLE - index] != null) {\n                            this.state.style = style;\n                            this.customHandles[InternalEvent.CUSTOM_HANDLE - index].positionChanged();\n                        }\n                    }\n                }\n                else if (index === InternalEvent.ROTATION_HANDLE) {\n                    if (this.currentAlpha != null) {\n                        const delta = this.currentAlpha - (this.state.style.rotation ?? 0);\n                        if (delta !== 0) {\n                            this.rotateCell(this.state.cell, delta);\n                        }\n                    }\n                    else {\n                        this.rotateClick();\n                    }\n                }\n                else {\n                    const gridEnabled = this.graph.isGridEnabledEvent(me.getEvent());\n                    const alpha = toRadians(this.state.style.rotation ?? 0);\n                    const cos = Math.cos(-alpha);\n                    const sin = Math.sin(-alpha);\n                    let dx = point.x - this.startX;\n                    let dy = point.y - this.startY;\n                    // Rotates vector for mouse gesture\n                    const tx = cos * dx - sin * dy;\n                    const ty = sin * dx + cos * dy;\n                    dx = tx;\n                    dy = ty;\n                    const s = this.graph.view.scale;\n                    const recurse = this.isRecursiveResize(this.state, me);\n                    this.resizeCell(this.state.cell, this.roundLength(dx / s), this.roundLength(dy / s), index, gridEnabled, this.isConstrainedEvent(me), recurse);\n                }\n            });\n            me.consume();\n            this.reset();\n            this.redrawHandles();\n        }\n    }\n    /**\n     * Returns the `recursiveResize` status of the given state.\n     * @param state the given {@link CellState}. This implementation takes the value of this state.\n     * @param me the mouse event.\n     */\n    isRecursiveResize(state, me) {\n        return this.graph.isRecursiveResize(this.state);\n    }\n    /**\n     * Hook for subclasses to implement a single click on the rotation handle.\n     * This code is executed as part of the model transaction.\n     *\n     * This implementation is empty.\n     */\n    rotateClick() {\n        return;\n    }\n    /**\n     * Rotates the given cell and its children by the given angle in degrees.\n     *\n     * @param cell {@link Cell} to be rotated.\n     * @param angle Angle in degrees.\n     * @param parent if set, consider the parent in the rotation computation.\n     */\n    rotateCell(cell, angle, parent) {\n        if (angle !== 0) {\n            const model = this.graph.getDataModel();\n            if (cell.isVertex() || cell.isEdge()) {\n                if (!cell.isEdge()) {\n                    const style = this.graph.getCurrentCellStyle(cell);\n                    const total = (style.rotation ?? 0) + angle;\n                    this.graph.setCellStyles('rotation', total, [cell]);\n                }\n                let geo = cell.getGeometry();\n                if (geo && parent) {\n                    const pgeo = parent.getGeometry();\n                    if (pgeo != null && !parent.isEdge()) {\n                        geo = geo.clone();\n                        geo.rotate(angle, new Point(pgeo.width / 2, pgeo.height / 2));\n                        model.setGeometry(cell, geo);\n                    }\n                    if ((cell.isVertex() && !geo.relative) || cell.isEdge()) {\n                        // Recursive rotation\n                        const childCount = cell.getChildCount();\n                        for (let i = 0; i < childCount; i += 1) {\n                            this.rotateCell(cell.getChildAt(i), angle, cell);\n                        }\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Resets the state of this handler.\n     */\n    reset() {\n        if (this.index !== null && this.sizers[this.index].node.style.display === 'none') {\n            this.sizers[this.index].node.style.display = '';\n        }\n        this.index = null;\n        this.currentAlpha = null;\n        // TODO: Reset and redraw cell states for live preview\n        if (this.preview) {\n            this.preview.destroy();\n            this.preview = null;\n        }\n        if (this.ghostPreview) {\n            this.ghostPreview.destroy();\n            this.ghostPreview = null;\n        }\n        if (this.livePreviewActive) {\n            for (let i = 0; i < this.sizers.length; i += 1) {\n                this.sizers[i].node.style.display = '';\n            }\n            // Shows folding icon\n            if (this.state.control && this.state.control.node) {\n                this.state.control.node.style.visibility = '';\n            }\n        }\n        for (let i = 0; i < this.customHandles.length; i += 1) {\n            if (this.customHandles[i].active) {\n                this.customHandles[i].active = false;\n                this.customHandles[i].reset();\n            }\n            else {\n                this.customHandles[i].setVisible(true);\n            }\n        }\n        // Checks if handler has been destroyed\n        this.selectionBorder.node.style.display = 'inline';\n        this.selectionBounds = this.getSelectionBounds(this.state);\n        this.bounds = new Rectangle(this.selectionBounds.x, this.selectionBounds.y, this.selectionBounds.width, this.selectionBounds.height);\n        this.drawPreview();\n        this.removeHint();\n        this.redrawHandles();\n        this.edgeHandlers = [];\n        this.handlesVisible = true;\n        this.unscaledBounds = null;\n    }\n    /**\n     * Uses the given vector to change the bounds of the given cell\n     * in the graph using {@link AbstractGraph.resizeCell}.\n     */\n    resizeCell(cell, dx, dy, index, gridEnabled, constrained, recurse) {\n        let geo = cell.getGeometry();\n        if (geo) {\n            if (index === InternalEvent.LABEL_HANDLE &&\n                this.labelShape &&\n                this.labelShape.bounds) {\n                const alpha = -toRadians(this.state.style.rotation ?? 0);\n                const cos = Math.cos(alpha);\n                const sin = Math.sin(alpha);\n                const { scale } = this.graph.view;\n                const pt = getRotatedPoint(new Point(Math.round((this.labelShape.bounds.getCenterX() - this.startX) / scale), Math.round((this.labelShape.bounds.getCenterY() - this.startY) / scale)), cos, sin);\n                geo = geo.clone();\n                if (geo.offset == null) {\n                    geo.offset = pt;\n                }\n                else {\n                    geo.offset.x += pt.x;\n                    geo.offset.y += pt.y;\n                }\n                this.graph.model.setGeometry(cell, geo);\n            }\n            else if (this.unscaledBounds) {\n                const { scale } = this.graph.view;\n                if (this.childOffsetX !== 0 || this.childOffsetY !== 0) {\n                    this.moveChildren(cell, Math.round(this.childOffsetX / scale), Math.round(this.childOffsetY / scale));\n                }\n                this.graph.resizeCell(cell, this.unscaledBounds, recurse);\n            }\n        }\n    }\n    /**\n     * Moves the children of the given cell by the given vector.\n     */\n    moveChildren(cell, dx, dy) {\n        const model = this.graph.getDataModel();\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = cell.getChildAt(i);\n            let geo = child.getGeometry();\n            if (geo != null) {\n                geo = geo.clone();\n                geo.translate(dx, dy);\n                model.setGeometry(child, geo);\n            }\n        }\n    }\n    /**\n     * Returns the union of the given bounds and location for the specified\n     * handle index.\n     *\n     * To override this to limit the size of vertex via a minWidth/-Height style,\n     * the following code can be used.\n     *\n     * ```javascript\n     * const vertexHandlerUnion = union;\n     * vertexHandler.union = (bounds, dx, dy, index, gridEnabled, scale, tr, constrained) => {\n     *   const result = vertexHandlerUnion.apply(this, arguments);\n     *\n     *   result.width = Math.max(result.width, this.state.style.minWidth ?? 0));\n     *   result.height = Math.max(result.height, this.state.style.minHeight ?? 0));\n     *\n     *   return result;\n     * };\n     * ```\n     *\n     * The minWidth/-Height style can then be used as follows:\n     *\n     * ```javascript\n     * graph.insertVertex({\n     *   parent,\n     *   value: 'Hello,',\n     *   position: [20, 20],\n     *   size: [80, 30],\n     *   style: {\n     *     minWidth: 100,\n     *     minHeight: 100,\n     *   },\n     * });\n     * ```\n     *\n     * To override this to update the height for a wrapped text if the width of a vertex is\n     * changed, the following can be used.\n     *\n     * ```javascript\n     * const vertexHandlerUnion = union;\n     * vertexHandler.union = (bounds, dx, dy, index, gridEnabled, scale, tr, constrained) => {\n     *   const result = vertexHandlerUnion.apply(this, arguments);\n     *   const s = this.state;\n     *\n     *   if (this.graph.isHtmlLabel(s.cell)\n     *        && (index == 3 || index == 4)\n     *        && s.text != null && s.style.whiteSpace == 'wrap') {\n     *     const label = this.graph.getLabel(s.cell);\n     *     const fontSize = s.style.fontSize ?? constants.DEFAULT_FONTSIZE;\n     *     const ww = result.width / s.view.scale - s.text.spacingRight - s.text.spacingLeft\n     *\n     *     result.height = styleUtils.getSizeForString(label, fontSize, s.style.fontFamily, ww).height;\n     *   }\n     *\n     *   return result;\n     * };\n     * ```\n     */\n    union(bounds, dx, dy, index, gridEnabled, scale, tr, constrained, centered) {\n        gridEnabled = gridEnabled && this.graph.isGridEnabled();\n        if (this.singleSizer) {\n            let x = bounds.x + bounds.width + dx;\n            let y = bounds.y + bounds.height + dy;\n            if (gridEnabled) {\n                x = this.graph.snap(x / scale) * scale;\n                y = this.graph.snap(y / scale) * scale;\n            }\n            const rect = new Rectangle(bounds.x, bounds.y, 0, 0);\n            rect.add(new Rectangle(x, y, 0, 0));\n            return rect;\n        }\n        const w0 = bounds.width;\n        const h0 = bounds.height;\n        let left = bounds.x - tr.x * scale;\n        let right = left + w0;\n        let top = bounds.y - tr.y * scale;\n        let bottom = top + h0;\n        const cx = left + w0 / 2;\n        const cy = top + h0 / 2;\n        if (index > 4 /* Bottom Row */) {\n            bottom += dy;\n            if (gridEnabled) {\n                bottom = this.graph.snap(bottom / scale) * scale;\n            }\n            else {\n                bottom = Math.round(bottom / scale) * scale;\n            }\n        }\n        else if (index < 3 /* Top Row */) {\n            top += dy;\n            if (gridEnabled) {\n                top = this.graph.snap(top / scale) * scale;\n            }\n            else {\n                top = Math.round(top / scale) * scale;\n            }\n        }\n        if (index === 0 || index === 3 || index === 5 /* Left */) {\n            left += dx;\n            if (gridEnabled) {\n                left = this.graph.snap(left / scale) * scale;\n            }\n            else {\n                left = Math.round(left / scale) * scale;\n            }\n        }\n        else if (index === 2 || index === 4 || index === 7 /* Right */) {\n            right += dx;\n            if (gridEnabled) {\n                right = this.graph.snap(right / scale) * scale;\n            }\n            else {\n                right = Math.round(right / scale) * scale;\n            }\n        }\n        let width = right - left;\n        let height = bottom - top;\n        if (constrained) {\n            const geo = this.state.cell.getGeometry();\n            if (geo != null) {\n                const aspect = geo.width / geo.height;\n                if (index === 1 || index === 2 || index === 7 || index === 6) {\n                    width = height * aspect;\n                }\n                else {\n                    height = width / aspect;\n                }\n                if (index === 0) {\n                    left = right - width;\n                    top = bottom - height;\n                }\n            }\n        }\n        if (centered) {\n            width += width - w0;\n            height += height - h0;\n            const cdx = cx - (left + width / 2);\n            const cdy = cy - (top + height / 2);\n            left += cdx;\n            top += cdy;\n            right += cdx;\n            bottom += cdy;\n        }\n        // Flips over left side\n        if (width < 0) {\n            left += width;\n            width = Math.abs(width);\n        }\n        // Flips over top side\n        if (height < 0) {\n            top += height;\n            height = Math.abs(height);\n        }\n        const result = new Rectangle(left + tr.x * scale, top + tr.y * scale, width, height);\n        if (this.minBounds != null) {\n            result.width = Math.max(result.width, this.minBounds.x * scale +\n                this.minBounds.width * scale +\n                Math.max(0, this.x0 * scale - result.x));\n            result.height = Math.max(result.height, this.minBounds.y * scale +\n                this.minBounds.height * scale +\n                Math.max(0, this.y0 * scale - result.y));\n        }\n        return result;\n    }\n    /**\n     * Redraws the handles and the preview.\n     */\n    redraw(ignoreHandles) {\n        this.selectionBounds = this.getSelectionBounds(this.state);\n        this.bounds = new Rectangle(this.selectionBounds.x, this.selectionBounds.y, this.selectionBounds.width, this.selectionBounds.height);\n        this.drawPreview();\n        if (!ignoreHandles) {\n            this.redrawHandles();\n        }\n    }\n    /**\n     * Returns the padding to be used for drawing handles for the current <bounds>.\n     */\n    getHandlePadding() {\n        // KNOWN: Tolerance depends on event type (eg. 0 for mouse events)\n        const result = new Point(0, 0);\n        let tol = this.tolerance;\n        if (this.sizers.length > 0 &&\n            this.sizers[0].bounds &&\n            (this.bounds.width < 2 * this.sizers[0].bounds.width + 2 * tol ||\n                this.bounds.height < 2 * this.sizers[0].bounds.height + 2 * tol)) {\n            tol /= 2;\n            result.x = this.sizers[0].bounds.width + tol;\n            result.y = this.sizers[0].bounds.height + tol;\n        }\n        return result;\n    }\n    /**\n     * Returns the bounds used to paint the resize handles.\n     */\n    getSizerBounds() {\n        return this.bounds;\n    }\n    /**\n     * Redraws the handles. To hide certain handles the following code can be used.\n     *\n     * ```javascript\n     * redrawHandles()\n     * {\n     *   mxVertexHandlerRedrawHandles.apply(this, arguments);\n     *\n     *   if (this.sizers != null && this.sizers.length > 7)\n     *   {\n     *     this.sizers[1].node.style.display = 'none';\n     *     this.sizers[6].node.style.display = 'none';\n     *   }\n     * };\n     * ```\n     */\n    redrawHandles() {\n        let s = this.getSizerBounds();\n        const tol = this.tolerance;\n        this.horizontalOffset = 0;\n        this.verticalOffset = 0;\n        for (let i = 0; i < this.customHandles.length; i += 1) {\n            const shape = this.customHandles[i].shape;\n            if (shape) {\n                const temp = shape.node.style.display;\n                this.customHandles[i].redraw();\n                shape.node.style.display = temp;\n                // Hides custom handles during text editing\n                shape.node.style.visibility =\n                    this.handlesVisible && this.isCustomHandleVisible(this.customHandles[i])\n                        ? ''\n                        : 'hidden';\n            }\n        }\n        if (this.sizers.length > 0 && this.sizers[0]) {\n            if (this.index === null && this.manageSizers && this.sizers.length >= 8) {\n                // KNOWN: Tolerance depends on event type (eg. 0 for mouse events)\n                const padding = this.getHandlePadding();\n                this.horizontalOffset = padding.x;\n                this.verticalOffset = padding.y;\n                if (this.horizontalOffset !== 0 || this.verticalOffset !== 0) {\n                    s = new Rectangle(s.x, s.y, s.width, s.height);\n                    s.x -= this.horizontalOffset / 2;\n                    s.width += this.horizontalOffset;\n                    s.y -= this.verticalOffset / 2;\n                    s.height += this.verticalOffset;\n                }\n                if (this.sizers.length >= 8) {\n                    if (this.sizers[0].bounds &&\n                        (s.width < 2 * this.sizers[0].bounds.width + 2 * tol ||\n                            s.height < 2 * this.sizers[0].bounds.height + 2 * tol)) {\n                        this.sizers[0].node.style.display = 'none';\n                        this.sizers[2].node.style.display = 'none';\n                        this.sizers[5].node.style.display = 'none';\n                        this.sizers[7].node.style.display = 'none';\n                    }\n                    else if (this.handlesVisible) {\n                        this.sizers[0].node.style.display = '';\n                        this.sizers[2].node.style.display = '';\n                        this.sizers[5].node.style.display = '';\n                        this.sizers[7].node.style.display = '';\n                    }\n                }\n            }\n            const r = s.x + s.width;\n            const b = s.y + s.height;\n            if (this.singleSizer) {\n                this.moveSizerTo(this.sizers[0], r, b);\n            }\n            else {\n                const cx = s.x + s.width / 2;\n                const cy = s.y + s.height / 2;\n                if (this.sizers.length >= 8) {\n                    const crs = [\n                        'nw-resize',\n                        'n-resize',\n                        'ne-resize',\n                        'e-resize',\n                        'se-resize',\n                        's-resize',\n                        'sw-resize',\n                        'w-resize',\n                    ];\n                    const alpha = toRadians(this.state.style.rotation ?? 0);\n                    const cos = Math.cos(alpha);\n                    const sin = Math.sin(alpha);\n                    const da = Math.round((alpha * 4) / Math.PI);\n                    const ct = new Point(s.getCenterX(), s.getCenterY());\n                    let pt = getRotatedPoint(new Point(s.x, s.y), cos, sin, ct);\n                    this.moveSizerTo(this.sizers[0], pt.x, pt.y);\n                    this.sizers[0].setCursor(crs[mod(0 + da, crs.length)]);\n                    pt.x = cx;\n                    pt.y = s.y;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[1], pt.x, pt.y);\n                    this.sizers[1].setCursor(crs[mod(1 + da, crs.length)]);\n                    pt.x = r;\n                    pt.y = s.y;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[2], pt.x, pt.y);\n                    this.sizers[2].setCursor(crs[mod(2 + da, crs.length)]);\n                    pt.x = s.x;\n                    pt.y = cy;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[3], pt.x, pt.y);\n                    this.sizers[3].setCursor(crs[mod(7 + da, crs.length)]);\n                    pt.x = r;\n                    pt.y = cy;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[4], pt.x, pt.y);\n                    this.sizers[4].setCursor(crs[mod(3 + da, crs.length)]);\n                    pt.x = s.x;\n                    pt.y = b;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[5], pt.x, pt.y);\n                    this.sizers[5].setCursor(crs[mod(6 + da, crs.length)]);\n                    pt.x = cx;\n                    pt.y = b;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[6], pt.x, pt.y);\n                    this.sizers[6].setCursor(crs[mod(5 + da, crs.length)]);\n                    pt.x = r;\n                    pt.y = b;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[7], pt.x, pt.y);\n                    this.sizers[7].setCursor(crs[mod(4 + da, crs.length)]);\n                    pt.x = cx + this.state.absoluteOffset.x;\n                    pt.y = cy + this.state.absoluteOffset.y;\n                    pt = getRotatedPoint(pt, cos, sin, ct);\n                    this.moveSizerTo(this.sizers[8], pt.x, pt.y);\n                }\n                else if (this.state.width >= 2 && this.state.height >= 2) {\n                    this.moveSizerTo(this.sizers[0], cx + this.state.absoluteOffset.x, cy + this.state.absoluteOffset.y);\n                }\n                else {\n                    this.moveSizerTo(this.sizers[0], this.state.x, this.state.y);\n                }\n            }\n        }\n        if (this.rotationShape) {\n            const alpha = toRadians(this.currentAlpha ?? this.state.style.rotation ?? 0);\n            const cos = Math.cos(alpha);\n            const sin = Math.sin(alpha);\n            const ct = new Point(this.state.getCenterX(), this.state.getCenterY());\n            const pt = getRotatedPoint(this.getRotationHandlePosition(), cos, sin, ct);\n            if (this.rotationShape.node != null) {\n                this.moveSizerTo(this.rotationShape, pt.x, pt.y);\n                // Hides rotation handle during text editing\n                this.rotationShape.node.style.visibility =\n                    this.state.view.graph.isEditing() || !this.handlesVisible ? 'hidden' : '';\n            }\n        }\n        if (this.selectionBorder != null) {\n            this.selectionBorder.rotation = this.state.style.rotation ?? 0;\n        }\n        if (this.edgeHandlers != null) {\n            for (let i = 0; i < this.edgeHandlers.length; i += 1) {\n                this.edgeHandlers[i].redraw();\n            }\n        }\n    }\n    /**\n     * Returns true if the given custom handle is visible.\n     */\n    isCustomHandleVisible(handle) {\n        return !this.graph.isEditing() && this.state.view.graph.getSelectionCount() === 1;\n    }\n    /**\n     * Returns an {@link Point} that defines the rotation handle position.\n     */\n    getRotationHandlePosition() {\n        return new Point(this.bounds.x + this.bounds.width / 2, this.bounds.y + this.rotationHandleVSpacing);\n    }\n    /**\n     * Returns `true` if the parent highlight should be visible.\n     *\n     * This implementation always returns `true`.\n     */\n    isParentHighlightVisible() {\n        const parent = this.state.cell.getParent();\n        return parent ? !this.graph.isCellSelected(parent) : false;\n    }\n    /**\n     * Updates the highlight of the parent if {@link parentHighlightEnabled} is `true`.\n     */\n    updateParentHighlight() {\n        if (!this.isDestroyed()) {\n            const visible = this.isParentHighlightVisible();\n            const parent = this.state.cell.getParent();\n            const pstate = parent ? this.graph.view.getState(parent) : null;\n            if (this.parentHighlight) {\n                if (parent && parent.isVertex() && visible) {\n                    const b = this.parentHighlight.bounds;\n                    if (pstate &&\n                        b &&\n                        (b.x !== pstate.x ||\n                            b.y !== pstate.y ||\n                            b.width !== pstate.width ||\n                            b.height !== pstate.height)) {\n                        this.parentHighlight.bounds = Rectangle.fromRectangle(pstate);\n                        this.parentHighlight.redraw();\n                    }\n                }\n                else {\n                    if (pstate != null && pstate.parentHighlight === this.parentHighlight) {\n                        pstate.parentHighlight = null;\n                    }\n                    this.parentHighlight.destroy();\n                    this.parentHighlight = null;\n                }\n            }\n            else if (this.parentHighlightEnabled && visible) {\n                if (parent &&\n                    parent.isVertex() &&\n                    pstate != null &&\n                    pstate.parentHighlight == null) {\n                    this.parentHighlight = this.createParentHighlightShape(pstate);\n                    // VML dialect required here for event transparency in IE\n                    this.parentHighlight.dialect = 'svg';\n                    this.parentHighlight.pointerEvents = false;\n                    this.parentHighlight.rotation = pstate.style.rotation ?? 0;\n                    this.parentHighlight.init(this.graph.getView().getOverlayPane());\n                    this.parentHighlight.redraw();\n                    // Shows highlight once per parent\n                    pstate.parentHighlight = this.parentHighlight;\n                }\n            }\n        }\n    }\n    /**\n     * Redraws the preview.\n     */\n    drawPreview() {\n        if (this.preview != null) {\n            this.preview.bounds = this.bounds;\n            if (this.preview.node.parentNode === this.graph.container) {\n                this.preview.bounds.width = Math.max(0, this.preview.bounds.width - 1);\n                this.preview.bounds.height = Math.max(0, this.preview.bounds.height - 1);\n            }\n            this.preview.rotation = this.state.style.rotation ?? 0;\n            this.preview.redraw();\n        }\n        this.selectionBorder.bounds = this.getSelectionBorderBounds();\n        this.selectionBorder.redraw();\n        this.updateParentHighlight();\n    }\n    /**\n     * Returns the bounds for the selection border.\n     */\n    getSelectionBorderBounds() {\n        return this.bounds;\n    }\n    /**\n     * Returns `true` if this handler was destroyed or not initialized.\n     */\n    isDestroyed() {\n        return this.selectionBorder == null;\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        this.state.view.graph.removeListener(this.escapeHandler);\n        this.escapeHandler = () => {\n            return;\n        };\n        if (this.preview) {\n            this.preview.destroy();\n            this.preview = null;\n        }\n        if (this.parentHighlight) {\n            const parent = this.state.cell.getParent();\n            const pstate = parent ? this.graph.view.getState(parent) : null;\n            if (pstate && pstate.parentHighlight === this.parentHighlight) {\n                pstate.parentHighlight = null;\n            }\n            this.parentHighlight.destroy();\n            this.parentHighlight = null;\n        }\n        if (this.ghostPreview) {\n            this.ghostPreview.destroy();\n            this.ghostPreview = null;\n        }\n        if (this.selectionBorder) {\n            this.selectionBorder.destroy();\n        }\n        this.labelShape = null;\n        this.removeHint();\n        for (let i = 0; i < this.sizers.length; i += 1) {\n            this.sizers[i].destroy();\n        }\n        this.sizers = [];\n        for (let i = 0; i < this.customHandles.length; i += 1) {\n            this.customHandles[i].destroy();\n        }\n        this.customHandles = [];\n    }\n}\nexport default VertexHandler;\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { GlobalConfig } from '../util/config.js';\n/**\n * @private\n */\nexport function isI18nEnabled() {\n    return GlobalConfig.i18n.isEnabled();\n}\n/**\n * @private\n */\nexport function translate(key, params, defaultValue) {\n    return GlobalConfig.i18n.get(key, params, defaultValue);\n}\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EdgeHandler from './EdgeHandler.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Point from '../geometry/Point.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { intersects } from '../../util/mathUtils.js';\nimport { isConsumed } from '../../util/EventUtils.js';\nimport { EdgeHandlerConfig, HandleConfig } from './config.js';\nimport { isI18nEnabled, translate } from '../../internal/i18n-utils.js';\n/**\n * Graph event handler that reconnects edges and modifies control points and\n * the edge label location. Uses {@link CellMarker} for finding and\n * highlighting new source and target vertices. This handler is automatically\n * created in {@link AbstractGraph.createHandler}. It extends {@link EdgeHandler}.\n *\n * Constructor: mxEdgeHandler\n *\n * Constructs an edge handler for the specified {@link CellState}.\n *\n * @param state {@link CellState} of the cell to be modified.\n */\nclass ElbowEdgeHandler extends EdgeHandler {\n    constructor(state) {\n        super(state);\n        /**\n         * Specifies if a double click on the middle handle should call {@link AbstractGraph.flipEdge}.\n         * @default true\n         */\n        this.flipEnabled = true;\n        /**\n         * Specifies the resource key for the tooltip to be displayed on the single\n         * control point for routed edges. If the resource for this key does not\n         * exist then the value is used as the error message.\n         * @default 'doubleClickOrientation'.\n         */\n        this.doubleClickOrientationResource = isI18nEnabled() ? 'doubleClickOrientation' : '';\n    }\n    /**\n     * Overrides {@link EdgeHandler.createBends} to create custom bends.\n     */\n    createBends() {\n        const bends = [];\n        // Source\n        let bend = this.createHandleShape(0);\n        this.initBend(bend);\n        bend.setCursor(EdgeHandlerConfig.cursorTerminal);\n        bends.push(bend);\n        // Virtual\n        bends.push(this.createVirtualBend((evt) => {\n            if (!isConsumed(evt) && this.flipEnabled) {\n                this.graph.flipEdge(this.state.cell);\n                InternalEvent.consume(evt);\n            }\n        }));\n        this.points.push(new Point(0, 0));\n        // Target\n        bend = this.createHandleShape(2);\n        this.initBend(bend);\n        bend.setCursor(EdgeHandlerConfig.cursorTerminal);\n        bends.push(bend);\n        return bends;\n    }\n    /**\n     * Creates a virtual bend that supports double-clicking and calls {@link AbstractGraph.flipEdge}.\n     */\n    createVirtualBend(dblClickHandler) {\n        const bend = this.createHandleShape();\n        this.initBend(bend, dblClickHandler);\n        bend.setCursor(this.getCursorForBend());\n        if (!this.graph.isCellBendable(this.state.cell)) {\n            bend.node.style.display = 'none';\n        }\n        return bend;\n    }\n    /**\n     * Returns the cursor to be used for the bend.\n     */\n    getCursorForBend() {\n        return this.state.style.edgeStyle === 'topToBottomEdgeStyle' ||\n            (this.state.style.edgeStyle === 'elbowEdgeStyle' &&\n                this.state.style.elbow === 'vertical')\n            ? 'row-resize'\n            : 'col-resize';\n    }\n    /**\n     * Returns the tooltip for the given node.\n     */\n    getTooltipForNode(node) {\n        let tip = null;\n        if (this.bends != null &&\n            this.bends[1] != null &&\n            (node === this.bends[1].node || node.parentNode === this.bends[1].node)) {\n            tip = this.doubleClickOrientationResource;\n            tip = translate(tip) || tip;\n        }\n        return tip;\n    }\n    /**\n     * Converts the given point in-place from screen to unscaled, untranslated\n     * graph coordinates and applies the grid.\n     *\n     * @param point {@link Point} to be converted.\n     * @param gridEnabled Boolean that specifies if the grid should be applied.\n     */\n    convertPoint(point, gridEnabled) {\n        const scale = this.graph.getView().getScale();\n        const tr = this.graph.getView().getTranslate();\n        const { origin } = this.state;\n        if (gridEnabled) {\n            point.x = this.graph.snap(point.x);\n            point.y = this.graph.snap(point.y);\n        }\n        point.x = Math.round(point.x / scale - tr.x - origin.x);\n        point.y = Math.round(point.y / scale - tr.y - origin.y);\n        return point;\n    }\n    /**\n     * Updates and redraws the inner bends.\n     *\n     * @param p0 {@link Point} that represents the location of the first point.\n     * @param pe {@link Point} that represents the location of the last point.\n     */\n    redrawInnerBends(p0, pe) {\n        const g = this.state.cell.getGeometry();\n        const pts = this.state.absolutePoints;\n        let pt = null;\n        // Keeps the virtual bend on the edge shape\n        if (pts.length > 1) {\n            p0 = pts[1];\n            pe = pts[pts.length - 2];\n        }\n        else if (g.points != null && g.points.length > 0) {\n            pt = pts[0];\n        }\n        if (pt == null) {\n            pt = new Point(p0.x + (pe.x - p0.x) / 2, p0.y + (pe.y - p0.y) / 2);\n        }\n        else {\n            pt = new Point(this.graph.getView().scale *\n                (pt.x + this.graph.getView().translate.x + this.state.origin.x), this.graph.getView().scale *\n                (pt.y + this.graph.getView().translate.y + this.state.origin.y));\n        }\n        // Makes handle slightly bigger if the yellow  label handle\n        // exists and intersects this green handle\n        const b = this.bends[1].bounds;\n        let w = b.width;\n        let h = b.height;\n        let bounds = new Rectangle(Math.round(pt.x - w / 2), Math.round(pt.y - h / 2), w, h);\n        if (this.manageLabelHandle) {\n            this.checkLabelHandle(bounds);\n        }\n        else if (this.handleImage == null &&\n            this.labelShape.visible &&\n            this.labelShape.bounds &&\n            intersects(bounds, this.labelShape.bounds)) {\n            w = HandleConfig.size + 3;\n            h = w;\n            bounds = new Rectangle(Math.floor(pt.x - w / 2), Math.floor(pt.y - h / 2), w, h);\n        }\n        this.bends[1].bounds = bounds;\n        this.bends[1].redraw();\n        if (this.manageLabelHandle) {\n            this.checkLabelHandle(this.bends[1].bounds);\n        }\n    }\n}\nexport default ElbowEdgeHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../geometry/Point.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { contains } from '../../util/mathUtils.js';\nimport { setOpacity } from '../../util/styleUtils.js';\nimport ElbowEdgeHandler from './ElbowEdgeHandler.js';\nimport { EdgeHandlerConfig } from './config.js';\nclass EdgeSegmentHandler extends ElbowEdgeHandler {\n    constructor(state) {\n        super(state);\n        this.points = [];\n    }\n    /**\n     * Returns the current absolute points.\n     */\n    getCurrentPoints() {\n        let pts = this.state.absolutePoints;\n        // Special case for straight edges where we add a virtual middle handle for moving the edge\n        const tol = Math.max(1, this.graph.view.scale);\n        if ((pts.length === 2 && pts[0] && pts[1]) ||\n            (pts.length === 3 &&\n                pts[0] &&\n                pts[1] &&\n                pts[2] &&\n                ((Math.abs(pts[0].x - pts[1].x) < tol && Math.abs(pts[1].x - pts[2].x) < tol) ||\n                    (Math.abs(pts[0].y - pts[1].y) < tol && Math.abs(pts[1].y - pts[2].y) < tol)))) {\n            const cx = pts[0].x + (pts[pts.length - 1].x - pts[0].x) / 2;\n            const cy = pts[0].y + (pts[pts.length - 1].y - pts[0].y) / 2;\n            pts = [pts[0], new Point(cx, cy), new Point(cx, cy), pts[pts.length - 1]];\n        }\n        return pts;\n    }\n    /**\n     * Updates the given preview state taking into account the state of the constraint handler.\n     */\n    getPreviewPoints(point) {\n        if (this.isSource || this.isTarget) {\n            return super.getPreviewPoints(point);\n        }\n        const pts = this.getCurrentPoints();\n        let last = this.convertPoint(pts[0].clone(), false);\n        point = this.convertPoint(point.clone(), false);\n        let result = [];\n        for (let i = 1; i < pts.length; i += 1) {\n            const pt = this.convertPoint(pts[i].clone(), false);\n            if (i === this.index) {\n                if (Math.round(last.x - pt.x) === 0) {\n                    last.x = point.x;\n                    pt.x = point.x;\n                }\n                if (Math.round(last.y - pt.y) === 0) {\n                    last.y = point.y;\n                    pt.y = point.y;\n                }\n            }\n            if (i < pts.length - 1) {\n                result.push(pt);\n            }\n            last = pt;\n        }\n        // Replaces single point that intersects with source or target\n        if (result.length === 1) {\n            const source = this.state.getVisibleTerminalState(true);\n            const target = this.state.getVisibleTerminalState(false);\n            const scale = this.state.view.getScale();\n            const tr = this.state.view.getTranslate();\n            const x = result[0].x * scale + tr.x;\n            const y = result[0].y * scale + tr.y;\n            if ((source != null && contains(source, x, y)) ||\n                (target != null && contains(target, x, y))) {\n                result = [point, point];\n            }\n        }\n        return result;\n    }\n    /**\n     * Overridden to perform optimization of the edge style result.\n     */\n    updatePreviewState(edge, point, terminalState, me) {\n        super.updatePreviewState(edge, point, terminalState, me);\n        // Checks and corrects preview by running edge style again\n        if (!this.isSource && !this.isTarget) {\n            point = this.convertPoint(point.clone(), false);\n            const pts = edge.absolutePoints;\n            let pt0 = pts[0];\n            let pt1 = pts[1];\n            let result = [];\n            for (let i = 2; i < pts.length; i += 1) {\n                const pt2 = pts[i];\n                // Merges adjacent segments only if more than 2 to allow for straight edges\n                if ((Math.round(pt0.x - pt1.x) !== 0 || Math.round(pt1.x - pt2.x) !== 0) &&\n                    (Math.round(pt0.y - pt1.y) !== 0 || Math.round(pt1.y - pt2.y) !== 0)) {\n                    result.push(this.convertPoint(pt1.clone(), false));\n                }\n                pt0 = pt1;\n                pt1 = pt2;\n            }\n            const source = this.state.getVisibleTerminalState(true);\n            const target = this.state.getVisibleTerminalState(false);\n            const rpts = this.state.absolutePoints;\n            const end = pts[pts.length - 1];\n            // A straight line is represented by 3 handles\n            if (result.length === 0 &&\n                pts[0] &&\n                end &&\n                (Math.round(pts[0].x - end.x) === 0 || Math.round(pts[0].y - end.y) === 0)) {\n                result = [point, point];\n            }\n            // Handles special case of transitions from straight vertical to routed\n            else if (pts.length === 5 &&\n                result.length === 2 &&\n                source != null &&\n                target != null &&\n                rpts != null &&\n                Math.round(rpts[0].x - rpts[rpts.length - 1].x) === 0) {\n                const view = this.graph.getView();\n                const scale = view.getScale();\n                const tr = view.getTranslate();\n                let y0 = view.getRoutingCenterY(source) / scale - tr.y;\n                // Use fixed connection point y-coordinate if one exists\n                const sc = this.graph.getConnectionConstraint(edge, source, true);\n                if (sc != null) {\n                    const pt = this.graph.getConnectionPoint(source, sc);\n                    if (pt != null) {\n                        this.convertPoint(pt, false);\n                        y0 = pt.y;\n                    }\n                }\n                let ye = view.getRoutingCenterY(target) / scale - tr.y;\n                // Use fixed connection point y-coordinate if one exists\n                const tc = this.graph.getConnectionConstraint(edge, target, false);\n                if (tc) {\n                    const pt = this.graph.getConnectionPoint(target, tc);\n                    if (pt != null) {\n                        this.convertPoint(pt, false);\n                        ye = pt.y;\n                    }\n                }\n                result = [new Point(point.x, y0), new Point(point.x, ye)];\n            }\n            this.points = result;\n            // LATER: Check if points and result are different\n            edge.view.updateFixedTerminalPoints(edge, source, target);\n            edge.view.updatePoints(edge, this.points, source, target);\n            edge.view.updateFloatingTerminalPoints(edge, source, target);\n        }\n    }\n    /**\n     * Overriden to merge edge segments.\n     */\n    connect(edge, terminal, isSource, isClone, me) {\n        const model = this.graph.getDataModel();\n        let geo = edge.getGeometry();\n        let result = null;\n        // Merges adjacent edge segments\n        if (geo != null && geo.points != null && geo.points.length > 0) {\n            const pts = this.abspoints;\n            let pt0 = pts[0];\n            let pt1 = pts[1];\n            result = [];\n            for (let i = 2; i < pts.length; i += 1) {\n                const pt2 = pts[i];\n                // Merges adjacent segments only if more than 2 to allow for straight edges\n                if (pt0 &&\n                    pt1 &&\n                    pt2 &&\n                    (Math.round(pt0.x - pt1.x) !== 0 || Math.round(pt1.x - pt2.x) !== 0) &&\n                    (Math.round(pt0.y - pt1.y) !== 0 || Math.round(pt1.y - pt2.y) !== 0)) {\n                    result.push(this.convertPoint(pt1.clone(), false));\n                }\n                pt0 = pt1;\n                pt1 = pt2;\n            }\n        }\n        this.graph.batchUpdate(() => {\n            if (result != null) {\n                geo = edge.getGeometry();\n                if (geo != null) {\n                    geo = geo.clone();\n                    geo.points = result;\n                    model.setGeometry(edge, geo);\n                }\n            }\n            edge = super.connect(edge, terminal, isSource, isClone, me);\n        });\n        return edge;\n    }\n    /**\n     * Returns no tooltips.\n     */\n    getTooltipForNode(node) {\n        return null;\n    }\n    /**\n     * Adds custom bends for the center of each segment.\n     */\n    start(x, y, index) {\n        super.start(x, y, index);\n        if (this.bends != null &&\n            this.bends[index] != null &&\n            !this.isSource &&\n            !this.isTarget) {\n            setOpacity(this.bends[index].node, 100);\n        }\n    }\n    /**\n     * Adds custom bends for the center of each segment.\n     */\n    createBends() {\n        const bends = [];\n        // Source\n        let bend = this.createHandleShape(0);\n        this.initBend(bend);\n        bend.setCursor(EdgeHandlerConfig.cursorTerminal);\n        bends.push(bend);\n        const pts = this.getCurrentPoints();\n        // Waypoints (segment handles)\n        if (this.graph.isCellBendable(this.state.cell)) {\n            if (this.points == null) {\n                this.points = [];\n            }\n            for (let i = 0; i < pts.length - 1; i += 1) {\n                bend = this.createVirtualBend();\n                bends.push(bend);\n                let horizontal = Math.round(pts[i].x - pts[i + 1].x) === 0;\n                // Special case where dy is 0 as well\n                if (Math.round(pts[i].y - pts[i + 1].y) === 0 && i < pts.length - 2) {\n                    horizontal = Math.round(pts[i].x - pts[i + 2].x) === 0;\n                }\n                bend.setCursor(horizontal ? 'col-resize' : 'row-resize');\n                this.points.push(new Point(0, 0));\n            }\n        }\n        // Target\n        bend = this.createHandleShape(pts.length);\n        this.initBend(bend);\n        bend.setCursor(EdgeHandlerConfig.cursorTerminal);\n        bends.push(bend);\n        return bends;\n    }\n    /**\n     * Overridden to invoke <refresh> before the redraw.\n     */\n    redraw() {\n        this.refresh();\n        super.redraw();\n    }\n    /**\n     * Updates the position of the custom bends.\n     */\n    redrawInnerBends(p0, pe) {\n        if (this.graph.isCellBendable(this.state.cell)) {\n            const pts = this.getCurrentPoints();\n            if (pts != null && pts.length > 1) {\n                let straight = false;\n                // Puts handle in the center of straight edges\n                if (pts.length === 4 &&\n                    pts[0] &&\n                    pts[1] &&\n                    pts[2] &&\n                    pts[3] &&\n                    Math.round(pts[1].x - pts[2].x) === 0 &&\n                    Math.round(pts[1].y - pts[2].y) === 0) {\n                    straight = true;\n                    if (Math.round(pts[0].y - pts[pts.length - 1].y) === 0) {\n                        const cx = pts[0].x + (pts[pts.length - 1].x - pts[0].x) / 2;\n                        pts[1] = new Point(cx, pts[1].y);\n                        pts[2] = new Point(cx, pts[2].y);\n                    }\n                    else {\n                        const cy = pts[0].y + (pts[pts.length - 1].y - pts[0].y) / 2;\n                        pts[1] = new Point(pts[1].x, cy);\n                        pts[2] = new Point(pts[2].x, cy);\n                    }\n                }\n                for (let i = 0; i < pts.length - 1; i += 1) {\n                    if (this.bends[i + 1] != null) {\n                        p0 = pts[i];\n                        pe = pts[i + 1];\n                        const pt = new Point(p0.x + (pe.x - p0.x) / 2, p0.y + (pe.y - p0.y) / 2);\n                        const b = this.bends[i + 1].bounds;\n                        this.bends[i + 1].bounds = new Rectangle(Math.floor(pt.x - b.width / 2), Math.floor(pt.y - b.height / 2), b.width, b.height);\n                        this.bends[i + 1].redraw();\n                        if (this.manageLabelHandle) {\n                            this.checkLabelHandle(this.bends[i + 1].bounds);\n                        }\n                    }\n                }\n                if (straight) {\n                    setOpacity(this.bends[1].node, EdgeHandlerConfig.virtualBendOpacity);\n                    setOpacity(this.bends[3].node, EdgeHandlerConfig.virtualBendOpacity);\n                }\n            }\n        }\n    }\n}\nexport default EdgeSegmentHandler;\n","/*\nCopyright 2022-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport ObjectIdentity from './ObjectIdentity.js';\n/**\n * Returns all opposite vertices terminal for the given edges, only returning sources and/or targets as specified.\n * The result is returned as an array of {@link Cell}.\n *\n * @param edges Array of {Cell} that contain the edges to be examined.\n * @param {Cell} terminal  that specifies the known end of the edges.\n * @param includeSources  Boolean that specifies if source terminals should be included in the result. Default is `true`.\n * @param includeTargets  Boolean that specifies if target terminals should be included in the result. Default is `true`.\n */\nexport const getOpposites = (edges, terminal, includeSources = true, includeTargets = true) => {\n    return edges.reduce((terminals, edge) => {\n        const source = edge.getTerminal(true);\n        const target = edge.getTerminal(false);\n        // Checks if the terminal is the source of the edge and if the target should be stored in the result\n        if (source === terminal && target != null && target !== terminal && includeTargets) {\n            terminals.push(target);\n        }\n        // Checks if the terminal is the target of the edge and if the source should be stored in the result\n        else if (target === terminal &&\n            source != null &&\n            source !== terminal &&\n            includeSources) {\n            terminals.push(source);\n        }\n        return terminals;\n    }, []);\n};\n/**\n * Returns the topmost cells of the hierarchy in an array that contains no\n * descendants for each {@link Cell} that it contains. Duplicates should be\n * removed in the cells array to improve performance.\n */\nexport const getTopmostCells = (cells) => {\n    const coveredEntries = new Map();\n    const tmp = [];\n    for (let i = 0; i < cells.length; i += 1) {\n        coveredEntries.set(cells[i], true);\n    }\n    for (let i = 0; i < cells.length; i += 1) {\n        const cell = cells[i];\n        let topmost = true;\n        let parent = cell.getParent();\n        while (parent != null) {\n            if (coveredEntries.get(parent)) {\n                topmost = false;\n                break;\n            }\n            parent = parent.getParent();\n        }\n        if (topmost) {\n            tmp.push(cell);\n        }\n    }\n    return tmp;\n};\n/**\n * Returns an array that represents the set (no duplicates) of all parents\n * for the given array of cells.\n */\nexport const getParents = (cells) => {\n    const parents = [];\n    const coveredParents = new Map();\n    for (const cell of cells) {\n        const parent = cell.getParent();\n        if (parent && !coveredParents.get(parent)) {\n            coveredParents.set(parent, true);\n            parents.push(parent);\n        }\n    }\n    return parents;\n};\n/**\n * Returns a deep clone of the given {@link Cell}` (including the children) which is created using {@link cloneCells}`.\n *\n * @param cell {@link Cell} to be cloned. Default is `null`.\n * @param includeChildren Boolean indicating if the cells should be cloned with all descendants. Default is `true`.\n */\nexport const cloneCell = (cell = null, includeChildren = true) => {\n    if (!cell) {\n        return null;\n    }\n    return cloneCells([cell], includeChildren)[0];\n};\n/**\n * Returns an array of clones for the given array of {@link Cell}`.\n * Depending on the value of includeChildren, a deep clone is created for\n * each cell. Connections are restored based if the corresponding\n * cell is contained in the provided in array.\n *\n * @param cells The cells to clone\n * @param includeChildren  Boolean indicating if the cells should be cloned with all descendants.\n * @param mapping  Optional mapping for existing clones.\n */\nexport const cloneCells = (cells, includeChildren = true, mapping = {}) => {\n    const clones = [];\n    for (const cell of cells) {\n        clones.push(cloneCellImpl(cell, mapping, includeChildren));\n    }\n    for (let i = 0; i < clones.length; i += 1) {\n        if (clones[i] != null) {\n            restoreClone(clones[i], cells[i], mapping);\n        }\n    }\n    return clones;\n};\n/**\n * Inner helper method for cloning cells recursively.\n *\n * @private\n */\nconst cloneCellImpl = (cell, mapping = {}, includeChildren = false) => {\n    const identity = ObjectIdentity.get(cell);\n    let clone = mapping ? mapping[identity] : null;\n    if (clone == null) {\n        clone = cell.clone();\n        mapping[identity] = clone;\n        if (includeChildren) {\n            const childCount = cell.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                const cloneChild = cloneCellImpl(cell.getChildAt(i), mapping, true);\n                clone.insert(cloneChild);\n            }\n        }\n    }\n    return clone;\n};\n/**\n * Inner helper method for restoring the connections in a network of cloned cells.\n *\n * @private\n */\nconst restoreClone = (clone, cell, mapping) => {\n    const source = cell.getTerminal(true);\n    if (source != null) {\n        const tmp = mapping[ObjectIdentity.get(source)];\n        if (tmp != null) {\n            tmp.insertEdge(clone, true);\n        }\n    }\n    const target = cell.getTerminal(false);\n    if (target != null) {\n        const tmp = mapping[ObjectIdentity.get(target)];\n        if (tmp != null) {\n            tmp.insertEdge(clone, false);\n        }\n    }\n    const childCount = clone.getChildCount();\n    for (let i = 0; i < childCount; i += 1) {\n        restoreClone(clone.getChildAt(i), cell.getChildAt(i), mapping);\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { contains, getBoundingBox, getRotatedPoint, intersects, ptSegDistSq, toRadians, } from '../../util/mathUtils.js';\nimport { getSizeForString, setCellStyleFlags, setCellStyles, } from '../../util/styleUtils.js';\nimport { DEFAULT_FONTSIZE, DEFAULT_IMAGESIZE } from '../../util/Constants.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport Point from '../geometry/Point.js';\nimport { htmlEntities } from '../../util/StringUtils.js';\nimport { cloneCells, getTopmostCells } from '../../util/cellArrayUtils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const CellsMixin = {\n    cellsResizable: true,\n    cellsBendable: true,\n    cellsSelectable: true,\n    cellsDisconnectable: true,\n    autoSizeCells: false,\n    autoSizeCellsOnAdd: false,\n    cellsLocked: false,\n    cellsCloneable: true,\n    cellsDeletable: true,\n    cellsMovable: true,\n    extendParents: true,\n    extendParentsOnAdd: true,\n    extendParentsOnMove: false,\n    getBoundingBox(cells) {\n        let result = null;\n        if (cells.length > 0) {\n            for (const cell of cells) {\n                if (cell.isVertex() || cell.isEdge()) {\n                    const bbox = this.getView().getBoundingBox(this.getView().getState(cell), true);\n                    if (bbox) {\n                        if (!result) {\n                            result = Rectangle.fromRectangle(bbox);\n                        }\n                        else {\n                            result.add(bbox);\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    },\n    removeStateForCell(cell) {\n        for (const child of cell.getChildren()) {\n            this.removeStateForCell(child);\n        }\n        this.getView().invalidate(cell, false, true);\n        this.getView().removeState(cell);\n    },\n    /*****************************************************************************\n     * Group: Cell styles\n     *****************************************************************************/\n    getCurrentCellStyle(cell, ignoreState = false) {\n        const state = ignoreState ? null : this.getView().getState(cell);\n        return state ? state.style : this.getCellStyle(cell);\n    },\n    getCellStyle(cell) {\n        const cellStyle = cell.getStyle();\n        const stylesheet = this.getStylesheet();\n        // Gets the default style for the cell\n        const defaultStyle = cell.isEdge()\n            ? stylesheet.getDefaultEdgeStyle()\n            : stylesheet.getDefaultVertexStyle();\n        // Resolves the stylename using the above as the default\n        const style = this.postProcessCellStyle(stylesheet.getCellStyle(cellStyle, defaultStyle ?? {}));\n        return style;\n    },\n    postProcessCellStyle(style) {\n        if (!style.image) {\n            return style;\n        }\n        const key = style.image;\n        let image = this.getImageFromBundles(key);\n        if (image) {\n            style.image = image;\n        }\n        else {\n            image = key;\n        }\n        // Converts short data uris to normal data uris\n        if (image && image.substring(0, 11) === 'data:image/') {\n            if (image.substring(0, 20) === 'data:image/svg+xml,<') {\n                // Required for FF and IE11\n                image = image.substring(0, 19) + encodeURIComponent(image.substring(19));\n            }\n            else if (image.substring(0, 22) !== 'data:image/svg+xml,%3C') {\n                const comma = image.indexOf(',');\n                // Adds base64 encoding prefix if needed\n                if (comma > 0 && image.substring(comma - 7, comma + 1) !== ';base64,') {\n                    image = `${image.substring(0, comma)};base64,${image.substring(comma + 1)}`;\n                }\n            }\n            style.image = image;\n        }\n        return style;\n    },\n    setCellStyle(style, cells) {\n        cells = cells ?? this.getSelectionCells();\n        this.batchUpdate(() => {\n            for (const cell of cells) {\n                this.getDataModel().setStyle(cell, style);\n            }\n        });\n    },\n    toggleCellStyle(key, defaultValue = false, cell) {\n        cell = cell ?? this.getSelectionCell();\n        return this.toggleCellStyles(key, defaultValue, [cell]);\n    },\n    toggleCellStyles(key, defaultValue = false, cells) {\n        let value = false;\n        cells = cells ?? this.getSelectionCells();\n        if (cells.length > 0) {\n            const style = this.getCurrentCellStyle(cells[0]);\n            value = !(style[key] ?? defaultValue);\n            this.setCellStyles(key, value, cells);\n        }\n        return value;\n    },\n    setCellStyles(key, value, cells) {\n        cells = cells ?? this.getSelectionCells();\n        setCellStyles(this.getDataModel(), cells, key, value);\n    },\n    toggleCellStyleFlags(key, flag, cells) {\n        cells = cells ?? this.getSelectionCells();\n        this.setCellStyleFlags(key, flag, null, cells);\n    },\n    setCellStyleFlags(key, flag, value = null, cells) {\n        cells = cells ?? this.getSelectionCells();\n        if (cells.length > 0) {\n            if (value === null) {\n                const style = this.getCurrentCellStyle(cells[0]);\n                const current = style[key] || 0;\n                value = !((current & flag) === flag);\n            }\n            setCellStyleFlags(this.getDataModel(), cells, key, flag, value);\n        }\n    },\n    /*****************************************************************************\n     * Group: Cell alignment and orientation\n     *****************************************************************************/\n    alignCells(align, cells, param = null) {\n        cells = cells ?? this.getSelectionCells();\n        if (cells.length > 1) {\n            // Finds the required coordinate for the alignment\n            if (param === null) {\n                for (const cell of cells) {\n                    const state = this.getView().getState(cell);\n                    if (state && !cell.isEdge()) {\n                        if (param === null) {\n                            if (align === 'center') {\n                                param = state.x + state.width / 2;\n                                break;\n                            }\n                            else if (align === 'right') {\n                                param = state.x + state.width;\n                            }\n                            else if (align === 'top') {\n                                param = state.y;\n                            }\n                            else if (align === 'middle') {\n                                param = state.y + state.height / 2;\n                                break;\n                            }\n                            else if (align === 'bottom') {\n                                param = state.y + state.height;\n                            }\n                            else {\n                                param = state.x;\n                            }\n                        }\n                        else if (align === 'right') {\n                            param = Math.max(param, state.x + state.width);\n                        }\n                        else if (align === 'top') {\n                            param = Math.min(param, state.y);\n                        }\n                        else if (align === 'bottom') {\n                            param = Math.max(param, state.y + state.height);\n                        }\n                        else {\n                            param = Math.min(param, state.x);\n                        }\n                    }\n                }\n            }\n            // Aligns the cells to the coordinate\n            if (param !== null) {\n                const s = this.getView().scale;\n                this.batchUpdate(() => {\n                    const p = param;\n                    for (const cell of cells) {\n                        const state = this.getView().getState(cell);\n                        if (state != null) {\n                            let geo = cell.getGeometry();\n                            if (geo != null && !cell.isEdge()) {\n                                geo = geo.clone();\n                                if (align === 'center') {\n                                    geo.x += (p - state.x - state.width / 2) / s;\n                                }\n                                else if (align === 'right') {\n                                    geo.x += (p - state.x - state.width) / s;\n                                }\n                                else if (align === 'top') {\n                                    geo.y += (p - state.y) / s;\n                                }\n                                else if (align === 'middle') {\n                                    geo.y += (p - state.y - state.height / 2) / s;\n                                }\n                                else if (align === 'bottom') {\n                                    geo.y += (p - state.y - state.height) / s;\n                                }\n                                else {\n                                    geo.x += (p - state.x) / s;\n                                }\n                                this.resizeCell(cell, geo);\n                            }\n                        }\n                    }\n                    this.fireEvent(new EventObject(InternalEvent.ALIGN_CELLS, { align, cells }));\n                });\n            }\n        }\n        return cells;\n    },\n    /*****************************************************************************\n     * Group: Cell cloning, insertion and removal\n     *****************************************************************************/\n    cloneCell(cell, allowInvalidEdges = false, mapping = {}, keepPosition = false) {\n        return this.cloneCells([cell], allowInvalidEdges, mapping, keepPosition)[0];\n    },\n    cloneCells(cells, allowInvalidEdges = true, mapping = {}, keepPosition = false) {\n        let clones;\n        // Creates a map for fast lookups\n        const dict = new Map();\n        const tmp = [];\n        for (const cell of cells) {\n            dict.set(cell, true);\n            tmp.push(cell);\n        }\n        if (tmp.length > 0) {\n            const { scale } = this.getView();\n            const trans = this.getView().translate;\n            const out = [];\n            clones = cloneCells(cells, true, mapping);\n            for (let i = 0; i < cells.length; i += 1) {\n                const cell = cells[i];\n                const clone = clones[i];\n                if (!allowInvalidEdges &&\n                    clone.isEdge() &&\n                    this.getEdgeValidationError(clone, clone.getTerminal(true), clone.getTerminal(false)) !== null) {\n                    //clones[i] = null;\n                }\n                else {\n                    out.push(clone);\n                    const g = clone.getGeometry();\n                    if (g) {\n                        const state = this.getView().getState(cell);\n                        const parent = cell.getParent();\n                        const pstate = parent ? this.getView().getState(parent) : null;\n                        if (state && pstate) {\n                            const dx = keepPosition ? 0 : pstate.origin.x;\n                            const dy = keepPosition ? 0 : pstate.origin.y;\n                            if (clone.isEdge()) {\n                                const pts = state.absolutePoints;\n                                // Checks if the source is cloned or sets the terminal point\n                                let src = cell.getTerminal(true);\n                                while (src && !dict.get(src)) {\n                                    src = src.getParent();\n                                }\n                                if (!src && pts[0]) {\n                                    g.setTerminalPoint(new Point(pts[0].x / scale - trans.x, pts[0].y / scale - trans.y), true);\n                                }\n                                // Checks if the target is cloned or sets the terminal point\n                                let trg = cell.getTerminal(false);\n                                while (trg && !dict.get(trg)) {\n                                    trg = trg.getParent();\n                                }\n                                const n = pts.length - 1;\n                                const p = pts[n];\n                                if (!trg && p) {\n                                    g.setTerminalPoint(new Point(p.x / scale - trans.x, p.y / scale - trans.y), false);\n                                }\n                                // Translates the control points\n                                const { points } = g;\n                                if (points) {\n                                    for (const point of points) {\n                                        point.x += dx;\n                                        point.y += dy;\n                                    }\n                                }\n                            }\n                            else {\n                                g.translate(dx, dy);\n                            }\n                        }\n                    }\n                }\n            }\n            clones = out;\n        }\n        else {\n            clones = [];\n        }\n        return clones;\n    },\n    addCell(cell, parent = null, index = null, source = null, target = null) {\n        return this.addCells([cell], parent, index, source, target)[0];\n    },\n    addCells(cells, parent = null, index = null, source = null, target = null, absolute = false) {\n        const p = parent ?? this.getDefaultParent();\n        const i = index ?? p.getChildCount();\n        this.batchUpdate(() => {\n            this.cellsAdded(cells, p, i, source, target, absolute, true);\n            this.fireEvent(new EventObject(InternalEvent.ADD_CELLS, { cells, p, i, source, target }));\n        });\n        return cells;\n    },\n    cellsAdded(cells, parent, index, source = null, target = null, absolute = false, constrain = false, extend = true) {\n        this.batchUpdate(() => {\n            const parentState = absolute ? this.getView().getState(parent) : null;\n            const o1 = parentState ? parentState.origin : null;\n            const zero = new Point(0, 0);\n            cells.forEach((cell, i) => {\n                /* Can cells include null values?\n                if (cell == null) {\n                  index--;\n                } else {\n                */\n                const previous = cell.getParent();\n                // Keeps the cell at its absolute location\n                if (o1 && cell !== parent && parent !== previous) {\n                    const oldState = previous ? this.getView().getState(previous) : null;\n                    const o2 = oldState ? oldState.origin : zero;\n                    let geo = cell.getGeometry();\n                    if (geo) {\n                        const dx = o2.x - o1.x;\n                        const dy = o2.y - o1.y;\n                        // FIXME: Cells should always be inserted first before any other edit\n                        // to avoid forward references in sessions.\n                        geo = geo.clone();\n                        geo.translate(dx, dy);\n                        if (!geo.relative && cell.isVertex() && !this.isAllowNegativeCoordinates()) {\n                            geo.x = Math.max(0, geo.x);\n                            geo.y = Math.max(0, geo.y);\n                        }\n                        this.getDataModel().setGeometry(cell, geo);\n                    }\n                }\n                // Decrements all following indices\n                // if cell is already in parent\n                if (parent === previous && index + i > parent.getChildCount()) {\n                    index--;\n                }\n                this.getDataModel().add(parent, cell, index + i);\n                if (this.autoSizeCellsOnAdd) {\n                    this.autoSizeCell(cell, true);\n                }\n                // Extends the parent or constrains the child\n                if ((!extend || extend) &&\n                    this.isExtendParentsOnAdd(cell) &&\n                    this.isExtendParent(cell)) {\n                    this.extendParent(cell);\n                }\n                // Additionally constrains the child after extending the parent\n                if (!constrain || constrain) {\n                    this.constrainChild(cell);\n                }\n                // Sets the source terminal\n                if (source) {\n                    this.cellConnected(cell, source, true);\n                }\n                // Sets the target terminal\n                if (target) {\n                    this.cellConnected(cell, target, false);\n                }\n                /*}*/\n            });\n            this.fireEvent(new EventObject(InternalEvent.CELLS_ADDED, {\n                cells,\n                parent,\n                index,\n                source,\n                target,\n                absolute,\n            }));\n        });\n    },\n    autoSizeCell(cell, recurse = true) {\n        if (recurse) {\n            for (const child of cell.getChildren()) {\n                this.autoSizeCell(child);\n            }\n        }\n        if (cell.isVertex() && this.isAutoSizeCell(cell)) {\n            this.updateCellSize(cell);\n        }\n    },\n    removeCells(cells = null, includeEdges = true) {\n        if (!cells) {\n            cells = this.getDeletableCells(this.getSelectionCells());\n        }\n        // Adds all edges to the cells\n        if (includeEdges) {\n            // FIXME: Remove duplicate cells in result or do not add if\n            // in cells or descendant of cells\n            cells = this.getDeletableCells(this.addAllEdges(cells));\n        }\n        else {\n            cells = cells.slice();\n            // Removes edges that are currently not\n            // visible as those cannot be updated\n            const edges = this.getDeletableCells(this.getAllEdges(cells));\n            const dict = new Map();\n            for (const cell of cells) {\n                dict.set(cell, true);\n            }\n            for (const edge of edges) {\n                if (!this.getView().getState(edge) && !dict.get(edge)) {\n                    dict.set(edge, true);\n                    cells.push(edge);\n                }\n            }\n        }\n        this.batchUpdate(() => {\n            this.cellsRemoved(cells);\n            this.fireEvent(new EventObject(InternalEvent.REMOVE_CELLS, { cells, includeEdges }));\n        });\n        return cells ?? [];\n    },\n    cellsRemoved(cells) {\n        if (cells.length > 0) {\n            const { scale } = this.getView();\n            const tr = this.getView().translate;\n            this.batchUpdate(() => {\n                // Creates hashtable for faster lookup\n                const dict = new Map();\n                for (const cell of cells) {\n                    dict.set(cell, true);\n                }\n                for (const cell of cells) {\n                    // Disconnects edges which are not being removed\n                    const edges = this.getAllEdges([cell]);\n                    const disconnectTerminal = (edge, source) => {\n                        let geo = edge.getGeometry();\n                        if (geo) {\n                            // Checks if terminal is being removed\n                            const terminal = edge.getTerminal(source);\n                            let connected = false;\n                            let tmp = terminal;\n                            while (tmp) {\n                                if (cell === tmp) {\n                                    connected = true;\n                                    break;\n                                }\n                                tmp = tmp.getParent();\n                            }\n                            if (connected) {\n                                geo = geo.clone();\n                                const state = this.getView().getState(edge);\n                                if (state) {\n                                    const pts = state.absolutePoints;\n                                    const n = source ? 0 : pts.length - 1;\n                                    const p = pts[n];\n                                    geo.setTerminalPoint(new Point(p.x / scale - tr.x - state.origin.x, p.y / scale - tr.y - state.origin.y), source);\n                                }\n                                else if (terminal) {\n                                    // Fallback to center of terminal if routing\n                                    // points are not available to add new point\n                                    // KNOWN: Should recurse to find parent offset\n                                    // of edge for nested groups but invisible edges\n                                    // should be removed in removeCells step\n                                    const tstate = this.getView().getState(terminal);\n                                    if (tstate) {\n                                        geo.setTerminalPoint(new Point(tstate.getCenterX() / scale - tr.x, tstate.getCenterY() / scale - tr.y), source);\n                                    }\n                                }\n                                this.getDataModel().setGeometry(edge, geo);\n                                this.getDataModel().setTerminal(edge, null, source);\n                            }\n                        }\n                    };\n                    for (const edge of edges) {\n                        if (!dict.get(edge)) {\n                            dict.set(edge, true);\n                            disconnectTerminal(edge, true);\n                            disconnectTerminal(edge, false);\n                        }\n                    }\n                    this.getDataModel().remove(cell);\n                }\n                this.fireEvent(new EventObject(InternalEvent.CELLS_REMOVED, { cells }));\n            });\n        }\n    },\n    /*****************************************************************************\n     * Group: Cell visibility\n     *****************************************************************************/\n    toggleCells(show = false, cells, includeEdges = true) {\n        cells = cells ?? this.getSelectionCells();\n        // Adds all connected edges recursively\n        if (includeEdges) {\n            cells = this.addAllEdges(cells);\n        }\n        this.batchUpdate(() => {\n            this.cellsToggled(cells, show);\n            this.fireEvent(new EventObject(InternalEvent.TOGGLE_CELLS, { show, cells, includeEdges }));\n        });\n        return cells;\n    },\n    cellsToggled(cells, show = false) {\n        if (cells.length > 0) {\n            this.batchUpdate(() => {\n                for (const cell of cells) {\n                    this.getDataModel().setVisible(cell, show);\n                }\n            });\n        }\n    },\n    /*****************************************************************************\n     * Group: Cell sizing\n     *****************************************************************************/\n    updateCellSize(cell, ignoreChildren = false) {\n        this.batchUpdate(() => {\n            this.cellSizeUpdated(cell, ignoreChildren);\n            this.fireEvent(new EventObject(InternalEvent.UPDATE_CELL_SIZE, { cell, ignoreChildren }));\n        });\n        return cell;\n    },\n    cellSizeUpdated(cell, ignoreChildren = false) {\n        this.batchUpdate(() => {\n            const size = this.getPreferredSizeForCell(cell);\n            let geo = cell.getGeometry();\n            if (size && geo) {\n                const collapsed = cell.isCollapsed();\n                geo = geo.clone();\n                if (this.isSwimlane(cell)) {\n                    const style = this.getCellStyle(cell);\n                    const cellStyle = cell.getStyle();\n                    if (style.horizontal ?? true) {\n                        cellStyle.startSize = size.height + 8;\n                        if (collapsed) {\n                            geo.height = size.height + 8;\n                        }\n                        geo.width = size.width;\n                    }\n                    else {\n                        cellStyle.startSize = size.width + 8;\n                        if (collapsed) {\n                            geo.width = size.width + 8;\n                        }\n                        geo.height = size.height;\n                    }\n                    this.getDataModel().setStyle(cell, cellStyle);\n                }\n                else {\n                    const state = this.getView().createState(cell);\n                    const align = state.style.align ?? 'center';\n                    if (align === 'right') {\n                        geo.x += geo.width - size.width;\n                    }\n                    else if (align === 'center') {\n                        geo.x += Math.round((geo.width - size.width) / 2);\n                    }\n                    const valign = state.getVerticalAlign();\n                    if (valign === 'bottom') {\n                        geo.y += geo.height - size.height;\n                    }\n                    else if (valign === 'middle') {\n                        geo.y += Math.round((geo.height - size.height) / 2);\n                    }\n                    geo.width = size.width;\n                    geo.height = size.height;\n                }\n                if (!ignoreChildren && !collapsed) {\n                    const bounds = this.getView().getBounds(cell.getChildren());\n                    if (bounds != null) {\n                        const tr = this.getView().translate;\n                        const { scale } = this.getView();\n                        const width = (bounds.x + bounds.width) / scale - geo.x - tr.x;\n                        const height = (bounds.y + bounds.height) / scale - geo.y - tr.y;\n                        geo.width = Math.max(geo.width, width);\n                        geo.height = Math.max(geo.height, height);\n                    }\n                }\n                this.cellsResized([cell], [geo], false);\n            }\n        });\n    },\n    getPreferredSizeForCell(cell, textWidth = null) {\n        let result = null;\n        const state = this.getView().createState(cell);\n        const { style } = state;\n        if (!cell.isEdge()) {\n            const fontSize = style.fontSize || DEFAULT_FONTSIZE;\n            let dx = 0;\n            let dy = 0;\n            // Adds dimension of image if shape is a label\n            if (state.getImageSrc() || style.image) {\n                if (style.shape === 'label') {\n                    if (style.verticalAlign === 'middle') {\n                        dx += style.imageWidth || DEFAULT_IMAGESIZE;\n                    }\n                    if (style.align !== 'center') {\n                        dy += style.imageHeight || DEFAULT_IMAGESIZE;\n                    }\n                }\n            }\n            // Adds spacings\n            dx += 2 * (style.spacing || 0);\n            dx += style.spacingLeft || 0;\n            dx += style.spacingRight || 0;\n            dy += 2 * (style.spacing || 0);\n            dy += style.spacingTop || 0;\n            dy += style.spacingBottom || 0;\n            // Add spacing for collapse/expand icon\n            // LATER: Check alignment and use constants\n            // for image spacing\n            const image = this.getFoldingImage(state);\n            if (image) {\n                dx += image.width + 8;\n            }\n            // Adds space for label\n            let value = this.getCellRenderer().getLabelValue(state);\n            if (value && value.length > 0) {\n                if (!this.isHtmlLabel(state.cell)) {\n                    value = htmlEntities(value, false);\n                }\n                value = value.replace(/\\n/g, '<br>');\n                const size = getSizeForString(value, fontSize, style.fontFamily, textWidth, style.fontStyle);\n                let width = size.width + dx;\n                let height = size.height + dy;\n                if (!(style.horizontal ?? true)) {\n                    const tmp = height;\n                    height = width;\n                    width = tmp;\n                }\n                if (this.isGridEnabled()) {\n                    width = this.snap(width + this.getGridSize() / 2);\n                    height = this.snap(height + this.getGridSize() / 2);\n                }\n                result = new Rectangle(0, 0, width, height);\n            }\n            else {\n                const gs2 = 4 * this.getGridSize();\n                result = new Rectangle(0, 0, gs2, gs2);\n            }\n        }\n        return result;\n    },\n    resizeCell(cell, bounds, recurse = false) {\n        return this.resizeCells([cell], [bounds], recurse)[0];\n    },\n    resizeCells(cells, bounds, recurse) {\n        recurse = recurse ?? this.isRecursiveResize();\n        this.batchUpdate(() => {\n            const prev = this.cellsResized(cells, bounds, recurse);\n            this.fireEvent(new EventObject(InternalEvent.RESIZE_CELLS, { cells, bounds, prev }));\n        });\n        return cells;\n    },\n    cellsResized(cells, bounds, recurse = false) {\n        const prev = [];\n        if (cells.length === bounds.length) {\n            this.batchUpdate(() => {\n                cells.forEach((cell, i) => {\n                    prev.push(this.cellResized(cell, bounds[i], false, recurse));\n                    if (this.isExtendParent(cell)) {\n                        this.extendParent(cell);\n                    }\n                    this.constrainChild(cell);\n                });\n                if (this.isResetEdgesOnResize()) {\n                    this.resetEdges(cells);\n                }\n                this.fireEvent(new EventObject(InternalEvent.CELLS_RESIZED, { cells, bounds, prev }));\n            });\n        }\n        return prev;\n    },\n    cellResized(cell, bounds, ignoreRelative = false, recurse = false) {\n        const prev = cell.getGeometry();\n        if (prev &&\n            (prev.x !== bounds.x ||\n                prev.y !== bounds.y ||\n                prev.width !== bounds.width ||\n                prev.height !== bounds.height)) {\n            const geo = prev.clone();\n            if (!ignoreRelative && geo.relative) {\n                const { offset } = geo;\n                if (offset) {\n                    offset.x += bounds.x - geo.x;\n                    offset.y += bounds.y - geo.y;\n                }\n            }\n            else {\n                geo.x = bounds.x;\n                geo.y = bounds.y;\n            }\n            geo.width = bounds.width;\n            geo.height = bounds.height;\n            if (!geo.relative && cell.isVertex() && !this.isAllowNegativeCoordinates()) {\n                geo.x = Math.max(0, geo.x);\n                geo.y = Math.max(0, geo.y);\n            }\n            this.batchUpdate(() => {\n                if (recurse) {\n                    this.resizeChildCells(cell, geo);\n                }\n                this.getDataModel().setGeometry(cell, geo);\n                this.constrainChildCells(cell);\n            });\n        }\n        return prev;\n    },\n    resizeChildCells(cell, newGeo) {\n        const geo = cell.getGeometry();\n        if (geo) {\n            const dx = geo.width !== 0 ? newGeo.width / geo.width : 1;\n            const dy = geo.height !== 0 ? newGeo.height / geo.height : 1;\n            for (const child of cell.getChildren()) {\n                this.scaleCell(child, dx, dy, true);\n            }\n        }\n    },\n    constrainChildCells(cell) {\n        for (const child of cell.getChildren()) {\n            this.constrainChild(child);\n        }\n    },\n    scaleCell(cell, dx, dy, recurse = false) {\n        let geo = cell.getGeometry();\n        if (geo) {\n            const style = this.getCurrentCellStyle(cell);\n            geo = geo.clone();\n            // Stores values for restoring based on style\n            const { x } = geo;\n            const { y } = geo;\n            const w = geo.width;\n            const h = geo.height;\n            geo.scale(dx, dy, style.aspect === 'fixed');\n            if (style.resizeWidth) {\n                geo.width = w * dx;\n            }\n            else if (!style.resizeWidth) {\n                geo.width = w;\n            }\n            if (style.resizeHeight) {\n                geo.height = h * dy;\n            }\n            else if (!style.resizeHeight) {\n                geo.height = h;\n            }\n            if (!this.isCellMovable(cell)) {\n                geo.x = x;\n                geo.y = y;\n            }\n            if (!this.isCellResizable(cell)) {\n                geo.width = w;\n                geo.height = h;\n            }\n            if (cell.isVertex()) {\n                this.cellResized(cell, geo, true, recurse);\n            }\n            else {\n                this.getDataModel().setGeometry(cell, geo);\n            }\n        }\n    },\n    extendParent(cell) {\n        const parent = cell.getParent();\n        let p = parent ? parent.getGeometry() : null;\n        if (parent && p && !parent.isCollapsed()) {\n            const geo = cell.getGeometry();\n            if (geo &&\n                !geo.relative &&\n                (p.width < geo.x + geo.width || p.height < geo.y + geo.height)) {\n                p = p.clone();\n                p.width = Math.max(p.width, geo.x + geo.width);\n                p.height = Math.max(p.height, geo.y + geo.height);\n                this.cellsResized([parent], [p], false);\n            }\n        }\n    },\n    // *************************************************************************************\n    // Group: Cell moving\n    // *************************************************************************************\n    importCells(cells, dx, dy, target = null, evt = null, mapping = {}) {\n        return this.moveCells(cells, dx, dy, true, target, evt, mapping);\n    },\n    moveCells(cells, dx = 0, dy = 0, clone = false, target = null, evt = null, mapping = {}) {\n        if (dx !== 0 || dy !== 0 || clone || target) {\n            // Removes descendants with ancestors in cells to avoid multiple moving\n            cells = getTopmostCells(cells);\n            const origCells = cells;\n            this.batchUpdate(() => {\n                // Faster cell lookups to remove relative edge labels with selected\n                // terminals to avoid explicit and implicit move at same time\n                const dict = new Map();\n                for (const cell of cells) {\n                    dict.set(cell, true);\n                }\n                const isSelected = (cell) => {\n                    while (cell) {\n                        if (dict.get(cell)) {\n                            return true;\n                        }\n                        cell = cell.getParent();\n                    }\n                    return false;\n                };\n                // Removes relative edge labels with selected terminals\n                const checked = [];\n                for (const cell of cells) {\n                    const geo = cell.getGeometry();\n                    const parent = cell.getParent();\n                    if (!geo ||\n                        !geo.relative ||\n                        (parent && !parent.isEdge()) ||\n                        (parent &&\n                            !isSelected(parent.getTerminal(true)) &&\n                            !isSelected(parent.getTerminal(false)))) {\n                        checked.push(cell);\n                    }\n                }\n                cells = checked;\n                if (clone) {\n                    cells = this.cloneCells(cells, this.isCloneInvalidEdges(), mapping);\n                    if (!target) {\n                        target = this.getDefaultParent();\n                    }\n                }\n                // FIXME: Cells should always be inserted first before any other edit\n                // to avoid forward references in sessions.\n                // Need to disable allowNegativeCoordinates if target not null to\n                // allow for temporary negative numbers until cellsAdded is called.\n                const previous = this.isAllowNegativeCoordinates();\n                if (target) {\n                    this.setAllowNegativeCoordinates(true);\n                }\n                this.cellsMoved(cells, dx, dy, !clone && this.isDisconnectOnMove() && this.isAllowDanglingEdges(), !target, this.isExtendParentsOnMove() && !target);\n                this.setAllowNegativeCoordinates(previous);\n                if (target) {\n                    const index = target.getChildCount();\n                    this.cellsAdded(cells, target, index, null, null, true);\n                    // Restores parent edge on cloned edge labels\n                    if (clone) {\n                        cells.forEach((cell, i) => {\n                            const geo = cell.getGeometry();\n                            const parent = origCells[i].getParent();\n                            if (geo &&\n                                geo.relative &&\n                                parent &&\n                                parent.isEdge() &&\n                                this.getDataModel().contains(parent)) {\n                                this.getDataModel().add(parent, cell);\n                            }\n                        });\n                    }\n                }\n                // Dispatches a move event\n                this.fireEvent(new EventObject(InternalEvent.MOVE_CELLS, {\n                    cells,\n                    dx,\n                    dy,\n                    clone,\n                    target,\n                    event: evt,\n                }));\n            });\n        }\n        return cells;\n    },\n    cellsMoved(cells, dx, dy, disconnect = false, constrain = false, extend = false) {\n        if (dx !== 0 || dy !== 0) {\n            this.batchUpdate(() => {\n                if (disconnect) {\n                    this.disconnectGraph(cells);\n                }\n                for (const cell of cells) {\n                    this.translateCell(cell, dx, dy);\n                    if (extend && this.isExtendParent(cell)) {\n                        this.extendParent(cell);\n                    }\n                    else if (constrain) {\n                        this.constrainChild(cell);\n                    }\n                }\n                if (this.isResetEdgesOnMove()) {\n                    this.resetEdges(cells);\n                }\n                this.fireEvent(new EventObject(InternalEvent.CELLS_MOVED, { cells, dx, dy, disconnect }));\n            });\n        }\n    },\n    translateCell(cell, dx, dy) {\n        let geometry = cell.getGeometry();\n        if (geometry) {\n            geometry = geometry.clone();\n            geometry.translate(dx, dy);\n            if (!geometry.relative && cell.isVertex() && !this.isAllowNegativeCoordinates()) {\n                geometry.x = Math.max(0, geometry.x);\n                geometry.y = Math.max(0, geometry.y);\n            }\n            if (geometry.relative && !cell.isEdge()) {\n                const parent = cell.getParent();\n                let angle = 0;\n                if (parent.isVertex()) {\n                    const style = this.getCurrentCellStyle(parent);\n                    angle = style.rotation ?? 0;\n                }\n                if (angle !== 0) {\n                    const rad = toRadians(-angle);\n                    const cos = Math.cos(rad);\n                    const sin = Math.sin(rad);\n                    const pt = getRotatedPoint(new Point(dx, dy), cos, sin, new Point(0, 0));\n                    dx = pt.x;\n                    dy = pt.y;\n                }\n                if (!geometry.offset) {\n                    geometry.offset = new Point(dx, dy);\n                }\n                else {\n                    geometry.offset.x = geometry.offset.x + dx;\n                    geometry.offset.y = geometry.offset.y + dy;\n                }\n            }\n            this.getDataModel().setGeometry(cell, geometry);\n        }\n    },\n    getCellContainmentArea(cell) {\n        if (!cell.isEdge()) {\n            const parent = cell.getParent();\n            if (parent && parent !== this.getDefaultParent()) {\n                const g = parent.getGeometry();\n                if (g) {\n                    let x = 0;\n                    let y = 0;\n                    let w = g.width;\n                    let h = g.height;\n                    if (this.isSwimlane(parent)) {\n                        const size = this.getStartSize(parent);\n                        const style = this.getCurrentCellStyle(parent);\n                        const dir = style.direction ?? 'east';\n                        const flipH = style.flipH ?? false;\n                        const flipV = style.flipV ?? false;\n                        if (dir === 'south' || dir === 'north') {\n                            const tmp = size.width;\n                            size.width = size.height;\n                            size.height = tmp;\n                        }\n                        if ((dir === 'east' && !flipV) ||\n                            (dir === 'north' && !flipH) ||\n                            (dir === 'west' && flipV) ||\n                            (dir === 'south' && flipH)) {\n                            x = size.width;\n                            y = size.height;\n                        }\n                        w -= size.width;\n                        h -= size.height;\n                    }\n                    return new Rectangle(x, y, w, h);\n                }\n            }\n        }\n        return null;\n    },\n    constrainChild(cell, sizeFirst = true) {\n        let geo = cell.getGeometry();\n        if (geo && (this.isConstrainRelativeChildren() || !geo.relative)) {\n            const parent = cell.getParent();\n            let max = this.getMaximumGraphBounds();\n            // Finds parent offset\n            if (max && parent) {\n                const off = this.getBoundingBoxFromGeometry([parent], false);\n                if (off) {\n                    max = Rectangle.fromRectangle(max);\n                    max.x -= off.x;\n                    max.y -= off.y;\n                }\n            }\n            if (this.isConstrainChild(cell)) {\n                let tmp = this.getCellContainmentArea(cell);\n                if (tmp) {\n                    const overlap = this.getOverlap(cell);\n                    if (overlap > 0) {\n                        tmp = Rectangle.fromRectangle(tmp);\n                        tmp.x -= tmp.width * overlap;\n                        tmp.y -= tmp.height * overlap;\n                        tmp.width += 2 * tmp.width * overlap;\n                        tmp.height += 2 * tmp.height * overlap;\n                    }\n                    // Find the intersection between max and tmp\n                    if (!max) {\n                        max = tmp;\n                    }\n                    else {\n                        max = Rectangle.fromRectangle(max);\n                        max.intersect(tmp);\n                    }\n                }\n            }\n            if (max) {\n                const cells = [cell];\n                if (!cell.isCollapsed()) {\n                    const desc = cell.getDescendants();\n                    for (const descItem of desc) {\n                        if (descItem.isVisible()) {\n                            cells.push(descItem);\n                        }\n                    }\n                }\n                const bbox = this.getBoundingBoxFromGeometry(cells, false);\n                if (bbox) {\n                    geo = geo.clone();\n                    // Cumulative horizontal movement\n                    let dx = 0;\n                    if (geo.width > max.width) {\n                        dx = geo.width - max.width;\n                        geo.width -= dx;\n                    }\n                    if (bbox.x + bbox.width > max.x + max.width) {\n                        dx -= bbox.x + bbox.width - max.x - max.width - dx;\n                    }\n                    // Cumulative vertical movement\n                    let dy = 0;\n                    if (geo.height > max.height) {\n                        dy = geo.height - max.height;\n                        geo.height -= dy;\n                    }\n                    if (bbox.y + bbox.height > max.y + max.height) {\n                        dy -= bbox.y + bbox.height - max.y - max.height - dy;\n                    }\n                    if (bbox.x < max.x) {\n                        dx -= bbox.x - max.x;\n                    }\n                    if (bbox.y < max.y) {\n                        dy -= bbox.y - max.y;\n                    }\n                    if (dx !== 0 || dy !== 0) {\n                        if (geo.relative) {\n                            // Relative geometries are moved via absolute offset\n                            if (!geo.offset) {\n                                geo.offset = new Point();\n                            }\n                            geo.offset.x += dx;\n                            geo.offset.y += dy;\n                        }\n                        else {\n                            geo.x += dx;\n                            geo.y += dy;\n                        }\n                    }\n                    this.getDataModel().setGeometry(cell, geo);\n                }\n            }\n        }\n    },\n    /*****************************************************************************\n     * Group: Cell retrieval\n     *****************************************************************************/\n    getChildCells(parent, vertices = false, edges = false) {\n        parent = parent ?? this.getDefaultParent();\n        const cells = parent.getChildCells(vertices, edges);\n        const result = [];\n        // Filters out the non-visible child cells\n        for (const cell of cells) {\n            if (cell.isVisible()) {\n                result.push(cell);\n            }\n        }\n        return result;\n    },\n    getCellAt(x, y, parent = null, vertices = true, edges = true, ignoreFn = null) {\n        if (!parent) {\n            parent = this.getCurrentRoot();\n            if (!parent) {\n                parent = this.getDataModel().getRoot();\n            }\n        }\n        if (parent) {\n            const childCount = parent.getChildCount();\n            for (let i = childCount - 1; i >= 0; i--) {\n                const cell = parent.getChildAt(i);\n                const result = this.getCellAt(x, y, cell, vertices, edges, ignoreFn);\n                if (result) {\n                    return result;\n                }\n                if (cell.isVisible() &&\n                    ((edges && cell.isEdge()) || (vertices && cell.isVertex()))) {\n                    const state = this.getView().getState(cell);\n                    if (state &&\n                        (!ignoreFn || !ignoreFn(state, x, y)) &&\n                        this.intersects(state, x, y)) {\n                        return cell;\n                    }\n                }\n            }\n        }\n        return null;\n    },\n    getCells(x, y, width, height, parent = null, result = [], intersection = null, ignoreFn = null, includeDescendants = false) {\n        if (width > 0 || height > 0 || intersection) {\n            const model = this.getDataModel();\n            const right = x + width;\n            const bottom = y + height;\n            if (!parent) {\n                parent = this.getCurrentRoot();\n                if (!parent) {\n                    parent = model.getRoot();\n                }\n            }\n            if (parent) {\n                for (const cell of parent.getChildren()) {\n                    const state = this.getView().getState(cell);\n                    if (state && cell.isVisible() && (!ignoreFn || !ignoreFn(state))) {\n                        const deg = state.style.rotation ?? 0;\n                        let box = state; // TODO: CHECK ME!!!! ==========================================================\n                        if (deg !== 0) {\n                            box = getBoundingBox(box, deg);\n                        }\n                        const hit = (intersection && cell.isVertex() && intersects(intersection, box)) ||\n                            (!intersection &&\n                                (cell.isEdge() || cell.isVertex()) &&\n                                box.x >= x &&\n                                box.y + box.height <= bottom &&\n                                box.y >= y &&\n                                box.x + box.width <= right);\n                        if (hit) {\n                            result.push(cell);\n                        }\n                        if (!hit || includeDescendants) {\n                            this.getCells(x, y, width, height, cell, result, intersection, ignoreFn, includeDescendants);\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    },\n    getCellsBeyond(x0, y0, parent = null, rightHalfpane = false, bottomHalfpane = false) {\n        const result = [];\n        if (rightHalfpane || bottomHalfpane) {\n            if (!parent) {\n                parent = this.getDefaultParent();\n            }\n            if (parent) {\n                for (const child of parent.getChildren()) {\n                    const state = this.getView().getState(child);\n                    if (child.isVisible() && state) {\n                        if ((!rightHalfpane || state.x >= x0) && (!bottomHalfpane || state.y >= y0)) {\n                            result.push(child);\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    },\n    intersects(state, x, y) {\n        const pts = state.absolutePoints;\n        if (pts.length > 0) {\n            const t2 = this.getEventTolerance() * this.getEventTolerance();\n            let pt = pts[0];\n            for (let i = 1; i < pts.length; i += 1) {\n                const next = pts[i];\n                if (pt && next) {\n                    const dist = ptSegDistSq(pt.x, pt.y, next.x, next.y, x, y);\n                    if (dist <= t2) {\n                        return true;\n                    }\n                }\n                pt = next;\n            }\n        }\n        else {\n            const alpha = toRadians(state.style.rotation ?? 0);\n            if (alpha !== 0) {\n                const cos = Math.cos(-alpha);\n                const sin = Math.sin(-alpha);\n                const cx = new Point(state.getCenterX(), state.getCenterY());\n                const pt = getRotatedPoint(new Point(x, y), cos, sin, cx);\n                x = pt.x;\n                y = pt.y;\n            }\n            if (contains(state, x, y)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    isValidAncestor(cell, parent, recurse = false) {\n        return recurse ? parent.isAncestor(cell) : cell?.getParent() === parent;\n    },\n    /*****************************************************************************\n     * Group: Graph behaviour\n     *****************************************************************************/\n    isCellLocked(cell) {\n        const geometry = cell.getGeometry();\n        return this.isCellsLocked() || (!!geometry && cell.isVertex() && geometry.relative);\n    },\n    isCellsLocked() {\n        return this.cellsLocked;\n    },\n    setCellsLocked(value) {\n        this.cellsLocked = value;\n    },\n    getCloneableCells(cells) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.isCellCloneable(cell);\n        });\n    },\n    isCellCloneable(cell) {\n        return this.isCellsCloneable() && (this.getCurrentCellStyle(cell).cloneable ?? true);\n    },\n    isCellsCloneable() {\n        return this.cellsCloneable;\n    },\n    setCellsCloneable(value) {\n        this.cellsCloneable = value;\n    },\n    getExportableCells(cells) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.canExportCell(cell);\n        });\n    },\n    canExportCell(_cell = null) {\n        return this.isExportEnabled();\n    },\n    getImportableCells(cells) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.canImportCell(cell);\n        });\n    },\n    canImportCell(cell = null) {\n        return this.isImportEnabled();\n    },\n    isCellSelectable(_cell) {\n        return this.isCellsSelectable();\n    },\n    isCellsSelectable() {\n        return this.cellsSelectable;\n    },\n    setCellsSelectable(value) {\n        this.cellsSelectable = value;\n    },\n    getDeletableCells(cells) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.isCellDeletable(cell);\n        });\n    },\n    isCellDeletable(cell) {\n        return this.isCellsDeletable() && (this.getCurrentCellStyle(cell).deletable ?? true);\n    },\n    isCellsDeletable() {\n        return this.cellsDeletable;\n    },\n    setCellsDeletable(value) {\n        this.cellsDeletable = value;\n    },\n    isCellRotatable(cell) {\n        return this.getCurrentCellStyle(cell).rotatable ?? true;\n    },\n    getMovableCells(cells) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.isCellMovable(cell);\n        });\n    },\n    isCellMovable(cell) {\n        return (this.isCellsMovable() &&\n            !this.isCellLocked(cell) &&\n            (this.getCurrentCellStyle(cell).movable ?? true));\n    },\n    isCellsMovable() {\n        return this.cellsMovable;\n    },\n    setCellsMovable(value) {\n        this.cellsMovable = value;\n    },\n    isCellResizable(cell) {\n        return (this.isCellsResizable() &&\n            !this.isCellLocked(cell) &&\n            (this.getCurrentCellStyle(cell).resizable ?? true));\n    },\n    isCellsResizable() {\n        return this.cellsResizable;\n    },\n    setCellsResizable(value) {\n        this.cellsResizable = value;\n    },\n    isCellBendable(cell) {\n        return (this.isCellsBendable() &&\n            !this.isCellLocked(cell) &&\n            (this.getCurrentCellStyle(cell).bendable ?? true));\n    },\n    isCellsBendable() {\n        return this.cellsBendable;\n    },\n    setCellsBendable(value) {\n        this.cellsBendable = value;\n    },\n    isAutoSizeCell(cell) {\n        return this.isAutoSizeCells() || (this.getCurrentCellStyle(cell).autoSize ?? false);\n    },\n    isAutoSizeCells() {\n        return this.autoSizeCells;\n    },\n    setAutoSizeCells(value) {\n        this.autoSizeCells = value;\n    },\n    isExtendParent(cell) {\n        return !cell.isEdge() && this.isExtendParents();\n    },\n    isExtendParents() {\n        return this.extendParents;\n    },\n    setExtendParents(value) {\n        this.extendParents = value;\n    },\n    isExtendParentsOnAdd(cell) {\n        return this.extendParentsOnAdd;\n    },\n    setExtendParentsOnAdd(value) {\n        this.extendParentsOnAdd = value;\n    },\n    isExtendParentsOnMove() {\n        return this.extendParentsOnMove;\n    },\n    setExtendParentsOnMove(value) {\n        this.extendParentsOnMove = value;\n    },\n    /*****************************************************************************\n     * Group: Graph appearance\n     *****************************************************************************/\n    getCursorForCell(_cell) {\n        return null;\n    },\n    /*****************************************************************************\n     * Group: Graph display\n     *****************************************************************************/\n    getCellBounds(cell, includeEdges = false, includeDescendants = false) {\n        let cells = [cell];\n        // Includes all connected edges\n        if (includeEdges) {\n            cells = cells.concat(cell.getEdges());\n        }\n        let result = this.getView().getBounds(cells);\n        // Recursively includes the bounds of the children\n        if (includeDescendants) {\n            for (const child of cell.getChildren()) {\n                const tmp = this.getCellBounds(child, includeEdges, true);\n                if (result && tmp) {\n                    result.add(tmp);\n                }\n                else {\n                    result = tmp;\n                }\n            }\n        }\n        return result;\n    },\n    getBoundingBoxFromGeometry(cells, includeEdges = false) {\n        let result = null;\n        let tmp = null;\n        for (const cell of cells) {\n            if (includeEdges || cell.isVertex()) {\n                // Computes the bounding box for the points in the geometry\n                const geo = cell.getGeometry();\n                if (geo) {\n                    let bbox = null;\n                    if (cell.isEdge()) {\n                        const addPoint = (pt) => {\n                            if (pt) {\n                                if (!tmp) {\n                                    tmp = new Rectangle(pt.x, pt.y, 0, 0);\n                                }\n                                else {\n                                    tmp.add(new Rectangle(pt.x, pt.y, 0, 0));\n                                }\n                            }\n                        };\n                        if (!cell.getTerminal(true)) {\n                            addPoint(geo.getTerminalPoint(true));\n                        }\n                        if (!cell.getTerminal(false)) {\n                            addPoint(geo.getTerminalPoint(false));\n                        }\n                        const pts = geo.points;\n                        if (pts && pts.length > 0) {\n                            tmp = new Rectangle(pts[0].x, pts[0].y, 0, 0);\n                            for (let j = 1; j < pts.length; j++) {\n                                addPoint(pts[j]);\n                            }\n                        }\n                        bbox = tmp;\n                    }\n                    else {\n                        const parent = cell.getParent();\n                        if (geo.relative && parent) {\n                            if (parent.isVertex() && parent !== this.getView().currentRoot) {\n                                tmp = this.getBoundingBoxFromGeometry([parent], false);\n                                if (tmp) {\n                                    bbox = new Rectangle(geo.x * tmp.width, geo.y * tmp.height, geo.width, geo.height);\n                                    if (cells.indexOf(parent) >= 0) {\n                                        bbox.x += tmp.x;\n                                        bbox.y += tmp.y;\n                                    }\n                                }\n                            }\n                        }\n                        else {\n                            bbox = Rectangle.fromRectangle(geo);\n                            if (parent && parent.isVertex() && cells.indexOf(parent) >= 0) {\n                                tmp = this.getBoundingBoxFromGeometry([parent], false);\n                                if (tmp) {\n                                    bbox.x += tmp.x;\n                                    bbox.y += tmp.y;\n                                }\n                            }\n                        }\n                        if (bbox && geo.offset) {\n                            bbox.x += geo.offset.x;\n                            bbox.y += geo.offset.y;\n                        }\n                        const style = this.getCurrentCellStyle(cell);\n                        if (bbox) {\n                            const angle = style.rotation ?? 0;\n                            if (angle !== 0) {\n                                bbox = getBoundingBox(bbox, angle);\n                            }\n                        }\n                    }\n                    if (bbox) {\n                        if (!result) {\n                            result = Rectangle.fromRectangle(bbox);\n                        }\n                        else {\n                            result.add(bbox);\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../geometry/Point.js';\nimport ConnectionConstraint from '../other/ConnectionConstraint.js';\nimport { getRotatedPoint, toRadians } from '../../util/mathUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const ConnectionsMixin = {\n    /*****************************************************************************\n     * Group: Cell connecting and connection constraints\n     *****************************************************************************/\n    constrainChildren: true,\n    constrainRelativeChildren: false,\n    disconnectOnMove: true,\n    cellsDisconnectable: true,\n    getOutlineConstraint(point, terminalState, me) {\n        if (terminalState.shape) {\n            const bounds = this.getView().getPerimeterBounds(terminalState);\n            const direction = terminalState.style.direction;\n            if (direction === 'north' || direction === 'south') {\n                bounds.x += bounds.width / 2 - bounds.height / 2;\n                bounds.y += bounds.height / 2 - bounds.width / 2;\n                const tmp = bounds.width;\n                bounds.width = bounds.height;\n                bounds.height = tmp;\n            }\n            const alpha = toRadians(terminalState.shape.getShapeRotation());\n            if (alpha !== 0) {\n                const cos = Math.cos(-alpha);\n                const sin = Math.sin(-alpha);\n                const ct = new Point(bounds.getCenterX(), bounds.getCenterY());\n                point = getRotatedPoint(point, cos, sin, ct);\n            }\n            let sx = 1;\n            let sy = 1;\n            let dx = 0;\n            let dy = 0;\n            // LATER: Add flipping support for image shapes\n            if (terminalState.cell.isVertex()) {\n                let flipH = terminalState.style.flipH;\n                let flipV = terminalState.style.flipV;\n                if (direction === 'north' || direction === 'south') {\n                    const tmp = flipH;\n                    flipH = flipV;\n                    flipV = tmp;\n                }\n                if (flipH) {\n                    sx = -1;\n                    dx = -bounds.width;\n                }\n                if (flipV) {\n                    sy = -1;\n                    dy = -bounds.height;\n                }\n            }\n            point = new Point((point.x - bounds.x) * sx - dx + bounds.x, (point.y - bounds.y) * sy - dy + bounds.y);\n            const x = bounds.width === 0\n                ? 0\n                : Math.round(((point.x - bounds.x) * 1000) / bounds.width) / 1000;\n            const y = bounds.height === 0\n                ? 0\n                : Math.round(((point.y - bounds.y) * 1000) / bounds.height) / 1000;\n            return new ConnectionConstraint(new Point(x, y), false);\n        }\n        return null;\n    },\n    getAllConnectionConstraints(terminal, _source) {\n        return terminal?.shape?.stencil?.constraints ?? null;\n    },\n    getConnectionConstraint(edge, terminal, source = false) {\n        let point = null;\n        const x = edge.style[source ? 'exitX' : 'entryX'];\n        if (x !== undefined) {\n            const y = edge.style[source ? 'exitY' : 'entryY'];\n            if (y !== undefined) {\n                point = new Point(x, y);\n            }\n        }\n        let perimeter = false;\n        let dx = 0;\n        let dy = 0;\n        if (point) {\n            perimeter = edge.style[source ? 'exitPerimeter' : 'entryPerimeter'] || false;\n            // Add entry/exit offset\n            dx = edge.style[source ? 'exitDx' : 'entryDx'];\n            dy = edge.style[source ? 'exitDy' : 'entryDy'];\n            dx = Number.isFinite(dx) ? dx : 0;\n            dy = Number.isFinite(dy) ? dy : 0;\n        }\n        return new ConnectionConstraint(point, perimeter, null, dx, dy);\n    },\n    setConnectionConstraint(edge, terminal, source = false, constraint = null) {\n        if (constraint) {\n            this.batchUpdate(() => {\n                if (!constraint || !constraint.point) {\n                    this.setCellStyles(source ? 'exitX' : 'entryX', null, [edge]);\n                    this.setCellStyles(source ? 'exitY' : 'entryY', null, [edge]);\n                    this.setCellStyles(source ? 'exitDx' : 'entryDx', null, [edge]);\n                    this.setCellStyles(source ? 'exitDy' : 'entryDy', null, [edge]);\n                    this.setCellStyles(source ? 'exitPerimeter' : 'entryPerimeter', null, [edge]);\n                }\n                else if (constraint.point) {\n                    this.setCellStyles(source ? 'exitX' : 'entryX', constraint.point.x, [edge]);\n                    this.setCellStyles(source ? 'exitY' : 'entryY', constraint.point.y, [edge]);\n                    this.setCellStyles(source ? 'exitDx' : 'entryDx', constraint.dx, [edge]);\n                    this.setCellStyles(source ? 'exitDy' : 'entryDy', constraint.dy, [edge]);\n                    // Only writes 0 since 1 is default\n                    if (!constraint.perimeter) {\n                        this.setCellStyles(source ? 'exitPerimeter' : 'entryPerimeter', '0', [edge]);\n                    }\n                    else {\n                        this.setCellStyles(source ? 'exitPerimeter' : 'entryPerimeter', null, [edge]);\n                    }\n                }\n            });\n        }\n    },\n    getConnectionPoint(vertex, constraint, round = true) {\n        let point = null;\n        if (constraint.point) {\n            const bounds = this.getView().getPerimeterBounds(vertex);\n            const cx = new Point(bounds.getCenterX(), bounds.getCenterY());\n            const direction = vertex.style.direction;\n            let r1 = 0;\n            // Bounds need to be rotated by 90 degrees for further computation\n            if (vertex.style.anchorPointDirection) {\n                if (direction === 'north') {\n                    r1 += 270;\n                }\n                else if (direction === 'west') {\n                    r1 += 180;\n                }\n                else if (direction === 'south') {\n                    r1 += 90;\n                }\n                // Bounds need to be rotated by 90 degrees for further computation\n                if (direction === 'north' || direction === 'south') {\n                    bounds.rotate90();\n                }\n            }\n            const { scale } = this.getView();\n            point = new Point(bounds.x + constraint.point.x * bounds.width + constraint.dx * scale, bounds.y + constraint.point.y * bounds.height + constraint.dy * scale);\n            // Rotation for direction before projection on perimeter\n            let r2 = vertex.style.rotation || 0;\n            if (constraint.perimeter) {\n                if (r1 !== 0) {\n                    // Only 90 degrees steps possible here so no trig needed\n                    let cos = 0;\n                    let sin = 0;\n                    if (r1 === 90) {\n                        sin = 1;\n                    }\n                    else if (r1 === 180) {\n                        cos = -1;\n                    }\n                    else if (r1 === 270) {\n                        sin = -1;\n                    }\n                    point = getRotatedPoint(point, cos, sin, cx);\n                }\n                point = this.getView().getPerimeterPoint(vertex, point, false);\n            }\n            else {\n                r2 += r1;\n                if (vertex.cell.isVertex()) {\n                    let flipH = vertex.style.flipH;\n                    let flipV = vertex.style.flipV;\n                    if (direction === 'north' || direction === 'south') {\n                        const temp = flipH;\n                        flipH = flipV;\n                        flipV = temp;\n                    }\n                    if (flipH) {\n                        point.x = 2 * bounds.getCenterX() - point.x;\n                    }\n                    if (flipV) {\n                        point.y = 2 * bounds.getCenterY() - point.y;\n                    }\n                }\n            }\n            // Generic rotation after projection on perimeter\n            if (r2 !== 0 && point) {\n                const rad = toRadians(r2);\n                const cos = Math.cos(rad);\n                const sin = Math.sin(rad);\n                point = getRotatedPoint(point, cos, sin, cx);\n            }\n        }\n        if (round && point) {\n            point.x = Math.round(point.x);\n            point.y = Math.round(point.y);\n        }\n        return point;\n    },\n    connectCell(edge, terminal = null, source = false, constraint = null) {\n        this.batchUpdate(() => {\n            const previous = edge.getTerminal(source);\n            this.cellConnected(edge, terminal, source, constraint);\n            this.fireEvent(new EventObject(InternalEvent.CONNECT_CELL, 'edge', edge, 'terminal', terminal, 'source', source, 'previous', previous));\n        });\n        return edge;\n    },\n    cellConnected(edge, terminal, source = false, constraint = null) {\n        this.batchUpdate(() => {\n            const previous = edge.getTerminal(source);\n            // Updates the constraint\n            this.setConnectionConstraint(edge, terminal, source, constraint);\n            // Checks if the new terminal is a port, uses the ID of the port in the\n            // style and the parent of the port as the actual terminal of the edge.\n            if (this.isPortsEnabled()) {\n                let id = null;\n                if (terminal && this.isPort(terminal)) {\n                    id = terminal.getId();\n                    terminal = this.getTerminalForPort(terminal, source);\n                }\n                // Sets or resets all previous information for connecting to a child port\n                const key = source ? 'sourcePort' : 'targetPort';\n                this.setCellStyles(key, id, [edge]);\n            }\n            this.getDataModel().setTerminal(edge, terminal, source);\n            if (this.isResetEdgesOnConnect()) {\n                this.resetEdge(edge);\n            }\n            this.fireEvent(new EventObject(InternalEvent.CELL_CONNECTED, 'edge', edge, 'terminal', terminal, 'source', source, 'previous', previous));\n        });\n    },\n    disconnectGraph(cells) {\n        this.batchUpdate(() => {\n            const { scale, translate: tr } = this.getView();\n            // Fast lookup for finding cells in array\n            const dict = new Map();\n            for (let i = 0; i < cells.length; i += 1) {\n                dict.set(cells[i], true);\n            }\n            for (const cell of cells) {\n                if (cell.isEdge()) {\n                    let geo = cell.getGeometry();\n                    if (geo) {\n                        const state = this.getView().getState(cell);\n                        const parent = cell.getParent();\n                        const pstate = parent ? this.getView().getState(parent) : null;\n                        if (state && pstate) {\n                            geo = geo.clone();\n                            const dx = -pstate.origin.x;\n                            const dy = -pstate.origin.y;\n                            const pts = state.absolutePoints;\n                            let src = cell.getTerminal(true);\n                            if (src && this.isCellDisconnectable(cell, src, true)) {\n                                while (src && !dict.get(src)) {\n                                    src = src.getParent();\n                                }\n                                if (!src && pts[0]) {\n                                    geo.setTerminalPoint(new Point(pts[0].x / scale - tr.x + dx, pts[0].y / scale - tr.y + dy), true);\n                                    this.getDataModel().setTerminal(cell, null, true);\n                                }\n                            }\n                            let trg = cell.getTerminal(false);\n                            if (trg && this.isCellDisconnectable(cell, trg, false)) {\n                                while (trg && !dict.get(trg)) {\n                                    trg = trg.getParent();\n                                }\n                                if (!trg) {\n                                    const n = pts.length - 1;\n                                    const p = pts[n];\n                                    if (p) {\n                                        geo.setTerminalPoint(new Point(p.x / scale - tr.x + dx, p.y / scale - tr.y + dy), false);\n                                        this.getDataModel().setTerminal(cell, null, false);\n                                    }\n                                }\n                            }\n                            this.getDataModel().setGeometry(cell, geo);\n                        }\n                    }\n                }\n            }\n        });\n    },\n    getConnections(cell, parent = null) {\n        return this.getEdges(cell, parent, true, true, false);\n    },\n    isConstrainChild(cell) {\n        return (this.isConstrainChildren() &&\n            !!cell.getParent() &&\n            !cell.getParent().isEdge());\n    },\n    isConstrainChildren() {\n        return this.constrainChildren;\n    },\n    setConstrainChildren(value) {\n        this.constrainChildren = value;\n    },\n    isConstrainRelativeChildren() {\n        return this.constrainRelativeChildren;\n    },\n    setConstrainRelativeChildren(value) {\n        this.constrainRelativeChildren = value;\n    },\n    /*****************************************************************************\n     * Group: Graph behaviour\n     *****************************************************************************/\n    isDisconnectOnMove() {\n        return this.disconnectOnMove;\n    },\n    setDisconnectOnMove(value) {\n        this.disconnectOnMove = value;\n    },\n    isCellDisconnectable(cell, terminal = null, source = false) {\n        return this.isCellsDisconnectable() && !this.isCellLocked(cell);\n    },\n    isCellsDisconnectable() {\n        return this.cellsDisconnectable;\n    },\n    setCellsDisconnectable(value) {\n        this.cellsDisconnectable = value;\n    },\n    isValidSource(cell) {\n        return ((cell == null && this.isAllowDanglingEdges()) ||\n            (cell != null &&\n                (!cell.isEdge() || this.isConnectableEdges()) &&\n                cell.isConnectable()));\n    },\n    isValidTarget(cell) {\n        return this.isValidSource(cell);\n    },\n    isValidConnection(source, target) {\n        return this.isValidSource(source) && this.isValidTarget(target);\n    },\n    setConnectable(connectable) {\n        const connectionHandler = this.getPlugin('ConnectionHandler');\n        connectionHandler?.setEnabled(connectable);\n    },\n    isConnectable() {\n        const connectionHandler = this.getPlugin('ConnectionHandler');\n        return connectionHandler?.isEnabled() ?? false;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const DragDropMixin = {\n    dropEnabled: false,\n    splitEnabled: true,\n    autoScroll: true,\n    isAutoScroll() {\n        return this.autoScroll;\n    },\n    autoExtend: true,\n    isAutoExtend() {\n        return this.autoExtend;\n    },\n    /*****************************************************************************\n     * Group: Graph behaviour\n     *****************************************************************************/\n    isDropEnabled() {\n        return this.dropEnabled;\n    },\n    setDropEnabled(value) {\n        this.dropEnabled = value;\n    },\n    /*****************************************************************************\n     * Group: Split behaviour\n     *****************************************************************************/\n    isSplitEnabled() {\n        return this.splitEnabled;\n    },\n    setSplitEnabled(value) {\n        this.splitEnabled = value;\n    },\n    isSplitTarget(target, cells = [], evt) {\n        if (target.isEdge() &&\n            cells.length === 1 &&\n            cells[0].isConnectable() &&\n            !this.getEdgeValidationError(target, target.getTerminal(true), cells[0])) {\n            const src = target.getTerminal(true);\n            const trg = target.getTerminal(false);\n            return !cells[0].isAncestor(src) && !cells[0].isAncestor(trg);\n        }\n        return false;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { removeDuplicates } from '../../util/arrayUtils.js';\nimport { findNearestSegment } from '../../util/mathUtils.js';\nimport Cell from '../cell/Cell.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Geometry from '../geometry/Geometry.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const EdgeMixin = {\n    resetEdgesOnResize: false,\n    isResetEdgesOnResize() {\n        return this.resetEdgesOnResize;\n    },\n    resetEdgesOnMove: false,\n    isResetEdgesOnMove() {\n        return this.resetEdgesOnMove;\n    },\n    resetEdgesOnConnect: true,\n    isResetEdgesOnConnect() {\n        return this.resetEdgesOnConnect;\n    },\n    connectableEdges: false,\n    allowDanglingEdges: true,\n    cloneInvalidEdges: false,\n    alternateEdgeStyle: {},\n    edgeLabelsMovable: true,\n    // ***************************************************************************\n    // Group: Graph Behaviour\n    // ***************************************************************************\n    isEdgeLabelsMovable() {\n        return this.edgeLabelsMovable;\n    },\n    setEdgeLabelsMovable(value) {\n        this.edgeLabelsMovable = value;\n    },\n    setAllowDanglingEdges(value) {\n        this.allowDanglingEdges = value;\n    },\n    isAllowDanglingEdges() {\n        return this.allowDanglingEdges;\n    },\n    setConnectableEdges(value) {\n        this.connectableEdges = value;\n    },\n    isConnectableEdges() {\n        return this.connectableEdges;\n    },\n    setCloneInvalidEdges(value) {\n        this.cloneInvalidEdges = value;\n    },\n    isCloneInvalidEdges() {\n        return this.cloneInvalidEdges;\n    },\n    // ***************************************************************************\n    // Group: Cell alignment and orientation\n    // ***************************************************************************\n    flipEdge(edge) {\n        if (this.alternateEdgeStyle) {\n            this.batchUpdate(() => {\n                const style = edge.getStyle();\n                if (Object.keys(style).length) {\n                    this.getDataModel().setStyle(edge, this.alternateEdgeStyle);\n                }\n                else {\n                    this.getDataModel().setStyle(edge, {});\n                }\n                // Removes all existing control points\n                this.resetEdge(edge);\n                this.fireEvent(new EventObject(InternalEvent.FLIP_EDGE, { edge }));\n            });\n        }\n        return edge;\n    },\n    splitEdge(edge, cells, newEdge, dx = 0, dy = 0, x, y, parent = null) {\n        parent = parent ?? edge.getParent();\n        const source = edge.getTerminal(true);\n        this.batchUpdate(() => {\n            if (!newEdge) {\n                newEdge = this.cloneCell(edge);\n                // Removes waypoints before/after new cell\n                const state = this.getView().getState(edge);\n                let geo = newEdge.getGeometry();\n                if (geo && state) {\n                    const t = this.getView().translate;\n                    const s = this.getView().scale;\n                    const idx = findNearestSegment(state, (dx + t.x) * s, (dy + t.y) * s);\n                    geo.points = geo.points.slice(0, idx);\n                    geo = edge.getGeometry();\n                    if (geo) {\n                        geo = geo.clone();\n                        geo.points = geo.points.slice(idx);\n                        this.getDataModel().setGeometry(edge, geo);\n                    }\n                }\n            }\n            this.cellsMoved(cells, dx, dy, false, false);\n            this.cellsAdded(cells, parent, parent ? parent.getChildCount() : 0, null, null, true);\n            this.cellsAdded([newEdge], parent, parent ? parent.getChildCount() : 0, source, cells[0], false);\n            this.cellConnected(edge, cells[0], true);\n            this.fireEvent(new EventObject(InternalEvent.SPLIT_EDGE, { edge, cells, newEdge, dx, dy }));\n        });\n        return newEdge;\n    },\n    insertEdge(...args) {\n        let parent;\n        let id;\n        let value;\n        let source;\n        let target;\n        let style;\n        if (args.length === 1 && typeof args[0] === 'object') {\n            const params = args[0];\n            parent = params.parent;\n            id = params.id;\n            value = params.value;\n            source = params.source;\n            target = params.target;\n            style = params.style;\n        }\n        else {\n            // otherwise treat as individual arguments\n            [parent, id, value, source, target, style] = args;\n        }\n        const edge = this.createEdge(parent, id, value, source, target, style);\n        return this.addEdge(edge, parent, source, target);\n    },\n    createEdge(parent = null, id, value, source = null, target = null, style = {}) {\n        // Creates the edge\n        const edge = new Cell(value, new Geometry(), style);\n        edge.setId(id);\n        edge.setEdge(true);\n        edge.geometry.relative = true; // geometry is set when creating the cell above\n        return edge;\n    },\n    addEdge(edge, parent = null, source = null, target = null, index = null) {\n        return this.addCell(edge, parent, index, source, target);\n    },\n    // ***************************************************************************\n    // Group: Folding\n    // ***************************************************************************\n    addAllEdges(cells) {\n        const allCells = cells.slice();\n        return removeDuplicates(allCells.concat(this.getAllEdges(cells)));\n    },\n    getAllEdges(cells) {\n        let edges = [];\n        if (cells) {\n            for (let i = 0; i < cells.length; i += 1) {\n                const edgeCount = cells[i].getEdgeCount();\n                for (let j = 0; j < edgeCount; j++) {\n                    edges.push(cells[i].getEdgeAt(j));\n                }\n                // Recurses\n                const children = cells[i].getChildren();\n                edges = edges.concat(this.getAllEdges(children));\n            }\n        }\n        return edges;\n    },\n    getIncomingEdges(cell, parent = null) {\n        return this.getEdges(cell, parent, true, false, false);\n    },\n    getOutgoingEdges(cell, parent = null) {\n        return this.getEdges(cell, parent, false, true, false);\n    },\n    getEdges(cell, parent = null, incoming = true, outgoing = true, includeLoops = true, recurse = false) {\n        let edges = [];\n        const isCollapsed = cell.isCollapsed();\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = cell.getChildAt(i);\n            if (isCollapsed || !child.isVisible()) {\n                edges = edges.concat(child.getEdges(incoming, outgoing));\n            }\n        }\n        edges = edges.concat(cell.getEdges(incoming, outgoing));\n        const result = [];\n        for (let i = 0; i < edges.length; i += 1) {\n            const state = this.getView().getState(edges[i]);\n            const source = state\n                ? state.getVisibleTerminal(true)\n                : this.getView().getVisibleTerminal(edges[i], true);\n            const target = state\n                ? state.getVisibleTerminal(false)\n                : this.getView().getVisibleTerminal(edges[i], false);\n            if ((includeLoops && source === target) ||\n                (source !== target &&\n                    ((incoming &&\n                        target === cell &&\n                        (!parent || this.isValidAncestor(source, parent, recurse))) ||\n                        (outgoing &&\n                            source === cell &&\n                            (!parent || this.isValidAncestor(target, parent, recurse)))))) {\n                result.push(edges[i]);\n            }\n        }\n        return result;\n    },\n    // ***************************************************************************\n    // Group: Cell retrieval\n    // ***************************************************************************\n    getChildEdges(parent) {\n        return this.getChildCells(parent, false, true);\n    },\n    getEdgesBetween(source, target, directed = false) {\n        const edges = this.getEdges(source);\n        const result = [];\n        // Checks if the edge is connected to the correct\n        // cell and returns the first match\n        for (let i = 0; i < edges.length; i += 1) {\n            const state = this.getView().getState(edges[i]);\n            const src = state\n                ? state.getVisibleTerminal(true)\n                : this.getView().getVisibleTerminal(edges[i], true);\n            const trg = state\n                ? state.getVisibleTerminal(false)\n                : this.getView().getVisibleTerminal(edges[i], false);\n            if ((src === source && trg === target) ||\n                (!directed && src === target && trg === source)) {\n                result.push(edges[i]);\n            }\n        }\n        return result;\n    },\n    // ***************************************************************************\n    // Group: Cell moving\n    // ***************************************************************************\n    resetEdges(cells) {\n        // Prepares faster cells lookup\n        const dict = new Map();\n        for (let i = 0; i < cells.length; i += 1) {\n            dict.set(cells[i], true);\n        }\n        this.batchUpdate(() => {\n            for (let i = 0; i < cells.length; i += 1) {\n                const edges = cells[i].getEdges();\n                for (let j = 0; j < edges.length; j++) {\n                    const state = this.getView().getState(edges[j]);\n                    const source = state\n                        ? state.getVisibleTerminal(true)\n                        : this.getView().getVisibleTerminal(edges[j], true);\n                    const target = state\n                        ? state.getVisibleTerminal(false)\n                        : this.getView().getVisibleTerminal(edges[j], false);\n                    // Checks if one of the terminals is not in the given array\n                    if (!dict.get(source) || !dict.get(target)) {\n                        this.resetEdge(edges[j]);\n                    }\n                }\n                this.resetEdges(cells[i].getChildren());\n            }\n        });\n    },\n    resetEdge(edge) {\n        let geo = edge.getGeometry();\n        // Resets the control points\n        if (geo && geo.points && geo.points.length > 0) {\n            geo = geo.clone();\n            geo.points = [];\n            this.getDataModel().setGeometry(edge, geo);\n        }\n        return edge;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { isMultiTouchEvent } from '../../util/EventUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const EditingMixin = {\n    cellsEditable: true,\n    /*****************************************************************************\n     * Group: Cell in-place editing\n     *****************************************************************************/\n    startEditing(evt) {\n        this.startEditingAtCell(null, evt);\n    },\n    startEditingAtCell(cell = null, evt) {\n        if (!evt || !isMultiTouchEvent(evt)) {\n            if (!cell) {\n                cell = this.getSelectionCell();\n                if (cell && !this.isCellEditable(cell)) {\n                    cell = null;\n                }\n            }\n            else {\n                this.fireEvent(new EventObject(InternalEvent.START_EDITING, { cell, event: evt }));\n                const cellEditorHandler = this.getPlugin('CellEditorHandler');\n                cellEditorHandler?.startEditing(cell, evt);\n                this.fireEvent(new EventObject(InternalEvent.EDITING_STARTED, { cell, event: evt }));\n            }\n        }\n    },\n    getEditingValue(cell, evt) {\n        return this.convertValueToString(cell);\n    },\n    stopEditing(cancel = false) {\n        const cellEditorHandler = this.getPlugin('CellEditorHandler');\n        cellEditorHandler?.stopEditing(cancel);\n        this.fireEvent(new EventObject(InternalEvent.EDITING_STOPPED, { cancel }));\n    },\n    labelChanged(cell, value, evt) {\n        this.batchUpdate(() => {\n            const old = cell.value;\n            this.cellLabelChanged(cell, value, this.isAutoSizeCell(cell));\n            this.fireEvent(new EventObject(InternalEvent.LABEL_CHANGED, {\n                cell: cell,\n                value: value,\n                old: old,\n                event: evt,\n            }));\n        });\n        return cell;\n    },\n    cellLabelChanged(cell, value, autoSize = false) {\n        this.batchUpdate(() => {\n            this.getDataModel().setValue(cell, value);\n            if (autoSize) {\n                this.cellSizeUpdated(cell, false);\n            }\n        });\n    },\n    /*****************************************************************************\n     * Group: Graph behaviour\n     *****************************************************************************/\n    isEditing(cell = null) {\n        const cellEditorHandler = this.getPlugin('CellEditorHandler');\n        const editingCell = cellEditorHandler?.getEditingCell();\n        return !cell ? !!editingCell : cell === editingCell;\n    },\n    isCellEditable(cell) {\n        return (this.isCellsEditable() &&\n            !this.isCellLocked(cell) &&\n            (this.getCurrentCellStyle(cell).editable ?? true));\n    },\n    isCellsEditable() {\n        return this.cellsEditable;\n    },\n    setCellsEditable(value) {\n        this.cellsEditable = value;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport InternalMouseEvent from '../event/InternalMouseEvent.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { getClientX, getClientY, isAltDown, isConsumed, isControlDown, isLeftMouseButton, isMetaDown, isMouseEvent, isMultiTouchEvent, isPenEvent, isPopupTrigger, isShiftDown, isTouchEvent, } from '../../util/EventUtils.js';\nimport Point from '../geometry/Point.js';\nimport { convertPoint } from '../../util/styleUtils.js';\nimport { NONE } from '../../util/Constants.js';\nimport Client from '../../Client.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const EventsMixin = {\n    // TODO: Document me!\n    lastTouchEvent: null,\n    doubleClickCounter: 0,\n    lastTouchCell: null,\n    fireDoubleClick: null,\n    tapAndHoldThread: null,\n    lastMouseX: null,\n    lastMouseY: null,\n    isMouseTrigger: null,\n    ignoreMouseEvents: null,\n    mouseMoveRedirect: null,\n    mouseUpRedirect: null,\n    lastEvent: null, // FIXME: Check if this can be more specific - DOM events or mxEventObjects!\n    escapeEnabled: true,\n    invokesStopCellEditing: true,\n    enterStopsCellEditing: false,\n    isMouseDown: false,\n    nativeDblClickEnabled: true,\n    doubleTapEnabled: true,\n    doubleTapTimeout: 500,\n    doubleTapTolerance: 25,\n    lastTouchX: 0,\n    lastTouchY: 0,\n    lastTouchTime: 0,\n    tapAndHoldEnabled: true,\n    tapAndHoldDelay: 500,\n    tapAndHoldInProgress: false,\n    tapAndHoldValid: false,\n    initialTouchX: 0,\n    initialTouchY: 0,\n    tolerance: 4,\n    isNativeDblClickEnabled() {\n        return this.nativeDblClickEnabled;\n    },\n    getEventTolerance() {\n        return this.tolerance;\n    },\n    setEventTolerance(tolerance) {\n        this.tolerance = tolerance;\n    },\n    escape(evt) {\n        this.fireEvent(new EventObject(InternalEvent.ESCAPE, { event: evt }));\n    },\n    click(me) {\n        const evt = me.getEvent();\n        let cell = me.getCell();\n        const mxe = new EventObject(InternalEvent.CLICK, { event: evt, cell });\n        if (me.isConsumed()) {\n            mxe.consume();\n        }\n        this.fireEvent(mxe);\n        if (this.isEnabled() && !isConsumed(evt) && !mxe.isConsumed()) {\n            if (cell) {\n                if (this.isTransparentClickEvent(evt)) {\n                    let active = false;\n                    const tmp = this.getCellAt(me.graphX, me.graphY, null, false, false, (state) => {\n                        const selected = this.isCellSelected(state.cell);\n                        active = active || selected;\n                        return (!active ||\n                            selected ||\n                            (state.cell !== cell && state.cell.isAncestor(cell)));\n                    });\n                    if (tmp) {\n                        cell = tmp;\n                    }\n                }\n            }\n            else if (this.isSwimlaneSelectionEnabled()) {\n                cell = this.getSwimlaneAt(me.getGraphX(), me.getGraphY());\n                if (cell != null && (!this.isToggleEvent(evt) || !isAltDown(evt))) {\n                    let temp = cell;\n                    let swimlanes = [];\n                    while (temp != null) {\n                        temp = temp.getParent();\n                        const state = this.getView().getState(temp);\n                        if (this.isSwimlane(temp) && state != null) {\n                            swimlanes.push(temp);\n                        }\n                    }\n                    // Selects ancestors for selected swimlanes\n                    if (swimlanes.length > 0) {\n                        swimlanes = swimlanes.reverse();\n                        swimlanes.splice(0, 0, cell);\n                        swimlanes.push(cell);\n                        for (let i = 0; i < swimlanes.length - 1; i += 1) {\n                            if (this.isCellSelected(swimlanes[i])) {\n                                cell = swimlanes[this.isToggleEvent(evt) ? i : i + 1];\n                            }\n                        }\n                    }\n                }\n            }\n            if (cell) {\n                this.selectCellForEvent(cell, evt);\n            }\n            else if (!this.isToggleEvent(evt)) {\n                this.clearSelection();\n            }\n        }\n        return false;\n    },\n    dblClick(evt, cell = null) {\n        const mxe = new EventObject(InternalEvent.DOUBLE_CLICK, { event: evt, cell });\n        this.fireEvent(mxe);\n        // Handles the event if it has not been consumed\n        if (this.isEnabled() &&\n            !isConsumed(evt) &&\n            !mxe.isConsumed() &&\n            cell &&\n            this.isCellEditable(cell) &&\n            !this.isEditing(cell)) {\n            this.startEditingAtCell(cell, evt);\n            InternalEvent.consume(evt);\n        }\n    },\n    tapAndHold(me) {\n        const evt = me.getEvent();\n        const mxe = new EventObject(InternalEvent.TAP_AND_HOLD, {\n            event: evt,\n            cell: me.getCell(),\n        });\n        const panningHandler = this.getPlugin('PanningHandler');\n        const connectionHandler = this.getPlugin('ConnectionHandler');\n        // LATER: Check if event should be consumed if me is consumed\n        this.fireEvent(mxe);\n        if (mxe.isConsumed()) {\n            // Resets the state of the panning handler\n            panningHandler && (panningHandler.panningTrigger = false);\n        }\n        // Handles the event if it has not been consumed\n        if (this.isEnabled() &&\n            !isConsumed(evt) &&\n            !mxe.isConsumed() &&\n            connectionHandler &&\n            connectionHandler.isEnabled()) {\n            const cell = connectionHandler.marker.getCell(me);\n            if (cell) {\n                const state = this.getView().getState(cell);\n                if (state) {\n                    connectionHandler.marker.currentColor = connectionHandler.marker.validColor;\n                    connectionHandler.marker.markedState = state;\n                    connectionHandler.marker.mark();\n                    connectionHandler.first = new Point(me.getGraphX(), me.getGraphY());\n                    connectionHandler.edgeState = connectionHandler.createEdgeState(me);\n                    connectionHandler.previous = state;\n                    connectionHandler.fireEvent(new EventObject(InternalEvent.START, { state: connectionHandler.previous }));\n                }\n            }\n        }\n    },\n    addMouseListener(listener) {\n        this.mouseListeners.push(listener);\n    },\n    removeMouseListener(listener) {\n        for (let i = 0; i < this.mouseListeners.length; i += 1) {\n            if (this.mouseListeners[i] === listener) {\n                this.mouseListeners.splice(i, 1);\n                break;\n            }\n        }\n    },\n    updateMouseEvent(me, evtName) {\n        const pt = convertPoint(this.getContainer(), me.getX(), me.getY());\n        me.graphX = pt.x - this.getPanDx();\n        me.graphY = pt.y - this.getPanDy();\n        // Searches for rectangles using method if native hit detection is disabled on shape\n        if (!me.getCell() && this.isMouseDown && evtName === InternalEvent.MOUSE_MOVE) {\n            const cell = this.getCellAt(pt.x, pt.y, null, true, true, (state) => {\n                return (!state.shape ||\n                    state.shape.paintBackground !== this.paintBackground ||\n                    state.style.pointerEvents ||\n                    state.shape.fill !== NONE);\n            });\n            me.state = cell ? this.getView().getState(cell) : null;\n        }\n        return me;\n    },\n    getStateForTouchEvent(evt) {\n        const x = getClientX(evt);\n        const y = getClientY(evt);\n        // Dispatches the drop event to the graph which\n        // consumes and executes the source function\n        const pt = convertPoint(this.getContainer(), x, y);\n        const cell = this.getCellAt(pt.x, pt.y);\n        return cell ? this.getView().getState(cell) : null;\n    },\n    isEventIgnored(evtName, me, sender) {\n        const mouseEvent = isMouseEvent(me.getEvent());\n        let result = false;\n        // Drops events that are fired more than once\n        if (me.getEvent() === this.lastEvent) {\n            result = true;\n        }\n        else {\n            this.lastEvent = me.getEvent();\n        }\n        // Installs event listeners to capture the complete gesture from the event source\n        // for non-MS touch events as a workaround for all events for the same geture being\n        // fired from the event source even if that was removed from the DOM.\n        const eventSource = this.getEventSource();\n        if (eventSource && evtName !== InternalEvent.MOUSE_MOVE) {\n            InternalEvent.removeGestureListeners(eventSource, null, this.mouseMoveRedirect, this.mouseUpRedirect);\n            this.mouseMoveRedirect = null;\n            this.mouseUpRedirect = null;\n            this.setEventSource(null);\n        }\n        else if (!Client.IS_GC && eventSource && me.getSource() !== eventSource) {\n            result = true;\n        }\n        else if (eventSource &&\n            Client.IS_TOUCH &&\n            evtName === InternalEvent.MOUSE_DOWN &&\n            !mouseEvent &&\n            !isPenEvent(me.getEvent())) {\n            this.setEventSource(me.getSource());\n            this.mouseMoveRedirect = (evt) => {\n                this.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, this.getStateForTouchEvent(evt)));\n            };\n            this.mouseUpRedirect = (evt) => {\n                this.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt, this.getStateForTouchEvent(evt)));\n            };\n            InternalEvent.addGestureListeners(eventSource, null, this.mouseMoveRedirect, this.mouseUpRedirect);\n        }\n        // Factored out the workarounds for FF to make it easier to override/remove\n        // Note this method has side-effects!\n        if (this.isSyntheticEventIgnored(evtName, me, sender)) {\n            result = true;\n        }\n        // Never fires mouseUp/-Down for double clicks\n        if (!isPopupTrigger(this.lastEvent) &&\n            evtName !== InternalEvent.MOUSE_MOVE &&\n            this.lastEvent.detail === 2) {\n            return true;\n        }\n        // Filters out of sequence events or mixed event types during a gesture\n        if (evtName === InternalEvent.MOUSE_UP && this.isMouseDown) {\n            this.isMouseDown = false;\n        }\n        else if (evtName === InternalEvent.MOUSE_DOWN && !this.isMouseDown) {\n            this.isMouseDown = true;\n            this.isMouseTrigger = mouseEvent;\n        }\n        // Drops mouse events that are fired during touch gestures as a workaround for Webkit\n        // and mouse events that are not in sync with the current internal button state\n        else if (!result &&\n            (((!Client.IS_FF || evtName !== InternalEvent.MOUSE_MOVE) &&\n                this.isMouseDown &&\n                this.isMouseTrigger !== mouseEvent) ||\n                (evtName === InternalEvent.MOUSE_DOWN && this.isMouseDown) ||\n                (evtName === InternalEvent.MOUSE_UP && !this.isMouseDown))) {\n            result = true;\n        }\n        if (!result && evtName === InternalEvent.MOUSE_DOWN) {\n            this.lastMouseX = me.getX();\n            this.lastMouseY = me.getY();\n        }\n        return result;\n    },\n    isSyntheticEventIgnored(evtName, me, sender) {\n        let result = false;\n        const mouseEvent = isMouseEvent(me.getEvent());\n        // LATER: This does not cover all possible cases that can go wrong in FF\n        if (this.ignoreMouseEvents && mouseEvent && evtName !== InternalEvent.MOUSE_MOVE) {\n            this.ignoreMouseEvents = evtName !== InternalEvent.MOUSE_UP;\n            result = true;\n        }\n        else if (Client.IS_FF && !mouseEvent && evtName === InternalEvent.MOUSE_UP) {\n            this.ignoreMouseEvents = true;\n        }\n        return result;\n    },\n    isEventSourceIgnored(evtName, me) {\n        const source = me.getSource();\n        if (!source)\n            return true;\n        // @ts-ignore nodeName could exist\n        const name = source.nodeName ? source.nodeName.toLowerCase() : '';\n        const candidate = !isMouseEvent(me.getEvent()) || isLeftMouseButton(me.getEvent());\n        return (evtName === InternalEvent.MOUSE_DOWN &&\n            candidate &&\n            (name === 'select' ||\n                name === 'option' ||\n                (name === 'input' &&\n                    // @ts-ignore type could exist\n                    source.type !== 'checkbox' &&\n                    // @ts-ignore type could exist\n                    source.type !== 'radio' &&\n                    // @ts-ignore type could exist\n                    source.type !== 'button' &&\n                    // @ts-ignore type could exist\n                    source.type !== 'submit' &&\n                    // @ts-ignore type could exist\n                    source.type !== 'file')));\n    },\n    getEventState(state) {\n        return state;\n    },\n    fireMouseEvent(evtName, me, sender) {\n        sender = sender ?? this;\n        if (this.isEventSourceIgnored(evtName, me)) {\n            const tooltipHandler = this.getPlugin('TooltipHandler');\n            if (tooltipHandler) {\n                tooltipHandler.hide();\n            }\n            return;\n        }\n        // Updates the graph coordinates in the event\n        me = this.updateMouseEvent(me, evtName);\n        // Detects and processes double taps for touch-based devices which do not have native double click events\n        // or where detection of double click is not always possible (quirks, IE10+). Note that this can only handle\n        // double clicks on cells because the sequence of events in IE prevents detection on the background, it fires\n        // two mouse ups, one of which without a cell but no mousedown for the second click which means we cannot\n        // detect which mouseup(s) are part of the first click, ie we do not know when the first click ends.\n        if ((!this.nativeDblClickEnabled && !isPopupTrigger(me.getEvent())) ||\n            (this.doubleTapEnabled &&\n                Client.IS_TOUCH &&\n                (isTouchEvent(me.getEvent()) || isPenEvent(me.getEvent())))) {\n            const currentTime = new Date().getTime();\n            if (evtName === InternalEvent.MOUSE_DOWN) {\n                if (this.lastTouchEvent &&\n                    this.lastTouchEvent !== me.getEvent() &&\n                    currentTime - this.lastTouchTime < this.doubleTapTimeout &&\n                    Math.abs(this.lastTouchX - me.getX()) < this.doubleTapTolerance &&\n                    Math.abs(this.lastTouchY - me.getY()) < this.doubleTapTolerance &&\n                    this.doubleClickCounter < 2) {\n                    this.doubleClickCounter += 1;\n                    let doubleClickFired = false;\n                    if (evtName === InternalEvent.MOUSE_UP) {\n                        if (me.getCell() === this.lastTouchCell && this.lastTouchCell) {\n                            this.lastTouchTime = 0;\n                            const cell = this.lastTouchCell;\n                            this.lastTouchCell = null;\n                            this.dblClick(me.getEvent(), cell);\n                            doubleClickFired = true;\n                        }\n                    }\n                    else {\n                        this.fireDoubleClick = true;\n                        this.lastTouchTime = 0;\n                    }\n                    if (doubleClickFired) {\n                        InternalEvent.consume(me.getEvent());\n                        return;\n                    }\n                }\n                else if (!this.lastTouchEvent || this.lastTouchEvent !== me.getEvent()) {\n                    this.lastTouchCell = me.getCell();\n                    this.lastTouchX = me.getX();\n                    this.lastTouchY = me.getY();\n                    this.lastTouchTime = currentTime;\n                    this.lastTouchEvent = me.getEvent();\n                    this.doubleClickCounter = 0;\n                }\n            }\n            else if ((this.isMouseDown || evtName === InternalEvent.MOUSE_UP) &&\n                this.fireDoubleClick) {\n                this.fireDoubleClick = false;\n                const cell = this.lastTouchCell;\n                this.lastTouchCell = null;\n                this.isMouseDown = false;\n                // Workaround for Chrome/Safari not firing native double click events for double touch on background\n                const valid = cell ||\n                    ((isTouchEvent(me.getEvent()) || isPenEvent(me.getEvent())) &&\n                        (Client.IS_GC || Client.IS_SF));\n                if (valid &&\n                    Math.abs(this.lastTouchX - me.getX()) < this.doubleTapTolerance &&\n                    Math.abs(this.lastTouchY - me.getY()) < this.doubleTapTolerance) {\n                    this.dblClick(me.getEvent(), cell);\n                }\n                else {\n                    InternalEvent.consume(me.getEvent());\n                }\n                return;\n            }\n        }\n        if (!this.isEventIgnored(evtName, me, sender)) {\n            const state = me.getState();\n            // Updates the event state via getEventState\n            me.state = state ? this.getEventState(state) : null;\n            this.fireEvent(new EventObject(InternalEvent.FIRE_MOUSE_EVENT, { eventName: evtName, event: me }));\n            if (Client.IS_SF || Client.IS_GC || me.getEvent().target !== this.getContainer()) {\n                const container = this.getContainer();\n                if (evtName === InternalEvent.MOUSE_MOVE &&\n                    this.isMouseDown &&\n                    this.isAutoScroll() &&\n                    !isMultiTouchEvent(me.getEvent())) {\n                    this.scrollPointToVisible(me.getGraphX(), me.getGraphY(), this.isAutoExtend());\n                }\n                else if (evtName === InternalEvent.MOUSE_UP &&\n                    this.isIgnoreScrollbars() &&\n                    this.isTranslateToScrollPosition() &&\n                    (container.scrollLeft !== 0 || container.scrollTop !== 0)) {\n                    const s = this.getView().scale;\n                    const tr = this.getView().translate;\n                    this.getView().setTranslate(tr.x - container.scrollLeft / s, tr.y - container.scrollTop / s);\n                    container.scrollLeft = 0;\n                    container.scrollTop = 0;\n                }\n                const mouseListeners = this.mouseListeners;\n                // Does not change returnValue in Opera\n                if (!me.getEvent().preventDefault) {\n                    me.getEvent().returnValue = true;\n                }\n                for (const l of mouseListeners) {\n                    if (evtName === InternalEvent.MOUSE_DOWN) {\n                        l.mouseDown(sender, me);\n                    }\n                    else if (evtName === InternalEvent.MOUSE_MOVE) {\n                        l.mouseMove(sender, me);\n                    }\n                    else if (evtName === InternalEvent.MOUSE_UP) {\n                        l.mouseUp(sender, me);\n                    }\n                }\n                // Invokes the click handler\n                if (evtName === InternalEvent.MOUSE_UP) {\n                    this.click(me);\n                }\n            }\n            // Detects tapAndHold events using a timer\n            if ((isTouchEvent(me.getEvent()) || isPenEvent(me.getEvent())) &&\n                evtName === InternalEvent.MOUSE_DOWN &&\n                this.tapAndHoldEnabled &&\n                !this.tapAndHoldInProgress) {\n                this.tapAndHoldInProgress = true;\n                this.initialTouchX = me.getGraphX();\n                this.initialTouchY = me.getGraphY();\n                const handler = () => {\n                    if (this.tapAndHoldValid) {\n                        this.tapAndHold(me);\n                    }\n                    this.tapAndHoldInProgress = false;\n                    this.tapAndHoldValid = false;\n                };\n                if (this.tapAndHoldThread) {\n                    window.clearTimeout(this.tapAndHoldThread);\n                }\n                this.tapAndHoldThread = window.setTimeout(handler, this.tapAndHoldDelay);\n                this.tapAndHoldValid = true;\n            }\n            else if (evtName === InternalEvent.MOUSE_UP) {\n                this.tapAndHoldInProgress = false;\n                this.tapAndHoldValid = false;\n            }\n            else if (this.tapAndHoldValid) {\n                this.tapAndHoldValid =\n                    Math.abs(this.initialTouchX - me.getGraphX()) < this.tolerance &&\n                        Math.abs(this.initialTouchY - me.getGraphY()) < this.tolerance;\n            }\n            const cellEditorHandler = this.getPlugin('CellEditorHandler');\n            // Stops editing for all events other than from cellEditorHandler\n            if (evtName === InternalEvent.MOUSE_DOWN &&\n                this.isEditing() &&\n                !cellEditorHandler?.isEventSource(me.getEvent())) {\n                this.stopEditing(!this.isInvokesStopCellEditing());\n            }\n            this.consumeMouseEvent(evtName, me, sender);\n        }\n    },\n    consumeMouseEvent(evtName, me, sender) {\n        sender = sender ?? this;\n        // Workaround for duplicate click in Windows 8 with Chrome/FF/Opera with touch\n        if (evtName === InternalEvent.MOUSE_DOWN && isTouchEvent(me.getEvent())) {\n            me.consume(false);\n        }\n    },\n    fireGestureEvent(evt, cell = null) {\n        // Resets double tap event handling when gestures take place\n        this.lastTouchTime = 0;\n        this.fireEvent(new EventObject(InternalEvent.GESTURE, { event: evt, cell }));\n    },\n    sizeDidChange() {\n        const bounds = this.getGraphBounds();\n        const border = this.getBorder();\n        let width = Math.max(0, bounds.x) + bounds.width + 2 * border;\n        let height = Math.max(0, bounds.y) + bounds.height + 2 * border;\n        const minimumContainerSize = this.getMinimumContainerSize();\n        if (minimumContainerSize) {\n            width = Math.max(width, minimumContainerSize.width);\n            height = Math.max(height, minimumContainerSize.height);\n        }\n        if (this.isResizeContainer()) {\n            this.doResizeContainer(width, height);\n        }\n        if (this.isPreferPageSize() || this.isPageVisible()) {\n            const size = this.getPreferredPageSize(bounds, Math.max(1, width), Math.max(1, height));\n            width = size.width * this.getView().scale;\n            height = size.height * this.getView().scale;\n        }\n        const minimumGraphSize = this.getMinimumGraphSize();\n        if (minimumGraphSize) {\n            width = Math.max(width, minimumGraphSize.width * this.getView().scale);\n            height = Math.max(height, minimumGraphSize.height * this.getView().scale);\n        }\n        width = Math.ceil(width);\n        height = Math.ceil(height);\n        // @ts-ignore\n        const root = this.getView().getDrawPane().ownerSVGElement;\n        if (root) {\n            root.style.minWidth = `${Math.max(1, width)}px`;\n            root.style.minHeight = `${Math.max(1, height)}px`;\n            root.style.width = '100%';\n            root.style.height = '100%';\n        }\n        this.updatePageBreaks(this.isPageBreaksVisible(), width, height);\n        this.fireEvent(new EventObject(InternalEvent.SIZE, { bounds }));\n    },\n    isCloneEvent(evt) {\n        return isControlDown(evt);\n    },\n    isTransparentClickEvent(evt) {\n        return false;\n    },\n    isToggleEvent(evt) {\n        return Client.IS_MAC ? isMetaDown(evt) : isControlDown(evt);\n    },\n    isGridEnabledEvent(evt) {\n        return !isAltDown(evt);\n    },\n    isConstrainedEvent(evt) {\n        return isShiftDown(evt);\n    },\n    isIgnoreTerminalEvent(_evt) {\n        return false;\n    },\n    getPointForEvent(evt, addOffset = true) {\n        const p = convertPoint(this.getContainer(), getClientX(evt), getClientY(evt));\n        const s = this.getView().scale;\n        const tr = this.getView().translate;\n        const off = addOffset ? this.getGridSize() / 2 : 0;\n        p.x = this.snap(p.x / s - tr.x - off);\n        p.y = this.snap(p.y / s - tr.y - off);\n        return p;\n    },\n    isEscapeEnabled() {\n        return this.escapeEnabled;\n    },\n    setEscapeEnabled(value) {\n        this.escapeEnabled = value;\n    },\n    isInvokesStopCellEditing() {\n        return this.invokesStopCellEditing;\n    },\n    setInvokesStopCellEditing(value) {\n        this.invokesStopCellEditing = value;\n    },\n    isEnterStopsCellEditing() {\n        return this.enterStopsCellEditing;\n    },\n    setEnterStopsCellEditing(value) {\n        this.enterStopsCellEditing = value;\n    },\n    getCursorForMouseEvent(me) {\n        const cell = me.getCell();\n        return cell ? this.getCursorForCell(cell) : null;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { toRadians } from '../../util/mathUtils.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { isI18nEnabled } from '../../internal/i18n-utils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const FoldingMixin = {\n    collapseExpandResource: isI18nEnabled() ? 'collapse-expand' : '',\n    getCollapseExpandResource() {\n        return this.collapseExpandResource;\n    },\n    isFoldingEnabled() {\n        return this.options.foldingEnabled;\n    },\n    getFoldableCells(cells, collapse = false) {\n        return this.getDataModel().filterCells(cells, (cell) => {\n            return this.isCellFoldable(cell, collapse);\n        });\n    },\n    isCellFoldable(cell, _collapse) {\n        return cell.getChildCount() > 0 && (this.getCurrentCellStyle(cell).foldable ?? true);\n    },\n    getFoldingImage(state) {\n        if (state != null && this.isFoldingEnabled() && !state.cell.isEdge()) {\n            const tmp = state.cell.isCollapsed();\n            if (this.isCellFoldable(state.cell, !tmp)) {\n                return tmp ? this.options.collapsedImage : this.options.expandedImage;\n            }\n        }\n        return null;\n    },\n    foldCells(collapse = false, recurse = false, cells = null, checkFoldable = false, _evt = null) {\n        if (cells == null) {\n            cells = this.getFoldableCells(this.getSelectionCells(), collapse);\n        }\n        this.stopEditing(false);\n        this.batchUpdate(() => {\n            this.cellsFolded(cells, collapse, recurse, checkFoldable);\n            this.fireEvent(new EventObject(InternalEvent.FOLD_CELLS, 'collapse', collapse, 'recurse', recurse, 'cells', cells));\n        });\n        return cells;\n    },\n    cellsFolded(cells = null, collapse = false, recurse = false, checkFoldable = false) {\n        if (cells != null && cells.length > 0) {\n            this.batchUpdate(() => {\n                for (let i = 0; i < cells.length; i += 1) {\n                    if ((!checkFoldable || this.isCellFoldable(cells[i], collapse)) &&\n                        collapse !== cells[i].isCollapsed()) {\n                        this.getDataModel().setCollapsed(cells[i], collapse);\n                        this.swapBounds(cells[i], collapse);\n                        if (this.isExtendParent(cells[i])) {\n                            this.extendParent(cells[i]);\n                        }\n                        if (recurse) {\n                            const children = cells[i].getChildren();\n                            this.cellsFolded(children, collapse, recurse);\n                        }\n                        this.constrainChild(cells[i]);\n                    }\n                }\n                this.fireEvent(new EventObject(InternalEvent.CELLS_FOLDED, { cells, collapse, recurse }));\n            });\n        }\n    },\n    swapBounds(cell, willCollapse = false) {\n        let geo = cell.getGeometry();\n        if (geo != null) {\n            geo = geo.clone();\n            this.updateAlternateBounds(cell, geo, willCollapse);\n            geo.swap();\n            this.getDataModel().setGeometry(cell, geo);\n        }\n    },\n    updateAlternateBounds(cell = null, geo = null, _willCollapse = false) {\n        if (cell != null && geo != null) {\n            const style = this.getCurrentCellStyle(cell);\n            if (geo.alternateBounds == null) {\n                let bounds = geo;\n                if (this.options.collapseToPreferredSize) {\n                    const tmp = this.getPreferredSizeForCell(cell);\n                    if (tmp != null) {\n                        bounds = tmp;\n                        const startSize = style.startSize ?? 0;\n                        if (startSize > 0) {\n                            bounds.height = Math.max(bounds.height, startSize);\n                        }\n                    }\n                }\n                geo.alternateBounds = new Rectangle(0, 0, bounds.width, bounds.height);\n            }\n            if (geo.alternateBounds != null) {\n                geo.alternateBounds.x = geo.x;\n                geo.alternateBounds.y = geo.y;\n                const alpha = toRadians(style.rotation || 0);\n                if (alpha !== 0) {\n                    const dx = geo.alternateBounds.getCenterX() - geo.getCenterX();\n                    const dy = geo.alternateBounds.getCenterY() - geo.getCenterY();\n                    const cos = Math.cos(alpha);\n                    const sin = Math.sin(alpha);\n                    const dx2 = cos * dx - sin * dy;\n                    const dy2 = sin * dx + cos * dy;\n                    geo.alternateBounds.x += dx2 - dx;\n                    geo.alternateBounds.y += dy2 - dy;\n                }\n            }\n        }\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Cell from '../cell/Cell.js';\nimport { sortCells } from '../../util/styleUtils.js';\nimport Geometry from '../geometry/Geometry.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Rectangle from '../geometry/Rectangle.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const GroupingMixin = {\n    groupCells(group, border = 0, cells) {\n        if (!cells)\n            cells = sortCells(this.getSelectionCells(), true);\n        if (!cells)\n            cells = this.getCellsForGroup(cells);\n        if (group == null) {\n            group = this.createGroupCell(cells);\n        }\n        const bounds = this.getBoundsForGroup(group, cells, border);\n        if (cells.length > 1 && bounds != null) {\n            // Uses parent of group or previous parent of first child\n            let parent = group.getParent();\n            if (parent == null) {\n                parent = cells[0].getParent();\n            }\n            this.batchUpdate(() => {\n                // Checks if the group has a geometry and\n                // creates one if one does not exist\n                if (group.getGeometry() == null) {\n                    this.getDataModel().setGeometry(group, new Geometry());\n                }\n                // Adds the group into the parent\n                let index = parent.getChildCount();\n                this.cellsAdded([group], parent, index, null, null, false, false, false);\n                // Adds the children into the group and moves\n                index = group.getChildCount();\n                this.cellsAdded(cells, group, index, null, null, false, false, false);\n                this.cellsMoved(cells, -bounds.x, -bounds.y, false, false, false);\n                // Resizes the group\n                this.cellsResized([group], [bounds], false);\n                this.fireEvent(new EventObject(InternalEvent.GROUP_CELLS, { group, border, cells }));\n            });\n        }\n        return group;\n    },\n    getCellsForGroup(cells) {\n        const result = [];\n        if (cells != null && cells.length > 0) {\n            const parent = cells[0].getParent();\n            result.push(cells[0]);\n            // Filters selection cells with the same parent\n            for (let i = 1; i < cells.length; i += 1) {\n                if (cells[i].getParent() === parent) {\n                    result.push(cells[i]);\n                }\n            }\n        }\n        return result;\n    },\n    getBoundsForGroup(group, children, border) {\n        const result = this.getBoundingBoxFromGeometry(children, true);\n        if (result != null) {\n            if (this.isSwimlane(group)) {\n                const size = this.getStartSize(group);\n                result.x -= size.width;\n                result.y -= size.height;\n                result.width += size.width;\n                result.height += size.height;\n            }\n            // Adds the border\n            if (border != null) {\n                result.x -= border;\n                result.y -= border;\n                result.width += 2 * border;\n                result.height += 2 * border;\n            }\n        }\n        return result;\n    },\n    createGroupCell(cells) {\n        const group = new Cell('');\n        group.setVertex(true);\n        group.setConnectable(false);\n        return group;\n    },\n    ungroupCells(cells) {\n        let result = [];\n        if (cells == null) {\n            cells = this.getCellsForUngroup();\n        }\n        if (cells != null && cells.length > 0) {\n            this.batchUpdate(() => {\n                const _cells = cells;\n                for (let i = 0; i < _cells.length; i += 1) {\n                    let children = _cells[i].getChildren();\n                    if (children != null && children.length > 0) {\n                        children = children.slice();\n                        const parent = _cells[i].getParent();\n                        const index = parent.getChildCount();\n                        this.cellsAdded(children, parent, index, null, null, true);\n                        result = result.concat(children);\n                        // Fix relative child cells\n                        for (const child of children) {\n                            const state = this.getView().getState(child);\n                            let geo = child.getGeometry();\n                            if (state != null && geo != null && geo.relative) {\n                                geo = geo.clone();\n                                geo.x = state.origin.x;\n                                geo.y = state.origin.y;\n                                geo.relative = false;\n                                this.getDataModel().setGeometry(child, geo);\n                            }\n                        }\n                    }\n                }\n                this.removeCellsAfterUngroup(_cells);\n                this.fireEvent(new EventObject(InternalEvent.UNGROUP_CELLS, { cells }));\n            });\n        }\n        return result;\n    },\n    getCellsForUngroup() {\n        const cells = this.getSelectionCells();\n        // Finds the cells with children\n        const tmp = [];\n        for (let i = 0; i < cells.length; i += 1) {\n            if (cells[i].isVertex() && cells[i].getChildCount() > 0) {\n                tmp.push(cells[i]);\n            }\n        }\n        return tmp;\n    },\n    removeCellsAfterUngroup(cells) {\n        this.cellsRemoved(this.addAllEdges(cells));\n    },\n    removeCellsFromParent(cells) {\n        if (cells == null) {\n            cells = this.getSelectionCells();\n        }\n        this.batchUpdate(() => {\n            const parent = this.getDefaultParent();\n            const index = parent.getChildCount();\n            this.cellsAdded(cells, parent, index, null, null, true);\n            this.fireEvent(new EventObject(InternalEvent.REMOVE_CELLS_FROM_PARENT, { cells }));\n        });\n        return cells;\n    },\n    updateGroupBounds(cells, border = 0, moveGroup = false, topBorder = 0, rightBorder = 0, bottomBorder = 0, leftBorder = 0) {\n        if (cells == null) {\n            cells = this.getSelectionCells();\n        }\n        border = border != null ? border : 0;\n        moveGroup = moveGroup != null ? moveGroup : false;\n        topBorder = topBorder != null ? topBorder : 0;\n        rightBorder = rightBorder != null ? rightBorder : 0;\n        bottomBorder = bottomBorder != null ? bottomBorder : 0;\n        leftBorder = leftBorder != null ? leftBorder : 0;\n        this.batchUpdate(() => {\n            for (let i = cells.length - 1; i >= 0; i--) {\n                let geo = cells[i].getGeometry();\n                if (geo == null) {\n                    continue;\n                }\n                const children = this.getChildCells(cells[i]);\n                if (children != null && children.length > 0) {\n                    const bounds = this.getBoundingBoxFromGeometry(children, true);\n                    if (bounds != null && bounds.width > 0 && bounds.height > 0) {\n                        // Adds the size of the title area for swimlanes\n                        const size = ((this.isSwimlane(cells[i])\n                            ? this.getActualStartSize(cells[i], true)\n                            : new Rectangle()));\n                        geo = geo.clone();\n                        if (moveGroup) {\n                            geo.x = Math.round(geo.x + bounds.x - border - size.x - leftBorder);\n                            geo.y = Math.round(geo.y + bounds.y - border - size.y - topBorder);\n                        }\n                        geo.width = Math.round(bounds.width + 2 * border + size.x + leftBorder + rightBorder + size.width);\n                        geo.height = Math.round(bounds.height + 2 * border + size.y + topBorder + bottomBorder + size.height);\n                        this.getDataModel().setGeometry(cells[i], geo);\n                        this.moveCells(children, border + size.x - bounds.x + leftBorder, border + size.y - bounds.y + topBorder);\n                    }\n                }\n            }\n        });\n        return cells;\n    },\n    /*****************************************************************************\n     * Group: Drilldown\n     *****************************************************************************/\n    enterGroup(cell) {\n        cell = cell || this.getSelectionCell();\n        if (cell != null && this.isValidRoot(cell)) {\n            this.getView().setCurrentRoot(cell);\n            this.clearSelection();\n        }\n    },\n    exitGroup() {\n        const root = this.getDataModel().getRoot();\n        const current = this.getCurrentRoot();\n        if (current != null) {\n            let next = current.getParent();\n            // Finds the next valid root in the hierarchy\n            while (next !== root && !this.isValidRoot(next) && next.getParent() !== root) {\n                next = next.getParent();\n            }\n            // Clears the current root if the new root is\n            // the model's root or one of the layers.\n            if (next === root || next.getParent() === root) {\n                this.getView().setCurrentRoot(null);\n            }\n            else {\n                this.getView().setCurrentRoot(next);\n            }\n            const state = this.getView().getState(current);\n            // Selects the previous root in the graph\n            if (state != null) {\n                this.setSelectionCell(current);\n            }\n        }\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const ImageMixin = {\n    addImageBundle(bundle) {\n        this.imageBundles.push(bundle);\n    },\n    removeImageBundle(bundle) {\n        const tmp = [];\n        for (let i = 0; i < this.imageBundles.length; i += 1) {\n            if (this.imageBundles[i] !== bundle) {\n                tmp.push(this.imageBundles[i]);\n            }\n        }\n        this.imageBundles = tmp;\n    },\n    getImageFromBundles(key) {\n        if (key) {\n            for (let i = 0; i < this.imageBundles.length; i += 1) {\n                const image = this.imageBundles[i].getImage(key);\n                if (image) {\n                    return image;\n                }\n            }\n        }\n        return null;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const LabelMixin = {\n    getLabel(cell) {\n        let result = '';\n        if (this.isLabelsVisible() && cell) {\n            const style = this.getCurrentCellStyle(cell);\n            if (!(style.noLabel ?? false)) {\n                result = this.convertValueToString(cell);\n            }\n        }\n        return result;\n    },\n    isHtmlLabel(_cell) {\n        return this.isHtmlLabels();\n    },\n    labelsVisible: true,\n    isLabelsVisible() {\n        return this.labelsVisible;\n    },\n    htmlLabels: false,\n    isHtmlLabels() {\n        return this.htmlLabels;\n    },\n    setHtmlLabels(value) {\n        this.htmlLabels = value;\n    },\n    isWrapping(cell) {\n        return this.getCurrentCellStyle(cell).whiteSpace === 'wrap';\n    },\n    isLabelClipped(cell) {\n        return this.getCurrentCellStyle(cell).overflow === 'hidden';\n    },\n    isLabelMovable(cell) {\n        return (!this.isCellLocked(cell) &&\n            ((cell.isEdge() && this.isEdgeLabelsMovable()) ||\n                (cell.isVertex() && this.isVertexLabelsMovable())));\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { sortCells } from '../../util/styleUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const OrderMixin = {\n    orderCells(back = false, cells) {\n        if (!cells)\n            cells = this.getSelectionCells();\n        if (!cells) {\n            cells = sortCells(this.getSelectionCells(), true);\n        }\n        this.batchUpdate(() => {\n            this.cellsOrdered(cells, back);\n            const event = new EventObject(InternalEvent.ORDER_CELLS, 'back', back, 'cells', cells);\n            this.fireEvent(event);\n        });\n        return cells;\n    },\n    cellsOrdered(cells, back = false) {\n        this.batchUpdate(() => {\n            for (let i = 0; i < cells.length; i += 1) {\n                const parent = cells[i].getParent();\n                if (back) {\n                    this.getDataModel().add(parent, cells[i], i);\n                }\n                else {\n                    this.getDataModel().add(parent, cells[i], parent ? parent.getChildCount() - 1 : 0);\n                }\n            }\n            this.fireEvent(new EventObject(InternalEvent.CELLS_ORDERED, { back, cells }));\n        });\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../geometry/Point.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport EventSource from '../event/EventSource.js';\n/**\n * Extends {@link EventSource} to implement a graph overlay, represented by an icon and a tooltip.\n *\n * Overlays can handle and fire {@link InternalEvent.CLICK} events and are added to the graph using {@link AbstractGraph.addCellOverlay}, and removed using\n * {@link AbstractGraph.removeCellOverlay}, or {@link AbstractGraph.removeCellOverlays} to remove all overlays.\n * The {@link AbstractGraph.getCellOverlays} function returns the array of overlays for a given cell in a graph.\n * If multiple overlays exist for the same cell, then {@link getBounds} should be overridden in at least one of the overlays.\n *\n * Overlays appear on top of all cells in a special layer.\n * If this is not desirable, then the image must be rendered as part of the shape or label of the cell instead.\n *\n * For cell overlays to be printed, use {@link PrintPreview.printOverlays}.\n *\n * ### Example\n *\n * The following adds a new overlay for a given vertex and selects the cell if the overlay is clicked.\n *\n * ```javascript\n * const overlay = new CellOverlay(img, html);\n * graph.addCellOverlay(vertex, overlay);\n * overlay.addListener(InternalEvent.CLICK, (sender, evt) => {\n *   const cell = evt.getProperty('cell');\n *   graph.setSelectionCell(cell);\n * });\n * ```\n *\n * ### Events\n *\n * **{@link InternalEvent.CLICK}**\n *\n * Fires when the user clicks on the overlay.\n * In the {@link EventObject} parameter of the listener function:\n * - the `event` property contains the corresponding {@link MouseEvent}\n * - the `cell` property contains the {@link Cell}.\n *\n * For touch devices this is fired if the element receives a touchend event.\n */\nclass CellOverlay extends EventSource {\n    /**\n     * Constructs a new overlay using the given image and tooltip.\n     *\n     * @param image {@link ImageBox} that represents the icon to be displayed.\n     * @param tooltip Optional string that specifies the tooltip.\n     * @param align Optional horizontal alignment for the overlay. Possible values are 'left', 'center' and 'right' (default).\n     * @param verticalAlign Vertical alignment for the overlay. Possible values are 'top', 'middle' and 'bottom' (default).\n     * @param offset Optional offset for positioning the overlay relative to its alignment. Scaled according to the current graph scale. Default is `new Point()`.\n     * @param cursor Optional CSS cursor for the overlay. Default is `'help'`.\n     */\n    constructor(image, tooltip = null, align = 'right', verticalAlign = 'bottom', offset = new Point(), cursor = 'help') {\n        super();\n        /**\n         * Holds the horizontal alignment for the overlay.\n         *\n         * For edges, the overlay always appears in the center of the edge.\n         * @default 'right'\n         */\n        this.align = 'right';\n        /**\n         * Holds the vertical alignment for the overlay.\n         *\n         * For edges, the overlay always appears in the center of the edge.\n         * @default 'bottom'\n         */\n        this.verticalAlign = 'bottom';\n        /**\n         * Holds the offset as an {@link Point}. The offset will be scaled according to the current scale.\n         */\n        this.offset = new Point();\n        /**\n         * Holds the cursor for the overlay.\n         * @default 'help'.\n         */\n        this.cursor = 'help';\n        /**\n         * Defines the overlapping for the overlay, that is, the proportional distance from the origin to the point defined by the alignment.\n         * @default 0.5\n         */\n        this.defaultOverlap = 0.5;\n        this.image = image;\n        this.tooltip = tooltip;\n        this.align = align;\n        this.verticalAlign = verticalAlign;\n        this.offset = offset;\n        this.cursor = cursor;\n    }\n    /**\n     * Returns the bounds of the overlay for the given {@link CellState} as an {@link Rectangle}.\n     * This should be overridden when using multiple overlays per cell so that the overlays do not overlap.\n     *\n     * The following example will place the overlay along an edge (where x=[-1..1] from the start to the end of the edge\n     * and y is the orthogonal offset in px).\n     *\n     * ```javascript\n     * const overlayBounds = overlay.getBounds;\n     * overlay.getBounds = function(state) {\n     *   const bounds = overlayBounds.call(this, state);\n     *\n     *   if (state.view.graph.getDataModel().isEdge(state.cell)) {\n     *     const pt = state.view.getPoint(state, {x: 0, y: 0, relative: true});\n     *\n     *     bounds.x = pt.x - bounds.width / 2;\n     *     bounds.y = pt.y - bounds.height / 2;\n     *   }\n     *\n     *   return bounds;\n     * };\n     * ```\n     *\n     * @param state {@link CellState} that represents the current state of the associated cell.\n     */\n    getBounds(state) {\n        const isEdge = state.cell.isEdge();\n        const s = state.view.scale;\n        let pt = null;\n        const image = this.image;\n        const w = image.width;\n        const h = image.height;\n        if (isEdge) {\n            const pts = state.absolutePoints;\n            if (pts.length % 2 === 1) {\n                pt = pts[Math.floor(pts.length / 2)];\n            }\n            else {\n                const idx = pts.length / 2;\n                const p0 = pts[idx - 1];\n                const p1 = pts[idx];\n                pt = new Point(p0.x + (p1.x - p0.x) / 2, p0.y + (p1.y - p0.y) / 2);\n            }\n        }\n        else {\n            pt = new Point();\n            if (this.align === 'left') {\n                pt.x = state.x;\n            }\n            else if (this.align === 'center') {\n                pt.x = state.x + state.width / 2;\n            }\n            else if (this.align === 'right') {\n                pt.x = state.x + state.width;\n            }\n            else {\n                throw new Error();\n            }\n            if (this.verticalAlign === 'top') {\n                pt.y = state.y;\n            }\n            else if (this.verticalAlign === 'middle') {\n                pt.y = state.y + state.height / 2;\n            }\n            else if (this.verticalAlign === 'bottom') {\n                pt.y = state.y + state.height;\n            }\n            else {\n                throw new Error();\n            }\n        }\n        return new Rectangle(Math.round(pt.x - (w * this.defaultOverlap - this.offset.x) * s), Math.round(pt.y - (h * this.defaultOverlap - this.offset.y) * s), w * s, h * s);\n    }\n    /**\n     * Returns the textual representation of the overlay to be used as the tooltip.\n     *\n     * This implementation returns {@link tooltip}.\n     */\n    toString() {\n        return this.tooltip;\n    }\n}\nexport default CellOverlay;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellOverlay from '../cell/CellOverlay.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const OverlaysMixin = {\n    addCellOverlay(cell, overlay) {\n        cell.overlays.push(overlay);\n        // Immediately update the cell display if the state exists\n        const state = this.getView().getState(cell);\n        if (state) {\n            this.getCellRenderer().redraw(state);\n        }\n        this.fireEvent(new EventObject(InternalEvent.ADD_OVERLAY, { cell, overlay }));\n        return overlay;\n    },\n    getCellOverlays(cell) {\n        return cell.overlays;\n    },\n    removeCellOverlay(cell, overlay = null) {\n        if (!overlay) {\n            this.removeCellOverlays(cell);\n        }\n        else {\n            const index = cell.overlays.indexOf(overlay);\n            if (index >= 0) {\n                cell.overlays.splice(index, 1);\n                // Immediately updates the cell display if the state exists\n                const state = this.getView().getState(cell);\n                if (state) {\n                    this.getCellRenderer().redraw(state);\n                }\n                this.fireEvent(new EventObject(InternalEvent.REMOVE_OVERLAY, { cell, overlay }));\n            }\n            else {\n                overlay = null;\n            }\n        }\n        return overlay;\n    },\n    removeCellOverlays(cell) {\n        const { overlays } = cell;\n        cell.overlays = [];\n        // Immediately updates the cell display if the state exists\n        const state = this.getView().getState(cell);\n        if (state) {\n            this.getCellRenderer().redraw(state);\n        }\n        for (let i = 0; i < overlays.length; i += 1) {\n            this.fireEvent(new EventObject(InternalEvent.REMOVE_OVERLAY, 'cell', cell, 'overlay', overlays[i]));\n        }\n        return overlays;\n    },\n    clearCellOverlays(cell = null) {\n        cell = cell ?? this.getDataModel().getRoot();\n        if (!cell)\n            return;\n        this.removeCellOverlays(cell);\n        // Recursively removes all overlays from the children\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = cell.getChildAt(i);\n            this.clearCellOverlays(child); // recurse\n        }\n    },\n    setCellWarning(cell, warning = null, img, isSelect = false) {\n        img = img ?? this.getWarningImage();\n        if (warning && warning.length > 0) {\n            // Creates the overlay with the image and warning\n            const overlay = new CellOverlay(img, `<font color=red>${warning}</font>`);\n            // Adds a handler for single mouseclicks to select the cell\n            if (isSelect) {\n                overlay.addListener(InternalEvent.CLICK, (sender, evt) => {\n                    if (this.isEnabled()) {\n                        this.setSelectionCell(cell);\n                    }\n                });\n            }\n            // Sets and returns the overlay in the graph\n            return this.addCellOverlay(cell, overlay);\n        }\n        this.removeCellOverlays(cell);\n        return null;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\n/**\n * Extends {@link Shape} to implement a polyline (a line with multiple points).\n *\n * The shape is used to represent edges, not vertices.\n *\n * This shape is **NOT** registered in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Edge Shapes\n */\nclass PolylineShape extends Shape {\n    /**\n     * Constructs a new polyline shape.\n     *\n     * @param points Array of <{@link Point} that define the points. This is stored in {@link Shape.points}.\n     * @param stroke String that defines the stroke color. Default is 'black'. This is stored in {@link Shape.stroke}.\n     * @param strokeWidth Optional integer that defines the stroke width. Default is 1. This is stored in {@link Shape.strokeWidth}.\n     */\n    constructor(points, stroke, strokeWidth = 1) {\n        super();\n        this.points = points;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Returns 0.\n     */\n    getRotation() {\n        return 0;\n    }\n    /**\n     * Returns 0.\n     */\n    getShapeRotation() {\n        return 0;\n    }\n    /**\n     * Returns false.\n     */\n    isPaintBoundsInverted() {\n        return false;\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintEdgeShape(c, pts) {\n        const prev = c.pointerEventsValue;\n        c.pointerEventsValue = 'stroke';\n        if (!this.style?.curved) {\n            this.paintLine(c, pts, this.isRounded);\n        }\n        else {\n            this.paintCurvedLine(c, pts);\n        }\n        c.pointerEventsValue = prev;\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintLine(c, pts, rounded) {\n        c.begin();\n        this.addPoints(c, pts, rounded, this.getBaseArcSize(), false);\n        c.stroke();\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintCurvedLine(c, pts) {\n        c.begin();\n        const pt = pts[0];\n        const n = pts.length;\n        c.moveTo(pt.x, pt.y);\n        for (let i = 1; i < n - 2; i += 1) {\n            const p0 = pts[i];\n            const p1 = pts[i + 1];\n            const ix = (p0.x + p1.x) / 2;\n            const iy = (p0.y + p1.y) / 2;\n            c.quadTo(p0.x, p0.y, ix, iy);\n        }\n        const p0 = pts[n - 2];\n        const p1 = pts[n - 1];\n        c.quadTo(p0.x, p0.y, p1.x, p1.y);\n        c.stroke();\n    }\n}\nexport default PolylineShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../geometry/Rectangle.js';\nimport Point from '../geometry/Point.js';\nimport PolylineShape from '../shape/edge/PolylineShape.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const PageBreaksMixin = {\n    horizontalPageBreaks: null,\n    verticalPageBreaks: null,\n    updatePageBreaks(visible, _width, _height) {\n        const { scale, translate: tr } = this.getView();\n        const fmt = this.getPageFormat();\n        const ps = scale * this.getPageScale();\n        const bounds = new Rectangle(0, 0, fmt.width * ps, fmt.height * ps);\n        const gb = Rectangle.fromRectangle(this.getGraphBounds());\n        gb.width = Math.max(1, gb.width);\n        gb.height = Math.max(1, gb.height);\n        bounds.x =\n            Math.floor((gb.x - tr.x * scale) / bounds.width) * bounds.width + tr.x * scale;\n        bounds.y =\n            Math.floor((gb.y - tr.y * scale) / bounds.height) * bounds.height + tr.y * scale;\n        gb.width = Math.ceil((gb.width + (gb.x - bounds.x)) / bounds.width) * bounds.width;\n        gb.height =\n            Math.ceil((gb.height + (gb.y - bounds.y)) / bounds.height) * bounds.height;\n        // Does not show page breaks if the scale is too small\n        visible =\n            visible && Math.min(bounds.width, bounds.height) > this.getMinPageBreakDist();\n        const horizontalCount = visible ? Math.ceil(gb.height / bounds.height) + 1 : 0;\n        const verticalCount = visible ? Math.ceil(gb.width / bounds.width) + 1 : 0;\n        const right = (verticalCount - 1) * bounds.width;\n        const bottom = (horizontalCount - 1) * bounds.height;\n        if (this.horizontalPageBreaks == null && horizontalCount > 0) {\n            this.horizontalPageBreaks = [];\n        }\n        if (this.verticalPageBreaks == null && verticalCount > 0) {\n            this.verticalPageBreaks = [];\n        }\n        const drawPageBreaks = (breaks) => {\n            if (breaks != null) {\n                const count = breaks === this.horizontalPageBreaks ? horizontalCount : verticalCount;\n                for (let i = 0; i <= count; i += 1) {\n                    const pts = breaks === this.horizontalPageBreaks\n                        ? [\n                            new Point(Math.round(bounds.x), Math.round(bounds.y + i * bounds.height)),\n                            new Point(Math.round(bounds.x + right), Math.round(bounds.y + i * bounds.height)),\n                        ]\n                        : [\n                            new Point(Math.round(bounds.x + i * bounds.width), Math.round(bounds.y)),\n                            new Point(Math.round(bounds.x + i * bounds.width), Math.round(bounds.y + bottom)),\n                        ];\n                    if (breaks[i] != null) {\n                        breaks[i].points = pts;\n                        breaks[i].redraw();\n                    }\n                    else {\n                        const pageBreak = new PolylineShape(pts, this.getPageBreakColor());\n                        pageBreak.dialect = this.getDialect();\n                        pageBreak.pointerEvents = false;\n                        pageBreak.isDashed = this.isPageBreakDashed();\n                        pageBreak.init(this.getView().backgroundPane);\n                        pageBreak.redraw();\n                        breaks[i] = pageBreak;\n                    }\n                }\n                for (let i = count; i < breaks.length; i += 1) {\n                    breaks[i].destroy();\n                }\n                breaks.splice(count, breaks.length - count);\n            }\n        };\n        drawPageBreaks(this.horizontalPageBreaks);\n        drawPageBreaks(this.verticalPageBreaks);\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { hasScrollbars } from '../../util/styleUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport Point from '../geometry/Point.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const PanningMixin = {\n    shiftPreview1: null,\n    shiftPreview2: null,\n    useScrollbarsForPanning: true,\n    isUseScrollbarsForPanning() {\n        return this.useScrollbarsForPanning;\n    },\n    timerAutoScroll: false,\n    isTimerAutoScroll() {\n        return this.timerAutoScroll;\n    },\n    allowAutoPanning: false,\n    isAllowAutoPanning() {\n        return this.allowAutoPanning;\n    },\n    panDx: 0,\n    getPanDx() {\n        return this.panDx;\n    },\n    setPanDx(dx) {\n        this.panDx = dx;\n    },\n    panDy: 0,\n    getPanDy() {\n        return this.panDy;\n    },\n    setPanDy(dy) {\n        this.panDy = dy;\n    },\n    panGraph(dx, dy) {\n        const container = this.getContainer();\n        if (this.useScrollbarsForPanning && hasScrollbars(container)) {\n            container.scrollLeft = -dx;\n            container.scrollTop = -dy;\n        }\n        else {\n            const canvas = this.getView().getCanvas();\n            // Puts everything inside the container in a DIV so that it\n            // can be moved without changing the state of the container\n            if (dx === 0 && dy === 0) {\n                canvas.removeAttribute('transform');\n                if (this.shiftPreview1) {\n                    let child = this.shiftPreview1.firstChild;\n                    while (child) {\n                        const next = child.nextSibling;\n                        container.appendChild(child);\n                        child = next;\n                    }\n                    if (this.shiftPreview1.parentNode) {\n                        this.shiftPreview1.parentNode.removeChild(this.shiftPreview1);\n                    }\n                    this.shiftPreview1 = null;\n                    container.appendChild(canvas.parentNode);\n                    const shiftPreview2 = this.shiftPreview2;\n                    child = shiftPreview2.firstChild;\n                    while (child) {\n                        const next = child.nextSibling;\n                        container.appendChild(child);\n                        child = next;\n                    }\n                    if (shiftPreview2.parentNode) {\n                        shiftPreview2.parentNode.removeChild(shiftPreview2);\n                    }\n                    this.shiftPreview2 = null;\n                }\n            }\n            else {\n                canvas.setAttribute('transform', `translate(${dx},${dy})`);\n                if (!this.shiftPreview1) {\n                    // Needs two divs for stuff before and after the SVG element\n                    this.shiftPreview1 = document.createElement('div');\n                    this.shiftPreview1.style.position = 'absolute';\n                    this.shiftPreview1.style.overflow = 'visible';\n                    this.shiftPreview2 = document.createElement('div');\n                    this.shiftPreview2.style.position = 'absolute';\n                    this.shiftPreview2.style.overflow = 'visible';\n                    let current = this.shiftPreview1;\n                    let child = container.firstChild;\n                    while (child) {\n                        const next = child.nextSibling;\n                        // SVG element is moved via transform attribute\n                        // @ts-ignore\n                        if (child !== canvas.parentNode) {\n                            current.appendChild(child);\n                        }\n                        else {\n                            current = this.shiftPreview2;\n                        }\n                        child = next;\n                    }\n                    // Inserts elements only if not empty\n                    if (this.shiftPreview1.firstChild) {\n                        container.insertBefore(this.shiftPreview1, canvas.parentNode);\n                    }\n                    if (this.shiftPreview2.firstChild) {\n                        container.appendChild(this.shiftPreview2);\n                    }\n                }\n                this.shiftPreview1.style.left = `${dx}px`;\n                this.shiftPreview1.style.top = `${dy}px`;\n                if (this.shiftPreview2) {\n                    this.shiftPreview2.style.left = `${dx}px`;\n                    this.shiftPreview2.style.top = `${dy}px`;\n                }\n            }\n            this.panDx = dx;\n            this.panDy = dy;\n            this.fireEvent(new EventObject(InternalEvent.PAN));\n        }\n    },\n    scrollCellToVisible(cell, center = false) {\n        const x = -this.getView().translate.x;\n        const y = -this.getView().translate.y;\n        const state = this.getView().getState(cell);\n        if (state) {\n            const bounds = new Rectangle(x + state.x, y + state.y, state.width, state.height);\n            if (center && this.getContainer()) {\n                const w = this.getContainer().clientWidth;\n                const h = this.getContainer().clientHeight;\n                bounds.x = bounds.getCenterX() - w / 2;\n                bounds.width = w;\n                bounds.y = bounds.getCenterY() - h / 2;\n                bounds.height = h;\n            }\n            const tr = new Point(this.getView().translate.x, this.getView().translate.y);\n            if (this.scrollRectToVisible(bounds)) {\n                // Triggers an update via the view's event source\n                const tr2 = new Point(this.getView().translate.x, this.getView().translate.y);\n                this.getView().translate.x = tr.x;\n                this.getView().translate.y = tr.y;\n                this.getView().setTranslate(tr2.x, tr2.y);\n            }\n        }\n    },\n    scrollRectToVisible(rect) {\n        let isChanged = false;\n        const container = this.getContainer();\n        const w = container.offsetWidth;\n        const h = container.offsetHeight;\n        const widthLimit = Math.min(w, rect.width);\n        const heightLimit = Math.min(h, rect.height);\n        if (hasScrollbars(container)) {\n            rect.x += this.getView().translate.x;\n            rect.y += this.getView().translate.y;\n            let dx = container.scrollLeft - rect.x;\n            const ddx = Math.max(dx - container.scrollLeft, 0);\n            if (dx > 0) {\n                container.scrollLeft -= dx + 2;\n            }\n            else {\n                dx = rect.x + widthLimit - container.scrollLeft - container.clientWidth;\n                if (dx > 0) {\n                    container.scrollLeft += dx + 2;\n                }\n            }\n            let dy = container.scrollTop - rect.y;\n            const ddy = Math.max(0, dy - container.scrollTop);\n            if (dy > 0) {\n                container.scrollTop -= dy + 2;\n            }\n            else {\n                dy = rect.y + heightLimit - container.scrollTop - container.clientHeight;\n                if (dy > 0) {\n                    container.scrollTop += dy + 2;\n                }\n            }\n            if (!this.useScrollbarsForPanning && (ddx != 0 || ddy != 0)) {\n                this.getView().setTranslate(ddx, ddy);\n            }\n        }\n        else {\n            const x = -this.getView().translate.x;\n            const y = -this.getView().translate.y;\n            const s = this.getView().scale;\n            if (rect.x + widthLimit > x + w) {\n                this.getView().translate.x -= (rect.x + widthLimit - w - x) / s;\n                isChanged = true;\n            }\n            if (rect.y + heightLimit > y + h) {\n                this.getView().translate.y -= (rect.y + heightLimit - h - y) / s;\n                isChanged = true;\n            }\n            if (rect.x < x) {\n                this.getView().translate.x += (x - rect.x) / s;\n                isChanged = true;\n            }\n            if (rect.y < y) {\n                this.getView().translate.y += (y - rect.y) / s;\n                isChanged = true;\n            }\n            if (isChanged) {\n                this.getView().refresh();\n                const selectionCellsHandler = this.getPlugin('SelectionCellsHandler');\n                // Repaints selection marker (ticket 18)\n                if (selectionCellsHandler) {\n                    selectionCellsHandler.refresh();\n                }\n            }\n        }\n        return isChanged;\n    },\n    setPanning(enabled) {\n        const panningHandler = this.getPlugin('PanningHandler');\n        panningHandler && (panningHandler.panningEnabled = enabled);\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nexport const PortsMixin = {\n    portsEnabled: true,\n    isPort(cell) {\n        return false;\n    },\n    getTerminalForPort(cell, _source = false) {\n        return cell.getParent();\n    },\n    isPortsEnabled() {\n        return this.portsEnabled;\n    },\n    setPortsEnabled(value) {\n        this.portsEnabled = value;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Cell from '../cell/Cell.js';\nimport RootChange from '../undoable_changes/RootChange.js';\nimport ChildChange from '../undoable_changes/ChildChange.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const SelectionMixin = {\n    selectionModel: null,\n    getSelectionModel() {\n        return this.selectionModel;\n    },\n    setSelectionModel(selectionModel) {\n        this.selectionModel = selectionModel;\n    },\n    /*****************************************************************************\n     * Selection\n     *****************************************************************************/\n    isCellSelected(cell) {\n        return this.selectionModel.isSelected(cell);\n    },\n    isSelectionEmpty() {\n        return this.selectionModel.isEmpty();\n    },\n    clearSelection() {\n        this.selectionModel.clear();\n    },\n    getSelectionCount() {\n        return this.selectionModel.cells.length;\n    },\n    getSelectionCell() {\n        return this.selectionModel.cells[0];\n    },\n    getSelectionCells() {\n        return this.selectionModel.cells.slice();\n    },\n    setSelectionCell(cell) {\n        this.selectionModel.setCell(cell);\n    },\n    setSelectionCells(cells) {\n        this.selectionModel.setCells(cells);\n    },\n    addSelectionCell(cell) {\n        this.selectionModel.addCell(cell);\n    },\n    addSelectionCells(cells) {\n        this.selectionModel.addCells(cells);\n    },\n    removeSelectionCell(cell) {\n        this.selectionModel.removeCell(cell);\n    },\n    removeSelectionCells(cells) {\n        this.selectionModel.removeCells(cells);\n    },\n    selectRegion(rect, evt) {\n        const cells = this.getCells(rect.x, rect.y, rect.width, rect.height);\n        this.selectCellsForEvent(cells, evt);\n        return cells;\n    },\n    selectNextCell() {\n        this.selectCell(true);\n    },\n    selectPreviousCell() {\n        this.selectCell();\n    },\n    selectParentCell() {\n        this.selectCell(false, true);\n    },\n    selectChildCell() {\n        this.selectCell(false, false, true);\n    },\n    selectCell(isNext = false, isParent = false, isChild = false) {\n        const cell = this.selectionModel.cells.length > 0 ? this.selectionModel.cells[0] : null;\n        if (this.selectionModel.cells.length > 1) {\n            this.selectionModel.clear();\n        }\n        const parent = cell ? cell.getParent() : this.getDefaultParent();\n        const childCount = parent.getChildCount();\n        if (!cell && childCount > 0) {\n            const child = parent.getChildAt(0);\n            this.setSelectionCell(child);\n        }\n        else if (parent &&\n            (!cell || isParent) &&\n            this.getView().getState(parent) &&\n            parent.getGeometry()) {\n            if (this.getCurrentRoot() !== parent) {\n                this.setSelectionCell(parent);\n            }\n        }\n        else if (cell && isChild) {\n            const tmp = cell.getChildCount();\n            if (tmp > 0) {\n                const child = cell.getChildAt(0);\n                this.setSelectionCell(child);\n            }\n        }\n        else if (childCount > 0) {\n            let i = parent.getIndex(cell);\n            if (isNext) {\n                i++;\n                const child = parent.getChildAt(i % childCount);\n                this.setSelectionCell(child);\n            }\n            else {\n                i--;\n                const index = i < 0 ? childCount - 1 : i;\n                const child = parent.getChildAt(index);\n                this.setSelectionCell(child);\n            }\n        }\n    },\n    selectAll(parent, descendants = false) {\n        parent = parent ?? this.getDefaultParent();\n        const cells = descendants\n            ? parent.filterDescendants((cell) => {\n                return cell !== parent && !!this.getView().getState(cell);\n            })\n            : parent.getChildren();\n        this.setSelectionCells(cells);\n    },\n    selectVertices(parent, selectGroups = false) {\n        this.selectCells(true, false, parent, selectGroups);\n    },\n    selectEdges(parent) {\n        this.selectCells(false, true, parent);\n    },\n    selectCells(vertices = false, edges = false, parent, selectGroups = false) {\n        parent = parent ?? this.getDefaultParent();\n        const filter = (cell) => {\n            const p = cell.getParent();\n            return (!!this.getView().getState(cell) &&\n                (((selectGroups || cell.getChildCount() === 0) &&\n                    cell.isVertex() &&\n                    vertices &&\n                    p &&\n                    !p.isEdge()) ||\n                    (cell.isEdge() && edges)));\n        };\n        const cells = parent.filterDescendants(filter);\n        this.setSelectionCells(cells);\n    },\n    selectCellForEvent(cell, evt) {\n        const isSelected = this.isCellSelected(cell);\n        if (this.isToggleEvent(evt)) {\n            if (isSelected) {\n                this.removeSelectionCell(cell);\n            }\n            else {\n                this.addSelectionCell(cell);\n            }\n        }\n        else if (!isSelected || this.getSelectionCount() !== 1) {\n            this.setSelectionCell(cell);\n        }\n    },\n    selectCellsForEvent(cells, evt) {\n        if (this.isToggleEvent(evt)) {\n            this.addSelectionCells(cells);\n        }\n        else {\n            this.setSelectionCells(cells);\n        }\n    },\n    isSiblingSelected(cell) {\n        const parent = cell.getParent();\n        const childCount = parent.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = parent.getChildAt(i);\n            if (cell !== child && this.isCellSelected(child)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    /*****************************************************************************\n     * Selection state\n     *****************************************************************************/\n    getSelectionCellsForChanges(changes, ignoreFn = null) {\n        const coveredElements = new Map();\n        const cells = [];\n        const addCell = (cell) => {\n            if (!coveredElements.has(cell) && this.getDataModel().contains(cell)) {\n                if (cell.isEdge() || cell.isVertex()) {\n                    coveredElements.set(cell, true);\n                    cells.push(cell);\n                }\n                else {\n                    const childCount = cell.getChildCount();\n                    for (let i = 0; i < childCount; i += 1) {\n                        addCell(cell.getChildAt(i));\n                    }\n                }\n            }\n        };\n        for (let i = 0; i < changes.length; i += 1) {\n            const change = changes[i];\n            if (change.constructor !== RootChange && (!ignoreFn || !ignoreFn(change))) {\n                let cell = null;\n                if (change instanceof ChildChange) {\n                    cell = change.child;\n                }\n                else if (change.cell && change.cell instanceof Cell) {\n                    cell = change.cell;\n                }\n                if (cell) {\n                    addCell(cell);\n                }\n            }\n        }\n        return cells;\n    },\n    updateSelection() {\n        const cells = this.getSelectionCells();\n        const removed = [];\n        for (const cell of cells) {\n            if (!this.getDataModel().contains(cell) || !cell.isVisible()) {\n                removed.push(cell);\n            }\n            else {\n                let par = cell.getParent();\n                while (par && par !== this.getView().currentRoot) {\n                    if (par.isCollapsed() || !par.isVisible()) {\n                        removed.push(cell);\n                        break;\n                    }\n                    par = par.getParent();\n                }\n            }\n        }\n        this.removeSelectionCells(removed);\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const SnapMixin = {\n    snapTolerance: 0,\n    getSnapTolerance() {\n        return this.snapTolerance;\n    },\n    gridSize: 10,\n    gridEnabled: true,\n    snap(value) {\n        if (this.gridEnabled) {\n            value = Math.round(value / this.gridSize) * this.gridSize;\n        }\n        return value;\n    },\n    snapDelta(delta, bounds, ignoreGrid = false, ignoreHorizontal = false, ignoreVertical = false) {\n        const t = this.getView().translate;\n        const s = this.getView().scale;\n        if (!ignoreGrid && this.gridEnabled) {\n            const tol = this.gridSize * s * 0.5;\n            if (!ignoreHorizontal) {\n                const tx = bounds.x - (this.snap(bounds.x / s - t.x) + t.x) * s;\n                if (Math.abs(delta.x - tx) < tol) {\n                    delta.x = 0;\n                }\n                else {\n                    delta.x = this.snap(delta.x / s) * s - tx;\n                }\n            }\n            if (!ignoreVertical) {\n                const ty = bounds.y - (this.snap(bounds.y / s - t.y) + t.y) * s;\n                if (Math.abs(delta.y - ty) < tol) {\n                    delta.y = 0;\n                }\n                else {\n                    delta.y = this.snap(delta.y / s) * s - ty;\n                }\n            }\n        }\n        else {\n            const tol = 0.5 * s;\n            if (!ignoreHorizontal) {\n                const tx = bounds.x - (Math.round(bounds.x / s - t.x) + t.x) * s;\n                if (Math.abs(delta.x - tx) < tol) {\n                    delta.x = 0;\n                }\n                else {\n                    delta.x = Math.round(delta.x / s) * s - tx;\n                }\n            }\n            if (!ignoreVertical) {\n                const ty = bounds.y - (Math.round(bounds.y / s - t.y) + t.y) * s;\n                if (Math.abs(delta.y - ty) < tol) {\n                    delta.y = 0;\n                }\n                else {\n                    delta.y = Math.round(delta.y / s) * s - ty;\n                }\n            }\n        }\n        return delta;\n    },\n    isGridEnabled() {\n        return this.gridEnabled;\n    },\n    setGridEnabled(value) {\n        this.gridEnabled = value;\n    },\n    getGridSize() {\n        return this.gridSize;\n    },\n    setGridSize(value) {\n        this.gridSize = value;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../geometry/Rectangle.js';\nimport { convertPoint } from '../../util/styleUtils.js';\nimport { mod } from '../../util/mathUtils.js';\nimport { DEFAULT_STARTSIZE } from '../../util/Constants.js';\nimport { getClientX, getClientY } from '../../util/EventUtils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const SwimlaneMixin = {\n    swimlaneSelectionEnabled: true,\n    swimlaneNesting: true,\n    swimlaneIndicatorColorAttribute: 'fillColor',\n    getSwimlane(cell = null) {\n        while (cell && !this.isSwimlane(cell)) {\n            cell = cell.getParent();\n        }\n        return cell;\n    },\n    getSwimlaneAt(x, y, parent) {\n        if (!parent) {\n            parent = this.getCurrentRoot();\n            if (!parent) {\n                parent = this.getDataModel().getRoot();\n            }\n        }\n        if (parent) {\n            const childCount = parent.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                const child = parent.getChildAt(i);\n                if (child) {\n                    const result = this.getSwimlaneAt(x, y, child);\n                    if (result != null) {\n                        return result;\n                    }\n                    if (child.isVisible() && this.isSwimlane(child)) {\n                        const state = this.getView().getState(child);\n                        if (state && this.intersects(state, x, y)) {\n                            return child;\n                        }\n                    }\n                }\n            }\n        }\n        return null;\n    },\n    hitsSwimlaneContent(swimlane, x, y) {\n        const state = this.getView().getState(swimlane);\n        const size = this.getStartSize(swimlane);\n        if (state) {\n            const scale = this.getView().getScale();\n            x -= state.x;\n            y -= state.y;\n            if (size.width > 0 && x > 0 && x > size.width * scale) {\n                return true;\n            }\n            if (size.height > 0 && y > 0 && y > size.height * scale) {\n                return true;\n            }\n        }\n        return false;\n    },\n    getStartSize(swimlane, ignoreState = false) {\n        const result = new Rectangle();\n        const style = this.getCurrentCellStyle(swimlane, ignoreState);\n        const size = style.startSize ?? DEFAULT_STARTSIZE;\n        if (style.horizontal ?? true) {\n            result.height = size;\n        }\n        else {\n            result.width = size;\n        }\n        return result;\n    },\n    getSwimlaneDirection(style) {\n        const dir = style.direction ?? 'east';\n        const flipH = style.flipH;\n        const flipV = style.flipV;\n        const h = style.horizontal ?? true;\n        let n = h ? 0 : 3;\n        if (dir === 'north') {\n            n--;\n        }\n        else if (dir === 'west') {\n            n += 2;\n        }\n        else if (dir === 'south') {\n            n += 1;\n        }\n        const _mod = mod(n, 2);\n        if (flipH && _mod === 1) {\n            n += 2;\n        }\n        if (flipV && _mod === 0) {\n            n += 2;\n        }\n        return ['north', 'east', 'south', 'west'][mod(n, 4)];\n    },\n    getActualStartSize(swimlane, ignoreState = false) {\n        const result = new Rectangle();\n        if (this.isSwimlane(swimlane, ignoreState)) {\n            const style = this.getCurrentCellStyle(swimlane, ignoreState);\n            const size = style.startSize ?? DEFAULT_STARTSIZE;\n            const dir = this.getSwimlaneDirection(style);\n            if (dir === 'north') {\n                result.y = size;\n            }\n            else if (dir === 'west') {\n                result.x = size;\n            }\n            else if (dir === 'south') {\n                result.height = size;\n            }\n            else {\n                result.width = size;\n            }\n        }\n        return result;\n    },\n    isSwimlane(cell, ignoreState = false) {\n        if (cell && cell.getParent() !== this.getDataModel().getRoot() && !cell.isEdge()) {\n            return this.getCurrentCellStyle(cell, ignoreState).shape === 'swimlane';\n        }\n        return false;\n    },\n    isValidDropTarget(cell, cells, evt) {\n        return (cell &&\n            ((this.isSplitEnabled() && this.isSplitTarget(cell, cells, evt)) ||\n                (!cell.isEdge() &&\n                    (this.isSwimlane(cell) || (cell.getChildCount() > 0 && !cell.isCollapsed())))));\n    },\n    getDropTarget(cells, evt, cell = null, clone = false) {\n        if (!this.isSwimlaneNesting()) {\n            for (let i = 0; i < cells.length; i += 1) {\n                if (this.isSwimlane(cells[i])) {\n                    return null;\n                }\n            }\n        }\n        const pt = convertPoint(this.getContainer(), getClientX(evt), getClientY(evt));\n        pt.x -= this.getPanDx();\n        pt.y -= this.getPanDy();\n        const swimlane = this.getSwimlaneAt(pt.x, pt.y);\n        if (!cell) {\n            cell = swimlane;\n        }\n        else if (swimlane) {\n            // Checks if the cell is an ancestor of the swimlane\n            // under the mouse and uses the swimlane in that case\n            let tmp = swimlane.getParent();\n            while (tmp && this.isSwimlane(tmp) && tmp !== cell) {\n                tmp = tmp.getParent();\n            }\n            if (tmp === cell) {\n                cell = swimlane;\n            }\n        }\n        while (cell &&\n            !this.isValidDropTarget(cell, cells, evt) &&\n            !this.getDataModel().isLayer(cell)) {\n            cell = cell.getParent();\n        }\n        // Checks if parent is dropped into child if not cloning\n        let parentCell = cell;\n        if (!clone) {\n            while (parentCell && cells.indexOf(parentCell) < 0) {\n                parentCell = parentCell.getParent();\n            }\n        }\n        return !this.getDataModel().isLayer(cell) && !parentCell ? cell : null;\n    },\n    isSwimlaneNesting() {\n        return this.swimlaneNesting;\n    },\n    setSwimlaneNesting(value) {\n        this.swimlaneNesting = value;\n    },\n    isSwimlaneSelectionEnabled() {\n        return this.swimlaneSelectionEnabled;\n    },\n    setSwimlaneSelectionEnabled(value) {\n        this.swimlaneSelectionEnabled = value;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const TerminalMixin = {\n    isTerminalPointMovable(cell, source) {\n        return true;\n    },\n    getOpposites(edges, terminal = null, includeSources = true, includeTargets = true) {\n        const terminals = [];\n        // Fast lookup to avoid duplicates in terminals array\n        const coveredEntries = new Map();\n        for (let i = 0; i < edges.length; i += 1) {\n            const state = this.getView().getState(edges[i]);\n            const source = state\n                ? state.getVisibleTerminal(true)\n                : this.getView().getVisibleTerminal(edges[i], true);\n            const target = state\n                ? state.getVisibleTerminal(false)\n                : this.getView().getVisibleTerminal(edges[i], false);\n            // Checks if the terminal is the source of the edge and if the target should be stored in the result\n            if (source === terminal && target && target !== terminal && includeTargets) {\n                if (!coveredEntries.has(target)) {\n                    coveredEntries.set(target, true);\n                    terminals.push(target);\n                }\n            }\n            // Checks if the terminal is the target of the edge and if the source should be stored in the result\n            else if (target === terminal && source && source !== terminal && includeSources) {\n                if (!coveredEntries.has(source)) {\n                    coveredEntries.set(source, true);\n                    terminals.push(source);\n                }\n            }\n        }\n        return terminals;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { htmlEntities } from '../../util/StringUtils.js';\nimport { translate } from '../../internal/i18n-utils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const TooltipMixin = {\n    getTooltip(state, node, x, y) {\n        let tip = null;\n        // Checks if the mouse is over the folding icon\n        if (state.control &&\n            (node === state.control.node || node.parentNode === state.control.node)) {\n            tip = this.getCollapseExpandResource();\n            tip = htmlEntities(translate(tip) || tip, true).replace(/\\\\n/g, '<br>');\n        }\n        if (!tip && state.overlays) {\n            state.overlays.forEach((shape) => {\n                // LATER: Exit loop if tip is not null\n                if (!tip && (node === shape.node || node.parentNode === shape.node)) {\n                    tip = shape.overlay ? (shape.overlay.toString() ?? null) : null;\n                }\n            });\n        }\n        if (!tip) {\n            const selectionCellsHandler = this.getPlugin('SelectionCellsHandler');\n            const handler = selectionCellsHandler?.getHandler(state.cell);\n            if (handler &&\n                'getTooltipForNode' in handler &&\n                typeof handler.getTooltipForNode === 'function') {\n                tip = handler.getTooltipForNode(node);\n            }\n        }\n        if (!tip) {\n            tip = this.getTooltipForCell(state.cell);\n        }\n        return tip;\n    },\n    getTooltipForCell(cell) {\n        let tip = null;\n        if (cell && 'getTooltip' in cell) {\n            // @ts-ignore getTooltip() must exists.\n            tip = cell.getTooltip();\n        }\n        else {\n            tip = this.convertValueToString(cell);\n        }\n        return tip;\n    },\n    setTooltips(enabled) {\n        const tooltipHandler = this.getPlugin('TooltipHandler');\n        tooltipHandler?.setEnabled(enabled);\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { isNode } from '../../util/domUtils.js';\nimport { translate } from '../../internal/i18n-utils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const ValidationMixin = {\n    validationAlert(message) {\n        alert(message);\n    },\n    isEdgeValid(edge, source, target) {\n        return !this.getEdgeValidationError(edge, source, target);\n    },\n    getEdgeValidationError(edge = null, source = null, target = null) {\n        if (edge && !this.isAllowDanglingEdges() && (!source || !target)) {\n            return '';\n        }\n        if (edge && !edge.getTerminal(true) && !edge.getTerminal(false)) {\n            return null;\n        }\n        // Checks if we're dealing with a loop\n        if (!this.isAllowLoops() && source === target && source) {\n            return '';\n        }\n        // Checks if the connection is generally allowed\n        if (!this.isValidConnection(source, target)) {\n            return '';\n        }\n        if (source && target) {\n            let error = '';\n            // Checks if the cells are already connected\n            // and adds an error message if required\n            if (!this.isMultigraph()) {\n                const tmp = this.getDataModel().getEdgesBetween(source, target, true);\n                // Checks if the source and target are not connected by another edge\n                if (tmp.length > 1 || (tmp.length === 1 && tmp[0] !== edge)) {\n                    error += `${translate(this.getAlreadyConnectedResource()) ||\n                        this.getAlreadyConnectedResource()}\\n`;\n                }\n            }\n            // Gets the number of outgoing edges from the source\n            // and the number of incoming edges from the target\n            // without counting the edge being currently changed.\n            const sourceOut = source.getDirectedEdgeCount(true, edge);\n            const targetIn = target.getDirectedEdgeCount(false, edge);\n            // Checks the change against each multiplicity rule\n            for (const multiplicity of this.multiplicities) {\n                const err = multiplicity.check(this, // needs to cast to Graph\n                edge, source, target, sourceOut, targetIn);\n                if (err != null) {\n                    error += err;\n                }\n            }\n            // Validates the source and target terminals independently\n            const err = this.validateEdge(edge, source, target);\n            if (err != null) {\n                error += err;\n            }\n            return error.length > 0 ? error : null;\n        }\n        return this.isAllowDanglingEdges() ? null : '';\n    },\n    validateEdge(edge = null, source = null, target = null) {\n        return null;\n    },\n    validateGraph(cell = null, context) {\n        cell = cell ?? this.getDataModel().getRoot();\n        if (!cell) {\n            return 'The root does not exist!';\n        }\n        context = context ?? {};\n        let isValid = true;\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const tmp = cell.getChildAt(i);\n            let ctx = context;\n            if (this.isValidRoot(tmp)) {\n                ctx = {};\n            }\n            const warn = this.validateGraph(tmp, ctx);\n            if (warn) {\n                this.setCellWarning(tmp, warn.replace(/\\n/g, '<br>'));\n            }\n            else {\n                this.setCellWarning(tmp, null);\n            }\n            isValid = isValid && warn == null;\n        }\n        let warning = '';\n        // Adds error for invalid children if collapsed (children invisible)\n        if (cell && cell.isCollapsed() && !isValid) {\n            warning += `${translate(this.getContainsValidationErrorsResource()) ||\n                this.getContainsValidationErrorsResource()}\\n`;\n        }\n        // Checks edges and cells using the defined multiplicities\n        if (cell && cell.isEdge()) {\n            warning +=\n                this.getEdgeValidationError(cell, cell.getTerminal(true), cell.getTerminal(false)) || '';\n        }\n        else {\n            warning += this.getCellValidationError(cell) || '';\n        }\n        // Checks custom validation rules\n        const err = this.validateCell(cell, context);\n        if (err != null) {\n            warning += err;\n        }\n        // Updates the display with the warning icons\n        // before any potential alerts are displayed.\n        // LATER: Move this into addCellOverlay. Redraw\n        // should check if overlay was added or removed.\n        if (cell.getParent() == null) {\n            this.getView().validate();\n        }\n        return warning.length > 0 || !isValid ? warning : null;\n    },\n    getCellValidationError(cell) {\n        const outCount = cell.getDirectedEdgeCount(true);\n        const inCount = cell.getDirectedEdgeCount(false);\n        const value = cell.getValue();\n        let error = '';\n        for (let i = 0; i < this.multiplicities.length; i += 1) {\n            const rule = this.multiplicities[i];\n            if (rule.source &&\n                isNode(value, rule.type, rule.attr, rule.value) &&\n                (outCount > rule.max || outCount < rule.min)) {\n                error += `${rule.countError}\\n`;\n            }\n            else if (!rule.source &&\n                isNode(value, rule.type, rule.attr, rule.value) &&\n                (inCount > rule.max || inCount < rule.min)) {\n                error += `${rule.countError}\\n`;\n            }\n        }\n        return error.length > 0 ? error : null;\n    },\n    validateCell(cell, context) {\n        return null;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Cell from '../cell/Cell.js';\nimport Geometry from '../geometry/Geometry.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const VertexMixin = {\n    vertexLabelsMovable: false,\n    allowNegativeCoordinates: true,\n    isAllowNegativeCoordinates() {\n        return this.allowNegativeCoordinates;\n    },\n    setAllowNegativeCoordinates(value) {\n        this.allowNegativeCoordinates = value;\n    },\n    insertVertex(...args) {\n        let parent;\n        let id;\n        let value;\n        let x;\n        let y;\n        let width;\n        let height;\n        let style;\n        let relative;\n        let geometryClass;\n        if (args.length === 1 && typeof args[0] === 'object') {\n            const params = args[0];\n            parent = params.parent;\n            id = params.id;\n            value = params.value;\n            x = 'x' in params ? params.x : params.position?.[0];\n            y = 'y' in params ? params.y : params.position?.[1];\n            width = 'width' in params ? params.width : params.size?.[0];\n            height = 'height' in params ? params.height : params.size?.[1];\n            style = params.style;\n            relative = params.relative;\n            geometryClass = params.geometryClass;\n        }\n        else {\n            // Otherwise treat as arguments\n            [parent, id, value, x, y, width, height, style, relative, geometryClass] = args;\n        }\n        const vertex = this.createVertex(parent, id, value, x, y, width, height, style, relative, geometryClass);\n        return this.addCell(vertex, parent);\n    },\n    createVertex(_parent, id, value, x, y, width, height, style, relative = false, geometryClass = Geometry) {\n        // Creates the geometry for the vertex\n        const geometry = new geometryClass(x, y, width, height);\n        geometry.relative = relative;\n        // Creates the vertex\n        const vertex = new Cell(value, geometry, style);\n        vertex.setId(id);\n        vertex.setVertex(true);\n        vertex.setConnectable(true);\n        return vertex;\n    },\n    getChildVertices(parent) {\n        return this.getChildCells(parent, true, false);\n    },\n    isVertexLabelsMovable() {\n        return this.vertexLabelsMovable;\n    },\n    setVertexLabelsMovable(value) {\n        this.vertexLabelsMovable = value;\n    },\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../geometry/Rectangle.js';\nimport { hasScrollbars } from '../../util/styleUtils.js';\n// @ts-expect-error The properties of PartialGraph are defined elsewhere.\nexport const ZoomMixin = {\n    zoomFactor: 1.2,\n    keepSelectionVisibleOnZoom: false,\n    centerZoom: true,\n    zoomIn() {\n        this.zoom(this.zoomFactor);\n    },\n    zoomOut() {\n        this.zoom(1 / this.zoomFactor);\n    },\n    zoomActual() {\n        if (this.getView().scale === 1) {\n            this.getView().setTranslate(0, 0);\n        }\n        else {\n            this.getView().translate.x = 0;\n            this.getView().translate.y = 0;\n            this.getView().setScale(1);\n        }\n    },\n    zoomTo(scale, center = false) {\n        this.zoom(scale / this.getView().scale, center);\n    },\n    zoom(factor, center) {\n        center = center ?? this.centerZoom;\n        const scale = Math.round(this.getView().scale * factor * 100) / 100;\n        const state = this.getView().getState(this.getSelectionCell());\n        const container = this.getContainer();\n        factor = scale / this.getView().scale;\n        if (this.keepSelectionVisibleOnZoom && state != null) {\n            const rect = new Rectangle(state.x * factor, state.y * factor, state.width * factor, state.height * factor);\n            // Refreshes the display only once if a scroll is carried out\n            this.getView().scale = scale;\n            if (!this.scrollRectToVisible(rect)) {\n                this.getView().revalidate();\n                // Forces an event to be fired but does not revalidate again\n                this.getView().setScale(scale);\n            }\n        }\n        else {\n            const _hasScrollbars = hasScrollbars(this.getContainer());\n            if (center && !_hasScrollbars) {\n                let dx = container.offsetWidth;\n                let dy = container.offsetHeight;\n                if (factor > 1) {\n                    const f = (factor - 1) / (scale * 2);\n                    dx *= -f;\n                    dy *= -f;\n                }\n                else {\n                    const f = (1 / factor - 1) / (this.getView().scale * 2);\n                    dx *= f;\n                    dy *= f;\n                }\n                this.getView().scaleAndTranslate(scale, this.getView().translate.x + dx, this.getView().translate.y + dy);\n            }\n            else {\n                // Allows for changes of translate and scrollbars during setscale\n                const tx = this.getView().translate.x;\n                const ty = this.getView().translate.y;\n                const sl = container.scrollLeft;\n                const st = container.scrollTop;\n                this.getView().setScale(scale);\n                if (_hasScrollbars) {\n                    let dx = 0;\n                    let dy = 0;\n                    if (center) {\n                        dx = (container.offsetWidth * (factor - 1)) / 2;\n                        dy = (container.offsetHeight * (factor - 1)) / 2;\n                    }\n                    container.scrollLeft =\n                        (this.getView().translate.x - tx) * this.getView().scale +\n                            Math.round(sl * factor + dx);\n                    container.scrollTop =\n                        (this.getView().translate.y - ty) * this.getView().scale +\n                            Math.round(st * factor + dy);\n                }\n            }\n        }\n    },\n    zoomToRect(rect) {\n        const container = this.getContainer();\n        const scaleX = container.clientWidth / rect.width;\n        const scaleY = container.clientHeight / rect.height;\n        const aspectFactor = scaleX / scaleY;\n        // Remove any overlap of the rect outside the client area\n        rect.x = Math.max(0, rect.x);\n        rect.y = Math.max(0, rect.y);\n        let rectRight = Math.min(container.scrollWidth, rect.x + rect.width);\n        let rectBottom = Math.min(container.scrollHeight, rect.y + rect.height);\n        rect.width = rectRight - rect.x;\n        rect.height = rectBottom - rect.y;\n        // The selection area has to be increased to the same aspect\n        // ratio as the container, centred around the centre point of the\n        // original rect passed in.\n        if (aspectFactor < 1.0) {\n            // Height needs increasing\n            const newHeight = rect.height / aspectFactor;\n            const deltaHeightBuffer = (newHeight - rect.height) / 2.0;\n            rect.height = newHeight;\n            // Assign up to half the buffer to the upper part of the rect, not crossing 0\n            // put the rest on the bottom\n            const upperBuffer = Math.min(rect.y, deltaHeightBuffer);\n            rect.y -= upperBuffer;\n            // Check if the bottom has extended too far\n            rectBottom = Math.min(container.scrollHeight, rect.y + rect.height);\n            rect.height = rectBottom - rect.y;\n        }\n        else {\n            // Width needs increasing\n            const newWidth = rect.width * aspectFactor;\n            const deltaWidthBuffer = (newWidth - rect.width) / 2.0;\n            rect.width = newWidth;\n            // Assign up to half the buffer to the upper part of the rect, not crossing 0\n            // put the rest on the bottom\n            const leftBuffer = Math.min(rect.x, deltaWidthBuffer);\n            rect.x -= leftBuffer;\n            // Check if the right hand side has extended too far\n            rectRight = Math.min(container.scrollWidth, rect.x + rect.width);\n            rect.width = rectRight - rect.x;\n        }\n        const scale = container.clientWidth / rect.width;\n        const newScale = this.getView().scale * scale;\n        if (!hasScrollbars(this.getContainer())) {\n            this.getView().scaleAndTranslate(newScale, this.getView().translate.x - rect.x / this.getView().scale, this.getView().translate.y - rect.y / this.getView().scale);\n        }\n        else {\n            this.getView().setScale(newScale);\n            container.scrollLeft = Math.round(rect.x * scale);\n            container.scrollTop = Math.round(rect.y * scale);\n        }\n    },\n};\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { mixInto } from '../../internal/utils.js';\nimport { CellsMixin } from './CellsMixin.js';\nimport { ConnectionsMixin } from './ConnectionsMixin.js';\nimport { DragDropMixin } from './DragDropMixin.js';\nimport { EdgeMixin } from './EdgeMixin.js';\nimport { EditingMixin } from './EditingMixin.js';\nimport { EventsMixin } from './EventsMixin.js';\nimport { FoldingMixin } from './FoldingMixin.js';\nimport { GroupingMixin } from './GroupingMixin.js';\nimport { ImageMixin } from './ImageMixin.js';\nimport { LabelMixin } from './LabelMixin.js';\nimport { OrderMixin } from './OrderMixin.js';\nimport { OverlaysMixin } from './OverlaysMixin.js';\nimport { PageBreaksMixin } from './PageBreaksMixin.js';\nimport { PanningMixin } from './PanningMixin.js';\nimport { PortsMixin } from './PortsMixin.js';\nimport { SelectionMixin } from './SelectionMixin.js';\nimport { SnapMixin } from './SnapMixin.js';\nimport { SwimlaneMixin } from './SwimlaneMixin.js';\nimport { TerminalMixin } from './TerminalMixin.js';\nimport { TooltipMixin } from './TooltipMixin.js';\nimport { ValidationMixin } from './ValidationMixin.js';\nimport { VertexMixin } from './VertexMixin.js';\nimport { ZoomMixin } from './ZoomMixin.js';\nexport const applyGraphMixins = (target) => {\n    const mixIntoGraph = mixInto(target);\n    // Apply the mixins in alphabetic order to ease maintenance.\n    // The order should have no influence of the resulting Graph prototype.\n    for (const mixin of [\n        CellsMixin,\n        ConnectionsMixin,\n        DragDropMixin,\n        EdgeMixin,\n        EditingMixin,\n        EventsMixin,\n        FoldingMixin,\n        GroupingMixin,\n        ImageMixin,\n        LabelMixin,\n        OrderMixin,\n        PageBreaksMixin,\n        OverlaysMixin,\n        PanningMixin,\n        PortsMixin,\n        SelectionMixin,\n        SnapMixin,\n        SwimlaneMixin,\n        TerminalMixin,\n        TooltipMixin,\n        ValidationMixin,\n        VertexMixin,\n        ZoomMixin,\n    ]) {\n        mixIntoGraph(mixin);\n    }\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Image from './image/ImageBox.js';\nimport EventObject from './event/EventObject.js';\nimport EventSource from './event/EventSource.js';\nimport InternalEvent from './event/InternalEvent.js';\nimport Rectangle from './geometry/Rectangle.js';\nimport Client from '../Client.js';\nimport { getCurrentStyle, hasScrollbars, parseCssNumber } from '../util/styleUtils.js';\nimport Cell from './cell/Cell.js';\nimport { PAGE_FORMAT_A4_PORTRAIT } from '../util/Constants.js';\nimport ChildChange from './undoable_changes/ChildChange.js';\nimport GeometryChange from './undoable_changes/GeometryChange.js';\nimport RootChange from './undoable_changes/RootChange.js';\nimport StyleChange from './undoable_changes/StyleChange.js';\nimport TerminalChange from './undoable_changes/TerminalChange.js';\nimport ValueChange from './undoable_changes/ValueChange.js';\nimport { isNode } from '../util/domUtils.js';\nimport { EdgeStyle } from './style/builtin-style-elements.js';\nimport { EdgeStyleRegistry } from './style/edge/EdgeStyleRegistry.js';\nimport EdgeHandler from './handler/EdgeHandler.js';\nimport VertexHandler from './handler/VertexHandler.js';\nimport EdgeSegmentHandler from './handler/EdgeSegmentHandler.js';\nimport ElbowEdgeHandler from './handler/ElbowEdgeHandler.js';\nimport { applyGraphMixins } from './mixins/_graph-mixins-apply.js';\nimport { isNullish } from '../internal/utils.js';\nimport { isI18nEnabled } from '../internal/i18n-utils.js';\n/**\n * Extends {@link EventSource} to implement a graph component for the browser. This is the entry point class of the package.\n *\n * To activate panning and connections use {@link setPanning} and {@link setConnectable}.\n * For rubberband selection you must create a new instance of {@link rubberband}.\n *\n * The following listeners are added to {@link mouseListeners} by default:\n *\n * - tooltipHandler: {@link TooltipHandler} that displays tooltips\n * - panningHandler: {@link PanningHandler} for panning and popup menus\n * - connectionHandler: {@link ConnectionHandler} for creating connections\n * - selectionHandler: {@link SelectionHandler} for moving and cloning cells\n *\n * These listeners will be called in the above order if they are enabled.\n *\n * @category Graph\n */\nexport class AbstractGraph extends EventSource {\n    // ===================================================================================================================\n    // Group: \"Create Class Instance\" factory functions.\n    // These can be overridden in subclasses to allow the Graph to instantiate user-defined implementations with custom behavior.\n    // Notice that the methods will be moved as part of https://github.com/maxGraph/maxGraph/issues/762\n    // ===================================================================================================================\n    /**\n     * Hooks to create a new {@link EdgeHandler} for the given {@link CellState}.\n     *\n     * @param state {@link CellState} to create the handler for.\n     */\n    createEdgeHandlerInstance(state) {\n        // Note this method not being called createEdgeHandler to keep compatibility\n        // with older code which overrides/calls createEdgeHandler\n        return new EdgeHandler(state);\n    }\n    /**\n     * Hooks to create a new {@link EdgeSegmentHandler} for the given {@link CellState}.\n     *\n     * @param state {@link CellState} to create the handler for.\n     */\n    createEdgeSegmentHandler(state) {\n        return new EdgeSegmentHandler(state);\n    }\n    /**\n     * Hooks to create a new {@link ElbowEdgeHandler} for the given {@link CellState}.\n     *\n     * @param state {@link CellState} to create the handler for.\n     */\n    createElbowEdgeHandler(state) {\n        return new ElbowEdgeHandler(state);\n    }\n    /**\n     * Hooks to create a new {@link VertexHandler} for the given {@link CellState}.\n     *\n     * @param state {@link CellState} to create the handler for.\n     */\n    createVertexHandler(state) {\n        return new VertexHandler(state);\n    }\n    // ===================================================================================================================\n    // Group: Main graph constructor and functions\n    // ===================================================================================================================\n    /**\n     * Convenient hook method that can be used to register global styles and shapes using the related global registries.\n     *\n     * While registration can also be done outside of this class (as it applies globally),\n     * implementing it here makes the registration process transparent to the caller of this class.\n     *\n     * Subclasses can override this method to register custom defaults.\n     */\n    registerDefaults() {\n        // do nothing, it's the purpose of this class not to load defaults.\n    }\n    constructor(options) {\n        super();\n        this.destroyed = false;\n        this.graphModelChangeListener = null;\n        this.paintBackground = null;\n        this.isConstrainedMoving = false;\n        // ===================================================================================================================\n        // Group: Variables (that maybe should be in the mixins, but need to be created for each new class instance)\n        // ===================================================================================================================\n        this.cells = [];\n        this.imageBundles = [];\n        /**\n         * Holds the mouse event listeners. See {@link fireMouseEvent}.\n         */\n        this.mouseListeners = [];\n        /**\n         * An array of {@link Multiplicity} describing the allowed connections in a graph.\n         */\n        this.multiplicities = [];\n        this.plugins = new Map();\n        /**\n         * RenderHint as it was passed to the constructor.\n         */\n        this.renderHint = null;\n        /**\n         * Dialect to be used for drawing the graph.\n         */\n        this.dialect = 'svg';\n        /**\n         * Value returned by {@link getOverlap} if {@link isAllowOverlapParent} returns\n         * `true` for the given cell. {@link getOverlap} is used in {@link constrainChild} if\n         * {@link isConstrainChild} returns `true`. The value specifies the\n         * portion of the child which is allowed to overlap the parent.\n         */\n        this.defaultOverlap = 0.5;\n        /**\n         * Specifies the default parent to be used to insert new cells.\n         * This is used in {@link getDefaultParent}.\n         * @default null\n         */\n        this.defaultParent = null;\n        /**\n         * Specifies the {@link Image} to be returned by {@link getBackgroundImage}.\n         * @default null\n         *\n         * @example\n         * ```javascript\n         * var img = new mxImage('http://www.example.com/maps/examplemap.jpg', 1024, 768);\n         * graph.setBackgroundImage(img);\n         * graph.view.validate();\n         * ```\n         */\n        this.backgroundImage = null;\n        /**\n         * Specifies if the background page should be visible.\n         * Not yet implemented.\n         * @default false\n         */\n        this.pageVisible = false;\n        /**\n         * Specifies if a dashed line should be drawn between multiple pages.\n         * If you change this value while a graph is being displayed then you\n         * should call {@link sizeDidChange} to force an update of the display.\n         * @default false\n         */\n        this.pageBreaksVisible = false;\n        /**\n         * Specifies the color for page breaks.\n         * @default gray\n         */\n        this.pageBreakColor = 'gray';\n        /**\n         * Specifies the page breaks should be dashed.\n         * @default true\n         */\n        this.pageBreakDashed = true;\n        /**\n         * Specifies the minimum distance in pixels for page breaks to be visible.\n         * @default 20\n         */\n        this.minPageBreakDist = 20;\n        /**\n         * Specifies if the graph size should be rounded to the next page number in\n         * {@link sizeDidChange}. This is only used if the graph container has scrollbars.\n         * @default false\n         */\n        this.preferPageSize = false;\n        /**\n         * Specifies the page format for the background page.\n         * This is used as the default in {@link PrintPreview} and for painting the background page\n         * if {@link pageVisible} is `true` and the page breaks if {@link pageBreaksVisible} is `true`.\n         * @default {@link PAGE_FORMAT_A4_PORTRAIT}\n         */\n        this.pageFormat = new Rectangle(...PAGE_FORMAT_A4_PORTRAIT);\n        /**\n         * Specifies the scale of the background page.\n         * Not yet implemented.\n         * @default 1.5\n         */\n        this.pageScale = 1.5;\n        /**\n         * Specifies the return value for {@link isEnabled}.\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * Specifies the return value for {@link canExportCell}.\n         * @default true\n         */\n        this.exportEnabled = true;\n        /**\n         * Specifies the return value for {@link canImportCell}.\n         * @default true\n         */\n        this.importEnabled = true;\n        /**\n         * Specifies if the graph should automatically scroll regardless of the\n         * scrollbars. This will scroll the container using positive values for\n         * scroll positions (ie usually only rightwards and downwards). To avoid\n         * possible conflicts with panning, set {@link translateToScrollPosition} to `true`.\n         */\n        this.ignoreScrollbars = false;\n        /**\n         * Specifies if the graph should automatically convert the current scroll\n         * position to a translate in the graph view when a mouseUp event is received.\n         * This can be used to avoid conflicts when using {@link autoScroll} and\n         * {@link ignoreScrollbars} with no scrollbars in the container.\n         */\n        this.translateToScrollPosition = false;\n        /**\n         * {@link Rectangle} that specifies the area in which all cells in the diagram\n         * should be placed. Uses in {@link getMaximumGraphBounds}. Use a width or height of\n         * `0` if you only want to give a upper, left corner.\n         */\n        this.maximumGraphBounds = null;\n        /**\n         * {@link Rectangle} that specifies the minimum size of the graph. This is ignored\n         * if the graph container has no scrollbars.\n         * @default null\n         */\n        this.minimumGraphSize = null;\n        /**\n         * {@link Rectangle} that specifies the minimum size of the {@link container} if\n         * {@link resizeContainer} is `true`.\n         */\n        this.minimumContainerSize = null;\n        /**\n         * {@link Rectangle} that specifies the maximum size of the container if\n         * {@link resizeContainer} is `true`.\n         */\n        this.maximumContainerSize = null;\n        /**\n         * Specifies if the container should be resized to the graph size when\n         * the graph size has changed.\n         * @default false\n         */\n        this.resizeContainer = false;\n        /**\n         * Border to be added to the bottom and right side when the container is\n         * being resized after the graph has been changed.\n         * @default 0\n         */\n        this.border = 0;\n        /**\n         * Specifies if edges should appear in the foreground regardless of their order\n         * in the model. If {@link keepEdgesInForeground} and {@link keepEdgesInBackground} are\n         * both `true` then the normal order is applied.\n         * @default false\n         */\n        this.keepEdgesInForeground = false;\n        /**\n         * Specifies if edges should appear in the background regardless of their order\n         * in the model. If {@link keepEdgesInForeground} and {@link keepEdgesInBackground} are\n         * both `true` then the normal order is applied.\n         * @default false\n         */\n        this.keepEdgesInBackground = false;\n        /**\n         * Specifies the return value for {@link isRecursiveResize}.\n         * @default false (for backwards compatibility)\n         */\n        this.recursiveResize = false;\n        /**\n         * Specifies if the scale and translate should be reset if the root changes in\n         * the model.\n         * @default true\n         */\n        this.resetViewOnRootChange = true;\n        /**\n         * Specifies if loops (aka self-references) are allowed.\n         * @default false\n         */\n        this.allowLoops = false;\n        /**\n         * {@link EdgeStyle} to be used for loops.\n         *\n         * This is a fallback for loops if the {@link CellStateStyle.loopStyle} is `undefined`.\n         * @default {@link EdgeStyle.Loop}\n         */\n        this.defaultLoopStyle = EdgeStyle.Loop;\n        /**\n         * Specifies if multiple edges in the same direction between the same pair of\n         * vertices are allowed.\n         * @default true\n         */\n        this.multigraph = true;\n        /**\n         * Specifies the {@link Image} for the image to be used to display a warning\n         * overlay. See {@link setCellWarning}. Default value is Client.imageBasePath +\n         * '/warning'.  The extension for the image depends on the platform. It is\n         * '.png' on the Mac and '.gif' on all other platforms.\n         */\n        this.warningImage = new Image(`${Client.imageBasePath}/warning${Client.IS_MAC ? '.png' : '.gif'}`, 16, 16);\n        /**\n         * Specifies the resource key for the error message to be displayed in\n         * non-multigraphs when two vertices are already connected. If the resource\n         * for this key does not exist then the value is used as the error message.\n         * @default 'alreadyConnected'\n         */\n        this.alreadyConnectedResource = isI18nEnabled() ? 'alreadyConnected' : '';\n        /**\n         * Specifies the resource key for the warning message to be displayed when\n         * a collapsed cell contains validation errors. If the resource for this\n         * key does not exist then the value is used as the warning message.\n         * @default 'containsValidationErrors'\n         */\n        this.containsValidationErrorsResource = isI18nEnabled()\n            ? 'containsValidationErrors'\n            : '';\n        /** Folding options. */\n        this.options = {\n            foldingEnabled: true,\n            collapsedImage: new Image(`${Client.imageBasePath}/collapsed.gif`, 9, 9),\n            expandedImage: new Image(`${Client.imageBasePath}/expanded.gif`, 9, 9),\n            collapseToPreferredSize: true,\n        };\n        this.getContainer = () => this.container;\n        this.getPlugin = (id) => this.plugins.get(id);\n        this.getCellRenderer = () => this.cellRenderer;\n        this.getDialect = () => this.dialect;\n        this.isPageVisible = () => this.pageVisible;\n        this.isPageBreaksVisible = () => this.pageBreaksVisible;\n        this.getPageBreakColor = () => this.pageBreakColor;\n        this.isPageBreakDashed = () => this.pageBreakDashed;\n        this.getMinPageBreakDist = () => this.minPageBreakDist;\n        this.isPreferPageSize = () => this.preferPageSize;\n        this.getPageFormat = () => this.pageFormat;\n        this.getPageScale = () => this.pageScale;\n        this.isExportEnabled = () => this.exportEnabled;\n        this.isImportEnabled = () => this.importEnabled;\n        this.isIgnoreScrollbars = () => this.ignoreScrollbars;\n        this.isTranslateToScrollPosition = () => this.translateToScrollPosition;\n        this.getMinimumGraphSize = () => this.minimumGraphSize;\n        this.setMinimumGraphSize = (size) => (this.minimumGraphSize = size);\n        this.getMinimumContainerSize = () => this.minimumContainerSize;\n        this.setMinimumContainerSize = (size) => (this.minimumContainerSize = size);\n        this.getAlreadyConnectedResource = () => this.alreadyConnectedResource;\n        this.getContainsValidationErrorsResource = () => this.containsValidationErrorsResource;\n        this.registerDefaults();\n        this.container = options?.container ?? document.createElement('div');\n        // collaborators\n        this.initializeCollaborators(options);\n        // Adds a graph model listener to update the view\n        this.graphModelChangeListener = (_sender, evt) => {\n            this.graphModelChanged(evt.getProperty('edit').changes);\n        };\n        this.getDataModel().addListener(InternalEvent.CHANGE, this.graphModelChangeListener);\n        // Initializes the container using the view\n        this.view.init();\n        // Updates the size of the container for the current graph\n        this.sizeDidChange();\n        // Initializes plugins\n        options?.plugins?.forEach((p) => this.plugins.set(p.pluginId, new p(this)));\n        this.view.revalidate();\n    }\n    getWarningImage() {\n        return this.warningImage;\n    }\n    /**\n     * Updates the model in a transaction.\n     *\n     * @param fn the update to be performed in the transaction.\n     *\n     * @see {@link GraphDataModel.batchUpdate}\n     */\n    batchUpdate(fn) {\n        this.getDataModel().batchUpdate(fn);\n    }\n    /**\n     * Returns the {@link GraphDataModel} that contains the cells.\n     */\n    getDataModel() {\n        return this.model;\n    }\n    /**\n     * Returns the {@link GraphView} that contains the {@link CellState}s.\n     */\n    getView() {\n        return this.view;\n    }\n    /**\n     * Returns the {@link Stylesheet} that defines the style.\n     */\n    getStylesheet() {\n        return this.stylesheet;\n    }\n    /**\n     * Sets the {@link Stylesheet} that defines the style.\n     */\n    setStylesheet(stylesheet) {\n        this.stylesheet = stylesheet;\n    }\n    /**\n     * Called when the graph model changes. Invokes {@link processChange} on each\n     * item of the given array to update the view accordingly.\n     *\n     * @param changes Array that contains the individual changes.\n     */\n    graphModelChanged(changes) {\n        for (const change of changes) {\n            this.processChange(change);\n        }\n        this.updateSelection();\n        this.view.validate();\n        this.sizeDidChange();\n    }\n    /**\n     * Processes the given change and invalidates the respective cached data\n     * in {@link GraphView}. This fires a {@link root} event if the root has changed in the\n     * model.\n     *\n     * @param {(RootChange|ChildChange|TerminalChange|GeometryChange|ValueChange|StyleChange)} change - Object that represents the change on the model.\n     */\n    processChange(change) {\n        // Resets the view settings, removes all cells and clears\n        // the selection if the root changes.\n        if (change instanceof RootChange) {\n            this.clearSelection();\n            this.setDefaultParent(null);\n            if (change.previous)\n                this.removeStateForCell(change.previous);\n            if (this.resetViewOnRootChange) {\n                this.view.scale = 1;\n                this.view.translate.x = 0;\n                this.view.translate.y = 0;\n            }\n            this.fireEvent(new EventObject(InternalEvent.ROOT));\n        }\n        // Adds or removes a child to the view by online invaliding\n        // the minimal required portions of the cache, namely, the\n        // old and new parent and the child.\n        else if (change instanceof ChildChange) {\n            const newParent = change.child.getParent();\n            this.view.invalidate(change.child, true, true);\n            if (!newParent ||\n                !this.getDataModel().contains(newParent) ||\n                newParent.isCollapsed()) {\n                this.view.invalidate(change.child, true, true);\n                this.removeStateForCell(change.child);\n                // Handles special case of current root of view being removed\n                if (this.view.currentRoot == change.child) {\n                    this.home();\n                }\n            }\n            if (newParent != change.previous) {\n                // Refreshes the collapse/expand icons on the parents\n                if (newParent != null) {\n                    this.view.invalidate(newParent, false, false);\n                }\n                if (change.previous != null) {\n                    this.view.invalidate(change.previous, false, false);\n                }\n            }\n        }\n        // Handles two special cases where the shape does not need to be\n        // recreated from scratch, it only needs to be invalidated.\n        else if (change instanceof TerminalChange || change instanceof GeometryChange) {\n            // Checks if the geometry has changed to avoid unnessecary revalidation\n            if (change instanceof TerminalChange ||\n                (change.previous == null && change.geometry != null) ||\n                (change.previous != null && !change.previous.equals(change.geometry))) {\n                this.view.invalidate(change.cell);\n            }\n        }\n        // Handles two special cases where only the shape, but no\n        // descendants need to be recreated\n        else if (change instanceof ValueChange) {\n            this.view.invalidate(change.cell, false, false);\n        }\n        // Requires a new mxShape in JavaScript\n        else if (change instanceof StyleChange) {\n            this.view.invalidate(change.cell, true, true);\n            const state = this.view.getState(change.cell);\n            if (state != null) {\n                state.invalidStyle = true;\n            }\n        }\n        // Removes the state from the cache by default\n        else if (change.cell != null && change.cell instanceof Cell) {\n            this.removeStateForCell(change.cell);\n        }\n    }\n    /**\n     * Scrolls the graph to the given point, extending the graph container if\n     * specified.\n     */\n    scrollPointToVisible(x, y, extend = false, border = 20) {\n        const panningHandler = this.getPlugin('PanningHandler');\n        if (!this.isTimerAutoScroll() &&\n            (this.ignoreScrollbars || hasScrollbars(this.container))) {\n            const c = this.container;\n            if (x >= c.scrollLeft &&\n                y >= c.scrollTop &&\n                x <= c.scrollLeft + c.clientWidth &&\n                y <= c.scrollTop + c.clientHeight) {\n                let dx = c.scrollLeft + c.clientWidth - x;\n                if (dx < border) {\n                    const old = c.scrollLeft;\n                    c.scrollLeft += border - dx;\n                    // Automatically extends the canvas size to the bottom, right\n                    // if the event is outside of the canvas and the edge of the\n                    // canvas has been reached. Notes: Needs fix for IE.\n                    if (extend && old === c.scrollLeft) {\n                        // @ts-ignore\n                        const root = this.view.getDrawPane().ownerSVGElement;\n                        const width = c.scrollWidth + border - dx;\n                        // Updates the clipping region. This is an expensive\n                        // operation that should not be executed too often.\n                        // @ts-ignore\n                        root.style.width = `${width}px`;\n                        c.scrollLeft += border - dx;\n                    }\n                }\n                else {\n                    dx = x - c.scrollLeft;\n                    if (dx < border) {\n                        c.scrollLeft -= border - dx;\n                    }\n                }\n                let dy = c.scrollTop + c.clientHeight - y;\n                if (dy < border) {\n                    const old = c.scrollTop;\n                    c.scrollTop += border - dy;\n                    if (old == c.scrollTop && extend) {\n                        // @ts-ignore\n                        const root = this.view.getDrawPane().ownerSVGElement;\n                        const height = c.scrollHeight + border - dy;\n                        // Updates the clipping region. This is an expensive\n                        // operation that should not be executed too often.\n                        // @ts-ignore\n                        root.style.height = `${height}px`;\n                        c.scrollTop += border - dy;\n                    }\n                }\n                else {\n                    dy = y - c.scrollTop;\n                    if (dy < border) {\n                        c.scrollTop -= border - dy;\n                    }\n                }\n            }\n        }\n        else if (this.isAllowAutoPanning() &&\n            panningHandler &&\n            !panningHandler.isActive()) {\n            panningHandler.getPanningManager().panTo(x + this.getPanDx(), y + this.getPanDy());\n        }\n    }\n    /**\n     * Returns the size of the border and padding on all four sides of the\n     * container. The left, top, right and bottom borders are stored in the x, y,\n     * width and height of the returned {@link Rectangle}, respectively.\n     */\n    getBorderSizes() {\n        const css = getCurrentStyle(this.container);\n        return new Rectangle(parseCssNumber(css.paddingLeft) +\n            (css.borderLeftStyle != 'none' ? parseCssNumber(css.borderLeftWidth) : 0), parseCssNumber(css.paddingTop) +\n            (css.borderTopStyle != 'none' ? parseCssNumber(css.borderTopWidth) : 0), parseCssNumber(css.paddingRight) +\n            (css.borderRightStyle != 'none' ? parseCssNumber(css.borderRightWidth) : 0), parseCssNumber(css.paddingBottom) +\n            (css.borderBottomStyle != 'none' ? parseCssNumber(css.borderBottomWidth) : 0));\n    }\n    /**\n     * Returns the preferred size of the background page if {@link preferPageSize} is true.\n     */\n    getPreferredPageSize(bounds, width, height) {\n        const tr = this.view.translate;\n        const fmt = this.pageFormat;\n        const ps = this.pageScale;\n        const page = new Rectangle(0, 0, Math.ceil(fmt.width * ps), Math.ceil(fmt.height * ps));\n        const hCount = this.pageBreaksVisible ? Math.ceil(width / page.width) : 1;\n        const vCount = this.pageBreaksVisible ? Math.ceil(height / page.height) : 1;\n        return new Rectangle(0, 0, hCount * page.width + 2 + tr.x, vCount * page.height + 2 + tr.y);\n    }\n    /**\n     * Resizes the container for the given graph width and height.\n     */\n    doResizeContainer(width, height) {\n        if (this.maximumContainerSize != null) {\n            width = Math.min(this.maximumContainerSize.width, width);\n            height = Math.min(this.maximumContainerSize.height, height);\n        }\n        const container = this.container;\n        container.style.width = `${Math.ceil(width)}px`;\n        container.style.height = `${Math.ceil(height)}px`;\n    }\n    /*****************************************************************************\n     * Group: UNCLASSIFIED\n     *****************************************************************************/\n    /**\n     * Creates a new handler for the given cell state. This implementation\n     * returns a new {@link EdgeHandler} of the corresponding cell is an edge,\n     * otherwise it returns an {@link VertexHandler}.\n     *\n     * @param state {@link CellState} whose handler should be created.\n     */\n    createHandler(state) {\n        let result = null;\n        if (state.cell.isEdge()) {\n            const source = state.getVisibleTerminalState(true);\n            const target = state.getVisibleTerminalState(false);\n            const geo = state.cell.getGeometry();\n            const edgeStyle = this.getView().getEdgeStyle(state, geo ? geo.points || undefined : undefined, source, target);\n            result = this.createEdgeHandler(state, edgeStyle);\n        }\n        else {\n            result = this.createVertexHandler(state);\n        }\n        return result;\n    }\n    /**\n     * Hooks to create a new {@link EdgeHandler} for the given {@link CellState}.\n     *\n     * This method relies on the registered elements in {@link EdgeStyleRegistry} to know which {@link EdgeHandler} to create.\n     * If the {@link EdgeStyle} is not registered, it will return a default {@link EdgeHandler}.\n     *\n     * @param state {@link CellState} to create the handler for.\n     * @param edgeStyle the {@link EdgeStyleFunction} that let choose the actual edge handler.\n     */\n    createEdgeHandler(state, edgeStyle) {\n        const handlerKind = EdgeStyleRegistry.getHandlerKind(edgeStyle);\n        switch (handlerKind) {\n            case 'elbow':\n                return this.createElbowEdgeHandler(state);\n            case 'segment':\n                return this.createEdgeSegmentHandler(state);\n        }\n        return this.createEdgeHandlerInstance(state);\n    }\n    /*****************************************************************************\n     * Group: Drill down\n     *****************************************************************************/\n    /**\n     * Returns the current root of the displayed cell hierarchy. This is a\n     * shortcut to {@link GraphView.currentRoot} in {@link GraphView}.\n     */\n    getCurrentRoot() {\n        return this.view.currentRoot;\n    }\n    /**\n     * Returns the translation to be used if the given cell is the root cell as\n     * an {@link Point}. This implementation returns null.\n     *\n     * To keep the children at their absolute position while stepping into groups,\n     * this function can be overridden as follows.\n     *\n     * @example\n     * ```javascript\n     * var offset = new mxPoint(0, 0);\n     *\n     * while (cell != null)\n     * {\n     *   var geo = this.model.getGeometry(cell);\n     *\n     *   if (geo != null)\n     *   {\n     *     offset.x -= geo.x;\n     *     offset.y -= geo.y;\n     *   }\n     *\n     *   cell = this.model.getParent(cell);\n     * }\n     *\n     * return offset;\n     * ```\n     *\n     * @param cell {@link Cell} that represents the root.\n     */\n    getTranslateForRoot(cell) {\n        return null;\n    }\n    /**\n     * Returns the offset to be used for the cells inside the given cell. The\n     * root and layer cells may be identified using {@link GraphDataModel.isRoot} and\n     * {@link GraphDataModel.isLayer}. For all other current roots, the\n     * {@link GraphView.currentRoot} field points to the respective cell, so that\n     * the following holds: cell == this.view.currentRoot. This implementation\n     * returns null.\n     *\n     * @param cell {@link Cell} whose offset should be returned.\n     */\n    getChildOffsetForCell(cell) {\n        return null;\n    }\n    /**\n     * Uses the root of the model as the root of the displayed cell hierarchy\n     * and selects the previous root.\n     */\n    home() {\n        const current = this.getCurrentRoot();\n        if (current != null) {\n            this.view.setCurrentRoot(null);\n            const state = this.view.getState(current);\n            if (state != null) {\n                this.setSelectionCell(current);\n            }\n        }\n    }\n    /**\n     * Returns true if the given cell is a valid root for the cell display\n     * hierarchy. This implementation returns true for all non-null values.\n     *\n     * @param cell {@link Cell} which should be checked as a possible root.\n     */\n    isValidRoot(cell) {\n        return !!cell;\n    }\n    /*****************************************************************************\n     * Group: Graph display\n     *****************************************************************************/\n    /**\n     * Returns the bounds of the visible graph. Shortcut to\n     * {@link GraphView.getGraphBounds}. See also: {@link getBoundingBoxFromGeometry}.\n     */\n    getGraphBounds() {\n        return this.view.getGraphBounds();\n    }\n    /**\n     * Returns the bounds inside which the diagram should be kept as an\n     * {@link Rectangle}.\n     */\n    getMaximumGraphBounds() {\n        return this.maximumGraphBounds;\n    }\n    /**\n     * Clears all cell states or the states for the hierarchy starting at the\n     * given cell and validates the graph. This fires a refresh event as the\n     * last step.\n     *\n     * @param cell Optional {@link Cell} for which the cell states should be cleared.\n     */\n    refresh(cell = null) {\n        if (cell) {\n            this.view.clear(cell, false);\n        }\n        else {\n            this.view.clear(undefined, true);\n        }\n        this.view.validate();\n        this.sizeDidChange();\n        this.fireEvent(new EventObject(InternalEvent.REFRESH));\n    }\n    /**\n     * Centers the graph in the container.\n     *\n     * @param horizontal Optional boolean that specifies if the graph should be centered\n     * horizontally. Default is `true`.\n     * @param vertical Optional boolean that specifies if the graph should be centered\n     * vertically. Default is `true`.\n     * @param cx Optional float that specifies the horizontal center. Default is `0.5`.\n     * @param cy Optional float that specifies the vertical center. Default is `0.5`.\n     */\n    center(horizontal = true, vertical = true, cx = 0.5, cy = 0.5) {\n        const container = this.container;\n        const _hasScrollbars = hasScrollbars(this.container);\n        const padding = 2 * this.getBorder();\n        const cw = container.clientWidth - padding;\n        const ch = container.clientHeight - padding;\n        const bounds = this.getGraphBounds();\n        const t = this.view.translate;\n        const s = this.view.scale;\n        let dx = horizontal ? cw - bounds.width : 0;\n        let dy = vertical ? ch - bounds.height : 0;\n        if (!_hasScrollbars) {\n            this.view.setTranslate(horizontal ? Math.floor(t.x - bounds.x / s + (dx * cx) / s) : t.x, vertical ? Math.floor(t.y - bounds.y / s + (dy * cy) / s) : t.y);\n        }\n        else {\n            bounds.x -= t.x;\n            bounds.y -= t.y;\n            const sw = container.scrollWidth;\n            const sh = container.scrollHeight;\n            if (sw > cw) {\n                dx = 0;\n            }\n            if (sh > ch) {\n                dy = 0;\n            }\n            this.view.setTranslate(Math.floor(dx / 2 - bounds.x), Math.floor(dy / 2 - bounds.y));\n            container.scrollLeft = (sw - cw) / 2;\n            container.scrollTop = (sh - ch) / 2;\n        }\n    }\n    /**\n     * Returns `true` if perimeter points should be computed such that the resulting edge has only horizontal or vertical segments.\n     *\n     * This method relies on the registered elements in {@link EdgeStyleRegistry} to know if the {@link CellStateStyle.edgeStyle} of the {@link CellState} is orthogonal.\n     * If the {@link EdgeStyle} is not registered, it is considered as NOT orthogonal.\n     *\n     * @param edge {@link CellState} that represents the edge.\n     */\n    isOrthogonal(edge) {\n        const orthogonal = edge.style.orthogonal;\n        if (!isNullish(orthogonal)) {\n            return orthogonal;\n        }\n        // fallback when the orthogonal style is not defined\n        const edgeStyle = this.view.getEdgeStyle(edge);\n        return EdgeStyleRegistry.isOrthogonal(edgeStyle);\n    }\n    /*****************************************************************************\n     * Group: Graph appearance\n     *****************************************************************************/\n    /**\n     * Returns the {@link backgroundImage} as an {@link Image}.\n     */\n    getBackgroundImage() {\n        return this.backgroundImage;\n    }\n    /**\n     * Sets the new {@link backgroundImage}.\n     *\n     * @param image New {@link Image} to be used for the background.\n     */\n    setBackgroundImage(image) {\n        this.backgroundImage = image;\n    }\n    /**\n     * Returns the textual representation for the given cell.\n     *\n     * This implementation returns the node name or string-representation of the user object.\n     *\n     *\n     * The following returns the label attribute from the cells user object if it is an XML node.\n     *\n     * @example\n     * ```javascript\n     * graph.convertValueToString = function(cell)\n     * {\n     * \treturn cell.getAttribute('label');\n     * }\n     * ```\n     *\n     * See also: {@link cellLabelChanged}.\n     *\n     * @param cell {@link Cell} whose textual representation should be returned.\n     */\n    convertValueToString(cell) {\n        const value = cell.getValue();\n        if (value != null) {\n            if (isNode(value)) {\n                return value.nodeName;\n            }\n            if (typeof value.toString === 'function') {\n                return value.toString();\n            }\n        }\n        return '';\n    }\n    /**\n     * Returns the string to be used as the link for the given cell.\n     *\n     * This implementation returns null.\n     *\n     * @param cell {@link Cell} whose link should be returned.\n     */\n    getLinkForCell(cell) {\n        return null;\n    }\n    /**\n     * Returns the value of {@link border}.\n     */\n    getBorder() {\n        return this.border;\n    }\n    /**\n     * Sets the value of {@link border}.\n     *\n     * @param value Positive integer that represents the border to be used.\n     */\n    setBorder(value) {\n        this.border = value;\n    }\n    /*****************************************************************************\n     * Group: Graph behaviour\n     *****************************************************************************/\n    /**\n     * Returns {@link resizeContainer}.\n     */\n    isResizeContainer() {\n        return this.resizeContainer;\n    }\n    /**\n     * Sets {@link resizeContainer}.\n     *\n     * @param value Boolean indicating if the container should be resized.\n     */\n    setResizeContainer(value) {\n        this.resizeContainer = value;\n    }\n    /**\n     * Returns true if the graph is {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Specifies if the graph should allow any interactions. This\n     * implementation updates {@link enabled}.\n     *\n     * @param value Boolean indicating if the graph should be enabled.\n     */\n    setEnabled(value) {\n        this.enabled = value;\n    }\n    /**\n     * Returns {@link multigraph} as a boolean.\n     */\n    isMultigraph() {\n        return this.multigraph;\n    }\n    /**\n     * Specifies if the graph should allow multiple connections between the\n     * same pair of vertices.\n     *\n     * @param value Boolean indicating if the graph allows multiple connections\n     * between the same pair of vertices.\n     */\n    setMultigraph(value) {\n        this.multigraph = value;\n    }\n    /**\n     * Returns {@link allowLoops} as a boolean.\n     */\n    isAllowLoops() {\n        return this.allowLoops;\n    }\n    /**\n     * Specifies if loops are allowed.\n     *\n     * @param value Boolean indicating if loops are allowed.\n     */\n    setAllowLoops(value) {\n        this.allowLoops = value;\n    }\n    /**\n     * Returns {@link recursiveResize}.\n     *\n     * @param state {@link CellState} that is being resized.\n     */\n    isRecursiveResize(state = null) {\n        return this.recursiveResize;\n    }\n    /**\n     * Sets {@link recursiveResize}.\n     *\n     * @param value New boolean value for {@link recursiveResize}.\n     */\n    setRecursiveResize(value) {\n        this.recursiveResize = value;\n    }\n    /**\n     * Returns a decimal number representing the amount of the width and height\n     * of the given cell that is allowed to overlap its parent. A value of 0\n     * means all children must stay inside the parent, 1 means the child is\n     * allowed to be placed outside of the parent such that it touches one of\n     * the parents sides. If {@link isAllowOverlapParent} returns false for the given\n     * cell, then this method returns 0.\n     *\n     * @param cell {@link Cell} for which the overlap ratio should be returned.\n     */\n    getOverlap(cell) {\n        return this.isAllowOverlapParent(cell) ? this.defaultOverlap : 0;\n    }\n    /**\n     * Returns true if the given cell is allowed to be placed outside the\n     * parents area.\n     *\n     * @param cell {@link Cell} that represents the child to be checked.\n     */\n    isAllowOverlapParent(cell) {\n        return false;\n    }\n    /*****************************************************************************\n     * Group: Cell retrieval\n     *****************************************************************************/\n    /**\n     * Returns {@link defaultParent} or {@link GraphView.currentRoot} or the first child\n     * of {@link GraphDataModel.root} if both are null. The value returned by\n     * this function should be used as the parent for new cells (aka default\n     * layer).\n     */\n    getDefaultParent() {\n        let parent = this.getCurrentRoot();\n        if (!parent) {\n            parent = this.defaultParent;\n            if (!parent) {\n                const root = this.getDataModel().getRoot();\n                parent = root.getChildAt(0);\n            }\n        }\n        return parent;\n    }\n    /**\n     * Sets the {@link defaultParent} to the given cell. Set this to null to return\n     * the first child of the root in getDefaultParent.\n     */\n    setDefaultParent(cell) {\n        this.defaultParent = cell;\n    }\n    /**\n     * Destroys the graph and all its resources.\n     */\n    destroy() {\n        if (!this.destroyed) {\n            this.destroyed = true;\n            Object.values(this.plugins).forEach((p) => p.onDestroy());\n            this.view.destroy();\n            if (this.model && this.graphModelChangeListener) {\n                this.getDataModel().removeListener(this.graphModelChangeListener);\n                this.graphModelChangeListener = null;\n            }\n        }\n    }\n}\n// This introduces a side effect, but it is necessary to ensure the Graph is enriched with all properties and methods defined in mixins.\n// It is only called when Graph is imported, so the Graph definition is always consistent.\n// And this doesn't impact the tree-shaking.\napplyGraphMixins(AbstractGraph);\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport InternalEvent from '../event/InternalEvent.js';\nimport EventObject from '../event/EventObject.js';\n/**\n * Implements a composite undoable edit. Here is an example for a custom change\n * which gets executed via the model:\n *\n * ```javascript\n * function CustomChange(model, name)\n * {\n *   this.model = model;\n *   this.name = name;\n *   this.previous = name;\n * };\n *\n * execute = ()=>\n * {\n *   let tmp = this.model.name;\n *   this.model.name = this.previous;\n *   this.previous = tmp;\n * };\n *\n * let name = prompt('Enter name');\n * graph.model.execute(new CustomChange(graph.model, name));\n * ```\n *\n * Event: mxEvent.EXECUTED\n *\n * Fires between START_EDIT and END_EDIT after an atomic change was executed.\n * The <code>change</code> property contains the change that was executed.\n *\n * Event: mxEvent.START_EDIT\n *\n * Fires before a set of changes will be executed in <undo> or <redo>.\n * This event contains no properties.\n *\n * Event: mxEvent.END_EDIT\n *\n * Fires after a set of changes was executed in <undo> or <redo>.\n * This event contains no properties.\n *\n * Constructor: mxUndoableEdit\n *\n * Constructs a new undoable edit for the given source.\n */\nclass UndoableEdit {\n    constructor(source, significant = true) {\n        /**\n         * Array that contains the changes that make up this edit. The changes are\n         * expected to either have an undo and redo function, or an execute\n         * function. Default is an empty array.\n         */\n        this.changes = [];\n        /**\n         * Specifies if the undoable change is significant.\n         * Default is true.\n         */\n        this.significant = true;\n        /**\n         * Specifies if this edit has been undone. Default is false.\n         */\n        this.undone = false;\n        /**\n         * Specifies if this edit has been redone. Default is false.\n         */\n        this.redone = false;\n        this.source = source;\n        this.changes = [];\n        this.significant = significant;\n    }\n    /**\n     * Returns true if the this edit contains no changes.\n     */\n    isEmpty() {\n        return this.changes.length === 0;\n    }\n    /**\n     * Returns <significant>.\n     */\n    isSignificant() {\n        return this.significant;\n    }\n    /**\n     * Adds the specified change to this edit. The change is an object that is\n     * expected to either have an undo and redo, or an execute function.\n     */\n    add(change) {\n        this.changes.push(change);\n    }\n    /**\n     * Hook to notify any listeners of the changes after an <undo> or <redo>\n     * has been carried out. This implementation is empty.\n     */\n    notify() {\n        return;\n    }\n    /**\n     * Hook to free resources after the edit has been removed from the command\n     * history. This implementation is empty.\n     */\n    die() {\n        return;\n    }\n    /**\n     * Undoes all changes in this edit.\n     */\n    undo() {\n        if (!this.undone) {\n            this.source.fireEvent(new EventObject(InternalEvent.START_EDIT));\n            const count = this.changes.length;\n            for (let i = count - 1; i >= 0; i--) {\n                const change = this.changes[i];\n                if (change.execute) {\n                    change.execute();\n                }\n                else if (change.undo) {\n                    change.undo();\n                }\n                // New global executed event\n                this.source.fireEvent(new EventObject(InternalEvent.EXECUTED, { change }));\n            }\n            this.undone = true;\n            this.redone = false;\n            this.source.fireEvent(new EventObject(InternalEvent.END_EDIT));\n        }\n        this.notify();\n    }\n    /**\n     * Redoes all changes in this edit.\n     */\n    redo() {\n        if (!this.redone) {\n            this.source.fireEvent(new EventObject(InternalEvent.START_EDIT));\n            const count = this.changes.length;\n            for (let i = 0; i < count; i += 1) {\n                const change = this.changes[i];\n                if (change.execute != null) {\n                    change.execute();\n                }\n                else if (change.redo != null) {\n                    change.redo();\n                }\n                // New global executed event\n                this.source.fireEvent(new EventObject(InternalEvent.EXECUTED, { change }));\n            }\n            this.undone = false;\n            this.redone = true;\n            this.source.fireEvent(new EventObject(InternalEvent.END_EDIT));\n        }\n        this.notify();\n    }\n}\nexport default UndoableEdit;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a cell's collapsed state in a model.\n *\n * @category Change\n */\nclass CollapseChange {\n    constructor(model, cell, collapsed) {\n        this.model = model;\n        this.cell = cell;\n        this.collapsed = collapsed;\n        this.previous = collapsed;\n    }\n    /**\n     * Changes the collapsed state of {@link cell} to {@link previous} using {@link GraphDataModel.collapsedStateForCellChanged}.\n     */\n    execute() {\n        this.collapsed = this.previous;\n        this.previous = this.model.collapsedStateForCellChanged(this.cell, this.previous);\n    }\n}\nexport default CollapseChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Action to change a cell's visible state in a model.\n *\n * @category Change\n */\nclass VisibleChange {\n    constructor(model, cell, visible) {\n        this.model = model;\n        this.cell = cell;\n        this.visible = visible;\n        this.previous = visible;\n    }\n    /**\n     * Changes the visible state of {@link cell} to {@link previous} using {@link GraphDataModel.visibleStateForCellChanged}.\n     */\n    execute() {\n        this.visible = this.previous;\n        this.previous = this.model.visibleStateForCellChanged(this.cell, this.previous);\n    }\n}\nexport default VisibleChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2018, JGraph Ltd\nCopyright (c) 2006-2018, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from './event/EventSource.js';\nimport UndoableEdit from './undoable_changes/UndoableEdit.js';\nimport CellPath from './cell/CellPath.js';\nimport Cell from './cell/Cell.js';\nimport { isNumeric } from '../util/mathUtils.js';\nimport EventObject from './event/EventObject.js';\nimport InternalEvent from './event/InternalEvent.js';\nimport ChildChange from './undoable_changes/ChildChange.js';\nimport CollapseChange from './undoable_changes/CollapseChange.js';\nimport GeometryChange from './undoable_changes/GeometryChange.js';\nimport RootChange from './undoable_changes/RootChange.js';\nimport StyleChange from './undoable_changes/StyleChange.js';\nimport TerminalChange from './undoable_changes/TerminalChange.js';\nimport ValueChange from './undoable_changes/ValueChange.js';\nimport VisibleChange from './undoable_changes/VisibleChange.js';\n/**\n * Extends {@link EventSource} to implement a graph model. The graph model acts as\n * a wrapper around the cells which are in charge of storing the actual graph\n * data structure. The model acts as a transactional wrapper with event\n * notification for all changes, whereas the cells contain the atomic\n * operations for updating the actual data structure.\n *\n * ### Layers\n *\n * The cell hierarchy in the model must have a top-level root cell which\n * contains the layers (typically one default layer), which in turn contain the\n * top-level cells of the layers. This means each cell is contained in a layer.\n * If no layers are required, then all new cells should be added to the default\n * layer.\n *\n * Layers are useful for hiding and showing groups of cells, or for placing\n * groups of cells on top of other cells in the display. To identify a layer,\n * the {@link isLayer} function is used. It returns true if the parent of the given\n * cell is the root of the model.\n *\n * ### Events\n *\n * See events section for more details. There is a new set of events for\n * tracking transactional changes as they happen. The events are called\n * startEdit for the initial beginUpdate, executed for each executed change\n * and endEdit for the terminal endUpdate. The executed event contains a\n * property called change which represents the change after execution.\n *\n * ### Encoding the model\n *\n * #### To encode a graph model, use the following code:\n *\n * ```javascript\n * var enc = new Codec();\n * var node = enc.encode(graph.getDataModel());\n * ```\n *\n * This will create an XML node that contains all the model information.\n *\n * #### Encoding and decoding changes:\n *\n * For the encoding of changes, a graph model listener is required that encodes\n * each change from the given array of changes.\n *\n * ```javascript\n * model.addListener(mxEvent.CHANGE, function(sender, evt)\n * {\n *   var changes = evt.getProperty('edit').changes;\n *   var nodes = [];\n *   var codec = new Codec();\n *\n *   for (var i = 0; i < changes.length; i++)\n *   {\n *     nodes.push(codec.encode(changes[i]));\n *   }\n *   // do something with the nodes\n * });\n * ```\n *\n * For the decoding and execution of changes, the codec needs a lookup function\n * that allows it to resolve cell IDs as follows:\n *\n * ```javascript\n * var codec = new Codec();\n * codec.lookup(id)\n * {\n *   return model.getCell(id);\n * }\n * ```\n *\n * For each encoded change (represented by a node), the following code can be\n * used to carry out the decoding and create a change object.\n *\n * ```javascript\n * var changes = [];\n * var change = codec.decode(node);\n * change.model = model;\n * change.execute();\n * changes.push(change);\n * ```\n *\n * The changes can then be dispatched using the model as follows.\n *\n * ```javascript\n * var edit = new mxUndoableEdit(model, false);\n * edit.changes = changes;\n *\n * edit.notify()\n * {\n *   edit.source.fireEvent(new mxEventObject(mxEvent.CHANGE,\n *   \t'edit', edit, 'changes', edit.changes));\n *   edit.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,\n *   \t'edit', edit, 'changes', edit.changes));\n * }\n *\n * model.fireEvent(new mxEventObject(mxEvent.UNDO, 'edit', edit));\n * model.fireEvent(new mxEventObject(mxEvent.CHANGE,\n *    'edit', edit, 'changes', changes));\n * ```\n *\n * Event: mxEvent.CHANGE\n *\n * Fires when an undoable edit is dispatched. The `edit` property\n * contains the {@link UndoableEdit}. The `changes` property contains\n * the array of atomic changes inside the undoable edit. The changes property\n * is **deprecated**, please use edit.changes instead.\n *\n * ### Example\n *\n * For finding newly inserted cells, the following code can be used:\n *\n * ```javascript\n * graph.model.addListener(mxEvent.CHANGE, function(sender, evt)\n * {\n *   var changes = evt.getProperty('edit').changes;\n *\n *   for (var i = 0; i < changes.length; i++)\n *   {\n *     var change = changes[i];\n *\n *     if (change instanceof mxChildChange &&\n *       change.change.previous == null)\n *     {\n *       graph.startEditingAtCell(change.child);\n *       break;\n *     }\n *   }\n * });\n * ```\n *\n * Event: mxEvent.NOTIFY\n *\n * Same as {@link Event#CHANGE}, this event can be used for classes that need to\n * implement a sync mechanism between this model and, say, a remote model. In\n * such a setup, only local changes should trigger a notify event and all\n * changes should trigger a change event.\n *\n * Event: mxEvent.EXECUTE\n *\n * Fires between begin- and endUpdate and after an atomic change was executed\n * in the model. The `change` property contains the atomic change\n * that was executed.\n *\n * Event: mxEvent.EXECUTED\n *\n * Fires between START_EDIT and END_EDIT after an atomic change was executed.\n * The `change` property contains the change that was executed.\n *\n * Event: mxEvent.BEGIN_UPDATE\n *\n * Fires after the {@link updateLevel} was incremented in {@link beginUpdate}. This event\n * contains no properties.\n *\n * Event: mxEvent.START_EDIT\n *\n * Fires after the {@link updateLevel} was changed from 0 to 1. This event\n * contains no properties.\n *\n * Event: mxEvent.END_UPDATE\n *\n * Fires after the {@link updateLevel} was decreased in {@link endUpdate} but before any\n * notification or change dispatching. The `edit` property contains\n * the {@link currentEdit}.\n *\n * Event: mxEvent.END_EDIT\n *\n * Fires after the {@link updateLevel} was changed from 1 to 0. This event\n * contains no properties.\n *\n * Event: mxEvent.BEFORE_UNDO\n *\n * Fires before the change is dispatched after the update level has reached 0\n * in {@link endUpdate}. The `edit` property contains the {@link currentEdit}.\n *\n * Event: mxEvent.UNDO\n *\n * Fires after the change was dispatched in {@link endUpdate}. The `edit`\n * property contains the {@link currentEdit}.\n *\n * @class GraphDataModel\n */\nexport class GraphDataModel extends EventSource {\n    constructor(root = null) {\n        super();\n        /**\n         * Holds the root cell, which in turn contains the cells that represent the\n         * layers of the diagram as child cells. That is, the actual elements of the\n         * diagram are supposed to live in the third generation of cells and below.\n         */\n        this.root = null;\n        /**\n         * Maps from Ids to cells.\n         */\n        this.cells = {};\n        /**\n         * Specifies if edges should automatically be moved into the nearest common ancestor of their terminals.\n         * @default true\n         */\n        this.maintainEdgeParent = true;\n        /**\n         * Specifies if relative edge parents should be ignored for finding the nearest common ancestors of an edge's terminals.\n         * @default true\n         */\n        this.ignoreRelativeEdgeParent = true;\n        /**\n         * Specifies if the model should automatically create Ids for new cells.\n         * @default true.\n         */\n        this.createIds = true;\n        /**\n         * Defines the prefix of new Ids. Default is an empty string.\n         * @default ''\n         */\n        this.prefix = '';\n        /**\n         * Defines the postfix of new Ids.\n         * @default ''\n         */\n        this.postfix = '';\n        /**\n         * Specifies the next Id to be created. Initial value is 0.\n         */\n        this.nextId = 0;\n        /**\n         * Holds the changes for the current transaction. If the transaction is\n         * closed then a new object is created for this variable using\n         * {@link createUndoableEdit}.\n         */\n        this.currentEdit = null;\n        /**\n         * Counter for the depth of nested transactions. Each call to {@link beginUpdate}\n         * will increment this number and each call to {@link endUpdate} will decrement\n         * it. When the counter reaches 0, the transaction is closed and the\n         * respective events are fired. Initial value is 0.\n         */\n        this.updateLevel = 0;\n        /**\n         * True if the program flow is currently inside endUpdate.\n         */\n        this.endingUpdate = false;\n        this.currentEdit = this.createUndoableEdit();\n        if (root != null) {\n            this.setRoot(root);\n        }\n        else {\n            this.clear();\n        }\n    }\n    /**\n     * Sets a new root using {@link createRoot}.\n     */\n    clear() {\n        this.setRoot(this.createRoot());\n    }\n    /**\n     * Returns {@link createIds}.\n     */\n    isCreateIds() {\n        return this.createIds;\n    }\n    /**\n     * Sets {@link createIds}.\n     */\n    setCreateIds(value) {\n        this.createIds = value;\n    }\n    /**\n     * Creates a new root cell with a default layer (child 0).\n     */\n    createRoot() {\n        const cell = new Cell();\n        cell.insert(new Cell());\n        return cell;\n    }\n    /**\n     * Returns the {@link Cell} for the specified Id or null if no cell can be\n     * found for the given Id.\n     *\n     * @param {string} id  A string representing the Id of the cell.\n     */\n    getCell(id) {\n        return this.cells ? this.cells[id] : null;\n    }\n    filterCells(cells, filter) {\n        return cells.filter(filter);\n    }\n    getRoot(cell = null) {\n        return cell ? cell.getRoot() : this.root;\n    }\n    /**\n     * Sets the {@link root} of the model using {@link RootChange} and adds the change to\n     * the current transaction. This resets all datastructures in the model and\n     * is the preferred way of clearing an existing model. Returns the new\n     * root.\n     *\n     * Example:\n     *\n     * ```javascript\n     * const root = new Cell();\n     * root.insert(new Cell());\n     * model.setRoot(root);\n     * ```\n     *\n     * @param {Cell} root  that specifies the new root.\n     */\n    setRoot(root) {\n        this.execute(new RootChange(this, root));\n        return root;\n    }\n    /**\n     * Inner callback to change the root of the model and update the internal\n     * datastructures, such as {@link cells} and {@link nextId}. Returns the previous root.\n     *\n     * @param {Cell} root  that specifies the new root.\n     */\n    rootChanged(root) {\n        const oldRoot = this.root;\n        this.root = root;\n        // Resets counters and datastructures\n        this.nextId = 0;\n        this.cells = null;\n        this.cellAdded(root);\n        return oldRoot;\n    }\n    /**\n     * Returns true if the given cell is the root of the model and a non-null\n     * value.\n     *\n     * @param {Cell} cell  that represents the possible root.\n     */\n    isRoot(cell = null) {\n        return cell != null && this.root === cell;\n    }\n    /**\n     * Returns true if {@link isRoot} returns true for the parent of the given cell.\n     *\n     * @param cell  that represents the possible layer.\n     */\n    isLayer(cell) {\n        return cell ? this.isRoot(cell.getParent()) : false;\n    }\n    /**\n     * Returns true if the model contains the given {@link Cell}.\n     *\n     * @param {Cell} cell  that specifies the cell.\n     */\n    contains(cell) {\n        return this.root.isAncestor(cell);\n    }\n    /**\n     * Adds the specified child to the parent at the given index using\n     * {@link ChildChange} and adds the change to the current transaction. If no\n     * index is specified then the child is appended to the parent's array of\n     * children. Returns the inserted child.\n     *\n     * @param {Cell} parent  that specifies the parent to contain the child.\n     * @param {Cell} child  that specifies the child to be inserted.\n     * @param index  Optional integer that specifies the index of the child.\n     */\n    add(parent, child, index = null) {\n        if (child !== parent && parent != null && child != null) {\n            // Appends the child if no index was specified\n            if (index == null) {\n                index = parent.getChildCount();\n            }\n            const parentChanged = parent !== child.getParent();\n            this.execute(new ChildChange(this, parent, child, index));\n            // Maintains the edges parents by moving the edges\n            // into the nearest common ancestor of its terminals\n            if (this.maintainEdgeParent && parentChanged) {\n                this.updateEdgeParents(child);\n            }\n        }\n        return child;\n    }\n    /**\n     * Inner callback to update {@link cells} when a cell has been added. This\n     * implementation resolves collisions by creating new Ids. To change the\n     * ID of a cell after it was inserted into the model, use the following\n     * code:\n     *\n     * (code\n     * delete model.cells[cell.getId()];\n     * cell.setId(newId);\n     * model.cells[cell.getId()] = cell;\n     * ```\n     *\n     * If the change of the ID should be part of the command history, then the\n     * cell should be removed from the model and a clone with the new ID should\n     * be reinserted into the model instead.\n     *\n     * @param {Cell} cell  that specifies the cell that has been added.\n     */\n    cellAdded(cell) {\n        if (cell != null) {\n            // Creates an Id for the cell if not Id exists\n            if (cell.getId() == null && this.createIds) {\n                cell.setId(this.createId(cell));\n            }\n            if (cell.getId() != null) {\n                let collision = this.getCell(cell.getId());\n                if (collision !== cell) {\n                    // Creates new Id for the cell\n                    // as long as there is a collision\n                    while (collision != null) {\n                        cell.setId(this.createId(cell));\n                        collision = this.getCell(cell.getId());\n                    }\n                    // Lazily creates the cells map\n                    if (this.cells == null) {\n                        this.cells = {};\n                    }\n                    this.cells[cell.getId()] = cell;\n                }\n            }\n            // Makes sure IDs of deleted cells are not reused\n            if (isNumeric(String(cell.getId()))) {\n                this.nextId = Math.max(this.nextId, parseInt(cell.getId()));\n            }\n            // Recursively processes child cells\n            for (const child of cell.getChildren()) {\n                this.cellAdded(child);\n            }\n        }\n    }\n    /**\n     * Hook method to create an Id for the specified cell. This implementation\n     * concatenates {@link prefix}, id and {@link postfix} to create the Id and increments\n     * {@link nextId}. The cell is ignored by this implementation, but can be used in\n     * overridden methods to prefix the Ids with eg. the cell type.\n     *\n     * @param {Cell} cell  to create the Id for.\n     */\n    createId(cell) {\n        const id = this.nextId;\n        this.nextId++;\n        return this.prefix + id + this.postfix;\n    }\n    /**\n     * Updates the parent for all edges that are connected to cell or one of\n     * its descendants using {@link updateEdgeParent}.\n     */\n    updateEdgeParents(cell, root = this.getRoot(cell)) {\n        // Updates edges on children first\n        const childCount = cell.getChildCount();\n        for (let i = 0; i < childCount; i += 1) {\n            const child = cell.getChildAt(i);\n            this.updateEdgeParents(child, root);\n        }\n        // Updates the parents of all connected edges\n        const edgeCount = cell.getEdgeCount();\n        const edges = [];\n        for (let i = 0; i < edgeCount; i += 1) {\n            edges.push(cell.getEdgeAt(i));\n        }\n        for (let i = 0; i < edges.length; i += 1) {\n            const edge = edges[i];\n            // Updates edge parent if edge and child have\n            // a common root node (does not need to be the\n            // model root node)\n            if (root.isAncestor(edge)) {\n                this.updateEdgeParent(edge, root);\n            }\n        }\n    }\n    /**\n     * Inner callback to update the parent of the specified {@link Cell} to the\n     * nearest-common-ancestor of its two terminals.\n     *\n     * @param {Cell} edge  that specifies the edge.\n     * @param {Cell} root  that represents the current root of the model.\n     */\n    updateEdgeParent(edge, root) {\n        let source = edge.getTerminal(true);\n        let target = edge.getTerminal(false);\n        let cell = null;\n        // Uses the first non-relative descendants of the source terminal\n        while (source != null &&\n            !source.isEdge() &&\n            source.geometry != null &&\n            source.geometry.relative) {\n            source = source.getParent();\n        }\n        // Uses the first non-relative descendants of the target terminal\n        while (target != null &&\n            this.ignoreRelativeEdgeParent &&\n            !target.isEdge() &&\n            target.geometry != null &&\n            target.geometry.relative) {\n            target = target.getParent();\n        }\n        if (root.isAncestor(source) && root.isAncestor(target)) {\n            if (source === target) {\n                cell = source ? source.getParent() : null;\n            }\n            else if (source) {\n                cell = source.getNearestCommonAncestor(target);\n            }\n            if (cell != null &&\n                (cell.getParent() !== this.root || cell.isAncestor(edge)) &&\n                edge &&\n                edge.getParent() !== cell) {\n                let geo = edge.getGeometry();\n                if (geo != null) {\n                    const origin1 = edge.getParent().getOrigin();\n                    const origin2 = cell.getOrigin();\n                    const dx = origin2.x - origin1.x;\n                    const dy = origin2.y - origin1.y;\n                    geo = geo.clone();\n                    geo.translate(-dx, -dy);\n                    this.setGeometry(edge, geo);\n                }\n                this.add(cell, edge, cell.getChildCount());\n            }\n        }\n    }\n    /**\n     * Removes the specified cell from the model using {@link ChildChange} and adds\n     * the change to the current transaction. This operation will remove the\n     * cell and all of its children from the model. Returns the removed cell.\n     *\n     * @param {Cell} cell  that should be removed.\n     */\n    remove(cell) {\n        if (cell === this.root) {\n            this.setRoot(null);\n        }\n        else if (cell.getParent() != null) {\n            this.execute(new ChildChange(this, null, cell));\n        }\n        return cell;\n    }\n    /**\n     * Inner callback to update {@link cells} when a cell has been removed.\n     *\n     * @param {Cell} cell  that specifies the cell that has been removed.\n     */\n    cellRemoved(cell) {\n        if (cell != null && this.cells != null) {\n            // Recursively processes child cells\n            const childCount = cell.getChildCount();\n            for (let i = childCount - 1; i >= 0; i--) {\n                this.cellRemoved(cell.getChildAt(i));\n            }\n            // Removes the map entry for the cell\n            if (this.cells != null && cell.getId() != null) {\n                // @ts-ignore\n                delete this.cells[cell.getId()];\n            }\n        }\n    }\n    /**\n     * Inner callback to update the parent of a cell using {@link Cell#insert}\n     * on the parent and return the previous parent.\n     *\n     * @param {Cell} cell  to update the parent for.\n     * @param {Cell} parent  that specifies the new parent of the cell.\n     * @param index  Optional integer that defines the index of the child\n     * in the parent's child array.\n     */\n    parentForCellChanged(cell, parent, index) {\n        const previous = cell.getParent();\n        if (parent != null) {\n            if (parent !== previous || previous.getIndex(cell) !== index) {\n                parent.insert(cell, index);\n            }\n        }\n        else if (previous != null) {\n            const oldIndex = previous.getIndex(cell);\n            previous.remove(oldIndex);\n        }\n        // Adds or removes the cell from the model\n        const par = parent ? this.contains(parent) : null;\n        const pre = this.contains(previous);\n        if (par && !pre) {\n            this.cellAdded(cell);\n        }\n        else if (pre && !par) {\n            this.cellRemoved(cell);\n        }\n        return previous;\n    }\n    /**\n     * Sets the source or target terminal of the given {@link Cell} using\n     * {@link TerminalChange} and adds the change to the current transaction.\n     * This implementation updates the parent of the edge using {@link updateEdgeParent}\n     * if required.\n     *\n     * @param {Cell} edge  that specifies the edge.\n     * @param {Cell} terminal  that specifies the new terminal.\n     * @param isSource  Boolean indicating if the terminal is the new source or\n     * target terminal of the edge.\n     */\n    setTerminal(edge, terminal, isSource) {\n        const terminalChanged = terminal !== edge.getTerminal(isSource);\n        this.execute(new TerminalChange(this, edge, terminal, isSource));\n        if (this.maintainEdgeParent && terminalChanged) {\n            this.updateEdgeParent(edge, this.getRoot());\n        }\n        return terminal;\n    }\n    /**\n     * Sets the source and target {@link Cell} of the given {@link Cell} in a single\n     * transaction using {@link setTerminal} for each end of the edge.\n     *\n     * @param {Cell} edge  that specifies the edge.\n     * @param {Cell} source  that specifies the new source terminal.\n     * @param {Cell} target  that specifies the new target terminal.\n     */\n    setTerminals(edge, source, target) {\n        this.beginUpdate();\n        try {\n            this.setTerminal(edge, source, true);\n            this.setTerminal(edge, target, false);\n        }\n        finally {\n            this.endUpdate();\n        }\n    }\n    /**\n     * Inner helper function to update the terminal of the edge using\n     * {@link Cell#insertEdge} and return the previous terminal.\n     *\n     * @param {Cell} edge  that specifies the edge to be updated.\n     * @param {Cell} terminal  that specifies the new terminal.\n     * @param isSource  Boolean indicating if the terminal is the new source or\n     * target terminal of the edge.\n     */\n    terminalForCellChanged(edge, terminal, isSource = false) {\n        const previous = edge.getTerminal(isSource);\n        if (terminal != null) {\n            terminal.insertEdge(edge, isSource);\n        }\n        else if (previous != null) {\n            previous.removeEdge(edge, isSource);\n        }\n        return previous;\n    }\n    /**\n     * Returns all edges between the given source and target pair. If directed\n     * is true, then only edges from the source to the target are returned,\n     * otherwise, all edges between the two cells are returned.\n     *\n     * @param {Cell} source  that defines the source terminal of the edge to be\n     * returned.\n     * @param {Cell} target  that defines the target terminal of the edge to be\n     * returned.\n     * @param directed  Optional boolean that specifies if the direction of the\n     * edge should be taken into account. Default is false.\n     */\n    getEdgesBetween(source, target, directed = false) {\n        const tmp1 = source.getEdgeCount();\n        const tmp2 = target.getEdgeCount();\n        // Assumes the source has less connected edges\n        let terminal = source;\n        let edgeCount = tmp1;\n        // Uses the smaller array of connected edges\n        // for searching the edge\n        if (tmp2 < tmp1) {\n            edgeCount = tmp2;\n            terminal = target;\n        }\n        const result = [];\n        // Checks if the edge is connected to the correct\n        // cell and returns the first match\n        for (let i = 0; i < edgeCount; i += 1) {\n            const edge = terminal.getEdgeAt(i);\n            const src = edge.getTerminal(true);\n            const trg = edge.getTerminal(false);\n            const directedMatch = src === source && trg === target;\n            const oppositeMatch = trg === source && src === target;\n            if (directedMatch || (!directed && oppositeMatch)) {\n                result.push(edge);\n            }\n        }\n        return result;\n    }\n    /**\n     * Sets the user object of then given {@link Cell} using {@link ValueChange}\n     * and adds the change to the current transaction.\n     *\n     * @param {Cell} cell  whose user object should be changed.\n     * @param value  Object that defines the new user object.\n     */\n    setValue(cell, value) {\n        this.execute(new ValueChange(this, cell, value));\n        return value;\n    }\n    /**\n     * Inner callback to update the user object of the given {@link Cell}\n     * using {@link Cell#valueChanged} and return the previous value,\n     * that is, the return value of {@link Cell#valueChanged}.\n     *\n     * To change a specific attribute in an XML node, the following code can be\n     * used.\n     *\n     * ```javascript\n     * graph.getDataModel().valueForCellChanged(cell, value)\n     * {\n     *   var previous = cell.value.getAttribute('label');\n     *   cell.value.setAttribute('label', value);\n     *\n     *   return previous;\n     * };\n     * ```\n     */\n    valueForCellChanged(cell, value) {\n        return cell.valueChanged(value);\n    }\n    /**\n     * Sets the {@link Geometry} of the given {@link Cell}. The actual update\n     * of the cell is carried out in {@link geometryForCellChanged}. The\n     * {@link GeometryChange} action is used to encapsulate the change.\n     *\n     * @param {Cell} cell  whose geometry should be changed.\n     * @param {Geometry} geometry  that defines the new geometry.\n     */\n    setGeometry(cell, geometry) {\n        if (geometry !== cell.getGeometry()) {\n            this.execute(new GeometryChange(this, cell, geometry));\n        }\n        return geometry;\n    }\n    /**\n     * Inner callback to update the {@link Geometry} of the given {@link Cell} using\n     * {@link Cell#setGeometry} and return the previous {@link Geometry}.\n     */\n    geometryForCellChanged(cell, geometry) {\n        const previous = cell.getGeometry();\n        cell.setGeometry(geometry);\n        return previous;\n    }\n    /**\n     * Sets the style of the given {@link Cell} using {@link StyleChange} and adds the change to the current transaction.\n     *\n     * **IMPORTANT**: Do not pass {@link Cell.getStyle} as value of the `style` parameter. Otherwise, no style change is performed, so the view won't be updated.\n     * Always get a clone of the style of the cell with {@link Cell.getClonedStyle}, then update it and pass the updated style to this method.\n     *\n     * @param cell  whose style should be changed.\n     * @param style the new cell style to set.\n     */\n    setStyle(cell, style) {\n        // To investigate in the future: it may be more convenient to do a deep comparison to prevent unnecessary changes\n        // If the passed style is the same as the current style without being the same instance, we don't need to do anything\n        // With the current implementation, a style change is executed when the styles are deep equal.\n        if (style !== cell.getStyle()) {\n            this.execute(new StyleChange(this, cell, style));\n        }\n    }\n    /**\n     * Inner callback to update the style of the given {@link Cell}  using {@link Cell#setStyle} and return the previous style.\n     *\n     * **IMPORTANT**: to fully work, this method should not receive `cell.getStyle` as value of the `style` parameter. See {@link setStyle} for more information.\n     *\n     * @param cell  whose style should be changed.\n     * @param style the new cell style to set.\n     */\n    styleForCellChanged(cell, style) {\n        const previous = cell.getStyle();\n        cell.setStyle(style);\n        return previous;\n    }\n    /**\n     * Sets the collapsed state of the given {@link Cell} using {@link CollapseChange}\n     * and adds the change to the current transaction.\n     *\n     * @param {Cell} cell  whose collapsed state should be changed.\n     * @param collapsed  Boolean that specifies the new collpased state.\n     */\n    setCollapsed(cell, collapsed) {\n        if (collapsed !== cell.isCollapsed()) {\n            this.execute(new CollapseChange(this, cell, collapsed));\n        }\n        return collapsed;\n    }\n    /**\n     * Inner callback to update the collapsed state of the\n     * given {@link Cell} using {@link Cell#setCollapsed} and return\n     * the previous collapsed state.\n     *\n     * @param {Cell} cell  that specifies the cell to be updated.\n     * @param collapsed  Boolean that specifies the new collapsed state.\n     */\n    collapsedStateForCellChanged(cell, collapsed) {\n        const previous = cell.isCollapsed();\n        cell.setCollapsed(collapsed);\n        return previous;\n    }\n    /**\n     * Sets the visible state of the given {@link Cell} using {@link VisibleChange} and\n     * adds the change to the current transaction.\n     *\n     * @param {Cell} cell  whose visible state should be changed.\n     * @param visible  Boolean that specifies the new visible state.\n     */\n    setVisible(cell, visible) {\n        if (visible !== cell.isVisible()) {\n            this.execute(new VisibleChange(this, cell, visible));\n        }\n        return visible;\n    }\n    /**\n     * Inner callback to update the visible state of the\n     * given {@link Cell} using {@link Cell#setCollapsed} and return\n     * the previous visible state.\n     *\n     * @param {Cell} cell  that specifies the cell to be updated.\n     * @param visible  Boolean that specifies the new visible state.\n     */\n    visibleStateForCellChanged(cell, visible) {\n        const previous = cell.isVisible();\n        cell.setVisible(visible);\n        return previous;\n    }\n    /**\n     * Executes the given edit and fires events if required. The edit object\n     * requires an execute function which is invoked. The edit is added to the\n     * {@link currentEdit} between {@link beginUpdate} and {@link endUpdate} calls, so that\n     * events will be fired if this execute is an individual transaction, that\n     * is, if no previous {@link beginUpdate} calls have been made without calling\n     * {@link endUpdate}. This implementation fires an {@link execute} event before\n     * executing the given change.\n     *\n     * @param change  Object that described the change.\n     */\n    execute(change) {\n        change.execute();\n        this.beginUpdate();\n        this.currentEdit.add(change);\n        this.fireEvent(new EventObject(InternalEvent.EXECUTE, { change }));\n        // New global executed event\n        this.fireEvent(new EventObject(InternalEvent.EXECUTED, { change }));\n        this.endUpdate();\n    }\n    /**\n     * Updates the model in a transaction.\n     * This is a shortcut to the usage of {@link beginUpdate} and the {@link endUpdate} methods.\n     *\n     * ```javascript\n     * const model = graph.getDataModel();\n     * const parent = graph.getDefaultParent();\n     * const index = model.getChildCount(parent);\n     * model.batchUpdate(() => {\n     *   model.add(parent, v1, index);\n     *   model.add(parent, v2, index+1);\n     * });\n     * ```\n     *\n     * @param fn the update to be performed in the transaction.\n     */\n    batchUpdate(fn) {\n        this.beginUpdate();\n        try {\n            fn();\n        }\n        finally {\n            this.endUpdate();\n        }\n    }\n    /**\n     * Increments the {@link updateLevel} by one. The event notification\n     * is queued until {@link updateLevel} reaches 0 by use of\n     * {@link endUpdate}.\n     *\n     * All changes on {@link GraphDataModel} are transactional,\n     * that is, they are executed in a single undoable change\n     * on the model (without transaction isolation).\n     * Therefore, if you want to combine any\n     * number of changes into a single undoable change,\n     * you should group any two or more API calls that\n     * modify the graph model between {@link beginUpdate}\n     * and {@link endUpdate} calls as shown here:\n     *\n     * ```javascript\n     * const model = graph.getDataModel();\n     * const parent = graph.getDefaultParent();\n     * const index = model.getChildCount(parent);\n     * model.beginUpdate();\n     * try\n     * {\n     *   model.add(parent, v1, index);\n     *   model.add(parent, v2, index+1);\n     * }\n     * finally\n     * {\n     *   model.endUpdate();\n     * }\n     * ```\n     *\n     * Of course there is a shortcut for appending a\n     * sequence of cells into the default parent:\n     *\n     * ```javascript\n     * graph.addCells([v1, v2]).\n     * ```\n     */\n    beginUpdate() {\n        this.updateLevel += 1;\n        this.fireEvent(new EventObject(InternalEvent.BEGIN_UPDATE));\n        if (this.updateLevel === 1) {\n            this.fireEvent(new EventObject(InternalEvent.START_EDIT));\n        }\n    }\n    /**\n     * Decrements the {@link updateLevel} by one and fires an {@link undo}\n     * event if the {@link updateLevel} reaches 0. This function\n     * indirectly fires a {@link change} event by invoking the notify\n     * function on the {@link currentEdit} und then creates a new\n     * {@link currentEdit} using {@link createUndoableEdit}.\n     *\n     * The {@link undo} event is fired only once per edit, whereas\n     * the {@link change} event is fired whenever the notify\n     * function is invoked, that is, on undo and redo of\n     * the edit.\n     */\n    endUpdate() {\n        this.updateLevel -= 1;\n        if (this.updateLevel === 0) {\n            this.fireEvent(new EventObject(InternalEvent.END_EDIT));\n        }\n        if (!this.endingUpdate) {\n            this.endingUpdate = this.updateLevel === 0;\n            this.fireEvent(new EventObject(InternalEvent.END_UPDATE, { edit: this.currentEdit }));\n            try {\n                if (this.endingUpdate && !this.currentEdit.isEmpty()) {\n                    this.fireEvent(new EventObject(InternalEvent.BEFORE_UNDO, { edit: this.currentEdit }));\n                    const tmp = this.currentEdit;\n                    this.currentEdit = this.createUndoableEdit();\n                    tmp.notify();\n                    this.fireEvent(new EventObject(InternalEvent.UNDO, { edit: tmp }));\n                }\n            }\n            finally {\n                this.endingUpdate = false;\n            }\n        }\n    }\n    /**\n     * Creates a new {@link UndoableEdit} that implements the\n     * notify function to fire a {@link change} and {@link notify} event\n     * through the {@link UndoableEdit}'s source.\n     *\n     * @param significant  Optional boolean that specifies if the edit to be created is\n     * significant. Default is true.\n     */\n    createUndoableEdit(significant = true) {\n        const edit = new UndoableEdit(this, significant);\n        edit.notify = () => {\n            // LATER: Remove changes property (deprecated)\n            edit.source.fireEvent(new EventObject(InternalEvent.CHANGE, { edit, changes: edit.changes }));\n            edit.source.fireEvent(new EventObject(InternalEvent.NOTIFY, { edit, changes: edit.changes }));\n        };\n        return edit;\n    }\n    /**\n     * Merges the children of the given cell into the given target cell inside\n     * this model. All cells are cloned unless there is a corresponding cell in\n     * the model with the same id, in which case the source cell is ignored and\n     * all edges are connected to the corresponding cell in this model. Edges\n     * are considered to have no identity and are always cloned unless the\n     * cloneAllEdges flag is set to false, in which case edges with the same\n     * id in the target model are reconnected to reflect the terminals of the\n     * source edges.\n     */\n    mergeChildren(from, to, cloneAllEdges = true) {\n        this.beginUpdate();\n        try {\n            const mapping = {};\n            this.mergeChildrenImpl(from, to, cloneAllEdges, mapping);\n            // Post-processes all edges in the mapping and\n            // reconnects the terminals to the corresponding\n            // cells in the target model\n            for (const key in mapping) {\n                const cell = mapping[key];\n                let terminal = cell.getTerminal(true);\n                if (terminal != null) {\n                    terminal = mapping[CellPath.create(terminal)];\n                    this.setTerminal(cell, terminal, true);\n                }\n                terminal = cell.getTerminal(false);\n                if (terminal != null) {\n                    terminal = mapping[CellPath.create(terminal)];\n                    this.setTerminal(cell, terminal, false);\n                }\n            }\n        }\n        finally {\n            this.endUpdate();\n        }\n    }\n    /**\n     * Clones the children of the source cell into the given target cell in\n     * this model and adds an entry to the mapping that maps from the source\n     * cell to the target cell with the same id or the clone of the source cell\n     * that was inserted into this model.\n     */\n    mergeChildrenImpl(from, to, cloneAllEdges, mapping = {}) {\n        this.beginUpdate();\n        try {\n            const childCount = from.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                const cell = from.getChildAt(i);\n                if (typeof cell.getId === 'function') {\n                    const id = cell.getId();\n                    let target = id != null && (!cell.isEdge() || !cloneAllEdges) ? this.getCell(id) : null;\n                    // Clones and adds the child if no cell exists for the id\n                    if (target == null) {\n                        const clone = cell.clone();\n                        clone.setId(id);\n                        // Sets the terminals from the original cell to the clone\n                        // because the lookup uses strings not cells in JS\n                        clone.setTerminal(cell.getTerminal(true), true);\n                        clone.setTerminal(cell.getTerminal(false), false);\n                        // Do *NOT* use model.add as this will move the edge away\n                        // from the parent in updateEdgeParent if maintainEdgeParent\n                        // is enabled in the target model\n                        target = to.insert(clone);\n                        this.cellAdded(target);\n                    }\n                    // Stores the mapping for later reconnecting edges\n                    mapping[CellPath.create(cell)] = target;\n                    // Recurses\n                    this.mergeChildrenImpl(cell, target, cloneAllEdges, mapping);\n                }\n            }\n        }\n        finally {\n            this.endUpdate();\n        }\n    }\n}\nexport default GraphDataModel;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { BaseRegistry } from '../../../internal/BaseRegistry.js';\nclass EdgeMarkerRegistryImpl extends BaseRegistry {\n    createMarker(canvas, shape, type, pe, unitX, unitY, size, source, sw, filled) {\n        const markerFunction = this.get(type);\n        return markerFunction\n            ? markerFunction(canvas, shape, type, pe, unitX, unitY, size, source, sw, filled)\n            : null;\n    }\n}\n/**\n * A registry that stores the {@link MarkerFactoryFunction}s and their configuration to let generate {@link MarkerFunction}.\n *\n * The name used to register the marker is the marker type. It is then used to create the marker with {@link createMarker}.\n *\n * @category Configuration\n * @category Style\n * @since 0.20.0\n */\nexport const EdgeMarkerRegistry = new EdgeMarkerRegistryImpl();\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { DEFAULT_MARKERSIZE, NONE } from '../../../util/Constants.js';\nimport PolylineShape from './PolylineShape.js';\nimport { EdgeMarkerRegistry } from '../../style/marker/EdgeMarkerRegistry.js';\n/**\n * Extends {@link PolylineShape} to implement a connector shape including a polyline (a line with multiple points)\n * that allows for arrow heads on either side.\n *\n * The shape is used to represent edges, not vertices.\n *\n * This shape is registered under `connector` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Edge Shapes\n */\nclass ConnectorShape extends PolylineShape {\n    constructor(points, stroke, strokewidth) {\n        super(points, stroke, strokewidth);\n    }\n    /**\n     * Updates the {@link boundingBox} for this shape using {@link createBoundingBox}\n     * and {@link augmentBoundingBox} and stores the result in {@link boundingBox}.\n     */\n    updateBoundingBox() {\n        this.useSvgBoundingBox = this.style?.curved ?? false;\n        super.updateBoundingBox();\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintEdgeShape(c, pts) {\n        // The indirection via functions for markers is needed in\n        // order to apply the offsets before painting the line and\n        // paint the markers after painting the line.\n        const sourceMarker = this.createMarker(c, pts, true);\n        const targetMarker = this.createMarker(c, pts, false);\n        super.paintEdgeShape(c, pts);\n        // Disables shadows, dashed styles\n        c.setShadow(false);\n        c.setDashed(false);\n        if (sourceMarker) {\n            const strokeColor = this.style?.startStrokeColor ?? this.stroke;\n            c.setStrokeColor(strokeColor);\n            c.setFillColor(this.style?.startFillColor ?? strokeColor);\n            sourceMarker();\n        }\n        if (targetMarker) {\n            const strokeColor = this.style?.endStrokeColor ?? this.stroke;\n            c.setStrokeColor(strokeColor);\n            c.setFillColor(this.style?.endFillColor ?? strokeColor);\n            targetMarker();\n        }\n    }\n    /**\n     * Prepares the marker by adding offsets in pts and returning a function to paint the marker.\n     */\n    createMarker(c, pts, source) {\n        if (!this.style)\n            return null;\n        let result = null;\n        const n = pts.length;\n        const type = (source ? this.style.startArrow : this.style.endArrow) || NONE;\n        let p0 = source ? pts[1] : pts[n - 2];\n        const pe = source ? pts[0] : pts[n - 1];\n        if (type !== NONE && p0 !== null && pe !== null) {\n            let count = 1;\n            // Uses next non-overlapping point\n            while (count < n - 1 &&\n                Math.round(p0.x - pe.x) === 0 &&\n                Math.round(p0.y - pe.y) === 0) {\n                p0 = source ? pts[1 + count] : pts[n - 2 - count];\n                count++;\n            }\n            // Computes the norm and the inverse norm\n            const dx = pe.x - p0.x;\n            const dy = pe.y - p0.y;\n            const dist = Math.max(1, Math.sqrt(dx * dx + dy * dy));\n            const unitX = dx / dist;\n            const unitY = dy / dist;\n            const size = (source ? this.style.startSize : this.style.endSize) ?? DEFAULT_MARKERSIZE;\n            // Allow for stroke width in the end point used and the\n            // orthogonal vectors describing the direction of the marker\n            const filled = (source ? this.style.startFill : this.style.endFill) ?? true;\n            result = EdgeMarkerRegistry.createMarker(c, this, type, pe, unitX, unitY, size, source, this.strokeWidth, filled);\n        }\n        return result;\n    }\n    /**\n     * Augments the bounding box with the strokewidth and shadow offsets.\n     */\n    augmentBoundingBox(bbox) {\n        super.augmentBoundingBox(bbox);\n        if (!this.style)\n            return;\n        // Adds marker sizes\n        let size = 0;\n        if (this.style.startArrow !== NONE) {\n            size = (this.style.startSize ?? DEFAULT_MARKERSIZE) + 1;\n        }\n        if (this.style.endArrow !== NONE) {\n            size = Math.max(size, this.style.endSize ?? DEFAULT_MARKERSIZE) + 1;\n        }\n        bbox.grow(size * this.scale);\n    }\n}\nexport default ConnectorShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Client from '../../../Client.js';\nimport { ABSOLUTE_LINE_HEIGHT, DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, DEFAULT_FONTSTYLE, DEFAULT_TEXT_DIRECTION, FONT_STYLE_MASK, NONE, WORD_WRAP, LINE_HEIGHT, } from '../../../util/Constants.js';\nimport { getBoundingBox } from '../../../util/mathUtils.js';\nimport { getAlignmentAsPoint } from '../../../util/styleUtils.js';\nimport Point from '../../geometry/Point.js';\nimport Shape from '../Shape.js';\nimport Rectangle from '../../geometry/Rectangle.js';\nimport { htmlEntities, replaceTrailingNewlines, trim, } from '../../../util/StringUtils.js';\nimport { isNode } from '../../../util/domUtils.js';\nimport SvgCanvas2D from '../../canvas/SvgCanvas2D.js';\nimport { matchBinaryMask } from '../../../internal/utils.js';\n/**\n * Extends {@link Shape} to implement a text shape.\n *\n * This shape is **NOT** registered in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * To change vertical text from \"bottom to top\" to \"top to bottom\", the following code can be used:\n * ```javascript\n * TextShape.prototype.verticalTextRotation = 90;\n * ```\n *\n * @category Vertex Shapes\n */\nclass TextShape extends Shape {\n    constructor(value, bounds, align = 'center', valign = 'middle', color = 'black', family = DEFAULT_FONTFAMILY, size = DEFAULT_FONTSIZE, fontStyle = DEFAULT_FONTSTYLE, spacing = 2, spacingTop = 0, spacingRight = 0, spacingBottom = 0, spacingLeft = 0, horizontal = true, background = NONE, border = NONE, wrap = false, clipped = false, overflow = 'visible', labelPadding = 0, textDirection = DEFAULT_TEXT_DIRECTION) {\n        super();\n        this.margin = null;\n        this.unrotatedBoundingBox = null;\n        this.flipH = false;\n        this.flipV = false;\n        /**\n         * Specifies the spacing to be added to the top spacing. Default is 0. Use the\n         * value 5 here to get the same label positions as in mxGraph 1.x.\n         */\n        this.baseSpacingTop = 0;\n        /**\n         * Specifies the spacing to be added to the bottom spacing. Default is 0. Use the\n         * value 1 here to get the same label positions as in mxGraph 1.x.\n         */\n        this.baseSpacingBottom = 0;\n        /**\n         * Specifies the spacing to be added to the left spacing. Default is 0.\n         */\n        this.baseSpacingLeft = 0;\n        /**\n         * Specifies the spacing to be added to the right spacing. Default is 0.\n         */\n        this.baseSpacingRight = 0;\n        /**\n         * Specifies if linefeeds in HTML labels should be replaced with BR tags.\n         * Default is true.\n         */\n        this.replaceLinefeeds = true;\n        /**\n         * Rotation for vertical text. Default is -90 (bottom to top).\n         */\n        this.verticalTextRotation = -90;\n        /**\n         * Specifies if the string size should be measured in <updateBoundingBox> if\n         * the label is clipped and the label position is center and middle. If this is\n         * true, then the bounding box will be set to <bounds>. Default is true.\n         * <ignoreStringSize> has precedence over this switch.\n         */\n        this.ignoreClippedStringSize = true;\n        /**\n         * Specifies if the actual string size should be measured. If disabled the\n         * boundingBox will not ignore the actual size of the string, otherwise\n         * <bounds> will be used instead. Default is false.\n         */\n        this.ignoreStringSize = false;\n        /**\n         * Contains the last rendered text value. Used for caching.\n         */\n        this.lastValue = null;\n        /**\n         * Specifies if caching for HTML labels should be enabled. Default is true.\n         */\n        this.cacheEnabled = true;\n        this.value = value;\n        this.bounds = bounds;\n        this.color = color ?? 'black';\n        this.align = align ?? 'center';\n        this.valign = valign ?? 'middle';\n        this.family = family ?? DEFAULT_FONTFAMILY;\n        this.size = size ?? DEFAULT_FONTSIZE;\n        this.fontStyle = fontStyle ?? DEFAULT_FONTSTYLE;\n        this.spacing = spacing ?? 2;\n        this.spacingTop = this.spacing + (spacingTop ?? 0);\n        this.spacingRight = this.spacing + (spacingRight ?? 0);\n        this.spacingBottom = this.spacing + (spacingBottom ?? 0);\n        this.spacingLeft = this.spacing + (spacingLeft ?? 0);\n        this.horizontal = horizontal ?? true;\n        this.background = background;\n        this.border = border;\n        this.wrap = wrap ?? false;\n        this.clipped = clipped ?? false;\n        this.overflow = overflow ?? 'visible';\n        this.labelPadding = labelPadding ?? 0;\n        this.textDirection = textDirection;\n        this.rotation = 0;\n        this.updateMargin();\n    }\n    /**\n     * Disables offset in IE9 for crisper image output.\n     */\n    getSvgScreenOffset() {\n        return 0;\n    }\n    /**\n     * Returns true if the bounds are not null and all of its variables are numeric.\n     */\n    checkBounds() {\n        return (!isNaN(this.scale) &&\n            isFinite(this.scale) &&\n            this.scale > 0 &&\n            this.bounds &&\n            !isNaN(this.bounds.x) &&\n            !isNaN(this.bounds.y) &&\n            !isNaN(this.bounds.width) &&\n            !isNaN(this.bounds.height));\n    }\n    /**\n     * Generic rendering code.\n     */\n    paint(c, update = false) {\n        // Scale is passed-through to canvas\n        const s = this.scale;\n        const x = this.bounds.x / s;\n        const y = this.bounds.y / s;\n        const w = this.bounds.width / s;\n        const h = this.bounds.height / s;\n        this.updateTransform(c, x, y, w, h);\n        this.configureCanvas(c, x, y, w, h);\n        if (update) {\n            c.updateText(x, y, w, h, this.align, this.valign, this.wrap, this.overflow, this.clipped, this.getTextRotation(), this.node);\n        }\n        else {\n            // Checks if text contains HTML markup\n            const realHtml = isNode(this.value) || this.dialect === 'strictHtml';\n            // Always renders labels as HTML in VML\n            const fmt = realHtml ? 'html' : '';\n            let val = this.value;\n            if (!realHtml && fmt === 'html') {\n                // @ts-ignore\n                val = htmlEntities(val, false);\n            }\n            if (fmt === 'html' && !isNode(this.value)) {\n                val = replaceTrailingNewlines(val, '<div><br></div>');\n            }\n            // Handles trailing newlines to make sure they are visible in rendering output\n            val =\n                !isNode(this.value) && this.replaceLinefeeds && fmt === 'html'\n                    ? val.replace(/\\n/g, '<br/>')\n                    : val;\n            let dir = this.textDirection;\n            if (dir === 'auto' && !realHtml) {\n                dir = this.getAutoDirection();\n            }\n            if (dir !== 'ltr' && dir !== 'rtl') {\n                dir = '';\n            }\n            c.text(x, y, w, h, val, this.align, this.valign, this.wrap, fmt, this.overflow, this.clipped, this.getTextRotation(), dir);\n        }\n    }\n    /**\n     * Renders the text using the given DOM nodes.\n     */\n    redraw() {\n        if (this.visible &&\n            this.checkBounds() &&\n            this.cacheEnabled &&\n            this.lastValue === this.value &&\n            (isNode(this.value) || this.dialect === 'strictHtml')) {\n            if (this.node.nodeName === 'DIV') {\n                this.redrawHtmlShape();\n                this.updateBoundingBox();\n            }\n            else {\n                const canvas = this.createCanvas();\n                if (canvas) {\n                    // Specifies if events should be handled\n                    canvas.pointerEvents = this.pointerEvents;\n                    this.paint(canvas, true);\n                    this.destroyCanvas(canvas);\n                    this.updateBoundingBox();\n                }\n            }\n        }\n        else {\n            super.redraw();\n            if (isNode(this.value) || this.dialect === 'strictHtml') {\n                this.lastValue = this.value;\n            }\n            else {\n                this.lastValue = null;\n            }\n        }\n    }\n    /**\n     * Resets all styles.\n     */\n    resetStyles() {\n        super.resetStyles();\n        this.color = 'black';\n        this.align = 'center';\n        this.valign = 'middle';\n        this.family = DEFAULT_FONTFAMILY;\n        this.size = DEFAULT_FONTSIZE;\n        this.fontStyle = DEFAULT_FONTSTYLE;\n        this.spacing = 2;\n        this.spacingTop = 2;\n        this.spacingRight = 2;\n        this.spacingBottom = 2;\n        this.spacingLeft = 2;\n        this.horizontal = true;\n        this.background = NONE;\n        this.border = NONE;\n        this.textDirection = DEFAULT_TEXT_DIRECTION;\n        this.margin = null;\n    }\n    /**\n     * Extends mxShape to update the text styles.\n     *\n     * @param state <CellState> of the corresponding cell.\n     */\n    apply(state) {\n        const old = this.spacing;\n        super.apply(state);\n        if (this.style) {\n            this.fontStyle = this.style.fontStyle ?? this.fontStyle;\n            this.family = this.style.fontFamily ?? this.family;\n            this.size = this.style.fontSize ?? this.size;\n            this.color = this.style.fontColor ?? this.color;\n            this.align = this.style.align ?? this.align;\n            this.valign = this.style.verticalAlign ?? this.valign;\n            this.spacing = this.style.spacing ?? this.spacing;\n            this.spacingTop = (this.style.spacingTop ?? this.spacingTop - old) + this.spacing;\n            this.spacingRight =\n                (this.style.spacingRight ?? this.spacingRight - old) + this.spacing;\n            this.spacingBottom =\n                (this.style.spacingBottom ?? this.spacingBottom - old) + this.spacing;\n            this.spacingLeft =\n                (this.style.spacingLeft ?? this.spacingLeft - old) + this.spacing;\n            this.horizontal = this.style.horizontal ?? this.horizontal;\n            this.background = this.style.labelBackgroundColor ?? this.background;\n            this.border = this.style.labelBorderColor ?? this.border;\n            this.textDirection = this.style.textDirection ?? DEFAULT_TEXT_DIRECTION;\n            this.opacity = this.style.textOpacity ?? 100;\n            this.updateMargin();\n        }\n        this.flipV = false;\n        this.flipH = false;\n    }\n    /**\n     * Used to determine the automatic text direction.\n     *\n     * Returns 'ltr' or 'rtl' depending on the contents of {@link value}.\n     *\n     * This is not invoked for HTML, wrapped content or if {@link value} is a DOM node.\n     */\n    getAutoDirection() {\n        // Looks for strong (directional) characters\n        const tmp = /[A-Za-z\\u05d0-\\u065f\\u066a-\\u06ef\\u06fa-\\u07ff\\ufb1d-\\ufdff\\ufe70-\\ufefc]/.exec(String(this.value));\n        // Returns the direction defined by the character\n        return tmp && tmp.length > 0 && tmp[0] > 'z' ? 'rtl' : 'ltr';\n    }\n    /**\n     * Returns the node that contains the rendered input.\n     */\n    getContentNode() {\n        let result = this.node;\n        if (result) {\n            // Rendered with no foreignObject\n            if (!result.ownerSVGElement) {\n                // @ts-ignore\n                result = this.node.firstChild.firstChild;\n            }\n            else {\n                // Innermost DIV that contains the actual content\n                // @ts-ignore\n                result = result.firstChild.firstChild.firstChild.firstChild.firstChild;\n            }\n        }\n        return result;\n    }\n    /**\n     * Updates the <boundingBox> for this shape using the given node and position.\n     */\n    updateBoundingBox() {\n        let { node } = this;\n        this.boundingBox = this.bounds.clone();\n        const rot = this.getTextRotation();\n        const h = this.style?.labelPosition ?? 'center';\n        const v = this.style?.verticalLabelPosition ?? 'middle';\n        if (!this.ignoreStringSize &&\n            node &&\n            this.overflow !== 'fill' &&\n            (!this.clipped || !this.ignoreClippedStringSize || h !== 'center' || v !== 'middle')) {\n            let ow = null;\n            let oh = null;\n            if (node.firstChild &&\n                node.firstChild.firstChild &&\n                node.firstChild.firstChild.nodeName === 'foreignObject') {\n                // Uses second inner DIV for font metrics\n                // @ts-ignore\n                node = node.firstChild.firstChild.firstChild.firstChild;\n                // @ts-ignore\n                oh = node.offsetHeight * this.scale;\n                if (this.overflow === 'width') {\n                    ow = this.boundingBox.width;\n                }\n                else {\n                    // @ts-ignore\n                    ow = node.offsetWidth * this.scale;\n                }\n            }\n            else {\n                try {\n                    const b = node.getBBox();\n                    // Workaround for bounding box of empty string\n                    if (typeof this.value === 'string' && trim(this.value)?.length === 0) {\n                        this.boundingBox = null;\n                    }\n                    else if (b.width === 0 && b.height === 0) {\n                        this.boundingBox = null;\n                    }\n                    else {\n                        this.boundingBox = new Rectangle(b.x, b.y, b.width, b.height);\n                    }\n                    return;\n                }\n                catch (e) {\n                    // Ignores NS_ERROR_FAILURE in FF if container display is none.\n                }\n            }\n            if (ow && oh) {\n                this.boundingBox = new Rectangle(this.bounds.x, this.bounds.y, ow, oh);\n            }\n        }\n        if (this.boundingBox) {\n            const margin = this.margin;\n            if (rot !== 0) {\n                // Accounts for pre-rotated x and y\n                const bbox = (getBoundingBox(new Rectangle(margin.x * this.boundingBox.width, margin.y * this.boundingBox.height, this.boundingBox.width, this.boundingBox.height), rot, new Point(0, 0)));\n                this.unrotatedBoundingBox = Rectangle.fromRectangle(this.boundingBox);\n                this.unrotatedBoundingBox.x += margin.x * this.unrotatedBoundingBox.width;\n                this.unrotatedBoundingBox.y += margin.y * this.unrotatedBoundingBox.height;\n                this.boundingBox.x += bbox.x;\n                this.boundingBox.y += bbox.y;\n                this.boundingBox.width = bbox.width;\n                this.boundingBox.height = bbox.height;\n            }\n            else {\n                this.boundingBox.x += margin.x * this.boundingBox.width;\n                this.boundingBox.y += margin.y * this.boundingBox.height;\n                this.unrotatedBoundingBox = null;\n            }\n        }\n    }\n    /**\n     * Returns 0 to avoid using rotation in the canvas via updateTransform.\n     */\n    getShapeRotation() {\n        return 0;\n    }\n    /**\n     * Returns the rotation for the text label of the corresponding shape.\n     */\n    getTextRotation() {\n        return this.state && this.state.shape ? this.state.shape.getTextRotation() : 0;\n    }\n    /**\n     * Inverts the bounds if {@link Shape#isBoundsInverted} returns true or if the\n     * horizontal style is false.\n     */\n    isPaintBoundsInverted() {\n        return !this.horizontal && !!this.state && this.state.cell.isVertex();\n    }\n    /**\n     * Sets the state of the canvas for drawing the shape.\n     */\n    configureCanvas(c, x, y, w, h) {\n        super.configureCanvas(c, x, y, w, h);\n        c.setFontColor(this.color);\n        c.setFontBackgroundColor(this.background);\n        c.setFontBorderColor(this.border);\n        c.setFontFamily(this.family);\n        c.setFontSize(this.size);\n        c.setFontStyle(this.fontStyle);\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    getHtmlValue() {\n        let val = this.value;\n        if (this.dialect !== 'strictHtml') {\n            val = htmlEntities(val, false);\n        }\n        // Handles trailing newlines to make sure they are visible in rendering output\n        val = replaceTrailingNewlines(val, '<div><br></div>');\n        val = this.replaceLinefeeds ? val.replace(/\\n/g, '<br/>') : val;\n        return val;\n    }\n    /**\n     * Private helper function to create SVG elements\n     */\n    getTextCss() {\n        const lh = ABSOLUTE_LINE_HEIGHT ? `${this.size * LINE_HEIGHT}px` : LINE_HEIGHT;\n        let css = `display: inline-block; font-size: ${this.size}px; ` +\n            `font-family: ${this.family}; color: ${this.color}; line-height: ${lh}; pointer-events: ${this.pointerEvents ? 'all' : 'none'}; `;\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.BOLD) &&\n            (css += 'font-weight: bold; ');\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.ITALIC) &&\n            (css += 'font-style: italic; ');\n        const txtDecor = [];\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.UNDERLINE) &&\n            txtDecor.push('underline');\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n            txtDecor.push('line-through');\n        txtDecor.length > 0 && (css += `text-decoration: ${txtDecor.join(' ')}; `);\n        return css;\n    }\n    /**\n     * Updates the HTML node(s) to reflect the latest bounds and scale.\n     */\n    redrawHtmlShape() {\n        const w = Math.max(0, Math.round(this.bounds.width / this.scale));\n        const h = Math.max(0, Math.round(this.bounds.height / this.scale));\n        const flex = `position: absolute; left: ${Math.round(this.bounds.x)}px; ` +\n            `top: ${Math.round(this.bounds.y)}px; pointer-events: none; `;\n        const block = this.getTextCss();\n        const margin = this.margin;\n        const node = this.node;\n        SvgCanvas2D.createCss(w + 2, h, this.align, this.valign, this.wrap, this.overflow, this.clipped, this.background !== NONE ? htmlEntities(this.background, true) : null, this.border !== NONE ? htmlEntities(this.border, true) : null, flex, block, this.scale, (dx, dy, flex, item, block, ofl) => {\n            const r = this.getTextRotation();\n            let tr = (this.scale !== 1 ? `scale(${this.scale}) ` : '') +\n                (r !== 0 ? `rotate(${r}deg) ` : '') +\n                (margin.x !== 0 || margin.y !== 0\n                    ? `translate(${margin.x * 100}%,${margin.y * 100}%)`\n                    : '');\n            if (tr !== '') {\n                tr = `transform-origin: 0 0; transform: ${tr}; `;\n            }\n            if (ofl === '') {\n                flex += item;\n                item = `display:inline-block; min-width: 100%; ${tr}`;\n            }\n            else {\n                item += tr;\n                if (Client.IS_SF) {\n                    item += '-webkit-clip-path: content-box;';\n                }\n            }\n            if (this.opacity < 100) {\n                block += `opacity: ${this.opacity / 100}; `;\n            }\n            node.setAttribute('style', flex);\n            const html = isNode(this.value)\n                ? // @ts-ignore\n                    this.value.outerHTML\n                : this.getHtmlValue();\n            if (!node.firstChild) {\n                node.innerHTML = `<div><div>${html}</div></div>`;\n            }\n            // @ts-ignore\n            node.firstChild.firstChild.setAttribute('style', block);\n            // @ts-ignore\n            node.firstChild.setAttribute('style', item);\n        });\n    }\n    /**\n     * Sets the inner HTML of the given element to the <value>.\n     */\n    updateInnerHtml(elt) {\n        if (isNode(this.value)) {\n            // @ts-ignore\n            elt.innerHTML = this.value.outerHTML;\n        }\n        else {\n            let val = this.value;\n            if (this.dialect !== 'strictHtml') {\n                // LATER: Can be cached in updateValue\n                val = htmlEntities(val, false);\n            }\n            // Handles trailing newlines to make sure they are visible in rendering output\n            val = replaceTrailingNewlines(val, '<div>&nbsp;</div>');\n            val = this.replaceLinefeeds ? val.replace(/\\n/g, '<br/>') : val;\n            val = `<div style=\"display:inline-block;_display:inline;\">${val}</div>`;\n            elt.innerHTML = val;\n        }\n    }\n    /**\n     * Updates the HTML node(s) to reflect the latest bounds and scale.\n     */\n    updateValue() {\n        const node = this.node;\n        if (isNode(this.value)) {\n            node.innerHTML = '';\n            node.appendChild(this.value);\n        }\n        else {\n            let val = this.value;\n            if (this.dialect !== 'strictHtml') {\n                val = htmlEntities(val, false);\n            }\n            // Handles trailing newlines to make sure they are visible in rendering output\n            val = replaceTrailingNewlines(val, '<div><br></div>');\n            val = this.replaceLinefeeds ? val.replace(/\\n/g, '<br/>') : val;\n            const bg = this.background !== NONE ? this.background : null;\n            const bd = this.border !== NONE ? this.border : null;\n            if (this.overflow === 'fill' || this.overflow === 'width') {\n                if (bg) {\n                    node.style.backgroundColor = bg;\n                }\n                if (bd) {\n                    node.style.border = `1px solid ${bd}`;\n                }\n            }\n            else {\n                let css = '';\n                if (bg) {\n                    css += `background-color:${htmlEntities(bg, true)};`;\n                }\n                if (bd) {\n                    css += `border:1px solid ${htmlEntities(bd, true)};`;\n                }\n                // Wrapper DIV for background, zoom needed for inline in quirks\n                // and to measure wrapped font sizes in all browsers\n                // FIXME: Background size in quirks mode for wrapped text\n                const lh = ABSOLUTE_LINE_HEIGHT ? `${this.size * LINE_HEIGHT}px` : LINE_HEIGHT;\n                val =\n                    `<div style=\"zoom:1;${css}display:inline-block;_display:inline;text-decoration:inherit;` +\n                        `padding-bottom:1px;padding-right:1px;line-height:${lh}\">${val}</div>`;\n            }\n            node.innerHTML = val;\n            // Sets text direction\n            const divs = node.getElementsByTagName('div');\n            if (divs.length > 0) {\n                let dir = this.textDirection;\n                if (dir === 'auto' && this.dialect !== 'strictHtml') {\n                    dir = this.getAutoDirection();\n                }\n                if (dir === 'ltr' || dir === 'rtl') {\n                    divs[divs.length - 1].setAttribute('dir', dir);\n                }\n                else {\n                    divs[divs.length - 1].removeAttribute('dir');\n                }\n            }\n        }\n    }\n    /**\n     * Updates the HTML node(s) to reflect the latest bounds and scale.\n     */\n    updateFont(node) {\n        const { style } = node;\n        // @ts-ignore\n        style.lineHeight = ABSOLUTE_LINE_HEIGHT\n            ? `${this.size * LINE_HEIGHT}px`\n            : LINE_HEIGHT;\n        style.fontSize = `${this.size}px`;\n        style.fontFamily = this.family;\n        style.verticalAlign = 'top';\n        style.color = this.color;\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.BOLD)\n            ? (style.fontWeight = 'bold')\n            : (style.fontWeight = '');\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.ITALIC)\n            ? (style.fontStyle = 'italic')\n            : (style.fontStyle = '');\n        const txtDecor = [];\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.UNDERLINE) &&\n            txtDecor.push('underline');\n        matchBinaryMask(this.fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n            txtDecor.push('line-through');\n        txtDecor.length > 0 && (style.textDecoration = txtDecor.join(' '));\n        if (this.align === 'center') {\n            style.textAlign = 'center';\n        }\n        else if (this.align === 'right') {\n            style.textAlign = 'right';\n        }\n        else {\n            style.textAlign = 'left';\n        }\n    }\n    /**\n     * Updates the HTML node(s) to reflect the latest bounds and scale.\n     */\n    updateSize(node, enableWrap = false) {\n        const w = Math.max(0, Math.round(this.bounds.width / this.scale));\n        const h = Math.max(0, Math.round(this.bounds.height / this.scale));\n        const { style } = node;\n        // NOTE: Do not use maxWidth here because wrapping will\n        // go wrong if the cell is outside of the viewable area\n        if (this.clipped) {\n            style.overflow = 'hidden';\n            style.maxHeight = `${h}px`;\n            style.maxWidth = `${w}px`;\n        }\n        else if (this.overflow === 'fill') {\n            style.width = `${w + 1}px`;\n            style.height = `${h + 1}px`;\n            style.overflow = 'hidden';\n        }\n        else if (this.overflow === 'width') {\n            style.width = `${w + 1}px`;\n            style.maxHeight = `${h + 1}px`;\n            style.overflow = 'hidden';\n        }\n        if (this.wrap && w > 0) {\n            style.wordWrap = WORD_WRAP;\n            style.whiteSpace = 'normal';\n            style.width = `${w}px`;\n            if (enableWrap && this.overflow !== 'fill' && this.overflow !== 'width') {\n                let sizeDiv = node;\n                if (sizeDiv.firstChild != null && sizeDiv.firstChild.nodeName === 'DIV') {\n                    // @ts-ignore\n                    sizeDiv = sizeDiv.firstChild;\n                    if (node.style.wordWrap === 'break-word') {\n                        sizeDiv.style.width = '100%';\n                    }\n                }\n                let tmp = sizeDiv.offsetWidth;\n                // Workaround for text measuring in hidden containers\n                if (tmp === 0) {\n                    const prev = node.parentNode;\n                    node.style.visibility = 'hidden';\n                    document.body.appendChild(node);\n                    tmp = sizeDiv.offsetWidth;\n                    node.style.visibility = '';\n                    prev.appendChild(node);\n                }\n                tmp += 3;\n                if (this.clipped) {\n                    tmp = Math.min(tmp, w);\n                }\n                style.width = `${tmp}px`;\n            }\n        }\n        else {\n            style.whiteSpace = 'nowrap';\n        }\n    }\n    /**\n     * Returns the spacing as an {@link Point}.\n     */\n    updateMargin() {\n        this.margin = getAlignmentAsPoint(this.align, this.valign);\n    }\n    /**\n     * Returns the spacing as an {@link Point}.\n     */\n    getSpacing() {\n        let dx = 0;\n        let dy = 0;\n        if (this.align === 'center') {\n            dx = (this.spacingLeft - this.spacingRight) / 2;\n        }\n        else if (this.align === 'right') {\n            dx = -this.spacingRight - this.baseSpacingRight;\n        }\n        else {\n            dx = this.spacingLeft + this.baseSpacingLeft;\n        }\n        if (this.valign === 'middle') {\n            dy = (this.spacingTop - this.spacingBottom) / 2;\n        }\n        else if (this.valign === 'bottom') {\n            dy = -this.spacingBottom - this.baseSpacingBottom;\n        }\n        else {\n            dy = this.spacingTop + this.baseSpacingTop;\n        }\n        return new Point(dx, dy);\n    }\n}\nexport default TextShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { BaseRegistry } from '../../internal/BaseRegistry.js';\n/**\n * A registry that stores the {@link ShapeConstructor}s and their configuration.\n *\n * For adding new shapes you should use {@link ShapeRegistry.add}.\n *\n * Names generally used to register the built-in shapes:\n * - actor\n * - arrow\n * - arrow connector (for edges)\n * - cloud\n * - connector (for edges)\n * - cylinder\n * - double ellipse\n * - ellipse\n * - hexagon\n * - image\n * - label\n * - line (for edges)\n * - rectangle\n * - rhombus\n * - swimlane\n * - triangle\n *\n * @since 0.20.0\n * @category Configuration\n * @category Shape\n */\nexport const ShapeRegistry = new BaseRegistry();\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { BaseRegistry } from '../../../internal/BaseRegistry.js';\n/**\n * A registry that stores the {@link StencilShape}s and their configuration.\n *\n * Here is an example showing how to add stencils:\n * ```javascript\n * const response = requestUtils.load('test/stencils.xml');\n * const root = response.getDocumentElement(); // <shapes> node\n * let shape = root.firstChild;\n *\n * while (shape) {\n *   if (shape.nodeType === constants.NODE_TYPE.ELEMENT) {\n *    StencilShapeRegistry.add(shape.getAttribute('name'), new StencilShape(shape));\n *  }\n *\n *  shape = shape.nextSibling;\n * }\n *\n * The XSD for the stencil description is available in the `stencils.xsd` file.\n * ```\n *\n * @category Configuration\n * @category Shape\n */\nexport const StencilShapeRegistry = new BaseRegistry();\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2017, JGraph Ltd\nCopyright (c) 2006-2017, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport RectangleShape from '../shape/node/RectangleShape.js';\nimport ConnectorShape from '../shape/edge/ConnectorShape.js';\nimport ImageShape from '../shape/node/ImageShape.js';\nimport TextShape from '../shape/node/TextShape.js';\nimport { DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, DEFAULT_FONTSTYLE, DEFAULT_TEXT_DIRECTION, NONE, } from '../../util/Constants.js';\nimport { getRotatedPoint, mod, toRadians } from '../../util/mathUtils.js';\nimport { convertPoint } from '../../util/styleUtils.js';\nimport { equalEntries, equalPoints } from '../../util/arrayUtils.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { ShapeRegistry } from '../shape/ShapeRegistry.js';\nimport { StencilShapeRegistry } from '../shape/stencil/StencilShapeRegistry.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Client from '../../Client.js';\nimport InternalMouseEvent from '../event/InternalMouseEvent.js';\nimport EventObject from '../event/EventObject.js';\nimport Point from '../geometry/Point.js';\nimport Shape from '../shape/Shape.js';\nimport { getClientX, getClientY, getSource } from '../../util/EventUtils.js';\nimport { isNode } from '../../util/domUtils.js';\nconst placeholderStyleValues = ['inherit', 'swimlane', 'indicated'];\nconst placeholderStyleProperties = [\n    'fillColor',\n    'strokeColor',\n    'gradientColor',\n    'fontColor',\n];\n/**\n * Renders {@link Cell}s into a document object model.\n *\n * In general, the `CellRenderer` is in charge of creating, redrawing and destroying the shape and label associated with a cell state,\n * as well as some other graphical objects, namely controls and overlays.\n *\n * The shape hierarchy in the display (i.e. the hierarchy in which the DOM nodes appear in the document) does not reflect the cell hierarchy.\n * The shapes are a (flat) sequence of shapes and labels inside the draw pane of the {@link GraphView}, with some exceptions,\n * namely the HTML labels being placed directly inside the graph container for certain browsers.\n */\nclass CellRenderer {\n    constructor() {\n        /**\n         * Defines the default shape for edges.\n         * @default {@link ConnectorShape}\n         */\n        this.defaultEdgeShape = ConnectorShape;\n        /**\n         * Defines the default shape for vertices.\n         * @default {@link RectangleShape}.\n         */\n        this.defaultVertexShape = RectangleShape;\n        /**\n         * Defines the default shape for labels.\n         * @default {@link TextShape}.\n         */\n        this.defaultTextShape = TextShape;\n        /**\n         * Specifies if the folding icon should ignore the horizontal orientation of a swimlane.\n         * @default true.\n         */\n        this.legacyControlPosition = true;\n        /**\n         * Specifies if spacing and label position should be ignored if overflow is fill or width.\n         * @default true for backwards compatibility.\n         */\n        this.legacySpacing = true;\n        /**\n         * Antialiasing option for new shapes.\n         * @default true.\n         */\n        this.antiAlias = true;\n        /**\n         * Minimum stroke width for SVG output.\n         */\n        this.minSvgStrokeWidth = 1;\n        /**\n         * Specifies if the enabled state of the graph should be ignored in the control\n         * click handler (to allow folding in disabled graphs).\n         * @default false.\n         */\n        this.forceControlClickHandler = false;\n    }\n    /**\n     * Initializes the shape in the given state by calling its init method with\n     * the correct container after configuring it using {@link configureShape}.\n     *\n     * @param state {@link CellState} for which the shape should be initialized.\n     */\n    initializeShape(state) {\n        if (state.shape) {\n            state.shape.dialect = state.view.graph.dialect;\n            this.configureShape(state);\n            state.shape.init(state.view.getDrawPane());\n        }\n    }\n    /**\n     * Creates and returns the shape for the given cell state.\n     *\n     * @param state {@link CellState} for which the shape should be created.\n     */\n    createShape(state) {\n        // Checks if there is a stencil for the name and creates a shape instance for the stencil if one exists\n        const stencil = StencilShapeRegistry.get(state.style.shape);\n        if (stencil) {\n            return new Shape(stencil);\n        }\n        const shapeConstructor = this.getShapeConstructor(state);\n        return new shapeConstructor();\n    }\n    /**\n     * Creates the indicator shape for the given cell state.\n     *\n     * @param state {@link CellState} for which the indicator shape should be created.\n     */\n    createIndicatorShape(state) {\n        if (state.shape) {\n            state.shape.indicatorShape = this.getShape(state.getIndicatorShape());\n        }\n    }\n    /**\n     * Returns the shape for the given name from {@link ShapeRegistry}.\n     */\n    getShape(name) {\n        return ShapeRegistry.get(name);\n    }\n    /**\n     * Returns the constructor to be used for creating the shape.\n     */\n    getShapeConstructor(state) {\n        let ctor = this.getShape(state.style.shape);\n        if (!ctor) {\n            ctor = state.cell.isEdge() ? this.defaultEdgeShape : this.defaultVertexShape;\n        }\n        return ctor;\n    }\n    /**\n     * Configures the shape for the given cell state.\n     *\n     * @param state {@link CellState} for which the shape should be configured.\n     */\n    configureShape(state) {\n        const shape = state.shape;\n        if (shape) {\n            shape.apply(state);\n            shape.imageSrc = state.getImageSrc() || null;\n            shape.indicatorColor = state.getIndicatorColor() || NONE;\n            shape.indicatorStrokeColor = state.style.indicatorStrokeColor || NONE;\n            shape.indicatorGradientColor = state.getIndicatorGradientColor() || NONE;\n            if (state.style.indicatorDirection) {\n                shape.indicatorDirection = state.style.indicatorDirection;\n            }\n            shape.indicatorImageSrc = state.getIndicatorImageSrc() || null;\n            this.postConfigureShape(state);\n        }\n    }\n    /**\n     * Replaces any reserved words used for attributes, eg. inherit,\n     * indicated or swimlane for colors in the shape for the given state.\n     * This implementation resolves these keywords on the fill, stroke\n     * and gradient color keys.\n     */\n    postConfigureShape(state) {\n        if (state.shape) {\n            this.resolveColor(state, 'indicatorGradientColor', 'gradientColor');\n            this.resolveColor(state, 'indicatorColor', 'fillColor');\n            this.resolveColor(state, 'gradient', 'gradientColor');\n            this.resolveColor(state, 'stroke', 'strokeColor');\n            this.resolveColor(state, 'fill', 'fillColor');\n        }\n    }\n    /**\n     * Check if style properties supporting placeholders requires resolution.\n     */\n    checkPlaceholderStyles(state) {\n        // LATER: Check if the color has actually changed\n        for (const property of placeholderStyleProperties) {\n            if (placeholderStyleValues.includes(state.style[property])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Resolves special keywords 'inherit', 'indicated' and 'swimlane' and sets\n     * the respective color on the shape.\n     */\n    resolveColor(state, field, key) {\n        const shape = key === 'fontColor' ? state.text : state.shape;\n        if (shape) {\n            const graph = state.view.graph;\n            // @ts-ignore\n            const value = shape[field];\n            let referenced = null;\n            if (value === 'inherit') {\n                referenced = state.cell.getParent();\n            }\n            else if (value === 'swimlane') {\n                // @ts-ignore\n                shape[field] =\n                    key === 'strokeColor' || key === 'fontColor' ? '#000000' : '#ffffff';\n                if (state.cell.getTerminal(false)) {\n                    referenced = state.cell.getTerminal(false);\n                }\n                else {\n                    referenced = state.cell;\n                }\n                referenced = graph.getSwimlane(referenced);\n                key = graph.swimlaneIndicatorColorAttribute;\n            }\n            else if (value === 'indicated' && state.shape) {\n                // @ts-ignore\n                shape[field] = state.shape.indicatorColor;\n            }\n            else if (key !== 'fillColor' && value === 'fillColor' && state.shape) {\n                // @ts-ignore\n                shape[field] = state.style.fillColor;\n            }\n            else if (key !== 'strokeColor' && value === 'strokeColor' && state.shape) {\n                // @ts-ignore\n                shape[field] = state.style.strokeColor;\n            }\n            if (referenced) {\n                const rstate = graph.getView().getState(referenced);\n                // @ts-ignore\n                shape[field] = null;\n                if (rstate) {\n                    const rshape = key === 'fontColor' ? rstate.text : rstate.shape;\n                    if (rshape && field !== 'indicatorColor') {\n                        // @ts-ignore\n                        shape[field] = rshape[field];\n                    }\n                    else {\n                        // @ts-ignore\n                        shape[field] = rstate.style[key];\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Returns the value to be used for the label.\n     *\n     * @param state {@link CellState} for which the label should be created.\n     */\n    getLabelValue(state) {\n        const graph = state.view.graph;\n        return graph.getLabel(state.cell);\n    }\n    /**\n     * Creates the label for the given cell state.\n     *\n     * @param state {@link CellState} for which the label should be created.\n     * @param value the label value.\n     */\n    createLabel(state, value) {\n        const graph = state.view.graph;\n        if ((state.style.fontSize || 0) > 0 || state.style.fontSize == null) {\n            // Avoids using DOM node for empty labels\n            const isForceHtml = graph.isHtmlLabel(state.cell) || isNode(value);\n            state.text = new this.defaultTextShape(value, new Rectangle(), state.style.align ?? 'center', state.getVerticalAlign(), state.style.fontColor, state.style.fontFamily, state.style.fontSize, state.style.fontStyle, state.style.spacing, state.style.spacingTop, state.style.spacingRight, state.style.spacingBottom, state.style.spacingLeft, state.style.horizontal, state.style.labelBackgroundColor, state.style.labelBorderColor, graph.isWrapping(state.cell) && graph.isHtmlLabel(state.cell), graph.isLabelClipped(state.cell), state.style.overflow, state.style.labelPadding, state.style.textDirection ?? DEFAULT_TEXT_DIRECTION);\n            state.text.opacity = state.style.textOpacity ?? 100;\n            state.text.dialect = isForceHtml ? 'strictHtml' : graph.dialect;\n            state.text.style = state.style;\n            state.text.state = state;\n            this.initializeLabel(state, state.text);\n            // Workaround for touch devices routing all events for a mouse gesture\n            // (down, move, up) via the initial DOM node. IE additionally redirects\n            // the event via the initial DOM node but the event source is the node\n            // under the mouse, so we need to check if this is the case and force\n            // getCellAt for the subsequent mouseMoves and the final mouseUp.\n            let forceGetCell = false;\n            const getState = (evt) => {\n                let result = state;\n                if (Client.IS_TOUCH || forceGetCell) {\n                    const x = getClientX(evt);\n                    const y = getClientY(evt);\n                    // Dispatches the drop event to the graph which\n                    // consumes and executes the source function\n                    const pt = convertPoint(graph.container, x, y);\n                    result = graph.view.getState(graph.getCellAt(pt.x, pt.y));\n                }\n                return result;\n            };\n            // TODO: Add handling for special touch device gestures\n            InternalEvent.addGestureListeners(state.text.node, (evt) => {\n                if (this.isLabelEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt, state));\n                    const source = getSource(evt);\n                    forceGetCell =\n                        // @ts-ignore nodeName should exist.\n                        graph.dialect !== 'svg' && source.nodeName === 'IMG';\n                }\n            }, (evt) => {\n                if (this.isLabelEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, getState(evt)));\n                }\n            }, (evt) => {\n                if (this.isLabelEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt, getState(evt)));\n                    forceGetCell = false;\n                }\n            });\n            // Uses double click timeout in mxGraph for quirks mode\n            if (graph.isNativeDblClickEnabled()) {\n                InternalEvent.addListener(state.text.node, 'dblclick', (evt) => {\n                    if (this.isLabelEvent(state, evt)) {\n                        graph.dblClick(evt, state.cell);\n                        InternalEvent.consume(evt);\n                    }\n                });\n            }\n        }\n    }\n    /**\n     * Initializes the label with a suitable container.\n     *\n     * @param state {@link CellState} whose label should be initialized.\n     * @param shape {@link Shape} that represents the label.\n     */\n    initializeLabel(state, shape) {\n        if (Client.IS_SVG && Client.NO_FO && shape.dialect !== 'svg') {\n            const graph = state.view.graph;\n            shape.init(graph.container);\n        }\n        else {\n            shape.init(state.view.getDrawPane());\n        }\n    }\n    /**\n     * Creates the actual shape for showing the overlay for the given cell state.\n     *\n     * @param state {@link CellState} for which the overlay should be created.\n     */\n    createCellOverlays(state) {\n        const graph = state.view.graph;\n        const cellOverlays = graph.getCellOverlays(state.cell);\n        const createdOverlays = new Map();\n        for (const cellOverlay of cellOverlays) {\n            const shape = state.overlays.get(cellOverlay);\n            state.overlays.delete(cellOverlay);\n            if (shape) {\n                createdOverlays.set(cellOverlay, shape);\n                continue;\n            }\n            const overlayShape = this.createOverlayShape(state, cellOverlay);\n            overlayShape.dialect = graph.dialect;\n            overlayShape.overlay = cellOverlay;\n            this.initializeOverlay(state, overlayShape);\n            this.installCellOverlayListeners(state, cellOverlay, overlayShape);\n            this.configureOverlayShape(state, cellOverlay, overlayShape);\n            createdOverlays.set(cellOverlay, overlayShape);\n        }\n        // Removes unused\n        state.overlays.forEach((shape) => {\n            shape.destroy();\n        });\n        state.overlays = createdOverlays;\n    }\n    /**\n     * Create the Shape of the overlay.\n     *\n     * @param _state {@link CellState} for which the overlay shape should be created.\n     * @param cellOverlay {@link CellOverlay} used to create the Shape of the overlay.\n     * @since 0.16.0\n     */\n    createOverlayShape(_state, cellOverlay) {\n        const overlayShape = new ImageShape(new Rectangle(), cellOverlay.image.src);\n        overlayShape.preserveImageAspect = false;\n        return overlayShape;\n    }\n    /**\n     * Initializes the given overlay.\n     *\n     * @param state {@link CellState}  for which the overlay should be created.\n     * @param overlay {@link Shape} that represents the overlay.\n     */\n    initializeOverlay(state, overlay) {\n        overlay.init(state.view.getOverlayPane());\n    }\n    /**\n     * Installs the listeners for the given {@link CellState} , {@link CellOverlay} and {@link Shape} that represents the overlay.\n     */\n    installCellOverlayListeners(state, overlay, shape) {\n        const graph = state.view.graph;\n        InternalEvent.addListener(shape.node, 'click', (evt) => {\n            if (graph.isEditing()) {\n                graph.stopEditing(!graph.isInvokesStopCellEditing());\n            }\n            overlay.fireEvent(new EventObject(InternalEvent.CLICK, { event: evt, cell: state.cell }));\n        });\n        InternalEvent.addGestureListeners(shape.node, (evt) => {\n            InternalEvent.consume(evt);\n        }, (evt) => {\n            graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, state));\n        });\n        if (Client.IS_TOUCH) {\n            InternalEvent.addListener(shape.node, 'touchend', (evt) => {\n                overlay.fireEvent(new EventObject(InternalEvent.CLICK, { event: evt, cell: state.cell }));\n            });\n        }\n    }\n    /**\n     * Configure the Shape of the overlay. Generally, it is used to configure the DOM node of the Shape\n     *\n     * The default implementation set the cursor in the DOM node of the Shape based on the {@link CellOverlay.cursor}.\n     *\n     * @param _state {@link CellState} for which the overlay shape should be created.\n     * @param cellOverlay {@link CellOverlay} used to create the Shape of the overlay.\n     * @param overlayShape the {@link Shape} of the overlay.\n     * @since 0.16.0\n     */\n    configureOverlayShape(_state, cellOverlay, overlayShape) {\n        if (cellOverlay.cursor) {\n            overlayShape.node.style.cursor = cellOverlay.cursor;\n        }\n    }\n    /**\n     * Creates the control for the given cell state.\n     *\n     * @param state {@link CellState}  for which the control should be created.\n     */\n    createControl(state) {\n        const graph = state.view.graph;\n        const image = graph.getFoldingImage(state);\n        if (graph.isFoldingEnabled() && image) {\n            if (!state.control) {\n                const b = new Rectangle(0, 0, image.width, image.height);\n                state.control = new ImageShape(b, image.src);\n                state.control.preserveImageAspect = false;\n                state.control.dialect = graph.dialect;\n                this.initControl(state, state.control, true, this.createControlClickHandler(state));\n            }\n        }\n        else if (state.control) {\n            state.control.destroy();\n            state.control = null;\n        }\n    }\n    /**\n     * Hook for creating the click handler for the folding icon.\n     *\n     * @param state {@link CellState}  whose control click handler should be returned.\n     */\n    createControlClickHandler(state) {\n        const graph = state.view.graph;\n        return (evt) => {\n            if (this.forceControlClickHandler || graph.isEnabled()) {\n                const collapse = !state.cell.isCollapsed();\n                graph.foldCells(collapse, false, [state.cell], false, evt);\n                InternalEvent.consume(evt);\n            }\n        };\n    }\n    /**\n     * Initializes the given control and returns the corresponding DOM node.\n     *\n     * @param state {@link CellState} for which the control should be initialized.\n     * @param control {@link Shape} to be initialized.\n     * @param handleEvents Boolean indicating if mousedown and mousemove should fire events via the graph.\n     * @param clickHandler Optional function to implement clicks on the control.\n     */\n    initControl(state, control, handleEvents, clickHandler) {\n        const graph = state.view.graph;\n        // In the special case where the label is in HTML and the display is SVG the image\n        // should go into the graph container directly in order to be clickable. Otherwise\n        // it is obscured by the HTML label that overlaps the cell.\n        const isForceHtml = graph.isHtmlLabel(state.cell) && Client.NO_FO && graph.dialect === 'svg';\n        if (isForceHtml) {\n            control.dialect = 'preferHtml';\n            control.init(graph.container);\n            control.node.style.zIndex = String(1);\n        }\n        else {\n            control.init(state.view.getOverlayPane());\n        }\n        const node = control.node;\n        // Workaround for missing click event on iOS is to check tolerance below\n        if (clickHandler && !Client.IS_IOS) {\n            if (graph.isEnabled()) {\n                node.style.cursor = 'pointer';\n            }\n            InternalEvent.addListener(node, 'click', clickHandler);\n        }\n        if (handleEvents) {\n            let first = null;\n            InternalEvent.addGestureListeners(node, (evt) => {\n                first = new Point(getClientX(evt), getClientY(evt));\n                graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt, state));\n                InternalEvent.consume(evt);\n            }, (evt) => {\n                graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, state));\n            }, (evt) => {\n                graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt, state));\n                InternalEvent.consume(evt);\n            });\n            // Uses capture phase for event interception to stop bubble phase\n            if (clickHandler && Client.IS_IOS) {\n                node.addEventListener('touchend', (evt) => {\n                    if (first) {\n                        const tol = graph.getEventTolerance();\n                        if (Math.abs(first.x - getClientX(evt)) < tol &&\n                            Math.abs(first.y - getClientY(evt)) < tol) {\n                            clickHandler.call(clickHandler, evt);\n                            InternalEvent.consume(evt);\n                        }\n                    }\n                }, true);\n            }\n        }\n        return node;\n    }\n    /**\n     * Returns `true` if the event is for the shape of the given state.\n     *\n     * This implementation always returns `true`.\n     *\n     * @param state {@link CellState}  whose shape fired the event.\n     * @param evt Mouse event which was fired.\n     */\n    isShapeEvent(state, evt) {\n        return true;\n    }\n    /**\n     * Returns `true` if the event is for the label of the given state.\n     *\n     * This implementation always returns `true`.\n     *\n     * @param state {@link CellState}  whose label fired the event.\n     * @param evt Mouse event which was fired.\n     */\n    isLabelEvent(state, evt) {\n        return true;\n    }\n    /**\n     * Installs the event listeners for the given cell state.\n     *\n     * @param state {@link CellState}  for which the event listeners should be isntalled.\n     */\n    installListeners(state) {\n        const graph = state.view.graph;\n        // Workaround for touch devices routing all events for a mouse\n        // gesture (down, move, up) via the initial DOM node. Same for\n        // HTML images in all IE versions (VML images are working).\n        const getState = (evt) => {\n            let result = state;\n            const source = getSource(evt);\n            if ((source &&\n                graph.dialect !== 'svg' &&\n                // @ts-ignore nodeName should exist\n                source.nodeName === 'IMG') ||\n                Client.IS_TOUCH) {\n                const x = getClientX(evt);\n                const y = getClientY(evt);\n                // Dispatches the drop event to the graph which\n                // consumes and executes the source function\n                const pt = convertPoint(graph.container, x, y);\n                const cell = graph.getCellAt(pt.x, pt.y);\n                result = cell ? graph.view.getState(cell) : null;\n            }\n            return result;\n        };\n        if (state.shape) {\n            InternalEvent.addGestureListeners(state.shape.node, (evt) => {\n                if (this.isShapeEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt, state));\n                }\n            }, (evt) => {\n                if (this.isShapeEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, getState(evt)));\n                }\n            }, (evt) => {\n                if (this.isShapeEvent(state, evt)) {\n                    graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt, getState(evt)));\n                }\n            });\n            // Uses double click timeout in mxGraph for quirks mode\n            if (graph.isNativeDblClickEnabled()) {\n                InternalEvent.addListener(state.shape.node, 'dblclick', (evt) => {\n                    if (this.isShapeEvent(state, evt)) {\n                        graph.dblClick(evt, state.cell);\n                        InternalEvent.consume(evt);\n                    }\n                });\n            }\n        }\n    }\n    /**\n     * Redraws the label for the given cell state.\n     *\n     * @param state {@link CellState}  whose label should be redrawn.\n     */\n    redrawLabel(state, forced) {\n        const graph = state.view.graph;\n        const value = this.getLabelValue(state);\n        const wrapping = graph.isWrapping(state.cell);\n        const clipping = graph.isLabelClipped(state.cell);\n        const isForceHtml = graph.isHtmlLabel(state.cell) || (value && isNode(value));\n        const dialect = isForceHtml ? 'strictHtml' : graph.dialect;\n        const overflow = state.style.overflow ?? 'visible';\n        if (state.text &&\n            (state.text.wrap !== wrapping ||\n                state.text.clipped !== clipping ||\n                state.text.overflow !== overflow ||\n                state.text.dialect !== dialect)) {\n            state.text.destroy();\n            state.text = null;\n        }\n        if (state.text == null && value != null && (isNode(value) || value.length > 0)) {\n            this.createLabel(state, value);\n        }\n        else if (state.text != null && (value == null || value.length == 0)) {\n            state.text.destroy();\n            state.text = null;\n        }\n        if (state.text != null) {\n            // Forced is true if the style has changed, so to get the updated\n            // result in getLabelBounds we apply the new style to the shape\n            if (forced) {\n                // Checks if a full repaint is needed\n                if (state.text.lastValue != null && this.isTextShapeInvalid(state, state.text)) {\n                    // Forces a full repaint\n                    state.text.lastValue = null;\n                }\n                state.text.resetStyles();\n                state.text.apply(state);\n                // Special case where value is obtained via hook in graph\n                state.text.valign = state.getVerticalAlign();\n            }\n            const bounds = this.getLabelBounds(state);\n            const nextScale = this.getTextScale(state);\n            this.resolveColor(state, 'color', 'fontColor');\n            if (forced ||\n                state.text.value !== value ||\n                state.text.wrap !== wrapping ||\n                state.text.overflow !== overflow ||\n                state.text.clipped !== clipping ||\n                state.text.scale !== nextScale ||\n                state.text.dialect !== dialect ||\n                state.text.bounds == null ||\n                !state.text.bounds.equals(bounds)) {\n                state.text.dialect = dialect;\n                state.text.value = value;\n                state.text.bounds = bounds;\n                state.text.scale = nextScale;\n                state.text.wrap = wrapping;\n                state.text.clipped = clipping;\n                state.text.overflow = overflow;\n                // Preserves visible state\n                // @ts-ignore\n                const vis = state.text.node.style.visibility;\n                this.redrawLabelShape(state.text);\n                // @ts-ignore\n                state.text.node.style.visibility = vis;\n            }\n        }\n    }\n    /**\n     * Returns true if the style for the text shape has changed.\n     *\n     * @param state {@link CellState}  whose label should be checked.\n     * @param shape {@link Text} shape to be checked.\n     */\n    isTextShapeInvalid(state, shape) {\n        function check(property, styleName, defaultValue) {\n            let result = false;\n            // Workaround for spacing added to directional spacing\n            if (styleName === 'spacingTop' ||\n                styleName === 'spacingRight' ||\n                styleName === 'spacingBottom' ||\n                styleName === 'spacingLeft') {\n                result =\n                    // @ts-ignore\n                    parseFloat(String(shape[property])) - parseFloat(String(shape.spacing)) !==\n                        (state.style[styleName] || defaultValue);\n            }\n            else {\n                // @ts-ignore\n                result = shape[property] !== (state.style[styleName] || defaultValue);\n            }\n            return result;\n        }\n        return (check('fontStyle', 'fontStyle', DEFAULT_FONTSTYLE) ||\n            check('family', 'fontFamily', DEFAULT_FONTFAMILY) ||\n            check('size', 'fontSize', DEFAULT_FONTSIZE) ||\n            check('color', 'fontColor', 'black') ||\n            check('align', 'align', '') ||\n            check('valign', 'verticalAlign', '') ||\n            check('spacing', 'spacing', 2) ||\n            check('spacingTop', 'spacingTop', 0) ||\n            check('spacingRight', 'spacingRight', 0) ||\n            check('spacingBottom', 'spacingBottom', 0) ||\n            check('spacingLeft', 'spacingLeft', 0) ||\n            check('horizontal', 'horizontal', true) ||\n            check('background', 'labelBackgroundColor', null) ||\n            check('border', 'labelBorderColor', null) ||\n            check('opacity', 'textOpacity', 100) ||\n            check('textDirection', 'textDirection', DEFAULT_TEXT_DIRECTION));\n    }\n    /**\n     * Called to invoked redraw on the given text shape.\n     *\n     * @param shape {@link Text} shape to be redrawn.\n     */\n    redrawLabelShape(shape) {\n        shape.redraw();\n    }\n    /**\n     * Returns the scaling used for the label of the given state\n     *\n     * @param state {@link CellState}  whose label scale should be returned.\n     */\n    getTextScale(state) {\n        return state.view.scale;\n    }\n    /**\n     * Returns the bounds to be used to draw the label of the given state.\n     *\n     * @param state {@link CellState}  whose label bounds should be returned.\n     */\n    getLabelBounds(state) {\n        const { scale } = state.view;\n        const isEdge = state.cell.isEdge();\n        let bounds = new Rectangle(state.absoluteOffset.x, state.absoluteOffset.y);\n        if (isEdge) {\n            // @ts-ignore\n            const spacing = state.text.getSpacing();\n            bounds.x += spacing.x * scale;\n            bounds.y += spacing.y * scale;\n            const geo = state.cell.getGeometry();\n            if (geo != null) {\n                bounds.width = Math.max(0, geo.width * scale);\n                bounds.height = Math.max(0, geo.height * scale);\n            }\n        }\n        else {\n            // Inverts label position\n            // @ts-ignore\n            if (state.text.isPaintBoundsInverted()) {\n                const tmp = bounds.x;\n                bounds.x = bounds.y;\n                bounds.y = tmp;\n            }\n            bounds.x += state.x;\n            bounds.y += state.y;\n            // Minimum of 1 fixes alignment bug in HTML labels\n            bounds.width = Math.max(1, state.width);\n            bounds.height = Math.max(1, state.height);\n        }\n        // @ts-ignore\n        if (state.text.isPaintBoundsInverted()) {\n            // Rotates around center of state\n            const t = (state.width - state.height) / 2;\n            bounds.x += t;\n            bounds.y -= t;\n            const tmp = bounds.width;\n            bounds.width = bounds.height;\n            bounds.height = tmp;\n        }\n        // Shape can modify its label bounds\n        if (state.shape != null) {\n            const hpos = state.style.labelPosition ?? 'center';\n            const vpos = state.style.verticalLabelPosition ?? 'middle';\n            if (hpos === 'center' && vpos === 'middle') {\n                bounds = state.shape.getLabelBounds(bounds);\n            }\n        }\n        // Label width style overrides actual label width\n        const lw = state.style.labelWidth ?? null;\n        if (lw != null) {\n            bounds.width = lw * scale;\n        }\n        if (!isEdge) {\n            this.rotateLabelBounds(state, bounds);\n        }\n        return bounds;\n    }\n    /**\n     * Adds the shape rotation to the given label bounds and\n     * applies the alignment and offsets.\n     *\n     * @param state {@link CellState}  whose label bounds should be rotated.\n     * @param bounds {@link Rectangle} the rectangle to be rotated.\n     */\n    rotateLabelBounds(state, bounds) {\n        const textShape = state.text;\n        bounds.y -= textShape.margin.y * bounds.height;\n        bounds.x -= textShape.margin.x * bounds.width;\n        if (!this.legacySpacing ||\n            (state.style.overflow !== 'fill' && state.style.overflow !== 'width')) {\n            const s = state.view.scale;\n            const spacing = textShape.getSpacing();\n            bounds.x += spacing.x * s;\n            bounds.y += spacing.y * s;\n            const hpos = state.style.labelPosition ?? 'center';\n            const vpos = state.style.verticalLabelPosition ?? 'middle';\n            const lw = state.style.labelWidth ?? null;\n            bounds.width = Math.max(0, bounds.width -\n                (hpos === 'center' && lw == null\n                    ? textShape.spacingLeft * s + textShape.spacingRight * s\n                    : 0));\n            bounds.height = Math.max(0, bounds.height -\n                (vpos === 'middle' ? textShape.spacingTop * s + textShape.spacingBottom * s : 0));\n        }\n        // @ts-ignore\n        const theta = textShape.getTextRotation();\n        // Only needed if rotated around another center\n        if (theta !== 0 &&\n            state != null &&\n            // @ts-ignore\n            state.cell.isVertex()) {\n            const cx = state.getCenterX();\n            const cy = state.getCenterY();\n            if (bounds.x !== cx || bounds.y !== cy) {\n                const rad = theta * (Math.PI / 180);\n                const pt = getRotatedPoint(new Point(bounds.x, bounds.y), Math.cos(rad), Math.sin(rad), new Point(cx, cy));\n                bounds.x = pt.x;\n                bounds.y = pt.y;\n            }\n        }\n    }\n    /**\n     * Redraws the overlays for the given cell state.\n     *\n     * @param state {@link CellState}  whose overlays should be redrawn.\n     */\n    redrawCellOverlays(state, forced = false) {\n        this.createCellOverlays(state);\n        if (state.overlays) {\n            const rot = mod(state.style.rotation ?? 0, 90);\n            const rad = toRadians(rot);\n            const cos = Math.cos(rad);\n            const sin = Math.sin(rad);\n            state.overlays.forEach((shape) => {\n                const bounds = shape.overlay?.getBounds(state) ?? null;\n                if (bounds && !state.cell.isEdge() && state.shape && rot !== 0) {\n                    let cx = bounds.getCenterX();\n                    let cy = bounds.getCenterY();\n                    const point = getRotatedPoint(new Point(cx, cy), cos, sin, new Point(state.getCenterX(), state.getCenterY()));\n                    cx = point.x;\n                    cy = point.y;\n                    bounds.x = Math.round(cx - bounds.width / 2);\n                    bounds.y = Math.round(cy - bounds.height / 2);\n                }\n                if (forced ||\n                    shape.bounds == null ||\n                    shape.scale !== state.view.scale ||\n                    !shape.bounds.equals(bounds)) {\n                    shape.bounds = bounds;\n                    shape.scale = state.view.scale;\n                    shape.redraw();\n                }\n            });\n        }\n    }\n    /**\n     * Redraws the control for the given cell state.\n     *\n     * @param state {@link CellState}  whose control should be redrawn.\n     */\n    redrawControl(state, forced = false) {\n        const image = state.view.graph.getFoldingImage(state);\n        if (state.control != null && image != null) {\n            const bounds = this.getControlBounds(state, image.width, image.height);\n            const r = this.legacyControlPosition\n                ? (state.style.rotation ?? 0)\n                : state.shape.getTextRotation();\n            const s = state.view.scale;\n            if (forced ||\n                state.control.scale !== s ||\n                !state.control.bounds.equals(bounds) ||\n                state.control.rotation !== r) {\n                state.control.rotation = r;\n                state.control.bounds = bounds;\n                state.control.scale = s;\n                state.control.redraw();\n            }\n        }\n    }\n    /**\n     * Returns the bounds to be used to draw the control (folding icon) of the given state.\n     */\n    getControlBounds(state, w, h) {\n        if (state.control != null) {\n            const s = state.view.scale;\n            let cx = state.getCenterX();\n            let cy = state.getCenterY();\n            if (!state.cell.isEdge()) {\n                cx = state.x + w * s;\n                cy = state.y + h * s;\n                if (state.shape != null) {\n                    // TODO: Factor out common code\n                    let rot = state.shape.getShapeRotation();\n                    if (this.legacyControlPosition) {\n                        rot = state.style.rotation ?? 0;\n                    }\n                    else if (state.shape.isPaintBoundsInverted()) {\n                        const t = (state.width - state.height) / 2;\n                        cx += t;\n                        cy -= t;\n                    }\n                    if (rot !== 0) {\n                        const rad = toRadians(rot);\n                        const cos = Math.cos(rad);\n                        const sin = Math.sin(rad);\n                        const point = getRotatedPoint(new Point(cx, cy), cos, sin, new Point(state.getCenterX(), state.getCenterY()));\n                        cx = point.x;\n                        cy = point.y;\n                    }\n                }\n            }\n            return state.cell.isEdge()\n                ? new Rectangle(Math.round(cx - (w / 2) * s), Math.round(cy - (h / 2) * s), Math.round(w * s), Math.round(h * s))\n                : new Rectangle(Math.round(cx - (w / 2) * s), Math.round(cy - (h / 2) * s), Math.round(w * s), Math.round(h * s));\n        }\n        return null;\n    }\n    /**\n     * Inserts the given {@link CellState} after the given nodes in the DOM.\n     *\n     * @param state {@link CellState} to be inserted.\n     * @param node Node in {@link GraphView.drawPane} after which the shapes should be inserted.\n     * @param htmlNode Node in the graph container after which the shapes should be inserted that\n     * will not go into the {@link GraphView.drawPane} (e.g. HTML labels without foreignObjects).\n     */\n    insertStateAfter(state, node, htmlNode) {\n        const graph = state.view.graph;\n        const shapes = this.getShapesForState(state);\n        for (let i = 0; i < shapes.length; i += 1) {\n            // @ts-ignore\n            if (shapes[i] != null && shapes[i].node != null) {\n                const html = \n                // @ts-ignore\n                shapes[i].node.parentNode !== state.view.getDrawPane() &&\n                    // @ts-ignore\n                    shapes[i].node.parentNode !== state.view.getOverlayPane();\n                const temp = html ? htmlNode : node;\n                // @ts-ignore\n                if (temp != null && temp.nextSibling !== shapes[i].node) {\n                    if (temp.nextSibling == null) {\n                        // @ts-ignore\n                        temp.parentNode.appendChild(shapes[i].node);\n                    }\n                    else {\n                        // @ts-ignore\n                        temp.parentNode.insertBefore(shapes[i].node, temp.nextSibling);\n                    }\n                }\n                else if (temp == null) {\n                    // Special case: First HTML node should be first sibling after canvas\n                    // @ts-ignore\n                    const shapeNode = shapes[i].node;\n                    if (shapeNode.parentNode === graph.container) {\n                        let { canvas } = state.view;\n                        while (canvas != null && canvas.parentNode !== graph.container) {\n                            // @ts-ignore\n                            canvas = canvas.parentNode;\n                        }\n                        if (canvas != null && canvas.nextSibling != null) {\n                            if (canvas.nextSibling !== shapeNode) {\n                                // @ts-ignore\n                                shapeNode.parentNode.insertBefore(shapeNode, canvas.nextSibling);\n                            }\n                        }\n                        else {\n                            // @ts-ignore\n                            shapeNode.parentNode.appendChild(shapeNode);\n                        }\n                    }\n                    else if (shapeNode.parentNode != null &&\n                        shapeNode.parentNode.firstChild != null &&\n                        shapeNode.parentNode.firstChild != shapeNode) {\n                        // Inserts the node as the first child of the parent to implement the order\n                        shapeNode.parentNode.insertBefore(shapeNode, shapeNode.parentNode.firstChild);\n                    }\n                }\n                if (html) {\n                    // @ts-ignore\n                    htmlNode = shapes[i].node;\n                }\n                else {\n                    // @ts-ignore\n                    node = shapes[i].node;\n                }\n            }\n        }\n        return [node, htmlNode];\n    }\n    /**\n     * Returns the {@link Shape}s for the given cell state in the order in which they should appear in the DOM.\n     *\n     * @param state {@link CellState}  whose shapes should be returned.\n     */\n    getShapesForState(state) {\n        return [state.shape, state.text, state.control];\n    }\n    /**\n     * Updates the bounds or points and scale of the shapes for the given cell\n     * state. This is called in mxGraphView.validatePoints as the last step of\n     * updating all cells.\n     *\n     * @param state {@link CellState}  for which the shapes should be updated.\n     * @param force Optional boolean that specifies if the cell should be reconfiured\n     * and redrawn without any additional checks.\n     * @param rendering Optional boolean that specifies if the cell should actually\n     * be drawn into the DOM. If this is false then redraw and/or reconfigure\n     * will not be called on the shape.\n     */\n    redraw(state, force = false, rendering = true) {\n        const shapeChanged = this.redrawShape(state, force, rendering);\n        if (state.shape != null && rendering) {\n            this.redrawLabel(state, shapeChanged);\n            this.redrawCellOverlays(state, shapeChanged);\n            this.redrawControl(state, shapeChanged);\n        }\n    }\n    /**\n     * Redraws the shape for the given cell state.\n     *\n     * @param state {@link CellState}  whose label should be redrawn.\n     */\n    redrawShape(state, force = false, rendering = true) {\n        let shapeChanged = false;\n        const graph = state.view.graph;\n        // Forces creation of new shape if shape style has changed\n        if (state.shape != null &&\n            state.shape.style != null &&\n            state.style != null &&\n            state.shape.style.shape !== state.style.shape) {\n            state.shape.destroy();\n            state.shape = null;\n        }\n        const selectionCellsHandler = graph.getPlugin('SelectionCellsHandler');\n        if (state.shape == null &&\n            graph.container != null &&\n            state.cell !== state.view.currentRoot &&\n            (state.cell.isVertex() || state.cell.isEdge())) {\n            state.shape = this.createShape(state);\n            if (state.shape != null) {\n                state.shape.minSvgStrokeWidth = this.minSvgStrokeWidth;\n                state.shape.antiAlias = this.antiAlias;\n                this.createIndicatorShape(state);\n                this.initializeShape(state);\n                this.createCellOverlays(state);\n                this.installListeners(state);\n                // Forces a refresh of the handler if one exists\n                selectionCellsHandler?.updateHandler(state);\n            }\n        }\n        else if (!force &&\n            state.shape != null &&\n            (!equalEntries(state.shape.style, state.style) ||\n                this.checkPlaceholderStyles(state))) {\n            state.shape.resetStyles();\n            this.configureShape(state);\n            // LATER: Ignore update for realtime to fix reset of current gesture\n            selectionCellsHandler?.updateHandler(state);\n            force = true;\n        }\n        // Updates indicator shape\n        if (state.shape != null &&\n            state.shape.indicatorShape != this.getShape(state.getIndicatorShape())) {\n            if (state.shape.indicator != null) {\n                state.shape.indicator.destroy();\n                state.shape.indicator = null;\n            }\n            this.createIndicatorShape(state);\n            if (state.shape.indicatorShape != null) {\n                state.shape.indicator = new state.shape.indicatorShape();\n                state.shape.indicator.dialect = state.shape.dialect;\n                state.shape.indicator.init(state.node);\n                force = true;\n            }\n        }\n        if (state.shape) {\n            // Handles changes of the collapse icon\n            this.createControl(state);\n            // Redraws the cell if required, ignores changes to bounds if points are\n            // defined as the bounds are updated for the given points inside the shape\n            if (force || this.isShapeInvalid(state, state.shape)) {\n                if (state.absolutePoints.length > 0) {\n                    state.shape.points = state.absolutePoints.slice();\n                    state.shape.bounds = null;\n                }\n                else {\n                    state.shape.points = [];\n                    state.shape.bounds = new Rectangle(state.x, state.y, state.width, state.height);\n                }\n                state.shape.scale = state.view.scale;\n                if (rendering == null || rendering) {\n                    this.doRedrawShape(state);\n                }\n                else {\n                    state.shape.updateBoundingBox();\n                }\n                shapeChanged = true;\n            }\n        }\n        return shapeChanged;\n    }\n    /**\n     * Invokes redraw on the shape of the given state.\n     */\n    doRedrawShape(state) {\n        state.shape?.redraw();\n    }\n    /**\n     * Returns true if the given shape must be repainted.\n     */\n    isShapeInvalid(state, shape) {\n        return (shape.bounds == null ||\n            shape.scale !== state.view.scale ||\n            (state.absolutePoints.length === 0 && !shape.bounds.equals(state)) ||\n            (state.absolutePoints.length > 0 &&\n                !equalPoints(shape.points, state.absolutePoints)));\n    }\n    /**\n     * Destroys the shapes associated with the given cell state.\n     *\n     * @param state {@link CellState}  for which the shapes should be destroyed.\n     */\n    destroy(state) {\n        if (state.shape) {\n            if (state.text) {\n                state.text.destroy();\n                state.text = null;\n            }\n            state.overlays.forEach((shape) => {\n                shape.destroy();\n            });\n            state.overlays = new Map();\n            if (state.control) {\n                state.control.destroy();\n                state.control = null;\n            }\n            state.shape.destroy();\n            state.shape = null;\n        }\n    }\n}\nexport default CellRenderer;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { NONE } from '../../util/Constants.js';\n/**\n * Defines the appearance of the cells in a graph. See {@link putCellStyle} for an example\n * of creating a new cell style.\n *\n * Existing styles can be cloned using {@link clone} and turned into a string for debugging\n * using {@link toString}.\n *\n * ### Default Styles\n *\n * The stylesheet contains two built-in styles, which are used if no style is defined for\n * a cell:\n *\n * - `defaultVertex`: default style for vertices\n * - `defaultEdge`: default style for edges\n *\n * ### Example\n *\n * ```javascript\n * const defaultVertexStyle = stylesheet.getDefaultVertexStyle();\n * defaultVertexStyle.rounded = true;\n * const defaultEdgeStyle = stylesheet.getDefaultEdgeStyle();\n * defaultEdgeStyle.edgeStyle = EdgeStyle.EntityRelation;\n * ```\n *\n * @category Style\n */\nexport class Stylesheet {\n    constructor() {\n        this.styles = new Map();\n        this.putDefaultVertexStyle(this.createDefaultVertexStyle());\n        this.putDefaultEdgeStyle(this.createDefaultEdgeStyle());\n    }\n    /**\n     * Creates and returns the default vertex style.\n     */\n    createDefaultVertexStyle() {\n        const style = {};\n        style.shape = 'rectangle';\n        style.perimeter = 'rectanglePerimeter';\n        style.verticalAlign = 'middle';\n        style.align = 'center';\n        style.fillColor = '#C3D9FF';\n        style.strokeColor = '#6482B9';\n        style.fontColor = '#774400';\n        return style;\n    }\n    /**\n     * Creates and returns the default edge style.\n     */\n    createDefaultEdgeStyle() {\n        const style = {};\n        style.shape = 'connector';\n        style.endArrow = 'classic';\n        style.verticalAlign = 'middle';\n        style.align = 'center';\n        style.strokeColor = '#6482B9';\n        style.fontColor = '#446299';\n        return style;\n    }\n    /**\n     * Sets the default style for vertices using `defaultVertex` as the style name.\n     * @param style The style to be stored.\n     */\n    putDefaultVertexStyle(style) {\n        this.putCellStyle('defaultVertex', style);\n    }\n    /**\n     * Sets the default style for edges using `defaultEdge` as the style name.\n     * @param style The style to be stored.\n     */\n    putDefaultEdgeStyle(style) {\n        this.putCellStyle('defaultEdge', style);\n    }\n    /**\n     * Returns the default style for vertices.\n     */\n    getDefaultVertexStyle() {\n        return this.styles.get('defaultVertex');\n    }\n    /**\n     * Returns the default style for edges.\n     */\n    getDefaultEdgeStyle() {\n        return this.styles.get('defaultEdge');\n    }\n    /**\n     * Stores the given {@link CellStateStyle} under the given name in {@link styles}.\n     *\n     * ### Example\n     *\n     * The following example adds a new style called `rounded` into an existing stylesheet:\n     *\n     * ```javascript\n     * const style = {} as CellStateStyle;\n     * style.shape = 'rectangle';\n     * style.perimeter = 'rectanglePerimeter';\n     * style.rounded = true;\n     * graph.getStylesheet().putCellStyle('rounded', style);\n     * ```\n     *\n     * ### Description\n     *\n     * Note that not all properties will be interpreted by all shapes. For example, the 'line' shape ignores the fill color.\n     * The final call to this method associates the style with a name in the stylesheet.\n     *\n     * The style is used in a cell with the following code:\n     * ```javascript\n     * // model is an instance of GraphDataModel\n     * // style is an instance of CellStyle\n     * model.setStyle(cell, { baseStyleNames: ['rounded'] });\n     * ```\n     *\n     * @param name Name for the style to be stored.\n     * @param style The instance of the style to be stored.\n     */\n    putCellStyle(name, style) {\n        this.styles.set(name, style);\n    }\n    /**\n     * Returns a {@link CellStateStyle} computed by merging the default style, styles referenced in the specified `baseStyleNames`\n     * and the properties of the `cellStyle` parameter.\n     *\n     * The properties are merged by taking the properties from various styles in the following order:\n     *   - default style (if {@link CellStyle.ignoreDefaultStyle} is not set to `true`, otherwise it is ignored)\n     *   - registered styles referenced in `baseStyleNames`, in the order of the array\n     *   - `cellStyle` parameter\n     *\n     * To fully unset a style property i.e. the property is not set even if a value is set in the default style or in the referenced styles,\n     * set the `cellStyle` property to `none`. For example. `cellStyle.fillColor = 'none'`\n     *\n     * @param cellStyle An object that represents the style.\n     * @param defaultStyle Default style used as reference to compute the returned style.\n     */\n    getCellStyle(cellStyle, defaultStyle) {\n        let style = cellStyle.ignoreDefaultStyle ? {} : { ...defaultStyle };\n        if (cellStyle.baseStyleNames) {\n            // creates style with the given baseStyleNames. (merges from left to right)\n            style = cellStyle.baseStyleNames.reduce((acc, styleName) => {\n                return {\n                    ...acc,\n                    ...this.styles.get(styleName),\n                };\n            }, style);\n        }\n        // Merges cellStyle into style\n        for (const key of Object.keys(cellStyle)) {\n            // @ts-ignore\n            if (cellStyle[key] !== undefined) {\n                // @ts-ignore\n                cellStyle[key] == NONE ? delete style[key] : (style[key] = cellStyle[key]);\n            }\n        }\n        // Remove the specific CellStyle properties that may have been copied from the cellStyle parameter to match the method signature\n        'baseStyleNames' in style && delete style.baseStyleNames;\n        'ignoreDefaultStyle' in style && delete style.ignoreDefaultStyle;\n        return style;\n    }\n}\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n/**\n * Action to change the current root in a view.\n *\n * @category Change\n */\nclass SelectionChange {\n    constructor(graph, added = [], removed = []) {\n        this.graph = graph;\n        this.added = added.slice();\n        this.removed = removed.slice();\n    }\n    /**\n     * Changes the current root of the view.\n     */\n    execute() {\n        const selectionModel = this.graph.getSelectionModel();\n        for (const removed of this.removed) {\n            selectionModel.cellRemoved(removed);\n        }\n        for (const added of this.added) {\n            selectionModel.cellAdded(added);\n        }\n        [this.added, this.removed] = [this.removed, this.added];\n        selectionModel.fireEvent(new EventObject(InternalEvent.CHANGE, { added: this.added, removed: this.removed }));\n    }\n}\nexport default SelectionChange;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../view/event/EventSource.js';\nimport SelectionChange from './undoable_changes/SelectionChange.js';\nimport UndoableEdit from './undoable_changes/UndoableEdit.js';\nimport EventObject from './event/EventObject.js';\nimport InternalEvent from './event/InternalEvent.js';\nimport { isI18nEnabled } from '../internal/i18n-utils.js';\n/**\n * Implements the selection model for a graph.\n *\n * Here is a listener that handles all removed selection cells.\n *\n * ```javascript\n * graph.getSelectionModel().addListener(mxEvent.CHANGE, function(sender, evt) {\n *   const cells = evt.getProperty('added');\n *   for (const cell of cells) {\n *     // Handle cell...\n *   }\n * });\n * ```\n *\n *\n * Event: mxEvent.UNDO\n *\n * Fires after the selection was changed in <changeSelection>. The\n * <code>edit</code> property contains the {@link UndoableEdit} which contains the\n * {@link SelectionChange}.\n *\n * Event: mxEvent.CHANGE\n *\n * Fires after the selection changes by executing an {@link SelectionChange}. The\n * <code>added</code> and <code>removed</code> properties contain arrays of\n * cells that have been added to or removed from the selection, respectively.\n * The names are inverted due to historic reasons. This cannot be changed.\n *\n */\nclass GraphSelectionModel extends EventSource {\n    /**\n     * Constructs a new graph selection model for the given {@link AbstractGraph}.\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     */\n    constructor(graph) {\n        super();\n        /**\n         * Specifies the resource key for the status message after a long operation.\n         * If the resource for this key does not exist then the value is used as\n         * the status message.\n         * @default 'done'\n         */\n        this.doneResource = isI18nEnabled() ? 'done' : '';\n        /**\n         * Specifies the resource key for the status message while the selection is\n         * being updated. If the resource for this key does not exist then the\n         * value is used as the status message.\n         * @default 'updatingSelection'\n         */\n        this.updatingSelectionResource = isI18nEnabled() ? 'updatingSelection' : '';\n        /**\n         * Specifies if only one selected item at a time is allowed.\n         * @default false.\n         */\n        this.singleSelection = false;\n        this.graph = graph;\n        this.cells = [];\n    }\n    /**\n     * Returns {@link singleSelection} as a boolean.\n     */\n    isSingleSelection() {\n        return this.singleSelection;\n    }\n    /**\n     * Sets the {@link singleSelection} flag.\n     *\n     * @param {boolean} singleSelection Boolean that specifies the new value for\n     * {@link singleSelection}.\n     */\n    setSingleSelection(singleSelection) {\n        this.singleSelection = singleSelection;\n    }\n    /**\n     * Returns true if the given {@link Cell} is selected.\n     */\n    isSelected(cell) {\n        return this.cells.indexOf(cell) >= 0;\n    }\n    /**\n     * Returns true if no cells are currently selected.\n     */\n    isEmpty() {\n        return this.cells.length === 0;\n    }\n    /**\n     * Clears the selection and fires a {@link change} event if the selection was not\n     * empty.\n     */\n    clear() {\n        this.changeSelection(null, this.cells);\n    }\n    /**\n     * Selects the specified {@link Cell} using {@link setCells}.\n     *\n     * @param cell {@link Cell} to be selected.\n     */\n    setCell(cell) {\n        this.setCells(cell ? [cell] : []);\n    }\n    /**\n     * Selects the given array of {@link Cell} and fires a {@link change} event.\n     *\n     * @param cells Array of {@link Cell} to be selected.\n     */\n    setCells(cells) {\n        if (this.singleSelection) {\n            cells = [this.getFirstSelectableCell(cells)];\n        }\n        const tmp = [];\n        for (let i = 0; i < cells.length; i += 1) {\n            if (this.graph.isCellSelectable(cells[i])) {\n                tmp.push(cells[i]);\n            }\n        }\n        this.changeSelection(tmp, this.cells);\n    }\n    /**\n     * Returns the first selectable cell in the given array of cells.\n     */\n    getFirstSelectableCell(cells) {\n        for (let i = 0; i < cells.length; i += 1) {\n            if (this.graph.isCellSelectable(cells[i])) {\n                return cells[i];\n            }\n        }\n        return null;\n    }\n    /**\n     * Adds the given {@link Cell} to the selection and fires a {@link select} event.\n     *\n     * @param cell {@link Cell} to add to the selection.\n     */\n    addCell(cell) {\n        this.addCells([cell]);\n    }\n    /**\n     * Adds the given array of {@link Cell} to the selection and fires a {@link select}\n     * event.\n     *\n     * @param cells Array of {@link Cell} to add to the selection.\n     */\n    addCells(cells) {\n        let remove = null;\n        if (this.singleSelection) {\n            remove = this.cells;\n            const selectableCell = this.getFirstSelectableCell(cells);\n            cells = selectableCell ? [selectableCell] : [];\n        }\n        const tmp = [];\n        for (let i = 0; i < cells.length; i += 1) {\n            if (!this.isSelected(cells[i]) && this.graph.isCellSelectable(cells[i])) {\n                tmp.push(cells[i]);\n            }\n        }\n        this.changeSelection(tmp, remove);\n    }\n    /**\n     * Removes the specified {@link Cell} from the selection and fires a {@link select}\n     * event for the remaining cells.\n     *\n     * @param cell {@link Cell} to remove from the selection.\n     */\n    removeCell(cell) {\n        this.removeCells([cell]);\n    }\n    /**\n     * Removes the specified {@link Cell} from the selection and fires a {@link select}\n     * event for the remaining cells.\n     *\n     * @param cells {@link Cell}s to remove from the selection.\n     */\n    removeCells(cells) {\n        const tmp = [];\n        for (let i = 0; i < cells.length; i += 1) {\n            if (this.isSelected(cells[i])) {\n                tmp.push(cells[i]);\n            }\n        }\n        this.changeSelection(null, tmp);\n    }\n    /**\n     * Adds/removes the specified arrays of {@link Cell} to/from the selection.\n     *\n     * @param added Array of {@link Cell} to add to the selection.\n     * @param remove Array of {@link Cell} to remove from the selection.\n     */\n    changeSelection(added = null, removed = null) {\n        if ((added && added.length > 0 && added[0]) ||\n            (removed && removed.length > 0 && removed[0])) {\n            const change = new SelectionChange(this.graph, added || [], removed || []);\n            change.execute();\n            const edit = new UndoableEdit(this.graph, false);\n            edit.add(change);\n            this.fireEvent(new EventObject(InternalEvent.UNDO, { edit }));\n        }\n    }\n    /**\n     * Inner callback to add the specified {@link Cell} to the selection. No event\n     * is fired in this implementation.\n     *\n     * Paramters:\n     *\n     * @param cell {@link Cell} to add to the selection.\n     */\n    cellAdded(cell) {\n        if (!this.isSelected(cell)) {\n            this.cells.push(cell);\n        }\n    }\n    /**\n     * Inner callback to remove the specified {@link Cell} from the selection. No\n     * event is fired in this implementation.\n     *\n     * @param cell {@link Cell} to remove from the selection.\n     */\n    cellRemoved(cell) {\n        const index = this.cells.indexOf(cell);\n        if (index >= 0) {\n            this.cells.splice(index, 1);\n        }\n    }\n}\nexport default GraphSelectionModel;\n","/*\nCopyright 2021-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventObject from '../event/EventObject.js';\nimport Point from '../geometry/Point.js';\nimport InternalEvent from '../event/InternalEvent.js';\n/**\n * Action to change the current root in a view.\n *\n * @category Change\n */\nclass CurrentRootChange {\n    constructor(view, root) {\n        this.view = view;\n        this.root = root;\n        this.previous = root;\n        this.isUp = root === null;\n        if (!this.isUp) {\n            let tmp = this.view.currentRoot;\n            while (tmp) {\n                if (tmp === root) {\n                    this.isUp = true;\n                    break;\n                }\n                tmp = tmp.getParent();\n            }\n        }\n    }\n    /**\n     * Changes the current root of the view.\n     */\n    execute() {\n        const tmp = this.view.currentRoot;\n        this.view.currentRoot = this.previous;\n        this.previous = tmp;\n        const translate = this.view.graph.getTranslateForRoot(this.view.currentRoot);\n        if (translate) {\n            this.view.translate = new Point(-translate.x, -translate.y);\n        }\n        if (this.isUp) {\n            this.view.clear(this.view.currentRoot, true, true);\n            this.view.validate(null);\n        }\n        else {\n            this.view.refresh();\n        }\n        const name = this.isUp ? InternalEvent.UP : InternalEvent.DOWN;\n        this.view.fireEvent(new EventObject(name, { root: this.view.currentRoot, previous: this.previous }));\n        this.isUp = !this.isUp;\n    }\n}\nexport default CurrentRootChange;\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { BaseRegistry } from '../../../internal/BaseRegistry.js';\n/**\n * A registry that stores the {@link PerimeterFunction}s.\n *\n * @since 0.20.0\n * @category Style\n * @category Configuration\n */\nexport const PerimeterRegistry = new BaseRegistry();\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from './geometry/Point.js';\nimport Rectangle from './geometry/Rectangle.js';\nimport EventSource from './event/EventSource.js';\nimport EventObject from './event/EventObject.js';\nimport RectangleShape from './shape/node/RectangleShape.js';\nimport { NS_SVG } from '../util/Constants.js';\nimport Client from '../Client.js';\nimport InternalEvent from './event/InternalEvent.js';\nimport { convertPoint, getCurrentStyle, getOffset } from '../util/styleUtils.js';\nimport { getRotatedPoint, ptSegDistSq, relativeCcw, toRadians, } from '../util/mathUtils.js';\nimport { GlobalConfig } from '../util/config.js';\nimport CellState from './cell/CellState.js';\nimport UndoableEdit from './undoable_changes/UndoableEdit.js';\nimport ImageShape from './shape/node/ImageShape.js';\nimport InternalMouseEvent from './event/InternalMouseEvent.js';\nimport CurrentRootChange from './undoable_changes/CurrentRootChange.js';\nimport { getClientX, getClientY, getSource, isConsumed } from '../util/EventUtils.js';\nimport { clone } from '../util/cloneUtils.js';\nimport { EdgeStyleRegistry } from './style/edge/EdgeStyleRegistry.js';\nimport { PerimeterRegistry } from './style/perimeter/PerimeterRegistry.js';\nimport { doEval } from '../internal/utils.js';\nimport { isI18nEnabled } from '../internal/i18n-utils.js';\n/**\n * @class GraphView\n * @extends {EventSource}\n *\n * Extends {@link EventSource} to implement a view for a graph. This class is in\n * charge of computing the absolute coordinates for the relative child\n * geometries, the points for perimeters and edge styles and keeping them\n * cached in {@link CellState}s for faster retrieval. The states are updated\n * whenever the model or the view state (translate, scale) changes. The scale\n * and translate are honoured in the bounds.\n *\n * #### Event: mxEvent.UNDO\n *\n * Fires after the root was changed in {@link setCurrentRoot}. The `edit`\n * property contains the {@link UndoableEdit} which contains the\n * {@link CurrentRootChange}.\n *\n * #### Event: mxEvent.SCALE_AND_TRANSLATE\n *\n * Fires after the scale and translate have been changed in {@link scaleAndTranslate}.\n * The `scale`, `previousScale`, `translate`\n * and `previousTranslate` properties contain the new and previous\n * scale and translate, respectively.\n *\n * #### Event: mxEvent.SCALE\n *\n * Fires after the scale was changed in {@link setScale}. The `scale` and\n * `previousScale` properties contain the new and previous scale.\n *\n * #### Event: mxEvent.TRANSLATE\n *\n * Fires after the translate was changed in {@link setTranslate}. The\n * `translate` and `previousTranslate` properties contain\n * the new and previous value for translate.\n *\n * #### Event: mxEvent.DOWN and mxEvent.UP\n *\n * Fire if the current root is changed by executing an {@link CurrentRootChange}.\n * The event name depends on the location of the root in the cell hierarchy\n * with respect to the current root. The `root` and\n * `previous` properties contain the new and previous root,\n * respectively.\n */\nexport class GraphView extends EventSource {\n    constructor(graph) {\n        super();\n        // TODO: Document me!\n        this.backgroundImage = null;\n        this.backgroundPageShape = null;\n        this.EMPTY_POINT = new Point();\n        /**\n         * Specifies the resource key for the status message after a long operation.\n         * If the resource for this key does not exist then the value is used as\n         * the status message.\n         * @default 'done'\n         */\n        this.doneResource = isI18nEnabled() ? 'done' : '';\n        /**\n         * Specifies the resource key for the status message while the document is\n         * being updated. If the resource for this key does not exist then the\n         * value is used as the status message.\n         * @default 'updatingSelection'\n         */\n        this.updatingDocumentResource = isI18nEnabled() ? 'updatingDocument' : '';\n        /**\n         * Specifies if string values in cell styles should be evaluated using {@link eval}.\n         *\n         * This will only be used if the string values can't be mapped to objects using {@link EdgeStyleRegistry} or  {@link PerimeterRegistry} when resolving {@link CellStateStyle.edgeStyle} and {@link CellStateStyle.perimeter} respectively.\n         *\n         * **WARNING**: Enabling this switch carries a possible security risk.\n         *\n         * @default false\n         */\n        this.allowEval = false;\n        /**\n         * Specifies if a gesture should be captured when it goes outside of the\n         * graph container. Default is true.\n         */\n        this.captureDocumentGesture = true;\n        /**\n         * Specifies if shapes should be created, updated and destroyed using the\n         * methods of {@link cellRenderer} in {@link graph}. Default is true.\n         */\n        this.rendering = true;\n        /**\n         * {@link Cell} that acts as the root of the displayed cell hierarchy.\n         */\n        this.currentRoot = null;\n        this.graphBounds = new Rectangle();\n        this.scale = 1;\n        /**\n         * {@link Point} that specifies the current translation. Default is a new\n         * empty {@link Point}.\n         */\n        this.translate = new Point();\n        this.states = new Map();\n        /**\n         * Specifies if the style should be updated in each validation step. If this\n         * is false then the style is only updated if the state is created or if the\n         * style of the cell was changed. Default is false.\n         */\n        this.updateStyle = false;\n        /**\n         * During validation, this contains the last DOM node that was processed.\n         */\n        this.lastNode = null;\n        /**\n         * During validation, this contains the last HTML DOM node that was processed.\n         */\n        this.lastHtmlNode = null;\n        /**\n         * During validation, this contains the last edge's DOM node that was processed.\n         */\n        this.lastForegroundNode = null;\n        /**\n         * During validation, this contains the last edge HTML DOM node that was processed.\n         */\n        this.lastForegroundHtmlNode = null;\n        this.endHandler = null;\n        this.moveHandler = null;\n        this.graph = graph;\n    }\n    /**\n     * Returns {@link graphBounds}.\n     */\n    getGraphBounds() {\n        return this.graphBounds;\n    }\n    /**\n     * Sets {@link graphBounds}.\n     */\n    setGraphBounds(value) {\n        this.graphBounds = value;\n    }\n    /**\n     * Returns the {@link scale}.\n     */\n    getScale() {\n        return this.scale;\n    }\n    /**\n     * Sets the scale and fires a {@link scale} event before calling {@link revalidate} followed\n     * by {@link AbstractGraph.sizeDidChange}.\n     *\n     * @param value Decimal value that specifies the new scale (1 is 100%).\n     */\n    setScale(value) {\n        const previousScale = this.scale;\n        if (previousScale !== value) {\n            this.scale = value;\n            if (this.isEventsEnabled()) {\n                this.viewStateChanged();\n            }\n        }\n        this.fireEvent(new EventObject(InternalEvent.SCALE, { scale: value, previousScale }));\n    }\n    /**\n     * Returns the {@link translate}.\n     */\n    getTranslate() {\n        return this.translate;\n    }\n    isRendering() {\n        return this.rendering;\n    }\n    setRendering(value) {\n        this.rendering = value;\n    }\n    /**\n     * Sets the translation and fires a {@link translate} event before calling\n     * {@link revalidate} followed by {@link AbstractGraph.sizeDidChange}. The translation is the\n     * negative of the origin.\n     *\n     * @param dx X-coordinate of the translation.\n     * @param dy Y-coordinate of the translation.\n     */\n    setTranslate(dx, dy) {\n        const previousTranslate = new Point(this.translate.x, this.translate.y);\n        if (this.translate.x !== dx || this.translate.y !== dy) {\n            this.translate.x = dx;\n            this.translate.y = dy;\n            if (this.isEventsEnabled()) {\n                this.viewStateChanged();\n            }\n        }\n        this.fireEvent(new EventObject(InternalEvent.TRANSLATE, {\n            translate: this.translate,\n            previousTranslate: previousTranslate,\n        }));\n    }\n    /**\n     * Returns {@link allowEval}.\n     */\n    isAllowEval() {\n        return this.allowEval;\n    }\n    /**\n     * Sets {@link allowEval}.\n     */\n    setAllowEval(value) {\n        this.allowEval = value;\n    }\n    /**\n     * Returns {@link states}.\n     */\n    getStates() {\n        return this.states;\n    }\n    /**\n     * Sets {@link states}.\n     */\n    setStates(value) {\n        this.states = value;\n    }\n    /**\n     * Returns the DOM node that contains the background-, draw-, overlay- and decorator- panes.\n     */\n    getCanvas() {\n        return this.canvas;\n    }\n    /**\n     * Returns the DOM node that represents the background layer.\n     */\n    getBackgroundPane() {\n        return this.backgroundPane;\n    }\n    /**\n     * Returns the DOM node that represents the main drawing layer.\n     */\n    getDrawPane() {\n        return this.drawPane;\n    }\n    /**\n     * Returns the DOM node that represents the layer above the drawing layer.\n     */\n    getOverlayPane() {\n        return this.overlayPane;\n    }\n    /**\n     * Returns the DOM node that represents the topmost drawing layer.\n     */\n    getDecoratorPane() {\n        return this.decoratorPane;\n    }\n    /**\n     * Returns the union of all {@link CellState}s for the given array of {@link Cell}.\n     *\n     * @param cells Array of {@link Cell} whose bounds should be returned.\n     */\n    getBounds(cells) {\n        let result = null;\n        if (cells.length > 0) {\n            for (let i = 0; i < cells.length; i += 1) {\n                if (cells[i].isVertex() || cells[i].isEdge()) {\n                    const state = this.getState(cells[i]);\n                    if (state) {\n                        if (!result) {\n                            result = Rectangle.fromRectangle(state);\n                        }\n                        else {\n                            result.add(state);\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Sets and returns the current root and fires an {@link undo} event before\n     * calling {@link AbstractGraph.sizeDidChange}.\n     *\n     * @param root {@link Cell} that specifies the root of the displayed cell hierarchy.\n     */\n    setCurrentRoot(root) {\n        if (this.currentRoot !== root) {\n            const change = new CurrentRootChange(this, root);\n            change.execute();\n            const edit = new UndoableEdit(this, true);\n            edit.add(change);\n            this.fireEvent(new EventObject(InternalEvent.UNDO, { edit }));\n            this.graph.sizeDidChange();\n            this.currentRoot = root;\n        }\n        return root;\n    }\n    /**\n     * Sets the scale and translation and fires a {@link scale} and {@link translate} event\n     * before calling {@link revalidate} followed by {@link AbstractGraph.sizeDidChange}.\n     *\n     * @param scale Decimal value that specifies the new scale (1 is 100%).\n     * @param dx X-coordinate of the translation.\n     * @param dy Y-coordinate of the translation.\n     */\n    scaleAndTranslate(scale, dx, dy) {\n        const previousScale = this.scale;\n        const previousTranslate = new Point(this.translate.x, this.translate.y);\n        if (this.scale !== scale || this.translate.x !== dx || this.translate.y !== dy) {\n            this.scale = scale;\n            this.translate.x = dx;\n            this.translate.y = dy;\n            if (this.isEventsEnabled()) {\n                this.viewStateChanged();\n            }\n        }\n        this.fireEvent(new EventObject(InternalEvent.SCALE_AND_TRANSLATE, {\n            scale,\n            previousScale,\n            translate: this.translate,\n            previousTranslate: previousTranslate,\n        }));\n    }\n    /**\n     * Invoked after {@link scale} and/or {@link translate} has changed.\n     */\n    viewStateChanged() {\n        this.revalidate();\n        this.graph.sizeDidChange();\n    }\n    /**\n     * Clears the view if {@link currentRoot} is not null and revalidates.\n     */\n    refresh() {\n        if (this.currentRoot) {\n            this.clear();\n        }\n        this.revalidate();\n    }\n    /**\n     * Revalidates the complete view with all cell states.\n     */\n    revalidate() {\n        this.invalidate();\n        this.validate();\n    }\n    /**\n     * Removes the state of the given cell and all descendants if the given cell is not the current root.\n     *\n     * @param cell Optional {@link Cell} for which the state should be removed. Default is the root of the model.\n     * @param force Optional boolean indicating if the current root should be ignored for recursion. Default is `false`.\n     * @param recurse Optional boolean indicating if the descendants should be cleared as well. Default is `true`.\n     */\n    clear(cell, force = false, recurse = true) {\n        if (!cell) {\n            cell = this.graph.getDataModel().getRoot();\n        }\n        if (cell) {\n            this.removeState(cell);\n            if (recurse && (force || cell !== this.currentRoot)) {\n                const childCount = cell.getChildCount();\n                for (let i = 0; i < childCount; i += 1) {\n                    this.clear(cell.getChildAt(i), force);\n                }\n            }\n            else {\n                this.invalidate(cell);\n            }\n        }\n    }\n    /**\n     * Invalidates the state of the given cell, all its descendants and\n     * connected edges.\n     *\n     * @param cell Optional {@link Cell} to be invalidated. Default is the root of the\n     * model.\n     */\n    invalidate(cell = null, recurse = true, includeEdges = true) {\n        const model = this.graph.getDataModel();\n        cell = cell ?? model.getRoot();\n        if (cell) {\n            const state = this.getState(cell);\n            if (state) {\n                state.invalid = true;\n            }\n            // Avoids infinite loops for invalid graphs\n            if (!cell.invalidating) {\n                cell.invalidating = true;\n                // Recursively invalidates all descendants\n                if (recurse) {\n                    const childCount = cell.getChildCount();\n                    for (let i = 0; i < childCount; i += 1) {\n                        const child = cell.getChildAt(i);\n                        this.invalidate(child, recurse, includeEdges);\n                    }\n                }\n                // Propagates invalidation to all connected edges\n                if (includeEdges) {\n                    const edgeCount = cell.getEdgeCount();\n                    for (let i = 0; i < edgeCount; i += 1) {\n                        this.invalidate(cell.getEdgeAt(i), recurse, includeEdges);\n                    }\n                }\n                cell.invalidating = false;\n            }\n        }\n    }\n    /**\n     * Calls {@link validateCell} and {@link validateCellState} and updates the {@link graphBounds}\n     * using {@link getBoundingBox}. Finally, the background is validated using\n     * {@link validateBackground}.\n     *\n     * @param cell Optional {@link Cell} to be used as the root of the validation.\n     * Default is {@link currentRoot} or the root of the model.\n     */\n    validate(cell = null) {\n        const t0 = GlobalConfig.logger.enter('GraphView.validate');\n        this.resetValidationState();\n        const c = cell || (this.currentRoot ?? this.graph.getDataModel().getRoot());\n        if (c) {\n            const graphBounds = this.getBoundingBox(this.validateCellState(c ? this.validateCell(c) : null));\n            this.setGraphBounds(graphBounds ?? this.getEmptyBounds());\n            this.validateBackground();\n            this.resetValidationState();\n        }\n        GlobalConfig.logger.leave('GraphView.validate', t0);\n    }\n    /**\n     * Returns the bounds for an empty graph. This returns a rectangle at\n     * {@link translate} with the size of 0 x 0.\n     */\n    getEmptyBounds() {\n        return new Rectangle(this.translate.x * this.scale, this.translate.y * this.scale);\n    }\n    /**\n     * Returns the bounding box of the shape and the label for the given\n     * {@link CellState} and its children if recurse is true.\n     *\n     * @param state {@link CellState} whose bounding box should be returned.\n     * @param recurse Optional boolean indicating if the children should be included.\n     * Default is true.\n     */\n    getBoundingBox(state = null, recurse = true) {\n        let bbox = null;\n        if (state) {\n            if (state.shape && state.shape.boundingBox) {\n                bbox = state.shape.boundingBox.clone();\n            }\n            // Adds label bounding box to graph bounds\n            if (state.text && state.text.boundingBox) {\n                if (bbox) {\n                    bbox.add(state.text.boundingBox);\n                }\n                else {\n                    bbox = state.text.boundingBox.clone();\n                }\n            }\n            if (recurse) {\n                const childCount = state.cell.getChildCount();\n                for (let i = 0; i < childCount; i += 1) {\n                    const bounds = this.getBoundingBox(this.getState(state.cell.getChildAt(i)));\n                    if (bounds) {\n                        if (!bbox) {\n                            bbox = bounds;\n                        }\n                        else {\n                            bbox.add(bounds);\n                        }\n                    }\n                }\n            }\n        }\n        return bbox;\n    }\n    /**\n     * Creates and returns the shape used as the background page.\n     *\n     * @param bounds {@link Rectangle} that represents the bounds of the shape.\n     */\n    createBackgroundPageShape(bounds) {\n        return new RectangleShape(bounds, 'white', 'black');\n    }\n    /**\n     * Calls {@link validateBackgroundImage} and {@link validateBackgroundPage}.\n     */\n    validateBackground() {\n        this.validateBackgroundImage();\n        this.validateBackgroundPage();\n    }\n    /**\n     * Validates the background image.\n     */\n    validateBackgroundImage() {\n        const bg = this.graph.getBackgroundImage();\n        if (bg) {\n            if (!this.backgroundImage || this.backgroundImage.imageSrc !== bg.src) {\n                if (this.backgroundImage) {\n                    this.backgroundImage.destroy();\n                }\n                const bounds = new Rectangle(0, 0, 1, 1);\n                this.backgroundImage = new ImageShape(bounds, bg.src);\n                this.backgroundImage.dialect = this.graph.dialect;\n                this.backgroundImage.init(this.backgroundPane);\n                this.backgroundImage.redraw();\n            }\n            this.redrawBackgroundImage(this.backgroundImage, bg);\n        }\n        else if (this.backgroundImage) {\n            this.backgroundImage.destroy();\n            this.backgroundImage = null;\n        }\n    }\n    /**\n     * Validates the background page.\n     */\n    validateBackgroundPage() {\n        const graph = this.graph;\n        if (graph.pageVisible) {\n            const bounds = this.getBackgroundPageBounds();\n            if (this.backgroundPageShape == null) {\n                this.backgroundPageShape = this.createBackgroundPageShape(bounds);\n                this.backgroundPageShape.scale = this.scale;\n                this.backgroundPageShape.isShadow = true;\n                this.backgroundPageShape.dialect = this.graph.dialect;\n                this.backgroundPageShape.init(this.backgroundPane);\n                this.backgroundPageShape.redraw();\n                if (this.backgroundPageShape.node) {\n                    // Adds listener for double click handling on background\n                    if (graph.isNativeDblClickEnabled()) {\n                        InternalEvent.addListener(this.backgroundPageShape.node, 'dblclick', ((evt) => {\n                            graph.dblClick(evt);\n                        }));\n                    }\n                    // Adds basic listeners for graph event dispatching outside the\n                    // container and finishing the handling of a single gesture\n                    InternalEvent.addGestureListeners(this.backgroundPageShape.node, (evt) => {\n                        graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt));\n                    }, (evt) => {\n                        const tooltipHandler = graph.getPlugin('TooltipHandler');\n                        // Hides the tooltip if mouse is outside container\n                        if (tooltipHandler && tooltipHandler.isHideOnHover()) {\n                            tooltipHandler.hide();\n                        }\n                        if (graph.isMouseDown && !isConsumed(evt)) {\n                            graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt));\n                        }\n                    }, (evt) => {\n                        graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt));\n                    });\n                }\n            }\n            else {\n                this.backgroundPageShape.scale = this.scale;\n                this.backgroundPageShape.bounds = bounds;\n                this.backgroundPageShape.redraw();\n            }\n        }\n        else if (this.backgroundPageShape) {\n            this.backgroundPageShape.destroy();\n            this.backgroundPageShape = null;\n        }\n    }\n    /**\n     * Returns the bounds for the background page.\n     */\n    getBackgroundPageBounds() {\n        const fmt = this.graph.pageFormat;\n        const ps = this.scale * this.graph.pageScale;\n        return new Rectangle(this.scale * this.translate.x, this.scale * this.translate.y, fmt.width * ps, fmt.height * ps);\n    }\n    /**\n     * Updates the bounds and redraws the background image.\n     *\n     * Example:\n     *\n     * If the background image should not be scaled, this can be replaced with\n     * the following.\n     *\n     * @example\n     * ```javascript\n     * redrawBackground(backgroundImage, bg)\n     * {\n     *   backgroundImage.bounds.x = this.translate.x;\n     *   backgroundImage.bounds.y = this.translate.y;\n     *   backgroundImage.bounds.width = bg.width;\n     *   backgroundImage.bounds.height = bg.height;\n     *\n     *   backgroundImage.redraw();\n     * };\n     * ```\n     *\n     * @param backgroundImage {@link ImageShape} that represents the background image.\n     * @param bg {@link Image} that specifies the image and its dimensions.\n     */\n    redrawBackgroundImage(backgroundImage, bg) {\n        backgroundImage.scale = this.scale;\n        if (backgroundImage.bounds) {\n            const bounds = backgroundImage.bounds;\n            bounds.x = this.scale * this.translate.x;\n            bounds.y = this.scale * this.translate.y;\n            bounds.width = this.scale * bg.width;\n            bounds.height = this.scale * bg.height;\n        }\n        backgroundImage.redraw();\n    }\n    /**\n     * Recursively creates the cell state for the given cell if visible is true and\n     * the given cell is visible. If the cell is not visible but the state exists\n     * then it is removed using {@link removeState}.\n     *\n     * @param cell {@link Cell} whose {@link CellState} should be created.\n     * @param visible Optional boolean indicating if the cell should be visible. Default\n     * is true.\n     */\n    validateCell(cell, visible = true) {\n        visible = visible && cell.isVisible();\n        const state = this.getState(cell, visible);\n        if (state && !visible) {\n            this.removeState(cell);\n        }\n        else {\n            const childCount = cell.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                this.validateCell(cell.getChildAt(i), visible && (!cell.isCollapsed() || cell === this.currentRoot));\n            }\n        }\n        return cell;\n    }\n    /**\n     * Validates and repaints the {@link CellState} for the given {@link Cell}.\n     *\n     * @param cell {@link Cell} whose {@link CellState} should be validated.\n     * @param recurse Optional boolean indicating if the children of the cell should be\n     * validated. Default is true.\n     */\n    validateCellState(cell, recurse = true) {\n        let state = null;\n        if (cell) {\n            state = this.getState(cell);\n            if (state) {\n                if (state.invalid) {\n                    state.invalid = false;\n                    if (!state.style || state.invalidStyle) {\n                        state.style = this.graph.getCellStyle(state.cell);\n                        state.invalidStyle = false;\n                    }\n                    if (cell !== this.currentRoot) {\n                        this.validateCellState(cell.getParent(), false);\n                    }\n                    state.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(cell, true), false), true);\n                    state.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(cell, false), false), false);\n                    this.updateCellState(state);\n                    // Repaint happens immediately after the cell is validated\n                    if (cell !== this.currentRoot && !state.invalid) {\n                        this.graph.cellRenderer.redraw(state, false, this.isRendering());\n                        // Handles changes to vertex paint bounds after update of rendering shape\n                        state.updateCachedBounds();\n                    }\n                }\n                if (recurse && !state.invalid) {\n                    // Updates order in DOM if recursively traversing\n                    if (state.shape) {\n                        this.stateValidated(state);\n                    }\n                    const childCount = cell.getChildCount();\n                    for (let i = 0; i < childCount; i += 1) {\n                        this.validateCellState(cell.getChildAt(i));\n                    }\n                }\n            }\n        }\n        return state;\n    }\n    /**\n     * Updates the given {@link CellState}.\n     *\n     * @param state {@link CellState} to be updated.\n     */\n    updateCellState(state) {\n        const absoluteOffset = state.absoluteOffset;\n        const origin = state.origin;\n        absoluteOffset.x = 0;\n        absoluteOffset.y = 0;\n        origin.x = 0;\n        origin.y = 0;\n        state.length = 0;\n        if (state.cell !== this.currentRoot) {\n            const parent = state.cell.getParent();\n            const pState = parent ? this.getState(parent) : null;\n            if (pState && pState.cell !== this.currentRoot) {\n                origin.x += pState.origin.x;\n                origin.y += pState.origin.y;\n            }\n            let offset = this.graph.getChildOffsetForCell(state.cell);\n            if (offset) {\n                origin.x += offset.x;\n                origin.y += offset.y;\n            }\n            const geo = state.cell.getGeometry();\n            if (geo) {\n                if (!state.cell.isEdge()) {\n                    offset = geo.offset ? geo.offset : this.EMPTY_POINT;\n                    if (geo.relative && pState) {\n                        if (pState.cell.isEdge()) {\n                            const point = this.getPoint(pState, geo);\n                            if (point) {\n                                origin.x += point.x / this.scale - pState.origin.x - this.translate.x;\n                                origin.y += point.y / this.scale - pState.origin.y - this.translate.y;\n                            }\n                        }\n                        else {\n                            origin.x += geo.x * pState.unscaledWidth + offset.x;\n                            origin.y += geo.y * pState.unscaledHeight + offset.y;\n                        }\n                    }\n                    else {\n                        absoluteOffset.x = this.scale * offset.x;\n                        absoluteOffset.y = this.scale * offset.y;\n                        origin.x += geo.x;\n                        origin.y += geo.y;\n                    }\n                }\n                state.x = this.scale * (this.translate.x + origin.x);\n                state.y = this.scale * (this.translate.y + origin.y);\n                state.width = this.scale * geo.width;\n                state.unscaledWidth = geo.width;\n                state.height = this.scale * geo.height;\n                state.unscaledHeight = geo.height;\n                if (state.cell.isVertex()) {\n                    this.updateVertexState(state, geo);\n                }\n                if (state.cell.isEdge()) {\n                    this.updateEdgeState(state, geo);\n                }\n            }\n        }\n        state.updateCachedBounds();\n    }\n    /**\n     * Validates the given cell state.\n     */\n    updateVertexState(state, geo) {\n        const parent = state.cell.getParent();\n        const pState = parent ? this.getState(parent) : null;\n        if (geo.relative && pState && !pState.cell.isEdge()) {\n            const alpha = toRadians(pState.style.rotation ?? 0);\n            if (alpha !== 0) {\n                const cos = Math.cos(alpha);\n                const sin = Math.sin(alpha);\n                const ct = new Point(state.getCenterX(), state.getCenterY());\n                const cx = new Point(pState.getCenterX(), pState.getCenterY());\n                const pt = getRotatedPoint(ct, cos, sin, cx);\n                state.x = pt.x - state.width / 2;\n                state.y = pt.y - state.height / 2;\n            }\n        }\n        this.updateVertexLabelOffset(state);\n    }\n    /**\n     * Validates the given cell state.\n     */\n    updateEdgeState(state, geo) {\n        const source = state.getVisibleTerminalState(true);\n        const target = state.getVisibleTerminalState(false);\n        // This will remove edges with no terminals and no terminal points\n        // as such edges are invalid and produce NPEs in the edge styles.\n        // Also removes connected edges that have no visible terminals.\n        if ((state.cell.getTerminal(true) && !source) ||\n            (!source && !geo.getTerminalPoint(true)) ||\n            (state.cell.getTerminal(false) && !target) ||\n            (!target && !geo.getTerminalPoint(false))) {\n            this.clear(state.cell, true);\n        }\n        else {\n            this.updateFixedTerminalPoints(state, source, target);\n            this.updatePoints(state, geo.points, source, target);\n            this.updateFloatingTerminalPoints(state, source, target);\n            const pts = state.absolutePoints;\n            if (state.cell !== this.currentRoot &&\n                (pts == null || pts.length < 2 || pts[0] == null || pts[pts.length - 1] == null)) {\n                // This will remove edges with invalid points from the list of states in the view.\n                // Happens if the one of the terminals and the corresponding terminal point is null.\n                this.clear(state.cell, true);\n            }\n            else {\n                this.updateEdgeBounds(state);\n                this.updateEdgeLabelOffset(state);\n            }\n        }\n    }\n    /**\n     * Updates the absoluteOffset of the given vertex cell state. This takes\n     * into account the label position styles.\n     *\n     * @param state {@link CellState} whose absolute offset should be updated.\n     */\n    updateVertexLabelOffset(state) {\n        const h = state.style.labelPosition ?? 'center';\n        if (h === 'left') {\n            let lw = state.style.labelWidth ?? null;\n            if (lw != null) {\n                lw *= this.scale;\n            }\n            else {\n                lw = state.width;\n            }\n            // @ts-ignore\n            state.absoluteOffset.x -= lw;\n        }\n        else if (h === 'right') {\n            // @ts-ignore\n            state.absoluteOffset.x += state.width;\n        }\n        else if (h === 'center') {\n            const lw = state.style.labelWidth ?? null;\n            if (lw != null) {\n                // Aligns text block with given width inside the vertex width\n                const align = state.style.align ?? 'center';\n                let dx = 0;\n                if (align === 'center') {\n                    dx = 0.5;\n                }\n                else if (align === 'right') {\n                    dx = 1;\n                }\n                if (dx !== 0) {\n                    // @ts-ignore\n                    state.absoluteOffset.x -= (lw * this.scale - state.width) * dx;\n                }\n            }\n        }\n        const v = state.style.verticalLabelPosition ?? 'middle';\n        if (v === 'top') {\n            // @ts-ignore\n            state.absoluteOffset.y -= state.height;\n        }\n        else if (v === 'bottom') {\n            // @ts-ignore\n            state.absoluteOffset.y += state.height;\n        }\n    }\n    /**\n     * Resets the current validation state.\n     */\n    resetValidationState() {\n        this.lastNode = null;\n        this.lastHtmlNode = null;\n        this.lastForegroundNode = null;\n        this.lastForegroundHtmlNode = null;\n    }\n    /**\n     * Invoked when a state has been processed in {@link validatePoints}. This is used\n     * to update the order of the DOM nodes of the shape.\n     *\n     * @param state {@link CellState} that represents the cell state.\n     */\n    stateValidated(state) {\n        const graph = this.graph;\n        const fg = (state.cell.isEdge() && graph.keepEdgesInForeground) ||\n            (state.cell.isVertex() && graph.keepEdgesInBackground);\n        const htmlNode = fg\n            ? this.lastForegroundHtmlNode || this.lastHtmlNode\n            : this.lastHtmlNode;\n        const node = fg ? this.lastForegroundNode || this.lastNode : this.lastNode;\n        const result = graph.cellRenderer.insertStateAfter(state, node, htmlNode);\n        if (fg) {\n            this.lastForegroundHtmlNode = result[1];\n            this.lastForegroundNode = result[0];\n        }\n        else {\n            this.lastHtmlNode = result[1];\n            this.lastNode = result[0];\n        }\n    }\n    /**\n     * Sets the initial absolute terminal points in the given state before the edge\n     * style is computed.\n     *\n     * @param edge {@link CellState} whose initial terminal points should be updated.\n     * @param source {@link CellState} which represents the source terminal.\n     * @param target {@link CellState} which represents the target terminal.\n     */\n    updateFixedTerminalPoints(edge, source, target) {\n        this.updateFixedTerminalPoint(edge, source, true, this.graph.getConnectionConstraint(edge, source, true));\n        this.updateFixedTerminalPoint(edge, target, false, this.graph.getConnectionConstraint(edge, target, false));\n    }\n    /**\n     * Sets the fixed source or target terminal point on the given edge.\n     *\n     * @param edge {@link CellState} whose terminal point should be updated.\n     * @param terminal {@link CellState} which represents the actual terminal.\n     * @param source Boolean that specifies if the terminal is the source.\n     * @param constraint {@link ConnectionConstraint} that specifies the connection.\n     */\n    updateFixedTerminalPoint(edge, terminal, source, constraint) {\n        edge.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(edge, terminal, source, constraint), source);\n    }\n    /**\n     * Returns the fixed source or target terminal point for the given edge.\n     *\n     * @param edge {@link CellState} whose terminal point should be returned.\n     * @param terminal {@link CellState} which represents the actual terminal.\n     * @param source Boolean that specifies if the terminal is the source.\n     * @param constraint {@link ConnectionConstraint} that specifies the connection.\n     */\n    getFixedTerminalPoint(edge, terminal, source, constraint) {\n        let pt = null;\n        if (constraint && terminal) {\n            pt = this.graph.getConnectionPoint(terminal, constraint, false); // FIXME Rounding introduced bugs when calculating label positions -> , this.graph.isOrthogonal(edge));\n        }\n        if (!pt && !terminal) {\n            const s = this.scale;\n            const tr = this.translate;\n            const orig = edge.origin;\n            const geo = edge.cell.getGeometry();\n            pt = geo.getTerminalPoint(source);\n            if (pt) {\n                pt = new Point(s * (tr.x + pt.x + orig.x), s * (tr.y + pt.y + orig.y));\n            }\n        }\n        return pt;\n    }\n    /**\n     * Updates the bounds of the given cell state to reflect the bounds of the stencil\n     * if it has a fixed aspect and returns the previous bounds as an {@link Rectangle} if\n     * the bounds have been modified or null otherwise.\n     *\n     * @param state {@link CellState} whose bounds should be updated.\n     */\n    updateBoundsFromStencil(state) {\n        let previous = null;\n        if (state &&\n            state.shape &&\n            state.shape.stencil &&\n            state.shape.stencil.aspect === 'fixed') {\n            previous = Rectangle.fromRectangle(state);\n            const asp = state.shape.stencil.computeAspect(null, // this argument is not used\n            state.x, state.y, state.width, state.height);\n            state.setRect(asp.x, asp.y, state.shape.stencil.w0 * asp.width, state.shape.stencil.h0 * asp.height);\n        }\n        return previous;\n    }\n    /**\n     * Updates the absolute points in the given state using the specified array\n     * of {@link Point} as the relative points.\n     *\n     * @param edge {@link CellState} whose absolute points should be updated.\n     * @param points Array of {@link Point} that constitute the relative points.\n     * @param source {@link CellState} that represents the source terminal.\n     * @param target {@link CellState} that represents the target terminal.\n     */\n    updatePoints(edge, points, source, target) {\n        const pts = [];\n        pts.push(edge.absolutePoints[0]);\n        const edgeStyle = this.getEdgeStyle(edge, points, source, target);\n        if (edgeStyle && source) {\n            // target can be null\n            const src = this.getTerminalPort(edge, source, true);\n            const trg = target ? this.getTerminalPort(edge, target, false) : null;\n            // Uses the stencil bounds for routing and restores after routing\n            const srcBounds = this.updateBoundsFromStencil(src);\n            const trgBounds = this.updateBoundsFromStencil(trg);\n            edgeStyle(edge, src, trg, points, pts);\n            // Restores previous bounds\n            if (src && srcBounds) {\n                src.setRect(srcBounds.x, srcBounds.y, srcBounds.width, srcBounds.height);\n            }\n            if (trg && trgBounds) {\n                trg.setRect(trgBounds.x, trgBounds.y, trgBounds.width, trgBounds.height);\n            }\n        }\n        else if (points) {\n            for (let i = 0; i < points.length; i += 1) {\n                if (points[i]) {\n                    const pt = clone(points[i]);\n                    pts.push(this.transformControlPoint(edge, pt));\n                }\n            }\n        }\n        const tmp = edge.absolutePoints;\n        pts.push(tmp[tmp.length - 1]);\n        edge.absolutePoints = pts;\n    }\n    /**\n     * Transforms the given control point to an absolute point.\n     */\n    transformControlPoint(state, pt, ignoreScale = false) {\n        if (state && pt) {\n            const orig = state.origin;\n            const scale = ignoreScale ? 1 : this.scale;\n            return new Point(scale * (pt.x + this.translate.x + orig.x), scale * (pt.y + this.translate.y + orig.y));\n        }\n        return null;\n    }\n    /**\n     * Returns `true` if the given edge should be routed with {@link AbstractGraph.defaultLoopStyle}\n     * or the {@link CellStateStyle.orthogonalLoop} defined for the given edge.\n     * This implementation returns `true` if the given edge is a loop and does not\n     */\n    isLoopStyleEnabled(edge, points = [], source = null, target = null) {\n        const sc = this.graph.getConnectionConstraint(edge, source, true);\n        const tc = this.graph.getConnectionConstraint(edge, target, false);\n        if ((points == null || points.length < 2) &&\n            !((edge.style.orthogonalLoop ?? false) ||\n                ((sc == null || sc.point == null) && (tc == null || tc.point == null)))) {\n            return source != null && source === target;\n        }\n        return false;\n    }\n    /**\n     * Returns the edge style function to be used to render the given edge state.\n     */\n    getEdgeStyle(edge, points = [], source = null, target = null) {\n        let edgeStyle = this.isLoopStyleEnabled(edge, points, source, target)\n            ? (edge.style.loopStyle ?? this.graph.defaultLoopStyle)\n            : !(edge.style.noEdgeStyle ?? false)\n                ? edge.style.edgeStyle\n                : null;\n        // Converts string values to objects\n        if (typeof edgeStyle === 'string') {\n            let tmp = EdgeStyleRegistry.get(edgeStyle);\n            if (!tmp && this.isAllowEval()) {\n                tmp = doEval(edgeStyle);\n            }\n            edgeStyle = tmp;\n        }\n        if (typeof edgeStyle === 'function') {\n            return edgeStyle;\n        }\n        return null;\n    }\n    /**\n     * Updates the terminal points in the given state after the edge style was\n     * computed for the edge.\n     *\n     * @param state {@link CellState} whose terminal points should be updated.\n     * @param source {@link CellState} that represents the source terminal.\n     * @param target {@link CellState} that represents the target terminal.\n     */\n    updateFloatingTerminalPoints(state, source, target) {\n        const pts = state.absolutePoints;\n        const p0 = pts[0];\n        const pe = pts[pts.length - 1];\n        if (!pe && target) {\n            this.updateFloatingTerminalPoint(state, target, source, false);\n        }\n        if (!p0 && source) {\n            this.updateFloatingTerminalPoint(state, source, target, true);\n        }\n    }\n    /**\n     * Updates the absolute terminal point in the given state for the given\n     * start and end state, where start is the source if source is true.\n     *\n     * @param edge {@link CellState} whose terminal point should be updated.\n     * @param start {@link CellState} for the terminal on \"this\" side of the edge.\n     * @param end {@link CellState} for the terminal on the other side of the edge.\n     * @param source Boolean indicating if start is the source terminal state.\n     */\n    updateFloatingTerminalPoint(edge, start, end, source) {\n        edge.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(edge, start, end, source), source);\n    }\n    /**\n     * Returns the floating terminal point for the given edge, start and end\n     * state, where start is the source if source is true.\n     *\n     * @param edge {@link CellState} whose terminal point should be returned.\n     * @param start {@link CellState} for the terminal on \"this\" side of the edge.\n     * @param end {@link CellState} for the terminal on the other side of the edge.\n     * @param source Boolean indicating if start is the source terminal state.\n     */\n    getFloatingTerminalPoint(edge, start, end, source) {\n        start = this.getTerminalPort(edge, start, source);\n        let next = this.getNextPoint(edge, end, source);\n        const orth = this.graph.isOrthogonal(edge);\n        const alpha = toRadians(start.style.rotation ?? 0);\n        const center = new Point(start.getCenterX(), start.getCenterY());\n        if (alpha !== 0) {\n            const cos = Math.cos(-alpha);\n            const sin = Math.sin(-alpha);\n            next = getRotatedPoint(next, cos, sin, center);\n        }\n        let border = edge.style.perimeterSpacing ?? 0;\n        border +=\n            edge.style[source ? 'sourcePerimeterSpacing' : 'targetPerimeterSpacing'] ?? 0;\n        let pt = this.getPerimeterPoint(start, next, alpha === 0 && orth, border);\n        if (pt && alpha !== 0) {\n            const cos = Math.cos(alpha);\n            const sin = Math.sin(alpha);\n            pt = getRotatedPoint(pt, cos, sin, center);\n        }\n        return pt;\n    }\n    /**\n     * Returns an {@link CellState} that represents the source or target terminal or\n     * port for the given edge.\n     *\n     * @param state {@link CellState} that represents the state of the edge.\n     * @param terminal {@link CellState} that represents the terminal.\n     * @param source Boolean indicating if the given terminal is the source terminal.\n     */\n    getTerminalPort(state, terminal, source = false) {\n        const key = source ? 'sourcePort' : 'targetPort';\n        const id = state.style[key];\n        if (id) {\n            const cell = this.graph.getDataModel().getCell(id);\n            if (cell) {\n                const tmp = this.getState(cell, false);\n                // Only uses ports where a cell state exists\n                if (tmp) {\n                    terminal = tmp;\n                }\n            }\n        }\n        return terminal;\n    }\n    /**\n     * Returns an {@link Point} that defines the location of the intersection point between\n     * the perimeter and the line between the center of the shape and the given point.\n     *\n     * @param terminal {@link CellState} for the source or target terminal.\n     * @param next {@link Point} that lies outside the given terminal.\n     * @param orthogonal Boolean that specifies if the orthogonal projection onto\n     * the perimeter should be returned. If this is false then the intersection\n     * of the perimeter and the line between the next and the center point is\n     * returned.\n     * @param border Optional border between the perimeter and the shape.\n     */\n    getPerimeterPoint(terminal, next, orthogonal, border = 0) {\n        let point = null;\n        if (terminal != null) {\n            const perimeter = this.getPerimeterFunction(terminal);\n            if (perimeter != null && next != null) {\n                const bounds = this.getPerimeterBounds(terminal, border);\n                if (bounds.width > 0 || bounds.height > 0) {\n                    point = new Point(next.x, next.y);\n                    let flipH = false;\n                    let flipV = false;\n                    if (terminal.cell.isVertex()) {\n                        flipH = !!terminal.style.flipH;\n                        flipV = !!terminal.style.flipV;\n                        if (flipH) {\n                            point.x = 2 * bounds.getCenterX() - point.x;\n                        }\n                        if (flipV) {\n                            point.y = 2 * bounds.getCenterY() - point.y;\n                        }\n                    }\n                    point = perimeter(bounds, terminal, point, orthogonal);\n                    if (point != null) {\n                        if (flipH) {\n                            point.x = 2 * bounds.getCenterX() - point.x;\n                        }\n                        if (flipV) {\n                            point.y = 2 * bounds.getCenterY() - point.y;\n                        }\n                    }\n                }\n            }\n            if (point == null) {\n                point = this.getPoint(terminal);\n            }\n        }\n        return point;\n    }\n    /**\n     * Returns the x-coordinate of the center point for automatic routing.\n     */\n    getRoutingCenterX(state) {\n        const f = state.style ? (state.style.routingCenterX ?? 0) : 0;\n        return state.getCenterX() + f * state.width;\n    }\n    /**\n     * Returns the y-coordinate of the center point for automatic routing.\n     */\n    getRoutingCenterY(state) {\n        const f = state.style ? (state.style.routingCenterY ?? 0) : 0;\n        return state.getCenterY() + f * state.height;\n    }\n    /**\n     * Returns the perimeter bounds for the given terminal, edge pair as an\n     * {@link Rectangle}.\n     *\n     * If you have a model where each terminal has a relative child that should\n     * act as the graphical endpoint for a connection from/to the terminal, then\n     * this method can be replaced as follows:\n     *\n     * @example\n     * ```javascript\n     * var oldGetPerimeterBounds = getPerimeterBounds;\n     * getPerimeterBounds(terminal, edge, isSource)\n     * {\n     *   var model = this.graph.getDataModel();\n     *   var childCount = model.getChildCount(terminal.cell);\n     *\n     *   if (childCount > 0)\n     *   {\n     *     var child = model.getChildAt(terminal.cell, 0);\n     *     var geo = model.getGeometry(child);\n     *\n     *     if (geo != null &&\n     *         geo.relative)\n     *     {\n     *       var state = this.getState(child);\n     *\n     *       if (state != null)\n     *       {\n     *         terminal = state;\n     *       }\n     *     }\n     *   }\n     *\n     *   return oldGetPerimeterBounds.apply(this, arguments);\n     * };\n     * ```\n     *\n     * @param terminal CellState that represents the terminal.\n     * @param border Number that adds a border between the shape and the perimeter.\n     */\n    getPerimeterBounds(terminal, border = 0) {\n        border += terminal.style.perimeterSpacing ?? 0;\n        return terminal.getPerimeterBounds(border * this.scale);\n    }\n    /**\n     * Returns the perimeter function for the given state.\n     */\n    getPerimeterFunction(state) {\n        let perimeter = state.style.perimeter;\n        // Converts string values to objects\n        if (typeof perimeter === 'string') {\n            let tmp = PerimeterRegistry.get(perimeter);\n            if (tmp == null && this.isAllowEval()) {\n                tmp = doEval(perimeter);\n            }\n            perimeter = tmp;\n        }\n        if (typeof perimeter === 'function') {\n            return perimeter;\n        }\n        return null;\n    }\n    /**\n     * Returns the nearest point in the list of absolute points or the center\n     * of the opposite terminal.\n     *\n     * @param edge {@link CellState} that represents the edge.\n     * @param opposite {@link CellState} that represents the opposite terminal.\n     * @param source Boolean indicating if the next point for the source or target\n     * should be returned.\n     */\n    getNextPoint(edge, opposite, source = false) {\n        const pts = edge.absolutePoints;\n        let point = null;\n        if (pts.length >= 2) {\n            const count = pts.length;\n            point = pts[source ? Math.min(1, count - 1) : Math.max(0, count - 2)];\n        }\n        if (!point && opposite) {\n            point = new Point(opposite.getCenterX(), opposite.getCenterY());\n        }\n        return point; // shouldn't return null, but really?\n    }\n    /**\n     * Returns the nearest ancestor terminal that is visible. The edge appears\n     * to be connected to this terminal on the display. The result of this method\n     * is cached in {@link CellState.getVisibleTerminalState}.\n     *\n     * @param edge {@link Cell} whose visible terminal should be returned.\n     * @param source Boolean that specifies if the source or target terminal\n     * should be returned.\n     */\n    getVisibleTerminal(edge, source) {\n        const model = this.graph.getDataModel();\n        let result = edge.getTerminal(source);\n        let best = result;\n        while (result && result !== this.currentRoot) {\n            if ((best && !best.isVisible()) || result.isCollapsed()) {\n                best = result;\n            }\n            result = result.getParent();\n        }\n        // Checks if the result is valid for the current view state\n        if (best &&\n            (!model.contains(best) ||\n                best.getParent() === model.getRoot() ||\n                best === this.currentRoot)) {\n            best = null;\n        }\n        return best;\n    }\n    /**\n     * Updates the given state using the bounding box of the absolute points.\n     * Also updates {@link CellState.terminalDistance}, {@link CellState.length} and\n     * {@link CellState.segments}.\n     *\n     * @param state {@link CellState} whose bounds should be updated.\n     */\n    updateEdgeBounds(state) {\n        const points = state.absolutePoints;\n        const p0 = points[0];\n        const pe = points[points.length - 1];\n        if (p0 && pe && (p0.x !== pe.x || p0.y !== pe.y)) {\n            const dx = pe.x - p0.x;\n            const dy = pe.y - p0.y;\n            state.terminalDistance = Math.sqrt(dx * dx + dy * dy);\n        }\n        else {\n            state.terminalDistance = 0;\n        }\n        let length = 0;\n        const segments = [];\n        let pt = p0;\n        if (pt) {\n            let minX = pt.x;\n            let minY = pt.y;\n            let maxX = minX;\n            let maxY = minY;\n            for (let i = 1; i < points.length; i += 1) {\n                const tmp = points[i];\n                if (tmp) {\n                    const dx = pt.x - tmp.x;\n                    const dy = pt.y - tmp.y;\n                    const segment = Math.sqrt(dx * dx + dy * dy);\n                    segments.push(segment);\n                    length += segment;\n                    pt = tmp;\n                    minX = Math.min(pt.x, minX);\n                    minY = Math.min(pt.y, minY);\n                    maxX = Math.max(pt.x, maxX);\n                    maxY = Math.max(pt.y, maxY);\n                }\n            }\n            state.length = length;\n            state.segments = segments;\n            const markerSize = 1; // TODO: include marker size\n            state.x = minX;\n            state.y = minY;\n            state.width = Math.max(markerSize, maxX - minX);\n            state.height = Math.max(markerSize, maxY - minY);\n        }\n    }\n    /**\n     * Returns the absolute point on the edge for the given relative\n     * {@link Geometry} as an {@link Point}. The edge is represented by the given\n     * {@link CellState}.\n     *\n     * @param state {@link CellState} that represents the state of the parent edge.\n     * @param geometry {@link Geometry} that represents the relative location.\n     */\n    getPoint(state, geometry = null) {\n        let x = state.getCenterX();\n        let y = state.getCenterY();\n        if (state.segments != null && (geometry == null || geometry.relative)) {\n            const gx = geometry != null ? geometry.x / 2 : 0;\n            const pointCount = state.absolutePoints.length;\n            const dist = Math.round((gx + 0.5) * state.length);\n            let segment = state.segments[0];\n            let length = 0;\n            let index = 1;\n            while (dist >= Math.round(length + segment) && index < pointCount - 1) {\n                length += segment;\n                segment = state.segments[index++];\n            }\n            const factor = segment === 0 ? 0 : (dist - length) / segment;\n            const p0 = state.absolutePoints[index - 1];\n            const pe = state.absolutePoints[index];\n            if (p0 != null && pe != null) {\n                let gy = 0;\n                let offsetX = 0;\n                let offsetY = 0;\n                if (geometry != null) {\n                    gy = geometry.y;\n                    const { offset } = geometry;\n                    if (offset != null) {\n                        offsetX = offset.x;\n                        offsetY = offset.y;\n                    }\n                }\n                const dx = pe.x - p0.x;\n                const dy = pe.y - p0.y;\n                const nx = segment === 0 ? 0 : dy / segment;\n                const ny = segment === 0 ? 0 : dx / segment;\n                x = p0.x + dx * factor + (nx * gy + offsetX) * this.scale;\n                y = p0.y + dy * factor - (ny * gy - offsetY) * this.scale;\n            }\n        }\n        else if (geometry != null) {\n            const { offset } = geometry;\n            if (offset != null) {\n                x += offset.x;\n                y += offset.y;\n            }\n        }\n        return new Point(x, y);\n    }\n    /**\n     * Gets the relative point that describes the given, absolute label\n     * position for the given edge state.\n     *\n     * @param edgeState {@link CellState} that represents the state of the parent edge.\n     * @param x Specifies the x-coordinate of the absolute label location.\n     * @param y Specifies the y-coordinate of the absolute label location.\n     */\n    getRelativePoint(edgeState, x, y) {\n        const geometry = edgeState.cell.getGeometry();\n        if (geometry) {\n            const absolutePoints = edgeState.absolutePoints;\n            const pointCount = absolutePoints.length;\n            if (geometry.relative && pointCount > 1) {\n                const totalLength = edgeState.length;\n                const { segments } = edgeState;\n                // Works out which line segment the point of the label is closest to\n                let p0 = absolutePoints[0];\n                let pe = absolutePoints[1];\n                let minDist = ptSegDistSq(p0.x, p0.y, pe.x, pe.y, x, y);\n                let length = 0;\n                let index = 0;\n                let tmp = 0;\n                for (let i = 2; i < pointCount; i += 1) {\n                    p0 = pe;\n                    pe = absolutePoints[i];\n                    const dist = ptSegDistSq(p0.x, p0.y, pe.x, pe.y, x, y);\n                    tmp += segments[i - 2];\n                    if (dist <= minDist) {\n                        minDist = dist;\n                        index = i - 1;\n                        length = tmp;\n                    }\n                }\n                const seg = segments[index];\n                p0 = absolutePoints[index];\n                pe = absolutePoints[index + 1];\n                const x2 = p0.x;\n                const y2 = p0.y;\n                const x1 = pe.x;\n                const y1 = pe.y;\n                let px = x;\n                let py = y;\n                const xSegment = x2 - x1;\n                const ySegment = y2 - y1;\n                px -= x1;\n                py -= y1;\n                let projlenSq = 0;\n                px = xSegment - px;\n                py = ySegment - py;\n                const dotprod = px * xSegment + py * ySegment;\n                if (dotprod <= 0.0) {\n                    projlenSq = 0;\n                }\n                else {\n                    projlenSq = (dotprod * dotprod) / (xSegment * xSegment + ySegment * ySegment);\n                }\n                let projlen = Math.sqrt(projlenSq);\n                if (projlen > seg) {\n                    projlen = seg;\n                }\n                let yDistance = Math.sqrt(ptSegDistSq(p0.x, p0.y, pe.x, pe.y, x, y));\n                const direction = relativeCcw(p0.x, p0.y, pe.x, pe.y, x, y);\n                if (direction === -1) {\n                    yDistance = -yDistance;\n                }\n                // Constructs the relative point for the label\n                return new Point(((totalLength / 2 - length - projlen) / totalLength) * -2, yDistance / this.scale);\n            }\n        }\n        return new Point();\n    }\n    /**\n     * Updates {@link CellState.absoluteOffset} for the given state. The absolute\n     * offset is normally used for the position of the edge label. It is\n     * calculated from the geometry as an absolute offset from the center\n     * between the two endpoints if the geometry is absolute, or as the\n     * relative distance between the center along the line and the absolute\n     * orthogonal distance if the geometry is relative.\n     *\n     * @param state {@link CellState} whose absolute offset should be updated.\n     */\n    updateEdgeLabelOffset(state) {\n        const points = state.absolutePoints;\n        const absoluteOffset = state.absoluteOffset;\n        absoluteOffset.x = state.getCenterX();\n        absoluteOffset.y = state.getCenterY();\n        if (points.length > 0 && state.segments) {\n            const geometry = state.cell.getGeometry();\n            if (geometry) {\n                if (geometry.relative) {\n                    const offset = this.getPoint(state, geometry);\n                    state.absoluteOffset = offset;\n                }\n                else {\n                    const p0 = points[0];\n                    const pe = points[points.length - 1];\n                    if (p0 && pe) {\n                        const dx = pe.x - p0.x;\n                        const dy = pe.y - p0.y;\n                        let x0 = 0;\n                        let y0 = 0;\n                        const off = geometry.offset;\n                        if (off) {\n                            x0 = off.x;\n                            y0 = off.y;\n                        }\n                        const x = p0.x + dx / 2 + x0 * this.scale;\n                        const y = p0.y + dy / 2 + y0 * this.scale;\n                        absoluteOffset.x = x;\n                        absoluteOffset.y = y;\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Returns the {@link CellState} for the given cell. If create is true, then\n     * the state is created if it does not yet exist.\n     *\n     * @param cell {@link Cell} for which the {@link CellState} should be returned.\n     * @param create Optional boolean indicating if a new state should be created if it does not yet exist. Default is false.\n     */\n    getState(cell, create = false) {\n        let state = this.states.get(cell) ?? null;\n        if (create && (!state || this.updateStyle) && cell.isVisible()) {\n            if (!state) {\n                state = this.createState(cell);\n                this.states.set(cell, state);\n            }\n            else {\n                state.style = this.graph.getCellStyle(cell);\n            }\n        }\n        return state;\n    }\n    /**\n     * Returns the {@link CellState}s for the given array of {@link Cell}.\n     *\n     * The array contains all states that are not null, that is, the returned array may have fewer elements than the given array.\n     *\n     * If no argument is given, then this returns the {@link CellState} of {@link states}.\n     */\n    getCellStates(cells = null) {\n        if (!cells) {\n            return Array.from(this.states.values());\n        }\n        const result = [];\n        for (const cell of cells) {\n            const state = this.getState(cell);\n            if (state) {\n                result.push(state);\n            }\n        }\n        return result;\n    }\n    /**\n     * Removes and returns the {@link CellState} for the given cell.\n     *\n     * @param cell {@link Cell} for which the {@link CellState} should be removed.\n     */\n    removeState(cell) {\n        const state = this.states.get(cell) ?? null;\n        this.states.delete(cell);\n        if (state) {\n            this.graph.cellRenderer.destroy(state);\n            state.invalid = true;\n            state.destroy();\n        }\n        return state;\n    }\n    /**\n     * Creates and returns an {@link CellState} for the given cell and initializes\n     * it using {@link cellRenderer.initialize}.\n     *\n     * @param cell {@link Cell} for which a new {@link CellState} should be created.\n     */\n    createState(cell) {\n        return new CellState(this, cell, this.graph.getCellStyle(cell));\n    }\n    /**\n     * Returns true if the event origin is one of the drawing panes or\n     * containers of the view.\n     */\n    isContainerEvent(evt) {\n        const source = getSource(evt);\n        return (source &&\n            (source === this.graph.container ||\n                // @ts-ignore parentNode may exist\n                source.parentNode === this.backgroundPane ||\n                // @ts-ignore parentNode may exist\n                (source.parentNode && source.parentNode.parentNode === this.backgroundPane) ||\n                source === this.canvas.parentNode ||\n                source === this.canvas ||\n                source === this.backgroundPane ||\n                source === this.drawPane ||\n                source === this.overlayPane ||\n                source === this.decoratorPane));\n    }\n    isScrollEvent(evt) {\n        const graph = this.graph;\n        const offset = getOffset(graph.container);\n        const eventClientPosition = evt instanceof MouseEvent\n            ? [evt.clientX, evt.clientY]\n            : [evt.touches[0].clientX, evt.touches[0].clientY];\n        const pt = new Point(eventClientPosition[0] - offset.x, eventClientPosition[1] - offset.y);\n        const container = graph.container;\n        const outWidth = container.offsetWidth;\n        const inWidth = container.clientWidth;\n        if (outWidth > inWidth && pt.x > inWidth + 2 && pt.x <= outWidth) {\n            return true;\n        }\n        const outHeight = container.offsetHeight;\n        const inHeight = container.clientHeight;\n        return outHeight > inHeight && pt.y > inHeight + 2 && pt.y <= outHeight;\n    }\n    /**\n     * Initializes the graph event dispatch loop for the specified container\n     * and invokes {@link create} to create the required DOM nodes for the display.\n     */\n    init() {\n        this.installListeners();\n        this.createSvg();\n    }\n    /**\n     * Installs the required listeners in the container.\n     */\n    installListeners() {\n        const graph = this.graph;\n        const { container } = graph;\n        // Support for touch device gestures (eg. pinch to zoom)\n        // Double-tap handling is implemented in mxGraph.fireMouseEvent\n        if (Client.IS_TOUCH) {\n            InternalEvent.addListener(container, 'gesturestart', ((evt) => {\n                graph.fireGestureEvent(evt);\n                InternalEvent.consume(evt);\n            }));\n            InternalEvent.addListener(container, 'gesturechange', ((evt) => {\n                graph.fireGestureEvent(evt);\n                InternalEvent.consume(evt);\n            }));\n            InternalEvent.addListener(container, 'gestureend', ((evt) => {\n                graph.fireGestureEvent(evt);\n                InternalEvent.consume(evt);\n            }));\n        }\n        // Fires event only for one pointer per gesture\n        let pointerId = null;\n        // Adds basic listeners for graph event dispatching\n        InternalEvent.addGestureListeners(container, ((evt) => {\n            // Condition to avoid scrollbar events starting a rubberband selection\n            if (this.isContainerEvent(evt) &&\n                ((!Client.IS_GC && !Client.IS_SF) || !this.isScrollEvent(evt))) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt));\n                // @ts-ignore\n                pointerId = evt.pointerId;\n            }\n        }), (evt) => {\n            if (this.isContainerEvent(evt) &&\n                // @ts-ignore\n                (pointerId === null || evt.pointerId === pointerId)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt));\n            }\n        }, (evt) => {\n            if (this.isContainerEvent(evt)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt));\n            }\n            pointerId = null;\n        });\n        // Adds listener for double click handling on background, this does always\n        // use native event handler, we assume that the DOM of the background\n        // does not change during the double click\n        InternalEvent.addListener(container, 'dblclick', ((evt) => {\n            if (this.isContainerEvent(evt)) {\n                graph.dblClick(evt);\n            }\n        }));\n        // Workaround for touch events which started on some DOM node\n        // on top of the container, in which case the cells under the\n        // mouse for the move and up events are not detected.\n        const getState = (evt) => {\n            let state = null;\n            // Workaround for touch events which started on some DOM node\n            // on top of the container, in which case the cells under the\n            // mouse for the move and up events are not detected.\n            if (Client.IS_TOUCH) {\n                const x = getClientX(evt);\n                const y = getClientY(evt);\n                // Dispatches the drop event to the graph which\n                // consumes and executes the source function\n                const pt = convertPoint(container, x, y);\n                const cell = graph.getCellAt(pt.x, pt.y);\n                if (cell)\n                    state = graph.view.getState(cell);\n            }\n            return state;\n        };\n        // Adds basic listeners for graph event dispatching outside the container and finishing the handling of a single gesture\n        // Implemented via graph event dispatch loop to avoid duplicate events in Firefox and Chrome\n        graph.addMouseListener({\n            mouseDown: () => {\n                const popupMenuHandler = graph.getPlugin('PopupMenuHandler');\n                popupMenuHandler?.hideMenu();\n            },\n            mouseMove: () => {\n                // do nothing\n            },\n            mouseUp: () => {\n                // do nothing\n            },\n        });\n        this.moveHandler = (evt) => {\n            const tooltipHandler = graph.getPlugin('TooltipHandler');\n            // Hides the tooltip if mouse is outside container\n            if (tooltipHandler && tooltipHandler.isHideOnHover()) {\n                tooltipHandler.hide();\n            }\n            if (this.captureDocumentGesture &&\n                graph.isMouseDown &&\n                graph.container != null &&\n                !this.isContainerEvent(evt) &&\n                graph.container.style.display !== 'none' &&\n                graph.container.style.visibility !== 'hidden' &&\n                !isConsumed(evt)) {\n                graph.fireMouseEvent(InternalEvent.MOUSE_MOVE, new InternalMouseEvent(evt, getState(evt)));\n            }\n        };\n        this.endHandler = (evt) => {\n            if (this.captureDocumentGesture &&\n                graph.isMouseDown &&\n                graph.container != null &&\n                !this.isContainerEvent(evt) &&\n                graph.container.style.display !== 'none' &&\n                graph.container.style.visibility !== 'hidden') {\n                graph.fireMouseEvent(InternalEvent.MOUSE_UP, new InternalMouseEvent(evt));\n            }\n        };\n        InternalEvent.addGestureListeners(document, null, this.moveHandler, this.endHandler);\n    }\n    /**\n     * Creates and returns the DOM nodes for the SVG display.\n     */\n    createSvg() {\n        const { container } = this.graph;\n        const canvas = (this.canvas = document.createElementNS(NS_SVG, 'g'));\n        // For background image\n        this.backgroundPane = document.createElementNS(NS_SVG, 'g');\n        canvas.appendChild(this.backgroundPane);\n        // Adds two layers (background is early feature)\n        this.drawPane = document.createElementNS(NS_SVG, 'g');\n        canvas.appendChild(this.drawPane);\n        this.overlayPane = document.createElementNS(NS_SVG, 'g');\n        canvas.appendChild(this.overlayPane);\n        this.decoratorPane = document.createElementNS(NS_SVG, 'g');\n        canvas.appendChild(this.decoratorPane);\n        const root = document.createElementNS(NS_SVG, 'svg');\n        root.style.left = '0px';\n        root.style.top = '0px';\n        root.style.width = '100%';\n        root.style.height = '100%';\n        // NOTE: In standards mode, the SVG must have block layout\n        // in order for the container DIV to not show scrollbars.\n        root.style.display = 'block';\n        root.appendChild(this.canvas);\n        if (container != null) {\n            container.appendChild(root);\n            this.updateContainerStyle(container);\n        }\n    }\n    /**\n     * Creates the DOM nodes for the HTML display.\n     */\n    createHtml() {\n        const container = this.graph.container;\n        if (container != null) {\n            this.canvas = this.createHtmlPane('100%', '100%');\n            this.canvas.style.overflow = 'hidden';\n            // Uses minimal size for inner DIVs on Canvas. This is required\n            // for correct event processing in IE. If we have an overlapping\n            // DIV then the events on the cells are only fired for labels.\n            this.backgroundPane = this.createHtmlPane('1px', '1px');\n            this.drawPane = this.createHtmlPane('1px', '1px');\n            this.overlayPane = this.createHtmlPane('1px', '1px');\n            this.decoratorPane = this.createHtmlPane('1px', '1px');\n            this.canvas.appendChild(this.backgroundPane);\n            this.canvas.appendChild(this.drawPane);\n            this.canvas.appendChild(this.overlayPane);\n            this.canvas.appendChild(this.decoratorPane);\n            container.appendChild(this.canvas);\n            this.updateContainerStyle(container);\n        }\n    }\n    /**\n     * Updates the size of the HTML canvas.\n     */\n    updateHtmlCanvasSize(width, height) {\n        if (this.graph.container != null) {\n            const ow = this.graph.container.offsetWidth;\n            const oh = this.graph.container.offsetHeight;\n            if (ow < width) {\n                this.canvas.style.width = width + 'px';\n            }\n            else {\n                this.canvas.style.width = '100%';\n            }\n            if (oh < height) {\n                this.canvas.style.height = height + 'px';\n            }\n            else {\n                this.canvas.style.height = '100%';\n            }\n        }\n    }\n    /**\n     * Creates and returns a drawing pane in HTML (DIV).\n     */\n    createHtmlPane(width, height) {\n        const pane = document.createElement('DIV');\n        if (width != null && height != null) {\n            pane.style.position = 'absolute';\n            pane.style.left = '0px';\n            pane.style.top = '0px';\n            pane.style.width = width;\n            pane.style.height = height;\n        }\n        else {\n            pane.style.position = 'relative';\n        }\n        return pane;\n    }\n    /**\n     * Updates the style of the container after installing the SVG DOM elements.\n     */\n    updateContainerStyle(container) {\n        // Workaround for offset of container\n        const style = getCurrentStyle(container);\n        if (style != null && style.position == 'static') {\n            container.style.position = 'relative';\n        }\n        // Disables built-in pan and zoom in IE10 and later\n        if (Client.IS_POINTER) {\n            container.style.touchAction = 'none';\n        }\n    }\n    /**\n     * Destroys the view and all its resources.\n     */\n    destroy() {\n        let root = null;\n        if (this.canvas && this.canvas instanceof SVGElement) {\n            root = this.canvas.ownerSVGElement;\n        }\n        if (!root) {\n            root = this.canvas;\n        }\n        if (root && root.parentNode) {\n            this.clear(this.currentRoot, true);\n            InternalEvent.removeGestureListeners(document, null, this.moveHandler, this.endHandler);\n            InternalEvent.release(this.graph.container);\n            root.parentNode.removeChild(root);\n            this.moveHandler = null;\n            this.endHandler = null;\n            // @ts-expect-error Can be null when destroyed.\n            this.canvas = null;\n            // @ts-expect-error Can be null when destroyed.\n            this.backgroundPane = null;\n            // @ts-expect-error Can be null when destroyed.\n            this.drawPane = null;\n            // @ts-expect-error Can be null when destroyed.\n            this.overlayPane = null;\n            // @ts-expect-error Can be null when destroyed.\n            this.decoratorPane = null;\n        }\n    }\n}\nexport default GraphView;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport Point from '../../geometry/Point.js';\n/**\n * Extends {@link Shape} to implement a rhombus (aka diamond) shape.\n *\n * This shape is registered under `rhombus` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass RhombusShape extends Shape {\n    constructor(bounds, fill, stroke, strokewidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokewidth;\n    }\n    /**\n     * Adds roundable support.\n     */\n    // isRoundable(): boolean;\n    isRoundable() {\n        return true;\n    }\n    /**\n     * Generic painting implementation.\n     * @param {mxAbstractCanvas2D} c\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    paintVertexShape(c, x, y, w, h) {\n        const hw = w / 2;\n        const hh = h / 2;\n        const arcSize = this.getBaseArcSize();\n        c.begin();\n        this.addPoints(c, [\n            new Point(x + hw, y),\n            new Point(x + w, y + hh),\n            new Point(x + hw, y + h),\n            new Point(x, y + hh),\n        ], this.isRounded, arcSize, true);\n        c.fillAndStroke();\n    }\n}\nexport default RhombusShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport { NONE } from '../../../util/Constants.js';\n/**\n * Extends {@link Shape} to implement a cylinder shape.\n *\n * This shape is registered under `cylinder` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * If a custom shape with one filled area and an overlay path is needed, then this shape's {@link redrawPath} should be overridden.\n *\n * @category Vertex Shapes\n */\nclass CylinderShape extends Shape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        /**\n         * Defines the maximum height of the top and bottom part of the cylinder shape.\n         */\n        this.maxHeight = 40;\n        /**\n         * Sets stroke tolerance to 0 for SVG.\n         */\n        this.svgStrokeTolerance = 0;\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Redirects to redrawPath for subclasses to work.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        c.translate(x, y);\n        c.begin();\n        this.redrawPath(c, x, y, w, h, false);\n        c.fillAndStroke();\n        if (!this.outline || !this.style || !(this.style.backgroundOutline ?? false)) {\n            c.setShadow(false);\n            c.begin();\n            this.redrawPath(c, x, y, w, h, true);\n            c.stroke();\n        }\n    }\n    /**\n     * Redirects to redrawPath for subclasses to work.\n     */\n    getCylinderSize(x, y, w, h) {\n        return Math.min(this.maxHeight, Math.round(h / 5));\n    }\n    /**\n     * Draws the path for this shape.\n     */\n    redrawPath(c, x, y, w, h, isForeground = false) {\n        const dy = this.getCylinderSize(x, y, w, h);\n        if ((isForeground && this.fill !== NONE) || (!isForeground && this.fill === NONE)) {\n            c.moveTo(0, dy);\n            c.curveTo(0, 2 * dy, w, 2 * dy, w, dy);\n            // Needs separate shapes for correct hit-detection\n            if (!isForeground) {\n                c.stroke();\n                c.begin();\n            }\n        }\n        if (!isForeground) {\n            c.moveTo(0, dy);\n            c.curveTo(0, -dy / 3, w, -dy / 3, w, dy);\n            c.lineTo(w, h - dy);\n            c.curveTo(w, h + dy / 3, 0, h + dy / 3, 0, h - dy);\n            c.close();\n        }\n    }\n}\nexport default CylinderShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport { NONE } from '../../../util/Constants.js';\n/**\n * Extends {@link Shape} to implement an actor shape.\n *\n * This shape is registered under `actor` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * If a custom shape with one filled area is needed, then this shape's {@link redrawPath} method should be overridden\n * like in the following example:\n *\n * ```typescript\n * class SampleShape extends ActorShape {\n *   redrawPath(c: AbstractCanvas2D, x: number, y: number, w: number, h: number) {\n *     path.moveTo(0, 0);\n *     path.lineTo(w, h);\n *     // ...\n *     path.close();\n *   }\n * }\n * ```\n *\n * @category Vertex Shapes\n */\nclass ActorShape extends Shape {\n    constructor(bounds = null, fill = NONE, stroke = NONE, strokeWidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Redirects to redrawPath for subclasses to work.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        c.translate(x, y);\n        c.begin();\n        this.redrawPath(c, x, y, w, h);\n        c.fillAndStroke();\n    }\n    /**\n     * Draws the path for this shape.\n     */\n    redrawPath(c, x, y, w, h) {\n        const width = w / 3;\n        c.moveTo(0, h);\n        c.curveTo(0, (3 * h) / 5, 0, (2 * h) / 5, w / 2, (2 * h) / 5);\n        c.curveTo(w / 2 - width, (2 * h) / 5, w / 2 - width, 0, w / 2, 0);\n        c.curveTo(w / 2 + width, 0, w / 2 + width, (2 * h) / 5, w / 2, (2 * h) / 5);\n        c.curveTo(w, (2 * h) / 5, w, (3 * h) / 5, w, h);\n        c.close();\n    }\n}\nexport default ActorShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Point from '../../geometry/Point.js';\nimport ActorShape from './ActorShape.js';\n/**\n * Implementation of the triangle shape.\n *\n * This shape is registered under `triangle` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass TriangleShape extends ActorShape {\n    constructor() {\n        super();\n    }\n    /**\n     * Adds roundable support.\n     * @returns {boolean}\n     */\n    isRoundable() {\n        return true;\n    }\n    /**\n     * Draws the path for this shape.\n     */\n    redrawPath(c, x, y, w, h) {\n        const arcSize = this.getBaseArcSize();\n        this.addPoints(c, [new Point(0, 0), new Point(w, 0.5 * h), new Point(0, h)], this.isRounded, arcSize, true);\n    }\n}\nexport default TriangleShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport ActorShape from './ActorShape.js';\nimport Point from '../../geometry/Point.js';\n/**\n * Implementation of the hexagon shape.\n *\n * This shape is registered under `hexagon` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass HexagonShape extends ActorShape {\n    constructor() {\n        super();\n    }\n    /**\n     * Draws the path for this shape.\n     */\n    redrawPath(c, x, y, w, h) {\n        const arcSize = this.getBaseArcSize();\n        this.addPoints(c, [\n            new Point(0.25 * w, 0),\n            new Point(0.75 * w, 0),\n            new Point(w, 0.5 * h),\n            new Point(0.75 * w, h),\n            new Point(0.25 * w, h),\n            new Point(0, 0.5 * h),\n        ], this.isRounded, arcSize, true);\n    }\n}\nexport default HexagonShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport ActorShape from './ActorShape.js';\n/**\n * Extends {@link ActorShape} to implement a cloud shape.\n *\n * This shape is registered under `cloud` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass CloudShape extends ActorShape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Draws the path for this shape.\n     */\n    redrawPath(c, x, y, w, h) {\n        c.moveTo(0.25 * w, 0.25 * h);\n        c.curveTo(0.05 * w, 0.25 * h, 0, 0.5 * h, 0.16 * w, 0.55 * h);\n        c.curveTo(0, 0.66 * h, 0.18 * w, 0.9 * h, 0.31 * w, 0.8 * h);\n        c.curveTo(0.4 * w, h, 0.7 * w, h, 0.8 * w, 0.8 * h);\n        c.curveTo(w, 0.8 * h, w, 0.6 * h, 0.875 * w, 0.5 * h);\n        c.curveTo(w, 0.3 * h, 0.8 * w, 0.1 * h, 0.625 * w, 0.2 * h);\n        c.curveTo(0.5 * w, 0.05 * h, 0.3 * w, 0.05 * h, 0.25 * w, 0.25 * h);\n        c.close();\n    }\n}\nexport default CloudShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\n/**\n * Extends {@link Shape} to implement a horizontal line shape.\n *\n * The shape is used to represent edges, not vertices.\n *\n * This shape is registered under `line` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Edge Shapes\n */\nclass LineShape extends Shape {\n    constructor(bounds, stroke, strokeWidth = 1, vertical = false) {\n        super();\n        this.bounds = bounds;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n        this.vertical = vertical;\n    }\n    /**\n     * Redirects to redrawPath for subclasses to work.\n     * @param {AbstractCanvas2D} c\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    paintVertexShape(c, x, y, w, h) {\n        c.begin();\n        if (this.vertical) {\n            const mid = x + w / 2;\n            c.moveTo(mid, y);\n            c.lineTo(mid, y + h);\n        }\n        else {\n            const mid = y + h / 2;\n            c.moveTo(x, mid);\n            c.lineTo(x + w, mid);\n        }\n        c.stroke();\n    }\n}\nexport default LineShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport { ARROW_SIZE, ARROW_SPACING, ARROW_WIDTH } from '../../../util/Constants.js';\n/**\n * Extends {@link Shape} to implement an arrow shape.\n *\n * The shape is used to represent edges, not vertices.\n *\n * This shape is registered under `arrow` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Edge Shapes\n */\nclass ArrowShape extends Shape {\n    constructor(points, fill, stroke, strokeWidth = 1, arrowWidth = ARROW_WIDTH, spacing = ARROW_SPACING, endSize = ARROW_SIZE) {\n        super();\n        this.points = points;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n        this.arrowWidth = arrowWidth;\n        this.spacing = spacing;\n        this.endSize = endSize;\n    }\n    /**\n     * Augments the bounding box with the edge width and markers.\n     */\n    augmentBoundingBox(bbox) {\n        super.augmentBoundingBox(bbox);\n        const w = Math.max(this.arrowWidth, this.endSize);\n        bbox.grow((w / 2 + this.strokeWidth) * this.scale);\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintEdgeShape(c, pts) {\n        // Geometry of arrow\n        const spacing = ARROW_SPACING;\n        const width = ARROW_WIDTH;\n        const arrow = ARROW_SIZE;\n        // Base vector (between end points)\n        const p0 = pts[0];\n        const pe = pts[pts.length - 1];\n        const dx = pe.x - p0.x;\n        const dy = pe.y - p0.y;\n        const dist = Math.sqrt(dx * dx + dy * dy);\n        const length = dist - 2 * spacing - arrow;\n        // Computes the norm and the inverse norm\n        const nx = dx / dist;\n        const ny = dy / dist;\n        const basex = length * nx;\n        const basey = length * ny;\n        const floorx = (width * ny) / 3;\n        const floory = (-width * nx) / 3;\n        // Computes points\n        const p0x = p0.x - floorx / 2 + spacing * nx;\n        const p0y = p0.y - floory / 2 + spacing * ny;\n        const p1x = p0x + floorx;\n        const p1y = p0y + floory;\n        const p2x = p1x + basex;\n        const p2y = p1y + basey;\n        const p3x = p2x + floorx;\n        const p3y = p2y + floory;\n        // p4 not necessary\n        const p5x = p3x - 3 * floorx;\n        const p5y = p3y - 3 * floory;\n        c.begin();\n        c.moveTo(p0x, p0y);\n        c.lineTo(p1x, p1y);\n        c.lineTo(p2x, p2y);\n        c.lineTo(p3x, p3y);\n        c.lineTo(pe.x - spacing * nx, pe.y - spacing * ny);\n        c.lineTo(p5x, p5y);\n        c.lineTo(p5x + floorx, p5y + floory);\n        c.close();\n        c.fillAndStroke();\n    }\n}\nexport default ArrowShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport { ARROW_SIZE, ARROW_SPACING, ARROW_WIDTH, NONE } from '../../../util/Constants.js';\nimport { relativeCcw } from '../../../util/mathUtils.js';\n/**\n * Extends {@link Shape} to implement a new rounded arrow shape with support for waypoints and double arrows.\n *\n * The shape is used to represent edges, not vertices.\n *\n * This shape is registered under `arrowConnector` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Edge Shapes\n */\nclass ArrowConnectorShape extends Shape {\n    constructor(points, fill, stroke, strokeWidth = 1, arrowWidth = ARROW_WIDTH, spacing = ARROW_SPACING, endSize = ARROW_SIZE / 5) {\n        super();\n        /**\n         * Allows to use the SVG bounding box in SVG.\n         * @defaultValue `false` for performance reasons.\n         */\n        this.useSvgBoundingBox = true;\n        this.points = points;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n        this.arrowWidth = arrowWidth;\n        this.arrowSpacing = spacing;\n        this.startSize = ARROW_SIZE / 5;\n        this.endSize = endSize;\n    }\n    /**\n     * Hook for subclassers.\n     */\n    isRoundable() {\n        return true;\n    }\n    /**\n     * Overrides mxShape to reset spacing.\n     */\n    resetStyles() {\n        super.resetStyles();\n        this.arrowSpacing = ARROW_SPACING;\n    }\n    /**\n     * Overrides apply to get smooth transition from default start- and endsize.\n     */\n    apply(state) {\n        super.apply(state);\n        if (this.style && this.style.startSize != null && this.style.endSize != null) {\n            this.startSize = this.style.startSize * 3;\n            this.endSize = this.style.endSize * 3;\n        }\n    }\n    /**\n     * Augments the bounding box with the edge width and markers.\n     */\n    augmentBoundingBox(bbox) {\n        super.augmentBoundingBox(bbox);\n        let w = this.getEdgeWidth();\n        if (this.isMarkerStart()) {\n            w = Math.max(w, this.getStartArrowWidth());\n        }\n        if (this.isMarkerEnd()) {\n            w = Math.max(w, this.getEndArrowWidth());\n        }\n        bbox.grow((w / 2 + this.strokeWidth) * this.scale);\n    }\n    /**\n     * Paints the line shape.\n     */\n    paintEdgeShape(c, pts) {\n        // Geometry of arrow\n        let strokeWidth = this.strokeWidth;\n        if (this.outline) {\n            strokeWidth = Math.max(1, this.style?.strokeWidth ?? 0);\n        }\n        const startWidth = this.getStartArrowWidth() + strokeWidth;\n        const endWidth = this.getEndArrowWidth() + strokeWidth;\n        const edgeWidth = this.outline\n            ? this.getEdgeWidth() + strokeWidth\n            : this.getEdgeWidth();\n        const openEnded = this.isOpenEnded();\n        const markerStart = this.isMarkerStart();\n        const markerEnd = this.isMarkerEnd();\n        const spacing = openEnded ? 0 : this.arrowSpacing + strokeWidth / 2;\n        const startSize = this.startSize + strokeWidth;\n        const endSize = this.endSize + strokeWidth;\n        const isRounded = this.isArrowRounded();\n        // Base vector (between first points)\n        const pe = pts[pts.length - 1];\n        // Finds first non-overlapping point\n        let i0 = 1;\n        while (i0 < pts.length - 1 && pts[i0].x === pts[0].x && pts[i0].y === pts[0].y) {\n            i0++;\n        }\n        const dx = pts[i0].x - pts[0].x;\n        const dy = pts[i0].y - pts[0].y;\n        const dist = Math.sqrt(dx * dx + dy * dy);\n        if (dist === 0) {\n            return;\n        }\n        // Computes the norm and the inverse norm\n        let nx = dx / dist;\n        let nx2;\n        let nx1 = nx;\n        let ny = dy / dist;\n        let ny2;\n        let ny1 = ny;\n        let orthx = edgeWidth * ny;\n        let orthy = -edgeWidth * nx;\n        // Stores the inbound function calls in reverse order in fns\n        const fns = [];\n        if (isRounded) {\n            c.setLineJoin('round');\n        }\n        else if (pts.length > 2) {\n            // Only mitre if there are waypoints\n            c.setMiterLimit(1.42);\n        }\n        c.begin();\n        const startNx = nx;\n        const startNy = ny;\n        if (markerStart && !openEnded) {\n            this.paintMarker(c, pts[0].x, pts[0].y, nx, ny, startSize, startWidth, edgeWidth, spacing, true);\n        }\n        else {\n            const outStartX = pts[0].x + orthx / 2 + spacing * nx;\n            const outStartY = pts[0].y + orthy / 2 + spacing * ny;\n            const inEndX = pts[0].x - orthx / 2 + spacing * nx;\n            const inEndY = pts[0].y - orthy / 2 + spacing * ny;\n            if (openEnded) {\n                c.moveTo(outStartX, outStartY);\n                fns.push(() => {\n                    c.lineTo(inEndX, inEndY);\n                });\n            }\n            else {\n                c.moveTo(inEndX, inEndY);\n                c.lineTo(outStartX, outStartY);\n            }\n        }\n        let dx1 = 0;\n        let dy1 = 0;\n        let dist1 = 0;\n        for (let i = 0; i < pts.length - 2; i += 1) {\n            // Work out in which direction the line is bending\n            const pos = relativeCcw(pts[i].x, pts[i].y, pts[i + 1].x, pts[i + 1].y, pts[i + 2].x, pts[i + 2].y);\n            dx1 = pts[i + 2].x - pts[i + 1].x;\n            dy1 = pts[i + 2].y - pts[i + 1].y;\n            dist1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);\n            if (dist1 !== 0) {\n                nx1 = dx1 / dist1;\n                ny1 = dy1 / dist1;\n                const tmp1 = nx * nx1 + ny * ny1;\n                const tmp = Math.max(Math.sqrt((tmp1 + 1) / 2), 0.04);\n                // Work out the normal orthogonal to the line through the control point and the edge sides intersection\n                nx2 = nx + nx1;\n                ny2 = ny + ny1;\n                const dist2 = Math.sqrt(nx2 * nx2 + ny2 * ny2);\n                if (dist2 !== 0) {\n                    nx2 /= dist2;\n                    ny2 /= dist2;\n                    // Higher strokewidths require a larger minimum bend, 0.35 covers all but the most extreme cases\n                    const strokeWidthFactor = Math.max(tmp, Math.min(this.strokeWidth / 200 + 0.04, 0.35));\n                    const angleFactor = pos !== 0 && isRounded\n                        ? Math.max(0.1, strokeWidthFactor)\n                        : Math.max(tmp, 0.06);\n                    const outX = pts[i + 1].x + (ny2 * edgeWidth) / 2 / angleFactor;\n                    const outY = pts[i + 1].y - (nx2 * edgeWidth) / 2 / angleFactor;\n                    const inX = pts[i + 1].x - (ny2 * edgeWidth) / 2 / angleFactor;\n                    const inY = pts[i + 1].y + (nx2 * edgeWidth) / 2 / angleFactor;\n                    if (pos === 0 || !isRounded) {\n                        // If the two segments are aligned, or if we're not drawing curved sections between segments\n                        // just draw straight to the intersection point\n                        c.lineTo(outX, outY);\n                        ((x, y) => {\n                            fns.push(() => {\n                                c.lineTo(x, y);\n                            });\n                        })(inX, inY);\n                    }\n                    else if (pos === -1) {\n                        const c1x = inX + ny * edgeWidth;\n                        const c1y = inY - nx * edgeWidth;\n                        const c2x = inX + ny1 * edgeWidth;\n                        const c2y = inY - nx1 * edgeWidth;\n                        c.lineTo(c1x, c1y);\n                        c.quadTo(outX, outY, c2x, c2y);\n                        ((x, y) => {\n                            fns.push(() => {\n                                c.lineTo(x, y);\n                            });\n                        })(inX, inY);\n                    }\n                    else {\n                        c.lineTo(outX, outY);\n                        ((x, y) => {\n                            const c1x = outX - ny * edgeWidth;\n                            const c1y = outY + nx * edgeWidth;\n                            const c2x = outX - ny1 * edgeWidth;\n                            const c2y = outY + nx1 * edgeWidth;\n                            fns.push(() => {\n                                c.quadTo(x, y, c1x, c1y);\n                            });\n                            fns.push(() => {\n                                c.lineTo(c2x, c2y);\n                            });\n                        })(inX, inY);\n                    }\n                    nx = nx1;\n                    ny = ny1;\n                }\n            }\n        }\n        orthx = edgeWidth * ny1;\n        orthy = -edgeWidth * nx1;\n        if (markerEnd && !openEnded) {\n            this.paintMarker(c, pe.x, pe.y, -nx, -ny, endSize, endWidth, edgeWidth, spacing, false);\n        }\n        else {\n            c.lineTo(pe.x - spacing * nx1 + orthx / 2, pe.y - spacing * ny1 + orthy / 2);\n            const inStartX = pe.x - spacing * nx1 - orthx / 2;\n            const inStartY = pe.y - spacing * ny1 - orthy / 2;\n            if (!openEnded) {\n                c.lineTo(inStartX, inStartY);\n            }\n            else {\n                c.moveTo(inStartX, inStartY);\n                fns.splice(0, 0, () => {\n                    c.moveTo(inStartX, inStartY);\n                });\n            }\n        }\n        for (let i = fns.length - 1; i >= 0; i--) {\n            fns[i]();\n        }\n        if (openEnded) {\n            c.end();\n            c.stroke();\n        }\n        else {\n            c.close();\n            c.fillAndStroke();\n        }\n        // Workaround for shadow on top of base arrow\n        c.setShadow(false);\n        // Need to redraw the markers without the low miter limit\n        c.setMiterLimit(4);\n        if (isRounded) {\n            c.setLineJoin('flat');\n        }\n        if (pts.length > 2) {\n            // Only to repaint markers if no waypoints\n            // Need to redraw the markers without the low miter limit\n            c.setMiterLimit(4);\n            if (markerStart && !openEnded) {\n                c.begin();\n                this.paintMarker(c, pts[0].x, pts[0].y, startNx, startNy, startSize, startWidth, edgeWidth, spacing, true);\n                c.stroke();\n                c.end();\n            }\n            if (markerEnd && !openEnded) {\n                c.begin();\n                this.paintMarker(c, pe.x, pe.y, -nx, -ny, endSize, endWidth, edgeWidth, spacing, true);\n                c.stroke();\n                c.end();\n            }\n        }\n    }\n    /**\n     * Paints the marker.\n     */\n    paintMarker(c, ptX, ptY, nx, ny, size, arrowWidth, edgeWidth, spacing, initialMove) {\n        const widthArrowRatio = edgeWidth / arrowWidth;\n        const orthx = (edgeWidth * ny) / 2;\n        const orthy = (-edgeWidth * nx) / 2;\n        const spaceX = (spacing + size) * nx;\n        const spaceY = (spacing + size) * ny;\n        if (initialMove) {\n            c.moveTo(ptX - orthx + spaceX, ptY - orthy + spaceY);\n        }\n        else {\n            c.lineTo(ptX - orthx + spaceX, ptY - orthy + spaceY);\n        }\n        c.lineTo(ptX - orthx / widthArrowRatio + spaceX, ptY - orthy / widthArrowRatio + spaceY);\n        c.lineTo(ptX + spacing * nx, ptY + spacing * ny);\n        c.lineTo(ptX + orthx / widthArrowRatio + spaceX, ptY + orthy / widthArrowRatio + spaceY);\n        c.lineTo(ptX + orthx + spaceX, ptY + orthy + spaceY);\n    }\n    /**\n     * @returns whether the arrow is rounded\n     */\n    isArrowRounded() {\n        return this.isRounded;\n    }\n    /**\n     * @returns the width of the start arrow\n     */\n    getStartArrowWidth() {\n        return ARROW_WIDTH;\n    }\n    /**\n     * @returns the width of the end arrow\n     */\n    getEndArrowWidth() {\n        return ARROW_WIDTH;\n    }\n    /**\n     * @returns the width of the body of the edge\n     */\n    getEdgeWidth() {\n        return ARROW_WIDTH / 3;\n    }\n    /**\n     * @returns whether the ends of the shape are drawn\n     */\n    isOpenEnded() {\n        return false;\n    }\n    /**\n     * @returns whether the start marker is drawn\n     */\n    isMarkerStart() {\n        return (this.style?.startArrow ?? NONE) !== NONE;\n    }\n    /**\n     * @returns whether the end marker is drawn\n     */\n    isMarkerEnd() {\n        return (this.style?.endArrow ?? NONE) !== NONE;\n    }\n}\nexport default ArrowConnectorShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../../geometry/Rectangle.js';\nimport Shape from '../Shape.js';\n/**\n * Extends {@link Shape} to implement a double ellipse shape.\n *\n * This shape is registered under `doubleEllipse` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * If a custom shape is needed to only fill the inner ellipse, then this shape's {@link paintVertexShape} method should be overridden\n * like in the following example:\n *\n * ```typescript\n * class SampleShape extends DoubleEllipseShape {\n *   paintVertexShape(c: AbstractCanvas2D, x: number, y: number, w: number, h: number) {\n *     c.ellipse(x, y, w, h);\n *     c.stroke();\n *\n *     const inset = this.style.margin ?? Math.min(3 + this.strokewidth, Math.min(w / 5, h / 5));\n *     x += inset;\n *     y += inset;\n *     w -= 2 * inset;\n *     h -= 2 * inset;\n *\n *     if (w > 0 && h > 0) {\n *       c.ellipse(x, y, w, h);\n *     }\n *\n *     c.fillAndStroke();\n *   }\n * }\n * ```\n *\n * @category Vertex Shapes\n */\nclass DoubleEllipseShape extends Shape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Paints the background.\n     */\n    paintBackground(c, x, y, w, h) {\n        c.ellipse(x, y, w, h);\n        c.fillAndStroke();\n    }\n    /**\n     * Paints the foreground.\n     */\n    paintForeground(c, x, y, w, h) {\n        if (!this.outline) {\n            const margin = this.style?.margin ?? Math.min(3 + this.strokeWidth, Math.min(w / 5, h / 5));\n            x += margin;\n            y += margin;\n            w -= 2 * margin;\n            h -= 2 * margin;\n            // FIXME: Rounding issues in IE8 standards mode (not in 1.x)\n            if (w > 0 && h > 0) {\n                c.ellipse(x, y, w, h);\n            }\n            c.stroke();\n        }\n    }\n    /**\n     * @returns the bounds for the label.\n     */\n    getLabelBounds(rect) {\n        const margin = this.style?.margin ??\n            Math.min(3 + this.strokeWidth, Math.min(rect.width / 5 / this.scale, rect.height / 5 / this.scale)) * this.scale;\n        return new Rectangle(rect.x + margin, rect.y + margin, rect.width - 2 * margin, rect.height - 2 * margin);\n    }\n}\nexport default DoubleEllipseShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Shape from '../Shape.js';\nimport Rectangle from '../../geometry/Rectangle.js';\nimport { DEFAULT_STARTSIZE, NONE, RECTANGLE_ROUNDING_FACTOR, } from '../../../util/Constants.js';\n/**\n * Extends {@link Shape} to implement a swimlane shape.\n *\n * This shape is registered under `swimlane` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * Use:\n * - {@link CellStateStyle.startSize} to define the size of the title region,\n * - {@link CellStateStyle.swimlaneFillColor} for the content area fill,\n * - {@link CellStateStyle.separatorColor} to draw an additional vertical separator,\n * - {@link CellStateStyle.swimlaneLine} to hide the line between the title region and the content area\n *\n * {@link CellStateStyle.horizontal} affects the orientation of this shape, not only its label.\n *\n * @category Vertex Shapes\n */\nclass SwimlaneShape extends Shape {\n    constructor(bounds, fill, stroke, strokeWidth = 1) {\n        super();\n        /**\n         * Default image width and image height if an image but no image width and image height are defined in the style.\n         * @default 16\n         */\n        this.imageSize = 16;\n        this.imageSrc = null;\n        this.bounds = bounds;\n        this.fill = fill;\n        this.stroke = stroke;\n        this.strokeWidth = strokeWidth;\n    }\n    /**\n     * Adds roundable support.\n     */\n    isRoundable(c, x, y, w, h) {\n        return true;\n    }\n    /**\n     * Returns the bounding box for the gradient box for this shape.\n     */\n    getTitleSize() {\n        return Math.max(0, this.style?.startSize ?? DEFAULT_STARTSIZE);\n    }\n    /**\n     * Returns the bounding box for the gradient box for this shape.\n     */\n    getLabelBounds(rect) {\n        const start = this.getTitleSize();\n        const bounds = new Rectangle(rect.x, rect.y, rect.width, rect.height);\n        const horizontal = this.isHorizontal();\n        const flipH = this.style?.flipH ?? false;\n        const flipV = this.style?.flipV ?? false;\n        // East is default\n        const shapeVertical = this.direction === 'north' || this.direction === 'south';\n        const realHorizontal = horizontal == !shapeVertical;\n        const realFlipH = !realHorizontal &&\n            flipH !== (this.direction === 'south' || this.direction === 'west');\n        const realFlipV = realHorizontal &&\n            flipV !== (this.direction === 'south' || this.direction === 'west');\n        // Shape is horizontal\n        if (!shapeVertical) {\n            const tmp = Math.min(bounds.height, start * this.scale);\n            if (realFlipH || realFlipV) {\n                bounds.y += bounds.height - tmp;\n            }\n            bounds.height = tmp;\n        }\n        else {\n            const tmp = Math.min(bounds.width, start * this.scale);\n            if (realFlipH || realFlipV) {\n                bounds.x += bounds.width - tmp;\n            }\n            bounds.width = tmp;\n        }\n        return bounds;\n    }\n    /**\n     * Returns the bounding box for the gradient box for this shape.\n     */\n    getGradientBounds(c, x, y, w, h) {\n        let start = this.getTitleSize();\n        if (this.isHorizontal()) {\n            start = Math.min(start, h);\n            return new Rectangle(x, y, w, start);\n        }\n        start = Math.min(start, w);\n        return new Rectangle(x, y, start, h);\n    }\n    /**\n     * Returns the arc size for the swimlane.\n     */\n    getSwimlaneArcSize(w, h, start) {\n        if (this.style?.absoluteArcSize) {\n            return Math.min(this.getBaseArcSize(), Math.min(h, w) / 2);\n        }\n        const roundingFactor = (this.style?.arcSize ?? RECTANGLE_ROUNDING_FACTOR * 100) / 100;\n        return start * roundingFactor * 3;\n    }\n    /**\n     * Paints the swimlane vertex shape.\n     */\n    isHorizontal() {\n        return this.style?.horizontal ?? true;\n    }\n    /**\n     * Paints the swimlane vertex shape.\n     */\n    paintVertexShape(c, x, y, w, h) {\n        let start = this.getTitleSize();\n        const fill = this.style?.swimlaneFillColor ?? NONE;\n        const swimlaneLine = this.style?.swimlaneLine ?? true;\n        let r = 0;\n        if (this.isHorizontal()) {\n            start = Math.min(start, h);\n        }\n        else {\n            start = Math.min(start, w);\n        }\n        c.translate(x, y);\n        if (!this.isRounded) {\n            this.paintSwimlane(c, x, y, w, h, start, fill, swimlaneLine);\n        }\n        else {\n            r = this.getSwimlaneArcSize(w, h, start);\n            r = Math.min((this.isHorizontal() ? h : w) - start, Math.min(start, r));\n            this.paintRoundedSwimlane(c, x, y, w, h, start, r, fill, swimlaneLine);\n        }\n        const sep = this.style?.separatorColor ?? NONE;\n        this.paintSeparator(c, x, y, w, h, start, sep);\n        if (this.imageSrc) {\n            const bounds = this.getImageBounds(x, y, w, h);\n            c.image(bounds.x - x, bounds.y - y, bounds.width, bounds.height, this.imageSrc, false, false, false);\n        }\n        if (this.glass) {\n            c.setShadow(false);\n            this.paintGlassEffect(c, 0, 0, w, start, r);\n        }\n    }\n    /**\n     * Paints the swimlane vertex shape.\n     */\n    paintSwimlane(c, x, y, w, h, start, fill, swimlaneLine) {\n        c.begin();\n        let events = true;\n        if (this.style && this.style.pointerEvents != null) {\n            events = this.style.pointerEvents;\n        }\n        if (!events && this.fill === NONE) {\n            c.pointerEvents = false;\n        }\n        if (this.isHorizontal()) {\n            c.moveTo(0, start);\n            c.lineTo(0, 0);\n            c.lineTo(w, 0);\n            c.lineTo(w, start);\n            c.fillAndStroke();\n            if (start < h) {\n                if (fill === NONE || !events) {\n                    c.pointerEvents = false;\n                }\n                if (fill !== NONE) {\n                    c.setFillColor(fill);\n                }\n                c.begin();\n                c.moveTo(0, start);\n                c.lineTo(0, h);\n                c.lineTo(w, h);\n                c.lineTo(w, start);\n                if (fill === NONE) {\n                    c.stroke();\n                }\n                else {\n                    c.fillAndStroke();\n                }\n            }\n        }\n        else {\n            c.moveTo(start, 0);\n            c.lineTo(0, 0);\n            c.lineTo(0, h);\n            c.lineTo(start, h);\n            c.fillAndStroke();\n            if (start < w) {\n                if (fill === NONE || !events) {\n                    c.pointerEvents = false;\n                }\n                if (fill !== NONE) {\n                    c.setFillColor(fill);\n                }\n                c.begin();\n                c.moveTo(start, 0);\n                c.lineTo(w, 0);\n                c.lineTo(w, h);\n                c.lineTo(start, h);\n                if (fill === NONE) {\n                    c.stroke();\n                }\n                else {\n                    c.fillAndStroke();\n                }\n            }\n        }\n        if (swimlaneLine) {\n            this.paintDivider(c, x, y, w, h, start, fill === NONE);\n        }\n    }\n    /**\n     * Paints the swimlane vertex shape.\n     */\n    paintRoundedSwimlane(c, x, y, w, h, start, r, fill, swimlaneLine) {\n        c.begin();\n        let events = true;\n        if (this.style && this.style.pointerEvents != null) {\n            events = this.style.pointerEvents;\n        }\n        if (!events && this.fill === NONE) {\n            c.pointerEvents = false;\n        }\n        if (this.isHorizontal()) {\n            c.moveTo(w, start);\n            c.lineTo(w, r);\n            c.quadTo(w, 0, w - Math.min(w / 2, r), 0);\n            c.lineTo(Math.min(w / 2, r), 0);\n            c.quadTo(0, 0, 0, r);\n            c.lineTo(0, start);\n            c.fillAndStroke();\n            if (start < h) {\n                if (fill === NONE || !events) {\n                    c.pointerEvents = false;\n                }\n                if (fill !== NONE) {\n                    c.setFillColor(fill);\n                }\n                c.begin();\n                c.moveTo(0, start);\n                c.lineTo(0, h - r);\n                c.quadTo(0, h, Math.min(w / 2, r), h);\n                c.lineTo(w - Math.min(w / 2, r), h);\n                c.quadTo(w, h, w, h - r);\n                c.lineTo(w, start);\n                if (fill === NONE) {\n                    c.stroke();\n                }\n                else {\n                    c.fillAndStroke();\n                }\n            }\n        }\n        else {\n            c.moveTo(start, 0);\n            c.lineTo(r, 0);\n            c.quadTo(0, 0, 0, Math.min(h / 2, r));\n            c.lineTo(0, h - Math.min(h / 2, r));\n            c.quadTo(0, h, r, h);\n            c.lineTo(start, h);\n            c.fillAndStroke();\n            if (start < w) {\n                if (fill === NONE || !events) {\n                    c.pointerEvents = false;\n                }\n                if (fill !== NONE) {\n                    c.setFillColor(fill);\n                }\n                c.begin();\n                c.moveTo(start, h);\n                c.lineTo(w - r, h);\n                c.quadTo(w, h, w, h - Math.min(h / 2, r));\n                c.lineTo(w, Math.min(h / 2, r));\n                c.quadTo(w, 0, w - r, 0);\n                c.lineTo(start, 0);\n                if (fill === NONE) {\n                    c.stroke();\n                }\n                else {\n                    c.fillAndStroke();\n                }\n            }\n        }\n        if (swimlaneLine) {\n            this.paintDivider(c, x, y, w, h, start, fill === NONE);\n        }\n    }\n    /**\n     * Paints the divider between swimlane title and content area.\n     */\n    paintDivider(c, x, y, w, h, start, shadow) {\n        if (!shadow) {\n            c.setShadow(false);\n        }\n        c.begin();\n        if (this.isHorizontal()) {\n            c.moveTo(0, start);\n            c.lineTo(w, start);\n        }\n        else {\n            c.moveTo(start, 0);\n            c.lineTo(start, h);\n        }\n        c.stroke();\n    }\n    /**\n     * Paints the vertical or horizontal separator line between swimlanes.\n     */\n    paintSeparator(c, x, y, w, h, start, color) {\n        if (color !== NONE) {\n            c.setStrokeColor(color);\n            c.setDashed(true);\n            c.begin();\n            if (this.isHorizontal()) {\n                c.moveTo(w, start);\n                c.lineTo(w, h);\n            }\n            else {\n                c.moveTo(start, 0);\n                c.lineTo(w, 0);\n            }\n            c.stroke();\n            c.setDashed(false);\n        }\n    }\n    /**\n     * Paints the swimlane vertex shape.\n     */\n    getImageBounds(x, y, w, h) {\n        if (this.isHorizontal()) {\n            return new Rectangle(x + w - this.imageSize, y, this.imageSize, this.imageSize);\n        }\n        return new Rectangle(x, y, this.imageSize, this.imageSize);\n    }\n}\nexport default SwimlaneShape;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Rectangle from '../../geometry/Rectangle.js';\nimport { DEFAULT_IMAGESIZE, NONE } from '../../../util/Constants.js';\nimport RectangleShape from './RectangleShape.js';\n/**\n * Extends {@link RectangleShape} to implement an image shape with a label.\n *\n * This shape is registered under `label` in {@link CellRenderer} when using {@link Graph} or calling {@link registerDefaultShapes}.\n *\n * @category Vertex Shapes\n */\nclass LabelShape extends RectangleShape {\n    /**\n     * Constructs a new label shape.\n     *\n     * @param bounds {@link Rectangle} that defines the bounds. This is stored in {@link bounds}.\n     * @param fill String that defines the fill color. This is stored in {@link fill}.\n     * @param stroke String that defines the stroke color. This is stored in {@link stroke}.\n     * @param strokeWidth Optional integer that defines the stroke width. Default is 1. This is stored in {@link strokeWidth}.\n     */\n    constructor(bounds, fill, stroke, strokeWidth) {\n        super(bounds, fill, stroke, strokeWidth);\n        /**\n         * Default width and height for the image.\n         * @default mxConstants.DEFAULT_IMAGESIZE\n         */\n        this.imageSize = DEFAULT_IMAGESIZE;\n        this.imageSrc = null;\n        /**\n         * Default value for image spacing\n         * @type {number}\n         * @default 2\n         */\n        this.spacing = 2;\n        /**\n         * Default width and height for the indicicator.\n         * @type {number}\n         * @default 10\n         */\n        this.indicatorSize = 10;\n        /**\n         * Default spacing between image and indicator\n         * @default 2\n         * @type {number}\n         */\n        this.indicatorSpacing = 2;\n        this.indicatorImageSrc = null;\n    }\n    /**\n     * Initializes the shape and the <indicator>.\n     */\n    init(container) {\n        super.init(container);\n        if (this.indicatorShape) {\n            this.indicator = new this.indicatorShape();\n            this.indicator.dialect = this.dialect;\n            this.indicator.init(this.node);\n        }\n    }\n    /**\n     * Reconfigures this shape. This will update the colors of the indicator\n     * and reconfigure it if required.\n     */\n    redraw() {\n        if (this.indicator) {\n            this.indicator.fill = this.indicatorColor;\n            this.indicator.stroke = this.indicatorStrokeColor;\n            this.indicator.gradient = this.indicatorGradientColor;\n            this.indicator.direction = this.indicatorDirection;\n            this.indicator.redraw();\n        }\n        super.redraw();\n    }\n    /**\n     * Returns true for non-rounded, non-rotated shapes with no glass gradient and\n     * no indicator shape.\n     */\n    isHtmlAllowed() {\n        return super.isHtmlAllowed() && this.indicatorColor === NONE && !!this.indicatorShape;\n    }\n    /**\n     * Generic background painting implementation.\n     * @param {mxAbstractCanvas2D} c\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    paintForeground(c, x, y, w, h) {\n        this.paintImage(c, x, y, w, h);\n        this.paintIndicator(c, x, y, w, h);\n        super.paintForeground(c, x, y, w, h);\n    }\n    /**\n     * Generic background painting implementation.\n     * @param {mxAbstractCanvas2D} c\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    paintImage(c, x, y, w, h) {\n        if (this.imageSrc) {\n            const bounds = this.getImageBounds(x, y, w, h);\n            c.image(bounds.x, bounds.y, bounds.width, bounds.height, this.imageSrc, false, false, false);\n        }\n    }\n    /**\n     * Generic background painting implementation.\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    getImageBounds(x, y, w, h) {\n        const align = this.style?.imageAlign ?? 'left';\n        const valign = this.style?.verticalAlign ?? 'middle';\n        const width = this.style?.imageWidth ?? DEFAULT_IMAGESIZE;\n        const height = this.style?.imageHeight ?? DEFAULT_IMAGESIZE;\n        const spacing = this.style?.spacing ?? this.spacing + 5;\n        if (align === 'center') {\n            x += (w - width) / 2;\n        }\n        else if (align === 'right') {\n            x += w - width - spacing;\n        } // default is left\n        else {\n            x += spacing;\n        }\n        if (valign === 'top') {\n            y += spacing;\n        }\n        else if (valign === 'bottom') {\n            y += h - height - spacing;\n        } // default is middle\n        else {\n            y += (h - height) / 2;\n        }\n        return new Rectangle(x, y, width, height);\n    }\n    /**\n     * Generic background painting implementation.\n     * @param {AbstractCanvas2D} c\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     */\n    paintIndicator(c, x, y, w, h) {\n        if (this.indicator) {\n            this.indicator.bounds = this.getIndicatorBounds(x, y, w, h);\n            this.indicator.paint(c);\n        }\n        else if (this.indicatorImageSrc) {\n            const bounds = this.getIndicatorBounds(x, y, w, h);\n            c.image(bounds.x, bounds.y, bounds.width, bounds.height, this.indicatorImageSrc, false, false, false);\n        }\n    }\n    /**\n     * Generic background painting implementation.\n     * @param {number} x\n     * @param {number} y\n     * @param {number} w\n     * @param {number} h\n     * @returns {Rectangle}\n     */\n    getIndicatorBounds(x, y, w, h) {\n        const align = this.style?.imageAlign ?? 'left';\n        const valign = this.style?.verticalAlign ?? 'middle';\n        const width = this.style?.indicatorWidth ?? this.indicatorSize;\n        const height = this.style?.indicatorHeight ?? this.indicatorSize;\n        const spacing = this.spacing + 5;\n        if (align === 'right') {\n            x += w - width - spacing;\n        }\n        else if (align === 'center') {\n            x += (w - width) / 2;\n        } // default is left\n        else {\n            x += spacing;\n        }\n        if (valign === 'bottom') {\n            y += h - height - spacing;\n        }\n        else if (valign === 'top') {\n            y += spacing;\n        } // default is middle\n        else {\n            y += (h - height) / 2;\n        }\n        return new Rectangle(x, y, width, height);\n    }\n    /**\n     * Generic background painting implementation.\n     */\n    redrawHtmlShape() {\n        super.redrawHtmlShape();\n        // Removes all children\n        while (this.node.hasChildNodes()) {\n            this.node.removeChild(this.node.lastChild);\n        }\n        if (this.imageSrc && this.bounds) {\n            const node = document.createElement('img');\n            node.style.position = 'relative';\n            node.setAttribute('border', '0');\n            const bounds = this.getImageBounds(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height);\n            bounds.x -= this.bounds.x;\n            bounds.y -= this.bounds.y;\n            node.style.left = `${Math.round(bounds.x)}px`;\n            node.style.top = `${Math.round(bounds.y)}px`;\n            node.style.width = `${Math.round(bounds.width)}px`;\n            node.style.height = `${Math.round(bounds.height)}px`;\n            node.src = this.imageSrc;\n            this.node.appendChild(node);\n        }\n    }\n}\nexport default LabelShape;\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { ShapeRegistry } from './ShapeRegistry.js';\nimport RectangleShape from './node/RectangleShape.js';\nimport EllipseShape from './node/EllipseShape.js';\nimport RhombusShape from './node/RhombusShape.js';\nimport CylinderShape from './node/CylinderShape.js';\nimport ConnectorShape from './edge/ConnectorShape.js';\nimport ActorShape from './node/ActorShape.js';\nimport TriangleShape from './node/TriangleShape.js';\nimport HexagonShape from './node/HexagonShape.js';\nimport CloudShape from './node/CloudShape.js';\nimport LineShape from './edge/LineShape.js';\nimport ArrowShape from './edge/ArrowShape.js';\nimport ArrowConnectorShape from './edge/ArrowConnectorShape.js';\nimport DoubleEllipseShape from './node/DoubleEllipseShape.js';\nimport SwimlaneShape from './node/SwimlaneShape.js';\nimport ImageShape from './node/ImageShape.js';\nimport LabelShape from './node/LabelShape.js';\nlet isDefaultElementsRegistered = false;\n/**\n * Register default builtin shapes into {@link CellRenderer}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport function registerDefaultShapes() {\n    if (!isDefaultElementsRegistered) {\n        const shapesToRegister = [\n            ['actor', ActorShape],\n            ['arrow', ArrowShape],\n            ['arrowConnector', ArrowConnectorShape],\n            ['cloud', CloudShape],\n            ['connector', ConnectorShape],\n            ['cylinder', CylinderShape],\n            ['doubleEllipse', DoubleEllipseShape],\n            ['ellipse', EllipseShape],\n            ['hexagon', HexagonShape],\n            ['image', ImageShape],\n            ['label', LabelShape],\n            ['line', LineShape],\n            ['rectangle', RectangleShape],\n            ['rhombus', RhombusShape],\n            ['swimlane', SwimlaneShape],\n            ['triangle', TriangleShape],\n        ];\n        for (const [shapeName, shapeClass] of shapesToRegister) {\n            ShapeRegistry.add(shapeName, shapeClass);\n        }\n        isDefaultElementsRegistered = true;\n    }\n}\n/**\n * Unregister all shapes from {@link ShapeRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport function unregisterAllShapes() {\n    ShapeRegistry.clear();\n    isDefaultElementsRegistered = false;\n}\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { EdgeStyle, EdgeMarker, Perimeter } from './builtin-style-elements.js';\nimport { EdgeStyleRegistry } from './edge/EdgeStyleRegistry.js';\nimport { EdgeMarkerRegistry } from './marker/EdgeMarkerRegistry.js';\nimport { PerimeterRegistry } from './perimeter/PerimeterRegistry.js';\nlet isDefaultEdgeStylesRegistered = false;\n/**\n * Register default builtin {@link EdgeStyle}s in {@link EdgeStyleRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport const registerDefaultEdgeStyles = () => {\n    if (!isDefaultEdgeStylesRegistered) {\n        const edgeStylesToRegister = [\n            ['elbowEdgeStyle', EdgeStyle.ElbowConnector, { handlerKind: 'elbow' }],\n            ['entityRelationEdgeStyle', EdgeStyle.EntityRelation, {}],\n            ['loopEdgeStyle', EdgeStyle.Loop, { handlerKind: 'elbow', isOrthogonal: false }],\n            ['manhattanEdgeStyle', EdgeStyle.ManhattanConnector, { handlerKind: 'segment' }],\n            ['orthogonalEdgeStyle', EdgeStyle.OrthConnector, { handlerKind: 'segment' }],\n            ['segmentEdgeStyle', EdgeStyle.SegmentConnector, { handlerKind: 'segment' }],\n            ['sideToSideEdgeStyle', EdgeStyle.SideToSide, { handlerKind: 'elbow' }],\n            ['topToBottomEdgeStyle', EdgeStyle.TopToBottom, { handlerKind: 'elbow' }],\n        ];\n        for (const [name, edgeStyle, metadata] of edgeStylesToRegister) {\n            EdgeStyleRegistry.add(name, edgeStyle, {\n                ...metadata,\n                // most edge styles registered here are orthogonal, so set to true by default to avoid to duplicate the configuration code\n                isOrthogonal: metadata.isOrthogonal ?? true,\n            });\n        }\n        isDefaultEdgeStylesRegistered = true;\n    }\n};\nlet isDefaultPerimetersRegistered = false;\n/**\n * Register default builtin {@link Perimeter}s in {@link PerimeterRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport const registerDefaultPerimeters = () => {\n    if (!isDefaultPerimetersRegistered) {\n        const perimetersToRegister = [\n            ['ellipsePerimeter', Perimeter.EllipsePerimeter],\n            ['hexagonPerimeter', Perimeter.HexagonPerimeter],\n            ['rectanglePerimeter', Perimeter.RectanglePerimeter],\n            ['rhombusPerimeter', Perimeter.RhombusPerimeter],\n            ['trianglePerimeter', Perimeter.TrianglePerimeter],\n        ];\n        for (const [name, perimeter] of perimetersToRegister) {\n            PerimeterRegistry.add(name, perimeter);\n        }\n        isDefaultPerimetersRegistered = true;\n    }\n};\n/**\n * Unregister all {@link EdgeStyle}s and {@link Perimeter}s from their registries.\n *\n * @see unregisterAllEdgeStyles\n * @see unregisterAllPerimeters\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport const unregisterAllEdgeStylesAndPerimeters = () => {\n    unregisterAllEdgeStyles();\n    unregisterAllPerimeters();\n};\n/**\n * Unregister all {@link EdgeStyle}s from {@link EdgeStyleRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.20.0\n */\nexport const unregisterAllEdgeStyles = () => {\n    EdgeStyleRegistry.clear();\n    isDefaultEdgeStylesRegistered = false;\n};\n/**\n * Unregister all {@link Perimeter}s from {@link PerimeterRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.20.0\n */\nexport const unregisterAllPerimeters = () => {\n    PerimeterRegistry.clear();\n    isDefaultPerimetersRegistered = false;\n};\nlet isDefaultMarkersRegistered = false;\n/**\n *\n * Register default builtin {@link MarkerFactoryFunction}s in {@link EdgeMarkerRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport const registerDefaultEdgeMarkers = () => {\n    if (!isDefaultMarkersRegistered) {\n        const markersToRegister = [\n            ['classic', EdgeMarker.createArrow(2)],\n            ['classicThin', EdgeMarker.createArrow(3)],\n            ['block', EdgeMarker.createArrow(2)],\n            ['blockThin', EdgeMarker.createArrow(3)],\n            ['open', EdgeMarker.createOpenArrow(2)],\n            ['openThin', EdgeMarker.createOpenArrow(3)],\n            ['oval', EdgeMarker.oval],\n            ['diamond', EdgeMarker.diamond],\n            ['diamondThin', EdgeMarker.diamond],\n        ];\n        for (const [type, factory] of markersToRegister) {\n            EdgeMarkerRegistry.add(type, factory);\n        }\n        isDefaultMarkersRegistered = true;\n    }\n};\n/**\n * Unregister all {@link MarkerFactoryFunction}s from {@link EdgeMarkerRegistry}.\n *\n * @category Configuration\n * @category Style\n * @since 0.18.0\n */\nexport const unregisterAllEdgeMarkers = () => {\n    EdgeMarkerRegistry.clear();\n    isDefaultMarkersRegistered = false;\n};\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { getAlignmentAsPoint, setPrefixedStyle } from '../../util/styleUtils.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Client from '../../Client.js';\nimport { ABSOLUTE_LINE_HEIGHT, DEFAULT_FONTFAMILY, DEFAULT_FONTSIZE, DEFAULT_TEXT_DIRECTION, FONT_STYLE_MASK, LINE_HEIGHT, NONE, WORD_WRAP, } from '../../util/Constants.js';\nimport TextShape from '../shape/node/TextShape.js';\nimport { clearSelection, extractTextWithWhitespace, isNode, } from '../../util/domUtils.js';\nimport { htmlEntities, replaceTrailingNewlines } from '../../util/StringUtils.js';\nimport { getSource, isConsumed, isControlDown, isMetaDown, isShiftDown, } from '../../util/EventUtils.js';\nimport { matchBinaryMask } from '../../internal/utils.js';\n/**\n * In-place editor for the graph.\n *\n * To control this editor, use:\n * - {@link AbstractGraph.invokesStopCellEditing}\n * - {@link AbstractGraph.enterStopsCellEditing}\n * - {@link AbstractGraph.escapeEnabled}\n *\n * If {@link AbstractGraph.enterStopsCellEditing} is `true` then ctrl-enter or shift-enter can be used to create a linefeed.\n *\n * The F2 (accept change) and escape keys (undo change) can always be used to stop editing.\n *\n * To customize the location of the textbox in the graph, override {@link getEditorBounds} as follows:\n *\n * ```javascript\n * graph.cellEditor.getEditorBounds = (state) => {\n *   const result = super.getEditorBounds(state);\n *\n *   if (this.graph.getDataModel().isEdge(state.cell)) {\n *     result.x = state.getCenterX() - result.width / 2;\n *     result.y = state.getCenterY() - result.height / 2;\n *   }\n *\n *   return result;\n * };\n * ```\n *\n * Note that this hook is only called if {@link autoSize} is `false`.\n * If {@link autoSize} is `true`, then {@link Shape.getLabelBounds} is used to compute the current bounds of the textbox.\n *\n * The textarea uses the `mxCellEditor` CSS class. You can modify this class in your custom CSS.\n\n * Example:\n *\n * To only allow numeric input in the in-place editor, use the following code.\n *\n * ```javascript\n * const text = graph.cellEditor.textarea;\n *\n * InternalEvent.addListener(text, 'keydown', function (evt) {\n *   if (!(evt.keyCode >= 48 && evt.keyCode <= 57) &&\n *       !(evt.keyCode >= 96 && evt.keyCode <= 105)) {\n *     InternalEvent.consume(evt);\n *   }\n * });\n * ```\n *\n * ### Placeholder\n *\n * To implement a placeholder for cells without a label, use the {@link emptyLabelText} variable.\n *\n *\n * ### Resize the textarea\n *\n * Resize of the textarea is disabled by default.\n * If you want to enable this feature extend {@link init} and set `this.textarea.style.resize = ''`.\n *\n *\n * ### Editing on key press\n *\n * To start editing on a key press event, the container of the graph\n * should have focus or a focusable parent should be used to add the\n * key press handler as follows.\n *\n * ```javascript\n * InternalEvent.addListener(graph.container, 'keypress', (evt) => {\n *   if (!graph.isEditing() && !graph.isSelectionEmpty() && evt.which !== 0\n *       && !eventUtils.isAltDown(evt)\n *       && !eventUtils.isControlDown(evt)\n *       && !eventUtils.isMetaDown(evt)) {\n *     graph.startEditing();\n *\n *     if (Client.IS_FF) {\n *       graph.cellEditor.textarea.value = String.fromCharCode(evt.which);\n *     }\n *   }\n * });\n * ```\n *\n * To allow focus for a DIV, and hence to receive key press events, some browsers require it to have a valid tabindex attribute.\n * In this case the following code may be used to keep the container focused.\n *\n * ```javascript\n * const graphFireMouseEvent = graph.fireMouseEvent;\n * graph.fireMouseEvent = (evtName, me, sender) => {\n *   if (evtName == mxEvent.MOUSE_DOWN) {\n *     this.container.focus();\n *   }\n *\n *   graphFireMouseEvent.apply(this, [evtName, me, sender]);\n * };\n * ```\n *\n * @category Plugin\n */\nclass CellEditorHandler {\n    constructor(graph) {\n        this.clearOnChange = false;\n        this.bounds = null;\n        this.resizeThread = null;\n        this.textDirection = null;\n        /**\n         * Holds the DIV that is used for text editing. Note that this may be null before the first\n         * edit. Instantiated in <init>.\n         */\n        this.textarea = null;\n        /**\n         * Reference to the <Cell> that is currently being edited.\n         */\n        this.editingCell = null;\n        /**\n         * Reference to the event that was used to start editing.\n         */\n        this.trigger = null;\n        /**\n         * Specifies if the label has been modified.\n         */\n        this.modified = false;\n        /**\n         * Specifies if the textarea should be resized while the text is being edited.\n         * Default is true.\n         */\n        this.autoSize = true;\n        /**\n         * Specifies if the text should be selected when editing starts. Default is\n         * true.\n         */\n        this.selectText = true;\n        /**\n         * Text to be displayed for empty labels. Default is '' or '<br>' in Firefox as\n         * a workaround for the missing cursor bug for empty content editable. This can\n         * be set to eg. \"[Type Here]\" to easier visualize editing of empty labels. The\n         * value is only displayed before the first keystroke and is never used as the\n         * actual editing value.\n         */\n        this.emptyLabelText = Client.IS_FF ? '<br>' : '';\n        /**\n         * If true, pressing the escape key will stop editing and not accept the new\n         * value. Change this to false to accept the new value on escape, and cancel\n         * editing on Shift+Escape instead. Default is true.\n         */\n        this.escapeCancelsEditing = true;\n        /**\n         * Reference to the label DOM node that has been hidden.\n         */\n        this.textNode = null;\n        /**\n         * Specifies the zIndex for the textarea. Default is 5.\n         */\n        this.zIndex = 5;\n        /**\n         * Defines the minimum width and height to be used in <resize>. Default is 0x20px.\n         */\n        this.minResize = new Rectangle(0, 20);\n        /**\n         * Correction factor for word wrapping width. Default is 2 in quirks, 0 in IE\n         * 11 and 1 in all other browsers and modes.\n         */\n        // wordWrapPadding: 2 | 1 | 0;\n        this.wordWrapPadding = 0;\n        /**\n         * If <focusLost> should be called if <textarea> loses the focus. Default is false.\n         */\n        this.blurEnabled = false;\n        /**\n         * Holds the initial editing value to check if the current value was modified.\n         */\n        this.initialValue = null;\n        /**\n         * Holds the current temporary horizontal alignment for the cell style. If this\n         * is modified then the current text alignment is changed and the cell style is\n         * updated when the value is applied.\n         */\n        this.align = null;\n        this.graph = graph;\n        // Stops editing after zoom changes\n        this.zoomHandler = () => {\n            if (this.graph.isEditing()) {\n                this.resize();\n            }\n        };\n        // Handling of deleted cells while editing\n        this.changeHandler = (_sender) => {\n            if (this.editingCell && !this.graph.getView().getState(this.editingCell, false)) {\n                this.stopEditing(true);\n            }\n        };\n        this.graph.getView().addListener(InternalEvent.SCALE, this.zoomHandler);\n        this.graph.getView().addListener(InternalEvent.SCALE_AND_TRANSLATE, this.zoomHandler);\n        this.graph.getDataModel().addListener(InternalEvent.CHANGE, this.changeHandler);\n    }\n    /**\n     * Creates the {@link textarea} and installs the event listeners. The key handler\n     * updates the {@link modified} state.\n     */\n    init() {\n        this.textarea = document.createElement('div');\n        this.textarea.className = 'mxCellEditor mxPlainTextEditor';\n        this.textarea.contentEditable = String(true);\n        // Workaround for selection outside DIV if height is 0\n        if (Client.IS_GC) {\n            this.textarea.style.minHeight = '1em';\n        }\n        this.textarea.style.position = 'absolute';\n        this.installListeners(this.textarea);\n    }\n    /**\n     * Called in <stopEditing> if cancel is false to invoke {@link AbstractGraph.labelChanged}.\n     */\n    applyValue(state, value) {\n        this.graph.labelChanged(state.cell, value, this.trigger);\n    }\n    /**\n     * Sets the temporary horizontal alignment for the current editing session.\n     */\n    setAlign(align) {\n        if (this.textarea) {\n            this.textarea.style.textAlign = align;\n        }\n        this.align = align;\n        this.resize();\n    }\n    /**\n     * Gets the initial editing value for the given cell.\n     */\n    getInitialValue(state, trigger) {\n        let result = htmlEntities(this.graph.getEditingValue(state.cell, trigger), false);\n        result = replaceTrailingNewlines(result, '<div><br></div>');\n        return result.replace(/\\n/g, '<br>');\n    }\n    /**\n     * Returns the current editing value.\n     */\n    getCurrentValue(state) {\n        if (!this.textarea)\n            return null;\n        return extractTextWithWhitespace(Array.from(this.textarea.childNodes));\n    }\n    /**\n     * Returns true if <escapeCancelsEditing> is true and shift, control and meta\n     * are not pressed.\n     */\n    // isCancelEditingKeyEvent(evt: Event): boolean;\n    isCancelEditingKeyEvent(evt) {\n        return (this.escapeCancelsEditing ||\n            isShiftDown(evt) ||\n            isControlDown(evt) ||\n            isMetaDown(evt));\n    }\n    /**\n     * Installs listeners for focus, change and standard key event handling.\n     */\n    // installListeners(elt: Element): void;\n    installListeners(elt) {\n        // Applies value if text is dragged\n        // LATER: Gesture mouse events ignored for starting move\n        InternalEvent.addListener(elt, 'dragstart', (evt) => {\n            this.graph.stopEditing(false);\n            InternalEvent.consume(evt);\n        });\n        // Applies value if focus is lost\n        InternalEvent.addListener(elt, 'blur', (evt) => {\n            if (this.blurEnabled) {\n                this.focusLost();\n            }\n        });\n        // Updates modified state and handles placeholder text\n        InternalEvent.addListener(elt, 'keydown', (evt) => {\n            if (!isConsumed(evt)) {\n                if (this.isStopEditingEvent(evt)) {\n                    this.graph.stopEditing(false);\n                    InternalEvent.consume(evt);\n                }\n                else if (evt.keyCode === 27 /* Escape */) {\n                    this.graph.stopEditing(this.isCancelEditingKeyEvent(evt));\n                    InternalEvent.consume(evt);\n                }\n            }\n        });\n        // Keypress only fires if printable key was pressed and handles removing the empty placeholder\n        const keypressHandler = (evt) => {\n            if (this.editingCell != null) {\n                // Clears the initial empty label on the first keystroke\n                // and workaround for FF which fires keypress for delete and backspace\n                if (this.clearOnChange &&\n                    elt.innerHTML === this.getEmptyLabelText() &&\n                    (!Client.IS_FF ||\n                        (evt.keyCode !== 8 /* Backspace */ && evt.keyCode !== 46)) /* Delete */) {\n                    this.clearOnChange = false;\n                    elt.innerHTML = '';\n                }\n            }\n        };\n        InternalEvent.addListener(elt, 'keypress', keypressHandler);\n        InternalEvent.addListener(elt, 'paste', keypressHandler);\n        // Handler for updating the empty label text value after a change\n        const keyupHandler = (evt) => {\n            if (this.editingCell != null) {\n                // Uses an optional text value for sempty labels which is cleared\n                // when the first keystroke appears. This makes it easier to see\n                // that a label is being edited even if the label is empty.\n                // In Safari and FF, an empty text is represented by <BR> which isn't enough to force a valid size\n                const textarea = this.textarea;\n                if (textarea.innerHTML.length === 0 || textarea.innerHTML === '<br>') {\n                    textarea.innerHTML = this.getEmptyLabelText();\n                    this.clearOnChange = textarea.innerHTML.length > 0;\n                }\n                else {\n                    this.clearOnChange = false;\n                }\n            }\n        };\n        InternalEvent.addListener(elt, 'input', keyupHandler);\n        InternalEvent.addListener(elt, 'cut', keyupHandler);\n        InternalEvent.addListener(elt, 'paste', keyupHandler);\n        // Adds automatic resizing of the textbox while typing using input, keyup and/or DOM change events\n        const evtName = 'input';\n        const resizeHandler = (evt) => {\n            if (this.editingCell != null && this.autoSize && !isConsumed(evt)) {\n                // Asynchronous is needed for keydown and shows better results for input events overall\n                // (ie non-blocking and cases where the offsetWidth/-Height was wrong at this time)\n                if (this.resizeThread != null) {\n                    window.clearTimeout(this.resizeThread);\n                }\n                this.resizeThread = window.setTimeout(() => {\n                    this.resizeThread = null;\n                    this.resize();\n                }, 0);\n            }\n        };\n        InternalEvent.addListener(elt, evtName, resizeHandler);\n        InternalEvent.addListener(window, 'resize', resizeHandler);\n        InternalEvent.addListener(elt, 'cut', resizeHandler);\n        InternalEvent.addListener(elt, 'paste', resizeHandler);\n    }\n    /**\n     * Returns true if the given keydown event should stop cell editing. This\n     * returns true if F2 is pressed of if {@link AbstractGraph.enterStopsCellEditing} is true\n     * and enter is pressed without control or shift.\n     */\n    isStopEditingEvent(evt) {\n        return (evt.keyCode === 113 /* F2 */ ||\n            (this.graph.isEnterStopsCellEditing() &&\n                evt.keyCode === 13 /* Enter */ &&\n                !isControlDown(evt) &&\n                !isShiftDown(evt)));\n    }\n    /**\n     * Returns true if this editor is the source for the given native event.\n     */\n    isEventSource(evt) {\n        return getSource(evt) === this.textarea;\n    }\n    /**\n     * Returns {@link odified}.\n     */\n    resize() {\n        const state = this.editingCell\n            ? this.graph.getView().getState(this.editingCell)\n            : null;\n        if (!state) {\n            this.stopEditing(true);\n        }\n        else if (this.textarea != null) {\n            const isEdge = state.cell.isEdge();\n            const { scale } = this.graph.getView();\n            let m = null;\n            if (!this.autoSize || state.style.overflow === 'fill') {\n                // Specifies the bounds of the editor box\n                this.bounds = this.getEditorBounds(state);\n                this.textarea.style.width = `${Math.round(this.bounds.width / scale)}px`;\n                this.textarea.style.height = `${Math.round(this.bounds.height / scale)}px`;\n                // FIXME: Offset when scaled\n                this.textarea.style.left = `${Math.max(0, Math.round(this.bounds.x + 1))}px`;\n                this.textarea.style.top = `${Math.max(0, Math.round(this.bounds.y + 1))}px`;\n                // Installs native word wrapping and avoids word wrap for empty label placeholder\n                if (this.graph.isWrapping(state.cell) &&\n                    (this.bounds.width >= 2 || this.bounds.height >= 2) &&\n                    this.textarea.innerHTML !== this.getEmptyLabelText()) {\n                    this.textarea.style.wordWrap = WORD_WRAP;\n                    this.textarea.style.whiteSpace = 'normal';\n                    if (state.style.overflow !== 'fill') {\n                        this.textarea.style.width = `${Math.round(this.bounds.width / scale) + this.wordWrapPadding}px`;\n                    }\n                }\n                else {\n                    this.textarea.style.whiteSpace = 'nowrap';\n                    if (state.style.overflow !== 'fill') {\n                        this.textarea.style.width = '';\n                    }\n                }\n            }\n            else {\n                const lw = state.style.labelWidth ?? null;\n                m = state.text != null && this.align == null ? state.text.margin : null;\n                if (m == null) {\n                    m = getAlignmentAsPoint(this.align ?? state.style.align ?? 'center', state.style.verticalAlign ?? 'middle');\n                }\n                if (isEdge) {\n                    this.bounds = new Rectangle(state.absoluteOffset.x, state.absoluteOffset.y, 0, 0);\n                    if (lw != null) {\n                        const tmp = (lw + 2) * scale;\n                        this.bounds.width = tmp;\n                        this.bounds.x += m.x * tmp;\n                    }\n                }\n                else {\n                    let bounds = Rectangle.fromRectangle(state);\n                    let hpos = state.style.labelPosition ?? 'center';\n                    let vpos = state.style.verticalLabelPosition ?? 'middle';\n                    bounds =\n                        state.shape != null && hpos === 'center' && vpos === 'middle'\n                            ? state.shape.getLabelBounds(bounds)\n                            : bounds;\n                    if (lw != null) {\n                        bounds.width = lw * scale;\n                    }\n                    if (!state.view.graph.cellRenderer.legacySpacing ||\n                        state.style.overflow !== 'width') {\n                        // @ts-ignore\n                        const dummy = new TextShape(); // FIXME!!!! ===================================================================================================\n                        const spacing = (state.style.spacing ?? 2) * scale;\n                        const spacingTop = ((state.style.spacingTop ?? 0) + dummy.baseSpacingTop) * scale + spacing;\n                        const spacingRight = ((state.style.spacingRight ?? 0) + dummy.baseSpacingRight) * scale +\n                            spacing;\n                        const spacingBottom = ((state.style.spacingBottom ?? 0) + dummy.baseSpacingBottom) * scale +\n                            spacing;\n                        const spacingLeft = ((state.style.spacingLeft ?? 0) + dummy.baseSpacingLeft) * scale + spacing;\n                        hpos =\n                            state.style.labelPosition != null ? state.style.labelPosition : 'center';\n                        vpos =\n                            state.style.verticalLabelPosition != null\n                                ? state.style.verticalLabelPosition\n                                : 'middle';\n                        bounds = new Rectangle(bounds.x + spacingLeft, bounds.y + spacingTop, bounds.width -\n                            (hpos === 'center' && lw == null ? spacingLeft + spacingRight : 0), bounds.height - (vpos === 'middle' ? spacingTop + spacingBottom : 0));\n                    }\n                    this.bounds = new Rectangle(bounds.x + state.absoluteOffset.x, bounds.y + state.absoluteOffset.y, bounds.width, bounds.height);\n                }\n                // Needed for word wrap inside text blocks with oversize lines to match the final result where\n                // the width of the longest line is used as the reference for text alignment in the cell\n                // TODO: Fix word wrapping preview for edge labels in helloworld.html\n                if (this.graph.isWrapping(state.cell) &&\n                    (this.bounds.width >= 2 || this.bounds.height >= 2) &&\n                    this.textarea.innerHTML !== this.getEmptyLabelText()) {\n                    this.textarea.style.wordWrap = WORD_WRAP;\n                    this.textarea.style.whiteSpace = 'normal';\n                    // Forces automatic reflow if text is removed from an oversize label and normal word wrap\n                    const tmp = Math.round(this.bounds.width / scale) + this.wordWrapPadding;\n                    if (this.textarea.style.position !== 'relative') {\n                        this.textarea.style.width = `${tmp}px`;\n                        if (this.textarea.scrollWidth > tmp) {\n                            this.textarea.style.width = `${this.textarea.scrollWidth}px`;\n                        }\n                    }\n                    else {\n                        this.textarea.style.maxWidth = `${tmp}px`;\n                    }\n                }\n                else {\n                    // KNOWN: Trailing cursor in IE9 quirks mode is not visible\n                    this.textarea.style.whiteSpace = 'nowrap';\n                    this.textarea.style.width = '';\n                }\n                const ow = this.textarea.scrollWidth;\n                const oh = this.textarea.scrollHeight;\n                // TODO: Update CSS width and height if smaller than minResize or remove minResize\n                // if (this.minResize != null)\n                // {\n                //  ow = Math.max(ow, this.minResize.width);\n                //  oh = Math.max(oh, this.minResize.height);\n                // }\n                // LATER: Keep in visible area, add fine tuning for pixel precision\n                this.textarea.style.left = `${Math.max(0, Math.round(this.bounds.x - m.x * (this.bounds.width - 2)) + 1)}px`;\n                this.textarea.style.top = `${Math.max(0, Math.round(this.bounds.y - m.y * (this.bounds.height - 4) + (m.y === -1 ? 3 : 0)) + 1)}px`;\n            }\n            setPrefixedStyle(this.textarea.style, 'transformOrigin', '0px 0px');\n            setPrefixedStyle(this.textarea.style, 'transform', `scale(${scale},${scale})${m == null ? '' : ` translate(${m.x * 100}%,${m.y * 100}%)`}`);\n        }\n    }\n    /**\n     * Called if the textarea has lost focus.\n     */\n    focusLost() {\n        this.stopEditing(!this.graph.isInvokesStopCellEditing());\n    }\n    /**\n     * Returns the background color for the in-place editor. This implementation\n     * always returns NONE.\n     */\n    getBackgroundColor(state) {\n        return NONE;\n    }\n    /**\n     * Starts the editor for the given cell.\n     *\n     * @param cell <Cell> to start editing.\n     * @param trigger Optional mouse event that triggered the editor.\n     */\n    startEditing(cell, trigger = null) {\n        this.stopEditing(true);\n        this.align = null;\n        // Creates new textarea instance\n        if (this.textarea == null) {\n            this.init();\n        }\n        const tooltipHandler = this.graph.getPlugin('TooltipHandler');\n        tooltipHandler?.hideTooltip();\n        const state = this.graph.getView().getState(cell);\n        if (state) {\n            // Configures the style of the in-place editor\n            // Notice that the logic here is duplicated with styleUtils.getSizeForString\n            const stateStyle = state.style;\n            const size = stateStyle.fontSize ?? DEFAULT_FONTSIZE;\n            const family = stateStyle.fontFamily ?? DEFAULT_FONTFAMILY;\n            const color = stateStyle.fontColor ?? 'black';\n            const align = stateStyle.align ?? 'left';\n            const fontStyle = stateStyle.fontStyle ?? 0;\n            const bold = matchBinaryMask(fontStyle, FONT_STYLE_MASK.BOLD);\n            const italic = matchBinaryMask(fontStyle, FONT_STYLE_MASK.ITALIC);\n            const txtDecor = [];\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.UNDERLINE) && txtDecor.push('underline');\n            matchBinaryMask(fontStyle, FONT_STYLE_MASK.STRIKETHROUGH) &&\n                txtDecor.push('line-through');\n            const textarea = this.textarea; // code above ensure it is always set\n            const textareaStyle = textarea.style;\n            textareaStyle.lineHeight = ABSOLUTE_LINE_HEIGHT\n                ? `${Math.round(size * LINE_HEIGHT)}px`\n                : String(LINE_HEIGHT);\n            textareaStyle.backgroundColor = this.getBackgroundColor(state) || 'transparent';\n            textareaStyle.textDecoration = txtDecor.join(' ');\n            textareaStyle.fontWeight = bold ? 'bold' : 'normal';\n            textareaStyle.fontStyle = italic ? 'italic' : '';\n            textareaStyle.fontSize = `${Math.round(size)}px`;\n            textareaStyle.zIndex = String(this.zIndex);\n            textareaStyle.fontFamily = family;\n            textareaStyle.textAlign = align;\n            textareaStyle.outline = 'none';\n            textareaStyle.color = color;\n            let dir = (this.textDirection = stateStyle.textDirection ?? DEFAULT_TEXT_DIRECTION);\n            const stateText = state.text;\n            if (dir === 'auto') {\n                if (stateText !== null &&\n                    stateText.dialect !== 'strictHtml' &&\n                    !isNode(stateText.value)) {\n                    dir = stateText.getAutoDirection();\n                }\n            }\n            if (dir === 'ltr' || dir === 'rtl') {\n                textarea.setAttribute('dir', dir);\n            }\n            else {\n                textarea.removeAttribute('dir');\n            }\n            // Sets the initial editing value\n            textarea.innerHTML = this.getInitialValue(state, trigger) || '';\n            this.initialValue = textarea.innerHTML;\n            // Uses an optional text value for empty labels which is cleared\n            // when the first keystroke appears. This makes it easier to see\n            // that a label is being edited even if the label is empty.\n            if (textarea.innerHTML.length === 0 || textarea.innerHTML === '<br>') {\n                textarea.innerHTML = this.getEmptyLabelText();\n                this.clearOnChange = true;\n            }\n            else {\n                this.clearOnChange = textarea.innerHTML === this.getEmptyLabelText();\n            }\n            // @ts-ignore\n            this.graph.container.appendChild(textarea);\n            // Update this after firing all potential events that could update the cleanOnChange flag\n            this.editingCell = cell;\n            this.trigger = trigger;\n            this.textNode = null;\n            if (stateText !== null && this.isHideLabel(state)) {\n                this.textNode = stateText.node;\n                this.textNode.style.visibility = 'hidden';\n            }\n            // Workaround for initial offsetHeight not ready for heading in markup\n            if (this.autoSize && (state.cell.isEdge() || stateStyle.overflow !== 'fill')) {\n                window.setTimeout(() => {\n                    this.resize();\n                }, 0);\n            }\n            this.resize();\n            // Workaround for NS_ERROR_FAILURE in FF\n            try {\n                // Prefers blinking cursor over no selected text if empty\n                textarea.focus();\n                if (this.isSelectText() &&\n                    textarea.innerHTML.length > 0 &&\n                    (textarea.innerHTML !== this.getEmptyLabelText() || !this.clearOnChange)) {\n                    document.execCommand('selectAll', false);\n                }\n            }\n            catch (e) {\n                // ignore\n            }\n        }\n    }\n    /**\n     * Returns <selectText>.\n     */\n    isSelectText() {\n        return this.selectText;\n    }\n    /**\n    clearSelection() {\n      const selection = window.getSelection();\n  \n      if (selection) {\n        if (selection.empty) {\n          selection.empty();\n        } else if (selection.removeAllRanges) {\n          selection.removeAllRanges();\n        }\n      }\n    }\n  \n    /**\n     * Stops the editor and applies the value if cancel is false.\n     */\n    stopEditing(cancel = false) {\n        if (this.editingCell) {\n            if (this.textNode) {\n                this.textNode.style.visibility = 'visible';\n                this.textNode = null;\n            }\n            const state = !cancel ? this.graph.view.getState(this.editingCell) : null;\n            const textarea = this.textarea;\n            const initial = this.initialValue;\n            this.initialValue = null;\n            this.editingCell = null;\n            this.bounds = null;\n            textarea.blur();\n            clearSelection();\n            if (textarea.parentNode) {\n                textarea.parentNode.removeChild(textarea);\n            }\n            if (this.clearOnChange && textarea.innerHTML === this.getEmptyLabelText()) {\n                textarea.innerHTML = '';\n                this.clearOnChange = false;\n            }\n            if (state && (textarea.innerHTML !== initial || this.align !== null)) {\n                this.prepareTextarea();\n                const value = this.getCurrentValue(state);\n                this.graph.batchUpdate(() => {\n                    if (value !== null) {\n                        this.applyValue(state, value);\n                    }\n                    if (this.align !== null) {\n                        this.graph.setCellStyles('align', this.align, [state.cell]);\n                    }\n                });\n            }\n            this.trigger = null;\n            // Forces new instance on next edit for undo history reset\n            if (this.textarea)\n                InternalEvent.release(this.textarea);\n            this.textarea = null;\n            this.align = null;\n        }\n    }\n    /**\n     * Prepares the textarea for getting its value in <stopEditing>.\n     * This implementation removes the extra trailing linefeed in Firefox.\n     */\n    prepareTextarea() {\n        const textarea = this.textarea;\n        if (textarea.lastChild && textarea.lastChild.nodeName === 'BR') {\n            textarea.removeChild(textarea.lastChild);\n        }\n    }\n    /**\n     * Returns true if the label should be hidden while the cell is being\n     * edited.\n     */\n    isHideLabel(state = null) {\n        return true;\n    }\n    /**\n     * Returns the minimum width and height for editing the given state.\n     */\n    getMinimumSize(state) {\n        const { scale } = this.graph.getView();\n        const textarea = this.textarea;\n        return new Rectangle(0, 0, state.text === null ? 30 : state.text.size * scale + 20, textarea.style.textAlign === 'left' ? 120 : 40);\n    }\n    /**\n     * Returns the {@link Rectangle} that defines the bounds of the editor.\n     */\n    getEditorBounds(state) {\n        const isEdge = state.cell.isEdge();\n        const { scale } = this.graph.getView();\n        const minSize = this.getMinimumSize(state);\n        const minWidth = minSize.width;\n        const minHeight = minSize.height;\n        let result = null;\n        if (!isEdge &&\n            state.view.graph.cellRenderer.legacySpacing &&\n            state.style.overflow === 'fill') {\n            result = state.shape.getLabelBounds(Rectangle.fromRectangle(state));\n        }\n        else {\n            // @ts-ignore\n            const dummy = new TextShape(); // FIXME!!!! ===================================================================================================\n            const spacing = (state.style.spacing ?? 0) * scale;\n            const spacingTop = ((state.style.spacingTop ?? 0) + dummy.baseSpacingTop) * scale + spacing;\n            const spacingRight = ((state.style.spacingRight ?? 0) + dummy.baseSpacingRight) * scale + spacing;\n            const spacingBottom = ((state.style.spacingBottom ?? 0) + dummy.baseSpacingBottom) * scale + spacing;\n            const spacingLeft = ((state.style.spacingLeft ?? 0) + dummy.baseSpacingLeft) * scale + spacing;\n            result = new Rectangle(state.x, state.y, Math.max(minWidth, state.width - spacingLeft - spacingRight), Math.max(minHeight, state.height - spacingTop - spacingBottom));\n            const hpos = state.style.labelPosition != null ? state.style.labelPosition : 'center';\n            const vpos = state.style.verticalLabelPosition != null\n                ? state.style.verticalLabelPosition\n                : 'middle';\n            result =\n                state.shape != null && hpos === 'center' && vpos === 'middle'\n                    ? state.shape.getLabelBounds(result)\n                    : result;\n            if (isEdge) {\n                result.x = state.absoluteOffset.x;\n                result.y = state.absoluteOffset.y;\n                if (state.text != null && state.text.boundingBox != null) {\n                    // Workaround for label containing just spaces in which case\n                    // the bounding box location contains negative numbers\n                    if (state.text.boundingBox.x > 0) {\n                        result.x = state.text.boundingBox.x;\n                    }\n                    if (state.text.boundingBox.y > 0) {\n                        result.y = state.text.boundingBox.y;\n                    }\n                }\n            }\n            else if (state.text != null && state.text.boundingBox != null) {\n                result.x = Math.min(result.x, state.text.boundingBox.x);\n                result.y = Math.min(result.y, state.text.boundingBox.y);\n            }\n            result.x += spacingLeft;\n            result.y += spacingTop;\n            if (state.text != null && state.text.boundingBox != null) {\n                if (!isEdge) {\n                    result.width = Math.max(result.width, state.text.boundingBox.width);\n                    result.height = Math.max(result.height, state.text.boundingBox.height);\n                }\n                else {\n                    result.width = Math.max(minWidth, state.text.boundingBox.width);\n                    result.height = Math.max(minHeight, state.text.boundingBox.height);\n                }\n            }\n            // Applies the horizontal and vertical label positions\n            if (state.cell.isVertex()) {\n                const horizontal = state.style.labelPosition ?? 'center';\n                if (horizontal === 'left') {\n                    result.x -= state.width;\n                }\n                else if (horizontal === 'right') {\n                    result.x += state.width;\n                }\n                const vertical = state.style.verticalLabelPosition != null\n                    ? state.style.verticalLabelPosition\n                    : 'middle';\n                if (vertical === 'top') {\n                    result.y -= state.height;\n                }\n                else if (vertical === 'bottom') {\n                    result.y += state.height;\n                }\n            }\n        }\n        return new Rectangle(Math.round(result.x), Math.round(result.y), Math.round(result.width), Math.round(result.height));\n    }\n    /**\n     * Returns the initial label value to be used of the label of the given\n     * cell is empty. This label is displayed and cleared on the first keystroke.\n     * This implementation returns <emptyLabelText>.\n     *\n     * @param cell <Cell> for which a text for an empty editing box should be\n     * returned.\n     */\n    getEmptyLabelText(cell = null) {\n        return this.emptyLabelText ?? '';\n    }\n    /**\n     * Returns the cell that is currently being edited or null if no cell is\n     * being edited.\n     */\n    getEditingCell() {\n        return this.editingCell;\n    }\n    /**\n     * Destroys the editor and removes all associated resources.\n     */\n    onDestroy() {\n        if (this.textarea) {\n            InternalEvent.release(this.textarea);\n            if (this.textarea.parentNode) {\n                this.textarea.parentNode.removeChild(this.textarea);\n            }\n            this.textarea = null;\n        }\n        this.graph.getDataModel().removeListener(this.changeHandler);\n        this.graph.getView().removeListener(this.zoomHandler);\n    }\n}\nCellEditorHandler.pluginId = 'CellEditorHandler';\nexport default CellEditorHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport InternalEvent from '../event/InternalEvent.js';\nimport { fit, getScrollOrigin } from '../../util/styleUtils.js';\nimport { TOOLTIP_VERTICAL_OFFSET } from '../../util/Constants.js';\nimport { getSource, isMouseEvent } from '../../util/EventUtils.js';\nimport { isNode } from '../../util/domUtils.js';\n/**\n * Graph event handler that displays tooltips.\n *\n * {@link AbstractGraph.getTooltip} is used to get the tooltip for a cell or handle.\n *\n * This handler is generally enabled using {@link AbstractGraph.setTooltips}.\n *\n * @category Plugin\n */\nclass TooltipHandler {\n    /**\n     * Creates the tooltip element and appends it to the document body.\n     *\n     */\n    init() {\n        if (document.body) {\n            this.div = document.createElement('div');\n            this.div.className = 'mxTooltip';\n            this.div.style.visibility = 'hidden';\n            document.body.appendChild(this.div);\n            InternalEvent.addGestureListeners(this.div, (evt) => {\n                const source = getSource(evt);\n                // @ts-ignore nodeName may exist\n                if (source && source.nodeName !== 'A') {\n                    this.hideTooltip();\n                }\n            });\n            // Hides tooltips and resets tooltip timer if mouse leaves container\n            InternalEvent.addListener(this.graph.getContainer(), 'mouseleave', (evt) => {\n                if (this.div !== evt.relatedTarget) {\n                    this.hide();\n                }\n            });\n        }\n    }\n    /**\n     * Constructs an event handler that displays tooltips.\n     *\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     */\n    constructor(graph) {\n        /**\n         * Specifies the zIndex for the tooltip and its shadow.\n         * @default 10005\n         */\n        this.zIndex = 10005;\n        /**\n         * Delay to show the tooltip in milliseconds.\n         * @default 500\n         */\n        this.delay = 500;\n        /**\n         * Specifies if touch and pen events should be ignored.\n         * @default true\n         */\n        this.ignoreTouchEvents = true;\n        /**\n         * Specifies if the tooltip should be hidden if the mouse is moved over the current cell.\n         * @default false\n         */\n        this.hideOnHover = false;\n        /**\n         * `true` if this handler was destroyed using {@link onDestroy}.\n         */\n        this.destroyed = false;\n        this.lastX = 0;\n        this.lastY = 0;\n        this.state = null;\n        this.stateSource = false;\n        this.thread = null;\n        /**\n         * Specifies if events are handled.\n         * @default false\n         */\n        this.enabled = false;\n        this.graph = graph;\n        this.graph.addMouseListener(this);\n    }\n    /**\n     * Returns `true` if events are handled.\n     *\n     * This implementation returns {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling.\n     *\n     * This implementation updates {@link enabled}.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Returns {@link hideOnHover}.\n     */\n    isHideOnHover() {\n        return this.hideOnHover;\n    }\n    /**\n     * Sets <hideOnHover>.\n     */\n    setHideOnHover(value) {\n        this.hideOnHover = value;\n    }\n    /**\n     * Returns the <CellState> to be used for showing a tooltip for this event.\n     */\n    getStateForEvent(me) {\n        return me.getState();\n    }\n    /**\n     * Handles the event by initiating a rubberband selection.\n     * By consuming the event all subsequent events of the gesture are redirected to this handler.\n     */\n    mouseDown(_sender, me) {\n        this.reset(me, false);\n        this.hideTooltip();\n    }\n    /**\n     * Handles the event by updating the rubberband selection.\n     */\n    mouseMove(_sender, me) {\n        if (me.getX() !== this.lastX || me.getY() !== this.lastY) {\n            this.reset(me, true);\n            const state = this.getStateForEvent(me);\n            if (this.isHideOnHover() ||\n                state !== this.state ||\n                (me.getSource() !== this.node &&\n                    (!this.stateSource ||\n                        (state != null &&\n                            this.stateSource ===\n                                (me.isSource(state.shape) || !me.isSource(state.text)))))) {\n                this.hideTooltip();\n            }\n        }\n        this.lastX = me.getX();\n        this.lastY = me.getY();\n    }\n    /**\n     * Handles the event by resetting the tooltip timer or hiding the existing tooltip.\n     */\n    mouseUp(_sender, me) {\n        this.reset(me, true);\n        this.hideTooltip();\n    }\n    /**\n     * Resets the timer.\n     */\n    resetTimer() {\n        if (this.thread) {\n            window.clearTimeout(this.thread);\n            this.thread = null;\n        }\n    }\n    /**\n     * Resets and/or restarts the timer to trigger the display of the tooltip.\n     */\n    reset(me, restart, state = null) {\n        if (!this.ignoreTouchEvents || isMouseEvent(me.getEvent())) {\n            this.resetTimer();\n            state = state ?? this.getStateForEvent(me);\n            if (restart &&\n                this.isEnabled() &&\n                state &&\n                (!this.div || this.div.style.visibility == 'hidden')) {\n                const node = me.getSource();\n                const x = me.getX();\n                const y = me.getY();\n                const stateSource = me.isSource(state.shape) || me.isSource(state.text);\n                const popupMenuHandler = this.graph.getPlugin('PopupMenuHandler');\n                this.thread = window.setTimeout(() => {\n                    if (state &&\n                        node &&\n                        !this.graph.isEditing() &&\n                        popupMenuHandler &&\n                        !popupMenuHandler.isMenuShowing() &&\n                        !this.graph.isMouseDown) {\n                        // Uses information from inside event cause using the event at\n                        // this (delayed) point in time is not possible in IE as it no\n                        // longer contains the required information (member not found)\n                        const tip = this.graph.getTooltip(state, node, x, y);\n                        this.show(tip, x, y);\n                        this.state = state;\n                        this.node = node;\n                        this.stateSource = stateSource;\n                    }\n                }, this.delay);\n            }\n        }\n    }\n    /**\n     * Hides the tooltip and resets the timer.\n     */\n    hide() {\n        this.resetTimer();\n        this.hideTooltip();\n    }\n    /**\n     * Hides the tooltip.\n     */\n    hideTooltip() {\n        if (this.div) {\n            this.div.style.visibility = 'hidden';\n            this.div.innerHTML = '';\n        }\n    }\n    /**\n     * Shows the tooltip for the specified cell and optional index at the\n     * specified location (with a vertical offset of 10 pixels).\n     */\n    show(tip, x, y) {\n        if (!this.destroyed && tip && tip !== '') {\n            const origin = getScrollOrigin();\n            if (!this.div) {\n                this.init();\n            }\n            this.div.style.zIndex = String(this.zIndex);\n            this.div.style.left = `${x + origin.x}px`;\n            this.div.style.top = `${y + TOOLTIP_VERTICAL_OFFSET + origin.y}px`;\n            if (!isNode(tip)) {\n                this.div.innerHTML = tip.replace(/\\n/g, '<br>');\n            }\n            else {\n                this.div.innerHTML = '';\n                this.div.appendChild(tip);\n            }\n            this.div.style.visibility = '';\n            fit(this.div);\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        if (!this.destroyed) {\n            this.resetTimer();\n            this.graph.removeMouseListener(this);\n            if (this.div) {\n                InternalEvent.release(this.div);\n            }\n            if (this.div?.parentNode) {\n                this.div.parentNode.removeChild(this.div);\n            }\n            this.destroyed = true;\n            this.div = null;\n        }\n    }\n}\nTooltipHandler.pluginId = 'TooltipHandler';\nexport default TooltipHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../event/EventSource.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { sortCells } from '../../util/styleUtils.js';\n/**\n * An event handler that manages cell handlers and invokes their mouse event processing functions.\n *\n * ### Events\n *\n * #### InternalEvent.ADD\n *\n * Fires if a cell has been added to the selection.\n * The `state` property contains the {@link CellState} that has been added.\n *\n * #### InternalEvent.REMOVE\n *\n * Fires if a cell has been remove from the selection.\n * The `state` property contains the {@link CellState} that has been removed.\n *\n * @category Plugin\n */\nclass SelectionCellsHandler extends EventSource {\n    constructor(graph) {\n        super();\n        /**\n         * Specifies if events are handled.\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * Defines the maximum number of handlers to paint individually.\n         * @default 100\n         */\n        this.maxHandlers = 100;\n        this.graph = graph;\n        this.handlers = new Map();\n        this.graph.addMouseListener(this);\n        this.refreshHandler = () => {\n            if (this.isEnabled()) {\n                this.refresh();\n            }\n        };\n        this.graph.getSelectionModel().addListener(InternalEvent.CHANGE, this.refreshHandler);\n        this.graph.getDataModel().addListener(InternalEvent.CHANGE, this.refreshHandler);\n        this.graph.getView().addListener(InternalEvent.SCALE, this.refreshHandler);\n        this.graph.getView().addListener(InternalEvent.TRANSLATE, this.refreshHandler);\n        this.graph\n            .getView()\n            .addListener(InternalEvent.SCALE_AND_TRANSLATE, this.refreshHandler);\n        this.graph.getView().addListener(InternalEvent.DOWN, this.refreshHandler);\n        this.graph.getView().addListener(InternalEvent.UP, this.refreshHandler);\n    }\n    /**\n     * Returns {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Sets {@link enabled}.\n     */\n    setEnabled(value) {\n        this.enabled = value;\n    }\n    /**\n     * Returns the handler for the given cell.\n     */\n    getHandler(cell) {\n        return this.handlers.get(cell);\n    }\n    /**\n     * Returns true if the given cell has a handler.\n     */\n    isHandled(cell) {\n        return !!this.getHandler(cell);\n    }\n    /**\n     * Resets all handlers.\n     */\n    reset() {\n        this.handlers.forEach((handler) => {\n            handler.reset.apply(handler);\n        });\n    }\n    /**\n     * Reloads or updates all handlers.\n     */\n    getHandledSelectionCells() {\n        return this.graph.getSelectionCells();\n    }\n    /**\n     * Reloads or updates all handlers.\n     */\n    refresh() {\n        // Removes all existing handlers\n        const oldHandlers = this.handlers;\n        this.handlers = new Map();\n        // Creates handles for all selection cells\n        const tmp = sortCells(this.getHandledSelectionCells(), false);\n        // Destroys or updates old handlers\n        for (let i = 0; i < tmp.length; i += 1) {\n            const state = this.graph.view.getState(tmp[i]);\n            if (state) {\n                let handler = oldHandlers.get(tmp[i]) ?? null;\n                oldHandlers.delete(tmp[i]);\n                if (handler) {\n                    if (handler.state !== state) {\n                        handler.onDestroy();\n                        handler = null;\n                    }\n                    else if (!this.isHandlerActive(handler)) {\n                        // @ts-ignore refresh may exist\n                        if (handler.refresh)\n                            handler.refresh();\n                        handler.redraw();\n                    }\n                }\n                if (handler) {\n                    this.handlers.set(tmp[i], handler);\n                }\n            }\n        }\n        // Destroys unused handlers\n        oldHandlers.forEach((handler) => {\n            this.fireEvent(new EventObject(InternalEvent.REMOVE, { state: handler.state }));\n            handler.onDestroy();\n        });\n        // Creates new handlers and updates parent highlight on existing handlers\n        for (let i = 0; i < tmp.length; i += 1) {\n            const state = this.graph.view.getState(tmp[i]);\n            if (state) {\n                let handler = this.handlers.get(tmp[i]);\n                if (!handler) {\n                    handler = this.graph.createHandler(state);\n                    this.fireEvent(new EventObject(InternalEvent.ADD, { state }));\n                    this.handlers.set(tmp[i], handler);\n                }\n                else {\n                    handler.updateParentHighlight();\n                }\n            }\n        }\n    }\n    /**\n     * Returns true if the given handler is active and should not be redrawn.\n     */\n    isHandlerActive(handler) {\n        return handler.index !== null;\n    }\n    /**\n     * Updates the handler for the given shape if one exists.\n     */\n    updateHandler(state) {\n        let handler = this.handlers.get(state.cell);\n        this.handlers.delete(state.cell);\n        if (handler) {\n            // Transfers the current state to the new handler\n            const { index } = handler;\n            const x = handler.startX;\n            const y = handler.startY;\n            handler.onDestroy();\n            handler = this.graph.createHandler(state);\n            if (handler) {\n                this.handlers.set(state.cell, handler);\n                if (index !== null) {\n                    handler.start(x, y, index);\n                }\n            }\n        }\n    }\n    /**\n     * Redirects the given event to the handlers.\n     */\n    mouseDown(sender, me) {\n        if (this.graph.isEnabled() && this.isEnabled()) {\n            this.handlers.forEach((handler) => {\n                handler.mouseDown(sender, me);\n            });\n        }\n    }\n    /**\n     * Redirects the given event to the handlers.\n     */\n    mouseMove(sender, me) {\n        if (this.graph.isEnabled() && this.isEnabled()) {\n            this.handlers.forEach((handler) => {\n                handler.mouseMove(sender, me);\n            });\n        }\n    }\n    /**\n     * Redirects the given event to the handlers.\n     */\n    mouseUp(sender, me) {\n        if (this.graph.isEnabled() && this.isEnabled()) {\n            this.handlers.forEach((handler) => {\n                handler.mouseUp(sender, me);\n            });\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        this.graph.removeMouseListener(this);\n        this.graph.removeListener(this.refreshHandler);\n        this.graph.getDataModel().removeListener(this.refreshHandler);\n        this.graph.getView().removeListener(this.refreshHandler);\n    }\n}\nSelectionCellsHandler.pluginId = 'SelectionCellsHandler';\nexport default SelectionCellsHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../view/event/EventSource.js';\nimport { fit, getDocumentScrollOrigin } from '../util/styleUtils.js';\nimport EventObject from '../view/event/EventObject.js';\nimport Client from '../Client.js';\nimport InternalEvent from '../view/event/InternalEvent.js';\nimport { write } from '../util/domUtils.js';\nimport { isLeftMouseButton } from '../util/EventUtils.js';\n/**\n * Basic popup menu.\n *\n * To add a vertical scrollbar to a given submenu, the following code can be used:\n *\n * ```javascript\n * const popupMenu = new MaxPopupMenu(...);\n * const popupMenuShowMenu = popupMenu.showMenu;\n * popupMenu.showMenu = function() {\n *   popupMenuShowMenu.apply(this, []);\n *\n *   this.div.style.overflowY = 'auto';\n *   this.div.style.overflowX = 'hidden';\n *   this.div.style.maxHeight = '160px';\n * };\n * ```\n *\n * ### Events\n *\n * **{@link InternalEvent.SHOW}**\n *\n * Fires after the menu has been shown in {@link popup}.\n *\n * @category GUI\n */\nclass MaxPopupMenu extends EventSource {\n    constructor(factoryMethod) {\n        super();\n        this.activeRow = null;\n        this.eventReceiver = null;\n        /**\n         * URL of the image to be used for the submenu icon.\n         */\n        this.submenuImage = `${Client.imageBasePath}/submenu.gif`;\n        /**\n         * Specifies the zIndex for the popupmenu and its shadow. Default is 1006.\n         */\n        this.zIndex = 10006;\n        /**\n         * Specifies if popupmenus should be activated by clicking the left mouse\n         * button. Default is false.\n         */\n        this.useLeftButtonForPopup = false;\n        /**\n         * Specifies if events are handled. Default is true.\n         */\n        this.enabled = true;\n        /**\n         * Contains the number of times <addItem> has been called for a new menu.\n         */\n        this.itemCount = 0;\n        /**\n         * Specifies if submenus should be expanded on mouseover. Default is false.\n         */\n        this.autoExpand = false;\n        /**\n         * Specifies if separators should only be added if a menu item follows them.\n         * Default is false.\n         */\n        this.smartSeparators = false;\n        /**\n         * Specifies if any labels should be visible. Default is true.\n         */\n        this.labels = true;\n        this.willAddSeparator = false;\n        this.containsItems = false;\n        if (factoryMethod) {\n            this.factoryMethod = factoryMethod;\n        }\n        // Adds the inner table\n        this.table = document.createElement('table');\n        this.table.className = 'mxPopupMenu';\n        this.tbody = document.createElement('tbody');\n        this.table.appendChild(this.tbody);\n        // Adds the outer div\n        this.div = document.createElement('div');\n        this.div.className = 'mxPopupMenu';\n        this.div.style.display = 'inline';\n        this.div.style.zIndex = String(this.zIndex);\n        this.div.appendChild(this.table);\n        // Disables the context menu on the outer div\n        InternalEvent.disableContextMenu(this.div);\n    }\n    /**\n     * Returns true if events are handled. This implementation\n     * returns <enabled>.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling. This implementation\n     * updates <enabled>.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Returns true if the given event is a popupmenu trigger for the optional\n     * given cell.\n     *\n     * @param me {@link MouseEvent} that represents the mouse event.\n     */\n    isPopupTrigger(me) {\n        return (me.isPopupTrigger() ||\n            (this.useLeftButtonForPopup && isLeftMouseButton(me.getEvent())));\n    }\n    /**\n     * Adds the given item to the given parent item. If no parent item is specified then the item is added to the top-level menu.\n     *\n     * The return value may be used as the parent argument, i.e. as a submenu item.\n     * The return value is the table row that represents the item.\n     *\n     * @param title String that represents the title of the menu item.\n     * @param image Optional URL for the image icon.\n     * @param funct Function associated that takes a `mouseup` or `touchend` event.\n     * @param parent Optional item returned by {@link addItem}.\n     * @param iconCls Optional string that represents the CSS class for the image icon. It is ignored if image is given.\n     * @param enabled Optional boolean indicating if the item is enabled. Default is `true`.\n     * @param active Optional boolean indicating if the menu should implement any event handling. Default is `true`.\n     * @param noHover Optional boolean to disable hover state. Default is `false`.\n     */\n    addItem(title, image, funct, parent = null, iconCls = null, enabled = true, active = true, noHover = false) {\n        parent = (parent ?? this);\n        this.itemCount++;\n        // Smart separators only added if element contains items\n        if (parent.willAddSeparator) {\n            if (parent.containsItems) {\n                this.addSeparator(parent, true);\n            }\n            parent.willAddSeparator = false;\n        }\n        parent.containsItems = true;\n        const tr = document.createElement('tr');\n        tr.className = 'mxPopupMenuItem';\n        const col1 = document.createElement('td');\n        col1.className = 'mxPopupMenuIcon';\n        // Adds the given image into the first column\n        if (image) {\n            const img = document.createElement('img');\n            img.src = image;\n            col1.appendChild(img);\n        }\n        else if (iconCls) {\n            const div = document.createElement('div');\n            div.className = iconCls;\n            col1.appendChild(div);\n        }\n        tr.appendChild(col1);\n        if (this.labels) {\n            const col2 = document.createElement('td');\n            col2.className = `mxPopupMenuItem${!enabled ? ' mxDisabled' : ''}`;\n            write(col2, title);\n            col2.align = 'left';\n            tr.appendChild(col2);\n            const col3 = document.createElement('td');\n            col3.className = `mxPopupMenuItem${!enabled ? ' mxDisabled' : ''}`;\n            col3.style.paddingRight = '6px';\n            col3.style.textAlign = 'right';\n            tr.appendChild(col3);\n            if (parent.div == null) {\n                this.createSubmenu(parent);\n            }\n        }\n        parent.tbody?.appendChild(tr);\n        if (active && enabled) {\n            InternalEvent.addGestureListeners(tr, (evt) => {\n                this.eventReceiver = tr;\n                if (parent && parent.activeRow != tr && parent.activeRow != parent) {\n                    if (parent.activeRow && parent.activeRow.div.parentNode) {\n                        this.hideSubmenu(parent);\n                    }\n                    if (tr.div) {\n                        this.showSubmenu(parent, tr);\n                        parent.activeRow = tr;\n                    }\n                }\n                InternalEvent.consume(evt);\n            }, (_evt) => {\n                if (parent && parent.activeRow != tr && parent.activeRow != parent) {\n                    if (parent.activeRow && parent.activeRow.div.parentNode) {\n                        this.hideSubmenu(parent);\n                    }\n                    if (this.autoExpand && tr.div) {\n                        this.showSubmenu(parent, tr);\n                        parent.activeRow = tr;\n                    }\n                }\n                // Sets hover style because TR in IE doesn't have hover\n                if (!noHover) {\n                    tr.className = 'mxPopupMenuItemHover';\n                }\n            }, (evt) => {\n                // EventReceiver avoids clicks on a submenu item\n                // which has just been shown in the mousedown\n                if (this.eventReceiver == tr) {\n                    if (parent && parent.activeRow != tr) {\n                        this.hideMenu();\n                    }\n                    funct?.(evt);\n                }\n                this.eventReceiver = null;\n                InternalEvent.consume(evt);\n            });\n            // Resets hover style because TR in IE doesn't have hover\n            if (!noHover) {\n                InternalEvent.addListener(tr, 'mouseout', (_evt) => {\n                    tr.className = 'mxPopupMenuItem';\n                });\n            }\n        }\n        return tr;\n    }\n    /**\n     * Adds a checkmark to the given menuitem.\n     */\n    addCheckmark(item, img) {\n        if (item.firstChild) {\n            const td = item.firstChild.nextSibling;\n            td.style.backgroundImage = `url('${img}')`;\n            td.style.backgroundRepeat = 'no-repeat';\n            td.style.backgroundPosition = '2px 50%';\n        }\n    }\n    /**\n     * Creates the nodes required to add submenu items inside the given parent\n     * item. This is called in <addItem> if a parent item is used for the first\n     * time. This adds various DOM nodes and a <submenuImage> to the parent.\n     *\n     * @param parent An item returned by <addItem>.\n     */\n    createSubmenu(parent) {\n        parent.table = document.createElement('table');\n        parent.table.className = 'mxPopupMenu';\n        parent.tbody = document.createElement('tbody');\n        parent.table.appendChild(parent.tbody);\n        parent.div = document.createElement('div');\n        parent.div.className = 'mxPopupMenu';\n        parent.div.style.position = 'absolute';\n        parent.div.style.display = 'inline';\n        parent.div.style.zIndex = String(this.zIndex);\n        parent.div.appendChild(parent.table);\n        const img = document.createElement('img');\n        img.setAttribute('src', this.submenuImage);\n        // Last column of the submenu item in the parent menu\n        if (parent.firstChild?.nextSibling?.nextSibling) {\n            const td = parent.firstChild.nextSibling.nextSibling;\n            td.appendChild(img);\n        }\n    }\n    /**\n     * Shows the submenu inside the given parent row.\n     */\n    showSubmenu(parent, row) {\n        if (row.div) {\n            row.div.style.left = `${parent.div.offsetLeft + row.offsetLeft + row.offsetWidth - 1}px`;\n            row.div.style.top = `${parent.div.offsetTop + row.offsetTop}px`;\n            document.body.appendChild(row.div);\n            // Moves the submenu to the left side if there is no space\n            const left = row.div.offsetLeft;\n            const width = row.div.offsetWidth;\n            const offset = getDocumentScrollOrigin(document);\n            const b = document.body;\n            const d = document.documentElement;\n            const right = offset.x + (b.clientWidth || d.clientWidth);\n            if (left + width > right) {\n                row.div.style.left = `${Math.max(0, parent.div.offsetLeft - width - 6)}px`;\n            }\n            fit(row.div);\n        }\n    }\n    /**\n     * Adds a horizontal separator in the given parent item or the top-level menu\n     * if no parent is specified.\n     *\n     * @param parent Optional item returned by <addItem>.\n     * @param force Optional boolean to ignore <smartSeparators>. Default is false.\n     */\n    addSeparator(parent = null, force = false) {\n        // Defaults to this instance if no parent (submenu) specified, but\n        // all the necessary DOM elements are present as in PopupMenuItem\n        parent = (parent || this);\n        if (this.smartSeparators && !force) {\n            parent.willAddSeparator = true;\n        }\n        else if (parent.tbody) {\n            parent.willAddSeparator = false;\n            const tr = document.createElement('tr');\n            const col1 = document.createElement('td');\n            col1.className = 'mxPopupMenuIcon';\n            col1.style.padding = '0 0 0 0px';\n            tr.appendChild(col1);\n            const col2 = document.createElement('td');\n            col2.style.padding = '0 0 0 0px';\n            col2.setAttribute('colSpan', '2');\n            const hr = document.createElement('hr');\n            hr.setAttribute('size', '1');\n            col2.appendChild(hr);\n            tr.appendChild(col2);\n            parent.tbody.appendChild(tr);\n        }\n    }\n    /**\n     * Shows the popup menu for the given event and cell.\n     *\n     * Example:\n     *\n     * ```javascript\n     * graph.getPlugin('PanningHandler').popup(x, y, cell, evt)\n     * {\n     *   mxUtils.alert('Hello, World!');\n     * }\n     * ```\n     */\n    popup(x, y, cell, evt) {\n        if (this.div && this.tbody && this.factoryMethod) {\n            this.div.style.left = `${x}px`;\n            this.div.style.top = `${y}px`;\n            // Removes all child nodes from the existing menu\n            while (this.tbody.firstChild) {\n                InternalEvent.release(this.tbody.firstChild);\n                this.tbody.removeChild(this.tbody.firstChild);\n            }\n            this.itemCount = 0;\n            this.factoryMethod(this, cell, evt);\n            if (this.itemCount > 0) {\n                this.showMenu();\n                this.fireEvent(new EventObject(InternalEvent.SHOW));\n            }\n        }\n    }\n    /**\n     * Returns true if the menu is showing.\n     */\n    isMenuShowing() {\n        return this.div && this.div.parentNode == document.body;\n    }\n    /**\n     * Shows the menu.\n     */\n    showMenu() {\n        // Fits the div inside the viewport\n        document.body.appendChild(this.div);\n        fit(this.div);\n    }\n    /**\n     * Removes the menu and all submenus.\n     */\n    hideMenu() {\n        if (this.div) {\n            this.div.parentNode?.removeChild(this.div);\n            this.hideSubmenu(this);\n            this.containsItems = false;\n            this.fireEvent(new EventObject(InternalEvent.HIDE));\n        }\n    }\n    /**\n     * Removes all submenus inside the given parent.\n     *\n     * @param parent An item returned by <addItem>.\n     */\n    hideSubmenu(parent) {\n        if (parent.activeRow) {\n            this.hideSubmenu(parent.activeRow);\n            parent.activeRow.div.parentNode?.removeChild(parent.activeRow.div);\n            parent.activeRow = null;\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    destroy() {\n        if (this.div) {\n            InternalEvent.release(this.div);\n            this.div.parentNode?.removeChild(this.div);\n        }\n    }\n}\nexport default MaxPopupMenu;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport MaxPopupMenu from '../../gui/MaxPopupMenu.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { getScrollOrigin } from '../../util/styleUtils.js';\nimport { getMainEvent, isMultiTouchEvent } from '../../util/EventUtils.js';\n/**\n * Event handler that creates popupmenus.\n *\n * Relates to {@link MaxPopupMenu}.\n *\n * @category Plugin\n */\nclass PopupMenuHandler extends MaxPopupMenu {\n    constructor(graph) {\n        super();\n        this.inTolerance = false;\n        this.popupTrigger = false;\n        /**\n         * Specifies if cells should be selected if a popupmenu is displayed for\n         * them. Default is true.\n         */\n        this.selectOnPopup = true;\n        /**\n         * Specifies if cells should be deselected if a popupmenu is displayed for\n         * the diagram background. Default is true.\n         */\n        this.clearSelectionOnBackground = true;\n        /**\n         * X-coordinate of the mouse down event.\n         */\n        this.triggerX = null;\n        /**\n         * Y-coordinate of the mouse down event.\n         */\n        this.triggerY = null;\n        /**\n         * Screen X-coordinate of the mouse down event.\n         */\n        this.screenX = null;\n        /**\n         * Screen Y-coordinate of the mouse down event.\n         */\n        this.screenY = null;\n        this.graph = graph;\n        this.graph.addMouseListener(this);\n        // Does not show menu if any touch gestures take place after the trigger\n        this.gestureHandler = (sender, eo) => {\n            this.inTolerance = false;\n        };\n        this.graph.addListener(InternalEvent.GESTURE, this.gestureHandler);\n        this.init();\n    }\n    /**\n     * Initializes the shapes required for this vertex handler.\n     */\n    init() {\n        // Hides the tooltip if the mouse is over the context menu\n        InternalEvent.addGestureListeners(this.div, (evt) => {\n            const tooltipHandler = this.graph.getPlugin('TooltipHandler');\n            tooltipHandler?.hide();\n        });\n    }\n    /**\n     * Hook for returning if a cell should be selected for a given {@link MouseEvent}.\n     * This implementation returns <selectOnPopup>.\n     */\n    isSelectOnPopup(me) {\n        return this.selectOnPopup;\n    }\n    /**\n     * Handles the event by initiating the panning. By consuming the event all\n     * subsequent events of the gesture are redirected to this handler.\n     */\n    mouseDown(_sender, me) {\n        if (this.isEnabled() && !isMultiTouchEvent(me.getEvent())) {\n            // Hides the popupmenu if it is being displayed\n            this.hideMenu();\n            this.triggerX = me.getGraphX();\n            this.triggerY = me.getGraphY();\n            this.screenX = getMainEvent(me.getEvent()).screenX;\n            this.screenY = getMainEvent(me.getEvent()).screenY;\n            this.popupTrigger = this.isPopupTrigger(me);\n            this.inTolerance = true;\n        }\n    }\n    /**\n     * Handles the event by updating the panning on the graph.\n     */\n    mouseMove(_sender, me) {\n        // Popup trigger may change on mouseUp so ignore it\n        if (this.inTolerance && this.screenX != null && this.screenY != null) {\n            if (Math.abs(getMainEvent(me.getEvent()).screenX - this.screenX) >\n                this.graph.getEventTolerance() ||\n                Math.abs(getMainEvent(me.getEvent()).screenY - this.screenY) >\n                    this.graph.getEventTolerance()) {\n                this.inTolerance = false;\n            }\n        }\n    }\n    /**\n     * Handles the event by setting the translation on the view or showing the popupmenu.\n     */\n    mouseUp(_sender, me) {\n        if (this.popupTrigger &&\n            this.inTolerance &&\n            this.triggerX != null &&\n            this.triggerY != null) {\n            const cell = this.getCellForPopupEvent(me);\n            // Selects the cell for which the context menu is being displayed\n            if (this.graph.isEnabled() &&\n                this.isSelectOnPopup(me) &&\n                cell != null &&\n                !this.graph.isCellSelected(cell)) {\n                this.graph.setSelectionCell(cell);\n            }\n            else if (this.clearSelectionOnBackground && cell == null) {\n                this.graph.clearSelection();\n            }\n            // Hides the tooltip if there is one\n            const tooltipHandler = this.graph.getPlugin('TooltipHandler');\n            tooltipHandler?.hide();\n            // Menu is shifted by 1 pixel so that the mouse up event\n            // is routed via the underlying shape instead of the DIV\n            const origin = getScrollOrigin();\n            this.popup(me.getX() + origin.x + 1, me.getY() + origin.y + 1, cell, me.getEvent());\n            me.consume();\n        }\n        this.popupTrigger = false;\n        this.inTolerance = false;\n    }\n    /**\n     * Hook to return the cell for the mouse up popup trigger handling.\n     */\n    getCellForPopupEvent(me) {\n        return me.getCell();\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        this.graph.removeMouseListener(this);\n        this.graph.removeListener(this.gestureHandler);\n        // Supercall\n        super.destroy();\n    }\n}\nPopupMenuHandler.pluginId = 'PopupMenuHandler';\nexport default PopupMenuHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2016, JGraph Ltd\nCopyright (c) 2006-2016, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Geometry from '../geometry/Geometry.js';\nimport Cell from '../cell/Cell.js';\nimport Point from '../geometry/Point.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { DEFAULT_HOTSPOT, DEFAULT_INVALID_COLOR, DEFAULT_VALID_COLOR, HIGHLIGHT_STROKEWIDTH, INVALID_COLOR, NONE, OUTLINE_HIGHLIGHT_COLOR, OUTLINE_HIGHLIGHT_STROKEWIDTH, TOOLTIP_VERTICAL_OFFSET, VALID_COLOR, } from '../../util/Constants.js';\nimport { getRotatedPoint, toRadians } from '../../util/mathUtils.js';\nimport { convertPoint, getOffset } from '../../util/styleUtils.js';\nimport InternalMouseEvent from '../event/InternalMouseEvent.js';\nimport ImageShape from '../shape/node/ImageShape.js';\nimport CellMarker from '../cell/CellMarker.js';\nimport ConstraintHandler from '../handler/ConstraintHandler.js';\nimport PolylineShape from '../shape/edge/PolylineShape.js';\nimport EventSource from '../event/EventSource.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { GlobalConfig } from '../../util/config.js';\nimport { getClientX, getClientY, isAltDown, isConsumed, isShiftDown, } from '../../util/EventUtils.js';\n/**\n * Graph event handler that creates new connections.\n * Uses {@link CellMarker} for finding and highlighting the source and target vertices and {@link factoryMethod} to create the edge instance.\n *\n * This handler is enabled using {@link AbstractGraph.setConnectable}.\n *\n * Example:\n *\n * ```javascript\n * new ConnectionHandler(graph, (source, target, style)=>\n * {\n *   edge = new Cell('', new Geometry());\n *   edge.setEdge(true);\n *   edge.setStyle(style);\n *   edge.geometry.relative = true;\n *   return edge;\n * });\n * ```\n *\n * Here is an alternative solution that just sets a specific user object for new edges by overriding {@link insertEdge}.\n *\n * ```javascript\n * originalConnectionHandlerInsertEdge = connectionHandler.insertEdge;\n * connectionHandler.insertEdge = (parent, id, value, source, target, style) => {\n *   value = 'Test';\n *   return originalConnectionHandlerInsertEdge.apply(this, arguments);\n * };\n * ```\n *\n * ### Using images to trigger connections\n *\n * This handler uses {@link CellMarker} to find the source and target cell for\n * the new connection and creates a new edge using {@link connect}. The new edge is\n * created using {@link createEdge} which in turn uses {@link factoryMethod} or creates a\n * new default edge.\n *\n * The handler uses a \"highlight-paradigm\" for indicating if a cell is being\n * used as a source or target terminal, as seen in other diagramming products.\n * In order to allow both, moving and connecting cells at the same time,\n * {@link DEFAULT_HOTSPOT} is used in the handler to determine the hotspot\n * of a cell, that is, the region of the cell which is used to trigger a new\n * connection. The constant is a value between 0 and 1 that specifies the\n * amount of the width and height around the center to be used for the hotspot\n * of a cell and its default value is 0.5. In addition,\n * {@link MIN_HOTSPOT_SIZE} defines the minimum number of pixels for the\n * width and height of the hotspot.\n *\n * This solution, while standards compliant, may be somewhat confusing because\n * there is no visual indicator for the hotspot and the highlight is seen to\n * switch on and off while the mouse is being moved in and out. Furthermore,\n * this paradigm does not allow to create different connections depending on\n * the highlighted hotspot as there is only one hotspot per cell, and it\n * normally does not allow cells to be moved and connected at the same time as\n * there is no clear indication of the connectable area of the cell.\n *\n * To come across these issues, the handle has an additional {@link createIcons} hook\n * with a default implementation that allows to create one icon to be used to\n * trigger new connections. If this icon is specified, then new connections can\n * only be created if the image is clicked while the cell is being highlighted.\n * The {@link createIcons} hook may be overridden to create more than one\n * {@link ImageShape} for creating new connections, but the default implementation\n * supports one image and is used as follows:\n *\n * In order to display the \"connect image\" whenever the mouse is over the cell, an DEFAULT_HOTSPOT of 1 should be used:\n *\n * ```javascript\n * mxConstants.DEFAULT_HOTSPOT = 1;\n * ```\n *\n * In order to avoid confusion with the highlighting, the highlight color should not be used with a connect image:\n *\n * ```javascript\n * mxConstants.HIGHLIGHT_COLOR = null;\n * ```\n *\n * To install the image, the connectImage field of the ConnectionHandler must be assigned a new {@link Image} instance:\n *\n * ```javascript\n * connectImage = new ImageBox('images/green-dot.gif', 14, 14);\n * ```\n *\n * This will use the green-dot.gif with a width and height of 14 pixels as the\n * image to trigger new connections. In createIcons the icon field of the\n * handler will be set in order to remember the icon that has been clicked for\n * creating the new connection. This field will be available under selectedIcon\n * in the connect method, which may be overridden to take the icon that\n * triggered the new connection into account. This is useful if more than one\n * icon may be used to create a connection.\n *\n * ### Events\n *\n * #### InternalEvent.START\n *\n * Fires when a new connection is being created by the user. The `state`\n * property contains the state of the source cell.\n *\n * #### InternalEvent.CONNECT\n *\n * Fires between begin- and endUpdate in {@link connect}. The `cell`\n * property contains the inserted edge, the `event` and `target`\n * properties contain the respective arguments that were passed to {@link connect} (where\n * target corresponds to the dropTarget argument). Finally, the `terminal`\n * property corresponds to the target argument in {@link connect} or the clone of the source\n * terminal if {@link createTarget} is enabled.\n *\n * Note that the target is the cell under the mouse where the mouse button was released.\n * Depending on the logic in the handler, this doesn't necessarily have to be the target\n * of the inserted edge. To print the source, target or any optional ports IDs that the\n * edge is connected to, the following code can be used. To get more details about the\n * actual connection point, {@link AbstractGraph.getConnectionConstraint} can be used. To resolve\n * the port IDs, use {@link GraphDataModel.getCell}.\n *\n * ```javascript\n * graph.getPlugin('ConnectionHandler')?.addListener(mxEvent.CONNECT, (sender, evt) => {\n *   const edge = evt.getProperty('cell');\n *   const source = graph.getDataModel().getTerminal(edge, true);\n *   const target = graph.getDataModel().getTerminal(edge, false);\n *\n *   const style = graph.getCellStyle(edge);\n *   const sourcePortId = style.sourcePort;\n *   const targetPortId = style.targetPort;\n *\n *   GlobalConfig.logger.show();\n *   GlobalConfig.logger.debug('connect', edge, source.id, target.id, sourcePortId, targetPortId);\n * });\n * ```\n *\n * #### InternalEvent.RESET\n *\n * Fires when the {@link reset} method is invoked.\n *\n * @category Plugin\n */\nclass ConnectionHandler extends EventSource {\n    /**\n     * Constructs an event handler that connects vertices using the specified\n     * factory method to create the new edges.\n     *\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     * @param factoryMethod Optional function to create the edge. The function takes\n     * the source and target {@link Cell} as the first and second argument and an\n     * optional cell style from the preview as the third argument. It returns\n     * the {@link Cell} that represents the new edge.\n     */\n    constructor(graph, factoryMethod = null) {\n        super();\n        this.previous = null;\n        this.iconState = null;\n        this.icons = [];\n        this.cell = null;\n        this.currentPoint = null;\n        this.sourceConstraint = null;\n        this.shape = null;\n        this.icon = null;\n        this.originalPoint = null;\n        this.currentState = null;\n        this.selectedIcon = null;\n        this.waypoints = [];\n        /**\n         * Function that is used for creating new edges. The function takes the\n         * source and target {@link Cell} as the first and second argument and returns\n         * a new {@link Cell} that represents the edge. This is used in {@link createEdge}.\n         */\n        this.factoryMethod = null;\n        /**\n         * Specifies if icons should be displayed inside the graph container instead\n         * of the overlay pane. This is used for HTML labels on vertices which hide\n         * the connect icon. This has precedence over {@link moveIconBack} when set\n         * to true.\n         * @default `false`\n         */\n        this.moveIconFront = false;\n        /**\n         * Specifies if icons should be moved to the back of the overlay pane. This can\n         * be set to true if the icons of the connection handler conflict with other\n         * handles, such as the vertex label move handle. Default is false.\n         */\n        this.moveIconBack = false;\n        /**\n         * {@link Image} that is used to trigger the creation of a new connection.\n         * This is used in {@link createIcons}.\n         * @default null\n         */\n        this.connectImage = null;\n        /**\n         * Specifies if the connect icon should be centered on the target state\n         * while connections are being previewed. Default is false.\n         */\n        this.targetConnectImage = false;\n        /**\n         * Specifies if events are handled. Default is false.\n         */\n        this.enabled = false;\n        /**\n         * Specifies if new edges should be selected. Default is true.\n         */\n        this.select = true;\n        /**\n         * Specifies if <createTargetVertex> should be called if no target was under the\n         * mouse for the new connection. Setting this to true means the connection\n         * will be drawn as valid if no target is under the mouse, and\n         * <createTargetVertex> will be called before the connection is created between\n         * the source cell and the newly created vertex in <createTargetVertex>, which\n         * can be overridden to create a new target. Default is false.\n         */\n        this.createTarget = false;\n        /**\n         * Holds the current validation error while connections are being created.\n         */\n        this.error = null;\n        /**\n         * Specifies if single clicks should add waypoints on the new edge. Default is\n         * false.\n         */\n        this.waypointsEnabled = false;\n        /**\n         * Specifies if the connection handler should ignore the state of the mouse\n         * button when highlighting the source. Default is false, that is, the\n         * handler only highlights the source if no button is being pressed.\n         */\n        this.ignoreMouseDown = false;\n        /**\n         * Holds the {@link Point} where the mouseDown took place while the handler is\n         * active.\n         */\n        this.first = null;\n        /**\n         * Holds the offset for connect icons during connection preview.\n         * Default is mxPoint(0, {@link Constants#TOOLTIP_VERTICAL_OFFSET}).\n         * Note that placing the icon under the mouse pointer with an\n         * offset of (0,0) will affect hit detection.\n         */\n        this.connectIconOffset = new Point(0, TOOLTIP_VERTICAL_OFFSET);\n        /**\n         * Optional <CellState> that represents the preview edge while the\n         * handler is active. This is created in <createEdgeState>.\n         */\n        this.edgeState = null;\n        /**\n         * Counts the number of mouseDown events since the start. The initial mouse\n         * down event counts as 1.\n         */\n        this.mouseDownCounter = 0;\n        /**\n         * Switch to enable moving the preview away from the mousepointer. This is required in browsers\n         * where the preview cannot be made transparent to events and if the built-in hit detection on\n         * the HTML elements in the page should be used.\n         * @default false\n         */\n        this.movePreviewAway = false;\n        /**\n         * Specifies if connections to the outline of a highlighted target should be\n         * enabled. This will allow to place the connection point along the outline of\n         * the highlighted target.\n         * @default false\n         */\n        this.outlineConnect = false;\n        /**\n         * Specifies if the actual shape of the edge state should be used for the preview.\n         * Default is false. (Ignored if no edge state is created in <createEdgeState>.)\n         */\n        this.livePreview = false;\n        /**\n         * Specifies the cursor to be used while the handler is active.\n         * @default null\n         */\n        this.cursor = null;\n        /**\n         * Defines the cursor for a connectable state.\n         * @default 'pointer'\n         * @since 0.20.0\n         */\n        this.cursorConnect = 'pointer';\n        /**\n         * Specifies if new edges should be inserted before the source vertex in the\n         * cell hierarchy. Default is false for backwards compatibility.\n         */\n        this.insertBeforeSource = false;\n        this.graph = graph;\n        this.factoryMethod = factoryMethod;\n        this.graph.addMouseListener(this);\n        this.marker = this.createMarker();\n        this.constraintHandler = this.createConstraintHandler();\n        // Redraws the icons if the graph changes\n        this.changeHandler = (sender) => {\n            if (this.iconState) {\n                this.iconState = this.graph.getView().getState(this.iconState.cell);\n            }\n            if (this.iconState) {\n                this.redrawIcons(this.icons, this.iconState);\n                this.constraintHandler.reset();\n            }\n            else if (this.previous && !this.graph.view.getState(this.previous.cell)) {\n                this.reset();\n            }\n        };\n        this.graph.getDataModel().addListener(InternalEvent.CHANGE, this.changeHandler);\n        this.graph.getView().addListener(InternalEvent.SCALE, this.changeHandler);\n        this.graph.getView().addListener(InternalEvent.TRANSLATE, this.changeHandler);\n        this.graph\n            .getView()\n            .addListener(InternalEvent.SCALE_AND_TRANSLATE, this.changeHandler);\n        // Removes the icon if we step into/up or start editing\n        this.drillHandler = (sender) => {\n            this.reset();\n        };\n        this.graph.addListener(InternalEvent.START_EDITING, this.drillHandler);\n        this.graph.getView().addListener(InternalEvent.DOWN, this.drillHandler);\n        this.graph.getView().addListener(InternalEvent.UP, this.drillHandler);\n        // Handles escape keystrokes\n        this.escapeHandler = () => {\n            this.reset();\n        };\n        this.graph.addListener(InternalEvent.ESCAPE, this.escapeHandler);\n    }\n    /**\n     * Hook for subclasses to change the implementation of {@link ConstraintHandler} used here.\n     * @since 0.21.0\n     */\n    createConstraintHandler() {\n        return new ConstraintHandler(this.graph);\n    }\n    /**\n     * Returns true if events are handled. This implementation\n     * returns <enabled>.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling. This implementation\n     * updates <enabled>.\n     *\n     * @param enabled Boolean that specifies the new enabled state.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Returns <insertBeforeSource> for non-loops and false for loops.\n     *\n     * @param edge <Cell> that represents the edge to be inserted.\n     * @param source <Cell> that represents the source terminal.\n     * @param target <Cell> that represents the target terminal.\n     * @param evt Mousedown event of the connect gesture.\n     * @param dropTarget <Cell> that represents the cell under the mouse when it was\n     * released.\n     */\n    isInsertBefore(edge, source, target, evt, dropTarget) {\n        return this.insertBeforeSource && source !== target;\n    }\n    /**\n     * Returns <createTarget>.\n     *\n     * @param evt Current active native pointer event.\n     */\n    isCreateTarget(evt) {\n        return this.createTarget;\n    }\n    /**\n     * Sets <createTarget>.\n     */\n    setCreateTarget(value) {\n        this.createTarget = value;\n    }\n    /**\n     * Creates the preview shape for new connections.\n     */\n    createShape() {\n        // Creates the edge preview\n        const shape = this.livePreview && this.edgeState\n            ? this.graph.cellRenderer.createShape(this.edgeState)\n            : new PolylineShape([], INVALID_COLOR);\n        if (shape && shape.node) {\n            shape.dialect = 'svg';\n            shape.scale = this.graph.view.scale;\n            shape.pointerEvents = false;\n            shape.isDashed = true;\n            shape.init(this.graph.getView().getOverlayPane());\n            InternalEvent.redirectMouseEvents(shape.node, this.graph, null);\n        }\n        return shape;\n    }\n    /**\n     * Returns true if the given cell is connectable. This is a hook to\n     * disable floating connections. This implementation returns true.\n     */\n    isConnectableCell(cell) {\n        return true;\n    }\n    /**\n     * Creates and returns the {@link CellMarker} used in {@link arker}.\n     */\n    createMarker() {\n        return new ConnectionHandlerCellMarker(this.graph, this);\n    }\n    /**\n     * Starts a new connection for the given state and coordinates.\n     */\n    start(state, x, y, edgeState) {\n        this.previous = state;\n        this.first = new Point(x, y);\n        this.edgeState = edgeState ?? this.createEdgeState();\n        // Marks the source state\n        this.marker.currentColor = this.marker.validColor;\n        this.marker.markedState = state;\n        this.marker.mark();\n        this.fireEvent(new EventObject(InternalEvent.START, { state: this.previous }));\n    }\n    /**\n     * Returns true if the source terminal has been clicked and a new\n     * connection is currently being previewed.\n     */\n    isConnecting() {\n        return !!this.first && !!this.shape;\n    }\n    /**\n     * Returns {@link AbstractGraph.isValidSource} for the given source terminal.\n     *\n     * @param cell <Cell> that represents the source terminal.\n     * @param me {@link MouseEvent} that is associated with this call.\n     */\n    isValidSource(cell, me) {\n        return this.graph.isValidSource(cell);\n    }\n    /**\n     * Returns true. The call to {@link AbstractGraph.isValidTarget} is implicit by calling\n     * {@link AbstractGraph.getEdgeValidationError} in <validateConnection>. This is an\n     * additional hook for disabling certain targets in this specific handler.\n     *\n     * @param cell <Cell> that represents the target terminal.\n     */\n    isValidTarget(cell) {\n        return true;\n    }\n    /**\n     * Returns the error message or an empty string if the connection for the\n     * given source target pair is not valid. Otherwise it returns null. This\n     * implementation uses {@link AbstractGraph.getEdgeValidationError}.\n     *\n     * @param source <Cell> that represents the source terminal.\n     * @param target <Cell> that represents the target terminal.\n     */\n    validateConnection(source, target) {\n        if (!this.isValidTarget(target)) {\n            return '';\n        }\n        return this.graph.getEdgeValidationError(null, source, target);\n    }\n    /**\n     * Hook to return the {@link Image} used for the connection icon of the given\n     * {@link CellState}. This implementation returns {@link connectImage}.\n     *\n     * @param state {@link CellState} whose connect image should be returned.\n     */\n    getConnectImage(state) {\n        return this.connectImage;\n    }\n    /**\n     * Returns true if the state has a HTML label in the graph's container, otherwise\n     * it returns {@link oveIconFront}.\n     *\n     * @param state <CellState> whose connect icons should be returned.\n     */\n    isMoveIconToFrontForState(state) {\n        if (state.text && state.text.node.parentNode === this.graph.container) {\n            return true;\n        }\n        return this.moveIconFront;\n    }\n    /**\n     * Creates the array {@link ImageShape}s that represent the connect icons for\n     * the given {@link CellState}.\n     *\n     * @param state {@link CellState} whose connect icons should be returned.\n     */\n    createIcons(state) {\n        const image = this.getConnectImage(state);\n        if (image) {\n            this.iconState = state;\n            const icons = [];\n            // Cannot use HTML for the connect icons because the icon receives all\n            // mouse move events in IE, must use VML and SVG instead even if the\n            // connect-icon appears behind the selection border and the selection\n            // border consumes the events before the icon gets a chance\n            const bounds = new Rectangle(0, 0, image.width, image.height);\n            const icon = new ImageShape(bounds, image.src, undefined, undefined, 0);\n            icon.preserveImageAspect = false;\n            if (this.isMoveIconToFrontForState(state)) {\n                icon.dialect = 'strictHtml';\n                icon.init(this.graph.container);\n            }\n            else {\n                icon.dialect = 'svg';\n                icon.init(this.graph.getView().getOverlayPane());\n                // Move the icon back in the overlay pane\n                if (this.moveIconBack && icon.node.parentNode && icon.node.previousSibling) {\n                    icon.node.parentNode.insertBefore(icon.node, icon.node.parentNode.firstChild);\n                }\n            }\n            icon.node.style.cursor = this.cursorConnect;\n            // Events transparency\n            const getState = () => {\n                return this.currentState ?? state;\n            };\n            // Updates the local icon before firing the mouse down event.\n            const mouseDown = (evt) => {\n                if (!isConsumed(evt)) {\n                    this.icon = icon;\n                    this.graph.fireMouseEvent(InternalEvent.MOUSE_DOWN, new InternalMouseEvent(evt, getState()));\n                }\n            };\n            InternalEvent.redirectMouseEvents(icon.node, this.graph, getState, mouseDown);\n            icons.push(icon);\n            this.redrawIcons(icons, this.iconState);\n            return icons;\n        }\n        return [];\n    }\n    /**\n     * Redraws the given array of {@link ImageShapes}.\n     *\n     * @param icons Array of {@link ImageShapes} to be redrawn.\n     */\n    redrawIcons(icons, state) {\n        if (icons[0] && icons[0].bounds) {\n            const pos = this.getIconPosition(icons[0], state);\n            icons[0].bounds.x = pos.x;\n            icons[0].bounds.y = pos.y;\n            icons[0].redraw();\n        }\n    }\n    // TODO: Document me! ===========================================================================================================\n    getIconPosition(icon, state) {\n        const { scale } = this.graph.getView();\n        let cx = state.getCenterX();\n        let cy = state.getCenterY();\n        if (this.graph.isSwimlane(state.cell)) {\n            const size = this.graph.getStartSize(state.cell);\n            cx = size.width !== 0 ? state.x + (size.width * scale) / 2 : cx;\n            cy = size.height !== 0 ? state.y + (size.height * scale) / 2 : cy;\n            const alpha = toRadians(state.style.rotation ?? 0);\n            if (alpha !== 0) {\n                const cos = Math.cos(alpha);\n                const sin = Math.sin(alpha);\n                const ct = new Point(state.getCenterX(), state.getCenterY());\n                const pt = getRotatedPoint(new Point(cx, cy), cos, sin, ct);\n                cx = pt.x;\n                cy = pt.y;\n            }\n        }\n        return new Point(cx - icon.bounds.width / 2, cy - icon.bounds.height / 2);\n    }\n    /**\n     * Destroys the connect icons and resets the respective state.\n     */\n    destroyIcons() {\n        for (let i = 0; i < this.icons.length; i += 1) {\n            this.icons[i].destroy();\n        }\n        this.icons = [];\n        this.icon = null;\n        this.selectedIcon = null;\n        this.iconState = null;\n    }\n    /**\n     * Returns true if the given mouse down event should start this handler. The\n     * This implementation returns true if the event does not force marquee\n     * selection, and the currentConstraint and currentFocus of the\n     * <constraintHandler> are not null, or <previous> and <error> are not null and\n     * <icons> is null or <icons> and <icon> are not null.\n     */\n    isStartEvent(me) {\n        return ((this.constraintHandler.currentFocus !== null &&\n            this.constraintHandler.currentConstraint !== null) ||\n            (this.previous !== null &&\n                this.error === null &&\n                (this.icons.length === 0 || this.icon !== null)));\n    }\n    /**\n     * Handles the event by initiating a new connection.\n     */\n    mouseDown(_sender, me) {\n        this.mouseDownCounter += 1;\n        if (this.isEnabled() &&\n            this.graph.isEnabled() &&\n            !me.isConsumed() &&\n            !this.isConnecting() &&\n            this.isStartEvent(me)) {\n            if (this.constraintHandler.currentConstraint &&\n                this.constraintHandler.currentFocus &&\n                this.constraintHandler.currentPoint) {\n                this.sourceConstraint = this.constraintHandler.currentConstraint;\n                this.previous = this.constraintHandler.currentFocus;\n                this.first = this.constraintHandler.currentPoint.clone();\n            }\n            else {\n                // Stores the location of the initial mousedown\n                this.first = new Point(me.getGraphX(), me.getGraphY());\n            }\n            this.edgeState = this.createEdgeState(me);\n            this.mouseDownCounter = 1;\n            if (this.waypointsEnabled && !this.shape) {\n                this.waypoints = [];\n                this.shape = this.createShape();\n                if (this.edgeState) {\n                    this.shape.apply(this.edgeState);\n                }\n            }\n            // Stores the starting point in the geometry of the preview\n            if (!this.previous && this.edgeState && this.edgeState.cell.geometry) {\n                const pt = this.graph.getPointForEvent(me.getEvent());\n                this.edgeState.cell.geometry.setTerminalPoint(pt, true);\n            }\n            this.fireEvent(new EventObject(InternalEvent.START, { state: this.previous }));\n            me.consume();\n        }\n        this.selectedIcon = this.icon;\n        this.icon = null;\n    }\n    /**\n     * Returns true if a tap on the given source state should immediately start\n     * connecting. This implementation returns true if the state is not movable\n     * in the graph.\n     */\n    isImmediateConnectSource(state) {\n        return !this.graph.isCellMovable(state.cell);\n    }\n    /**\n     * Hook to return an <CellState> which may be used during the preview.\n     * This implementation returns null.\n     *\n     * Use the following code to create a preview for an existing edge style:\n     *\n     * ```javascript\n     * graph.getPlugin('ConnectionHandler').createEdgeState(me)\n     * {\n     *   var edge = graph.createEdge(null, null, null, null, null, 'edgeStyle=elbowEdgeStyle');\n     *\n     *   return new CellState(this.graph.view, edge, this.graph.getCellStyle(edge));\n     * };\n     * ```\n     */\n    createEdgeState(me) {\n        return null;\n    }\n    /**\n     * Returns true if <outlineConnect> is true and the source of the event is the outline shape\n     * or shift is pressed.\n     */\n    isOutlineConnectEvent(me) {\n        if (!this.currentPoint)\n            return false;\n        const offset = getOffset(this.graph.container);\n        const evt = me.getEvent();\n        const clientX = getClientX(evt);\n        const clientY = getClientY(evt);\n        const doc = document.documentElement;\n        const left = (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);\n        const top = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);\n        const gridX = this.currentPoint.x - this.graph.container.scrollLeft + offset.x - left;\n        const gridY = this.currentPoint.y - this.graph.container.scrollTop + offset.y - top;\n        return (this.outlineConnect &&\n            !isShiftDown(me.getEvent()) &&\n            (me.isSource(this.marker.highlight.shape) ||\n                (isAltDown(me.getEvent()) && me.getState() != null) ||\n                this.marker.highlight.isHighlightAt(clientX, clientY) ||\n                ((gridX !== clientX || gridY !== clientY) &&\n                    me.getState() == null &&\n                    this.marker.highlight.isHighlightAt(gridX, gridY))));\n    }\n    /**\n     * Updates the current state for a given mouse move event by using\n     * the {@link arker}.\n     */\n    updateCurrentState(me, point) {\n        this.constraintHandler.update(me, !this.first, false, !this.first || me.isSource(this.marker.highlight.shape) ? null : point);\n        if (this.constraintHandler.currentFocus != null &&\n            this.constraintHandler.currentConstraint != null) {\n            // Handles special case where grid is large and connection point is at actual point in which\n            // case the outline is not followed as long as we're < gridSize / 2 away from that point\n            if (this.marker.highlight &&\n                this.marker.highlight.state &&\n                this.marker.highlight.state.cell === this.constraintHandler.currentFocus.cell &&\n                this.marker.highlight.shape) {\n                // Direct repaint needed if cell already highlighted\n                if (this.marker.highlight.shape.stroke !== 'transparent') {\n                    this.marker.highlight.shape.stroke = 'transparent';\n                    this.marker.highlight.repaint();\n                }\n            }\n            else {\n                this.marker.markCell(this.constraintHandler.currentFocus.cell, 'transparent');\n            }\n            // Updates validation state\n            if (this.previous) {\n                this.error = this.validateConnection(this.previous.cell, this.constraintHandler.currentFocus.cell);\n                if (!this.error) {\n                    this.currentState = this.constraintHandler.currentFocus;\n                }\n                if (this.error ||\n                    (this.currentState && !this.isCellEnabled(this.currentState.cell))) {\n                    this.constraintHandler.reset();\n                }\n            }\n        }\n        else {\n            if (this.graph.isIgnoreTerminalEvent(me.getEvent())) {\n                this.marker.reset();\n                this.currentState = null;\n            }\n            else {\n                this.marker.process(me);\n                this.currentState = this.marker.getValidState();\n            }\n            if (this.currentState != null && !this.isCellEnabled(this.currentState.cell)) {\n                this.constraintHandler.reset();\n                this.marker.reset();\n                this.currentState = null;\n            }\n            const outline = this.isOutlineConnectEvent(me);\n            if (this.currentState != null && outline) {\n                // Handles special case where mouse is on outline away from actual end point\n                // in which case the grid is ignored and mouse point is used instead\n                if (me.isSource(this.marker.highlight.shape)) {\n                    point = new Point(me.getGraphX(), me.getGraphY());\n                }\n                const constraint = this.graph.getOutlineConstraint(point, this.currentState, me);\n                this.constraintHandler.setFocus(me, this.currentState, false);\n                this.constraintHandler.currentConstraint = constraint;\n                this.constraintHandler.currentPoint = point;\n            }\n            if (this.outlineConnect) {\n                if (this.marker.highlight != null && this.marker.highlight.shape != null) {\n                    const s = this.graph.view.scale;\n                    if (this.constraintHandler.currentConstraint != null &&\n                        this.constraintHandler.currentFocus != null) {\n                        this.marker.highlight.shape.stroke = OUTLINE_HIGHLIGHT_COLOR;\n                        this.marker.highlight.shape.strokeWidth =\n                            OUTLINE_HIGHLIGHT_STROKEWIDTH / s / s;\n                        this.marker.highlight.repaint();\n                    }\n                    else if (this.marker.hasValidState()) {\n                        const cell = me.getCell();\n                        // Handles special case where actual end point of edge and current mouse point\n                        // are not equal (due to grid snapping) and there is no hit on shape or highlight\n                        // but ignores cases where parent is used for non-connectable child cells\n                        if (cell &&\n                            cell.isConnectable() &&\n                            this.marker.getValidState() !== me.getState()) {\n                            this.marker.highlight.shape.stroke = 'transparent';\n                            this.currentState = null;\n                        }\n                        else {\n                            this.marker.highlight.shape.stroke = DEFAULT_VALID_COLOR;\n                        }\n                        this.marker.highlight.shape.strokeWidth = HIGHLIGHT_STROKEWIDTH / s / s;\n                        this.marker.highlight.repaint();\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Returns true if the given cell does not allow new connections to be created.\n     */\n    isCellEnabled(cell) {\n        return true;\n    }\n    /**\n     * Converts the given point from screen coordinates to model coordinates.\n     */\n    convertWaypoint(point) {\n        const scale = this.graph.getView().getScale();\n        const tr = this.graph.getView().getTranslate();\n        point.x = point.x / scale - tr.x;\n        point.y = point.y / scale - tr.y;\n    }\n    /**\n     * Called to snap the given point to the current preview. This snaps to the\n     * first point of the preview if alt is not pressed.\n     */\n    snapToPreview(me, point) {\n        if (!isAltDown(me.getEvent()) && this.previous) {\n            const tol = (this.graph.getGridSize() * this.graph.view.scale) / 2;\n            const tmp = this.sourceConstraint && this.first\n                ? this.first\n                : new Point(this.previous.getCenterX(), this.previous.getCenterY());\n            if (Math.abs(tmp.x - me.getGraphX()) < tol) {\n                point.x = tmp.x;\n            }\n            if (Math.abs(tmp.y - me.getGraphY()) < tol) {\n                point.y = tmp.y;\n            }\n        }\n    }\n    /**\n     * Handles the event by updating the preview edge or by highlighting\n     * a possible source or target terminal.\n     */\n    mouseMove(_sender, me) {\n        if (!me.isConsumed() &&\n            (this.ignoreMouseDown || this.first || !this.graph.isMouseDown)) {\n            // Handles special case when handler is disabled during highlight\n            if (!this.isEnabled() && this.currentState) {\n                this.destroyIcons();\n                this.currentState = null;\n            }\n            const view = this.graph.getView();\n            const { scale } = view;\n            const tr = view.translate;\n            let point = new Point(me.getGraphX(), me.getGraphY());\n            this.error = null;\n            if (this.graph.isGridEnabledEvent(me.getEvent())) {\n                point = new Point((this.graph.snap(point.x / scale - tr.x) + tr.x) * scale, (this.graph.snap(point.y / scale - tr.y) + tr.y) * scale);\n            }\n            this.snapToPreview(me, point);\n            this.currentPoint = point;\n            if ((this.first || (this.isEnabled() && this.graph.isEnabled())) &&\n                (this.shape ||\n                    !this.first ||\n                    Math.abs(me.getGraphX() - this.first.x) > this.graph.getEventTolerance() ||\n                    Math.abs(me.getGraphY() - this.first.y) > this.graph.getEventTolerance())) {\n                this.updateCurrentState(me, point);\n            }\n            if (this.first) {\n                let constraint = null;\n                let current = point;\n                // Uses the current point from the constraint handler if available\n                if (this.constraintHandler.currentConstraint &&\n                    this.constraintHandler.currentFocus &&\n                    this.constraintHandler.currentPoint) {\n                    constraint = this.constraintHandler.currentConstraint;\n                    current = this.constraintHandler.currentPoint.clone();\n                }\n                else if (this.previous &&\n                    !this.graph.isIgnoreTerminalEvent(me.getEvent()) &&\n                    isShiftDown(me.getEvent())) {\n                    if (Math.abs(this.previous.getCenterX() - point.x) <\n                        Math.abs(this.previous.getCenterY() - point.y)) {\n                        point.x = this.previous.getCenterX();\n                    }\n                    else {\n                        point.y = this.previous.getCenterY();\n                    }\n                }\n                let pt2 = this.first;\n                // Moves the connect icon with the mouse\n                if (this.selectedIcon && this.selectedIcon.bounds) {\n                    const w = this.selectedIcon.bounds.width;\n                    const h = this.selectedIcon.bounds.height;\n                    if (this.currentState && this.targetConnectImage) {\n                        const pos = this.getIconPosition(this.selectedIcon, this.currentState);\n                        this.selectedIcon.bounds.x = pos.x;\n                        this.selectedIcon.bounds.y = pos.y;\n                    }\n                    else {\n                        const bounds = new Rectangle(me.getGraphX() + this.connectIconOffset.x, me.getGraphY() + this.connectIconOffset.y, w, h);\n                        this.selectedIcon.bounds = bounds;\n                    }\n                    this.selectedIcon.redraw();\n                }\n                // Uses edge state to compute the terminal points\n                if (this.edgeState) {\n                    this.updateEdgeState(current, constraint);\n                    current =\n                        this.edgeState.absolutePoints[this.edgeState.absolutePoints.length - 1];\n                    pt2 = this.edgeState.absolutePoints[0];\n                }\n                else {\n                    if (this.currentState) {\n                        if (!this.constraintHandler.currentConstraint) {\n                            const tmp = this.getTargetPerimeterPoint(this.currentState, me);\n                            if (tmp != null) {\n                                current = tmp;\n                            }\n                        }\n                    }\n                    // Computes the source perimeter point\n                    if (!this.sourceConstraint && this.previous) {\n                        const next = this.waypoints.length > 0 ? this.waypoints[0] : current;\n                        const tmp = this.getSourcePerimeterPoint(this.previous, next, me);\n                        if (tmp) {\n                            pt2 = tmp;\n                        }\n                    }\n                }\n                // Makes sure the cell under the mousepointer can be detected\n                // by moving the preview shape away from the mouse. This\n                // makes sure the preview shape does not prevent the detection\n                // of the cell under the mousepointer even for slow gestures.\n                if (!this.currentState && this.movePreviewAway && current) {\n                    let tmp = pt2;\n                    if (this.edgeState && this.edgeState.absolutePoints.length >= 2) {\n                        const tmp2 = this.edgeState.absolutePoints[this.edgeState.absolutePoints.length - 2];\n                        if (tmp2) {\n                            tmp = tmp2;\n                        }\n                    }\n                    if (tmp) {\n                        const dx = current.x - tmp.x;\n                        const dy = current.y - tmp.y;\n                        const len = Math.sqrt(dx * dx + dy * dy);\n                        if (len === 0) {\n                            return;\n                        }\n                        // Stores old point to reuse when creating edge\n                        this.originalPoint = current.clone();\n                        current.x -= (dx * 4) / len;\n                        current.y -= (dy * 4) / len;\n                    }\n                }\n                else {\n                    this.originalPoint = null;\n                }\n                // Creates the preview shape (lazy)\n                if (!this.shape) {\n                    const dx = Math.abs(me.getGraphX() - this.first.x);\n                    const dy = Math.abs(me.getGraphY() - this.first.y);\n                    if (dx > this.graph.getEventTolerance() ||\n                        dy > this.graph.getEventTolerance()) {\n                        this.shape = this.createShape();\n                        if (this.edgeState) {\n                            this.shape.apply(this.edgeState);\n                        }\n                        // Revalidates current connection\n                        this.updateCurrentState(me, point);\n                    }\n                }\n                // Updates the points in the preview edge\n                if (this.shape) {\n                    if (this.edgeState) {\n                        this.shape.points = this.edgeState.absolutePoints;\n                    }\n                    else {\n                        let pts = [pt2];\n                        if (this.waypoints.length > 0) {\n                            pts = pts.concat(this.waypoints);\n                        }\n                        pts.push(current);\n                        this.shape.points = pts;\n                    }\n                    this.drawPreview();\n                }\n                // Makes sure endpoint of edge is visible during connect\n                if (this.cursor) {\n                    this.graph.container.style.cursor = this.cursor;\n                }\n                InternalEvent.consume(me.getEvent());\n                me.consume();\n            }\n            else if (!this.isEnabled() || !this.graph.isEnabled()) {\n                this.constraintHandler.reset();\n            }\n            else if (this.previous !== this.currentState && !this.edgeState) {\n                this.destroyIcons();\n                // Sets the cursor on the current shape\n                if (this.currentState &&\n                    !this.error &&\n                    !this.constraintHandler.currentConstraint) {\n                    this.icons = this.createIcons(this.currentState);\n                    if (this.icons.length === 0) {\n                        this.currentState.setCursor(this.cursorConnect);\n                        me.consume();\n                    }\n                }\n                this.previous = this.currentState;\n            }\n            else if (this.previous === this.currentState &&\n                this.currentState != null &&\n                this.icons.length === 0 &&\n                !this.graph.isMouseDown) {\n                // Makes sure that no cursors are changed\n                me.consume();\n            }\n            if (!this.graph.isMouseDown && this.currentState != null && this.icons != null) {\n                let hitsIcon = false;\n                const target = me.getSource();\n                for (let i = 0; i < this.icons.length && !hitsIcon; i += 1) {\n                    hitsIcon =\n                        target === this.icons[i].node ||\n                            // @ts-ignore parentNode should exist.\n                            (!!target && target.parentNode === this.icons[i].node);\n                }\n                if (!hitsIcon) {\n                    this.updateIcons(this.currentState, this.icons, me);\n                }\n            }\n        }\n        else {\n            this.constraintHandler.reset();\n        }\n    }\n    /**\n     * Updates {@link edgeState}.\n     */\n    updateEdgeState(current, constraint) {\n        if (!this.edgeState)\n            return;\n        // TODO: Use generic method for writing constraint to style\n        if (this.sourceConstraint && this.sourceConstraint.point) {\n            this.edgeState.style.exitX = this.sourceConstraint.point.x;\n            this.edgeState.style.exitY = this.sourceConstraint.point.y;\n        }\n        if (constraint && constraint.point) {\n            this.edgeState.style.entryX = constraint.point.x;\n            this.edgeState.style.entryY = constraint.point.y;\n        }\n        else {\n            this.edgeState.style.entryX = 0;\n            this.edgeState.style.entryY = 0;\n        }\n        this.edgeState.absolutePoints = [null, this.currentState != null ? null : current];\n        if (this.sourceConstraint) {\n            this.graph.view.updateFixedTerminalPoint(this.edgeState, this.previous, true, this.sourceConstraint);\n        }\n        if (this.currentState != null) {\n            if (constraint == null) {\n                constraint = this.graph.getConnectionConstraint(this.edgeState, this.previous, false);\n            }\n            this.edgeState.setAbsoluteTerminalPoint(null, false);\n            this.graph.view.updateFixedTerminalPoint(this.edgeState, this.currentState, false, constraint);\n        }\n        // Scales and translates the waypoints to the model\n        const realPoints = [];\n        for (let i = 0; i < this.waypoints.length; i += 1) {\n            const pt = this.waypoints[i].clone();\n            this.convertWaypoint(pt);\n            realPoints[i] = pt;\n        }\n        this.graph.view.updatePoints(this.edgeState, realPoints, this.previous, this.currentState);\n        this.graph.view.updateFloatingTerminalPoints(this.edgeState, this.previous, this.currentState);\n    }\n    /**\n     * Returns the perimeter point for the given target state.\n     *\n     * @param state <CellState> that represents the target cell state.\n     * @param _me {@link MouseEvent} that represents the mouse move.\n     */\n    getTargetPerimeterPoint(state, _me) {\n        let result = null;\n        const { view } = state;\n        const targetPerimeter = view.getPerimeterFunction(state);\n        if (targetPerimeter && this.previous && this.edgeState) {\n            const next = this.waypoints.length > 0\n                ? this.waypoints[this.waypoints.length - 1]\n                : new Point(this.previous.getCenterX(), this.previous.getCenterY());\n            const tmp = targetPerimeter(view.getPerimeterBounds(state), this.edgeState, next, false);\n            if (tmp) {\n                result = tmp;\n            }\n        }\n        else {\n            result = new Point(state.getCenterX(), state.getCenterY());\n        }\n        return result;\n    }\n    /**\n     * Hook to update the icon position(s) based on a mouseOver event. This is\n     * an empty implementation.\n     *\n     * @param state <CellState> that represents the target cell state.\n     * @param next {@link Point} that represents the next point along the previewed edge.\n     * @param me {@link MouseEvent} that represents the mouse move.\n     */\n    getSourcePerimeterPoint(state, next, me) {\n        let result = null;\n        const { view } = state;\n        const sourcePerimeter = view.getPerimeterFunction(state);\n        const c = new Point(state.getCenterX(), state.getCenterY());\n        if (sourcePerimeter) {\n            const theta = state.style.rotation ?? 0;\n            const rad = -theta * (Math.PI / 180);\n            if (theta !== 0) {\n                next = getRotatedPoint(new Point(next.x, next.y), Math.cos(rad), Math.sin(rad), c);\n            }\n            let tmp = sourcePerimeter(view.getPerimeterBounds(state), state, next, false);\n            if (tmp) {\n                if (theta !== 0) {\n                    tmp = getRotatedPoint(new Point(tmp.x, tmp.y), Math.cos(-rad), Math.sin(-rad), c);\n                }\n                result = tmp;\n            }\n        }\n        else {\n            result = c;\n        }\n        return result;\n    }\n    /**\n     * Hook to update the icon position(s) based on a mouseOver event. This is\n     * an empty implementation.\n     *\n     * @param state <CellState> under the mouse.\n     * @param icons Array of currently displayed icons.\n     * @param me {@link MouseEvent} that contains the mouse event.\n     */\n    updateIcons(state, icons, me) {\n        // empty\n    }\n    /**\n     * Returns true if the given mouse up event should stop this handler. The\n     * connection will be created if <error> is null. Note that this is only\n     * called if <waypointsEnabled> is true. This implemtation returns true\n     * if there is a cell state in the given event.\n     */\n    isStopEvent(me) {\n        return !!me.getState();\n    }\n    /**\n     * Adds the waypoint for the given event to <waypoints>.\n     */\n    addWaypointForEvent(me) {\n        if (!this.first)\n            return;\n        let point = convertPoint(this.graph.container, me.getX(), me.getY());\n        const dx = Math.abs(point.x - this.first.x);\n        const dy = Math.abs(point.y - this.first.y);\n        const addPoint = this.waypoints.length > 0 ||\n            (this.mouseDownCounter > 1 &&\n                (dx > this.graph.getEventTolerance() || dy > this.graph.getEventTolerance()));\n        if (addPoint) {\n            const { scale } = this.graph.view;\n            point = new Point(this.graph.snap(me.getGraphX() / scale) * scale, this.graph.snap(me.getGraphY() / scale) * scale);\n            this.waypoints.push(point);\n        }\n    }\n    /**\n     * Returns true if the connection for the given constraints is valid. This\n     * implementation returns true if the constraints are not pointing to the\n     * same fixed connection point.\n     */\n    checkConstraints(c1, c2) {\n        return (!c1 ||\n            !c2 ||\n            !c1.point ||\n            !c2.point ||\n            !c1.point.equals(c2.point) ||\n            c1.dx !== c2.dx ||\n            c1.dy !== c2.dy ||\n            c1.perimeter !== c2.perimeter);\n    }\n    /**\n     * Handles the event by inserting the new connection.\n     */\n    mouseUp(_sender, me) {\n        if (!me.isConsumed() && this.isConnecting()) {\n            if (this.waypointsEnabled && !this.isStopEvent(me)) {\n                this.addWaypointForEvent(me);\n                me.consume();\n                return;\n            }\n            const c1 = this.sourceConstraint;\n            const c2 = this.constraintHandler.currentConstraint;\n            const source = this.previous ? this.previous.cell : null;\n            let target = null;\n            if (this.constraintHandler.currentConstraint &&\n                this.constraintHandler.currentFocus) {\n                target = this.constraintHandler.currentFocus.cell;\n            }\n            if (!target && this.currentState) {\n                target = this.currentState.cell;\n            }\n            // Inserts the edge if no validation error exists and if constraints differ\n            if (!this.error &&\n                (!source || !target || source !== target || this.checkConstraints(c1, c2))) {\n                this.connect(source, target, me.getEvent(), me.getCell());\n            }\n            else {\n                // Selects the source terminal for self-references\n                if (this.previous != null &&\n                    this.marker.validState != null &&\n                    this.previous.cell === this.marker.validState.cell) {\n                    this.graph.selectCellForEvent(this.marker.validState.cell, me.getEvent());\n                }\n                // Displays the error message if it is not an empty string,\n                // for empty error messages, the event is silently dropped\n                if (this.error != null && this.error.length > 0) {\n                    this.graph.validationAlert(this.error);\n                }\n            }\n            // Redraws the connect icons and resets the handler state\n            this.destroyIcons();\n            me.consume();\n        }\n        if (this.first != null) {\n            this.reset();\n        }\n    }\n    /**\n     * Resets the state of this handler.\n     */\n    reset() {\n        if (this.shape != null) {\n            this.shape.destroy();\n            this.shape = null;\n        }\n        // Resets the cursor on the container\n        if (this.cursor != null && this.graph.container != null) {\n            this.graph.container.style.cursor = '';\n        }\n        this.destroyIcons();\n        this.marker.reset();\n        this.constraintHandler.reset();\n        this.originalPoint = null;\n        this.currentPoint = null;\n        this.edgeState = null;\n        this.previous = null;\n        this.error = null;\n        this.sourceConstraint = null;\n        this.mouseDownCounter = 0;\n        this.first = null;\n        this.fireEvent(new EventObject(InternalEvent.RESET));\n    }\n    /**\n     * Redraws the preview edge using the color and width returned by\n     * <getEdgeColor> and <getEdgeWidth>.\n     */\n    drawPreview() {\n        this.updatePreview(this.error === null);\n        if (this.shape)\n            this.shape.redraw();\n    }\n    /**\n     * Returns the color used to draw the preview edge. This returns green if\n     * there is no edge validation error and red otherwise.\n     *\n     * @param valid Boolean indicating if the color for a valid edge should be\n     * returned.\n     */\n    updatePreview(valid) {\n        if (this.shape) {\n            this.shape.strokeWidth = this.getEdgeWidth(valid);\n            this.shape.stroke = this.getEdgeColor(valid);\n        }\n    }\n    /**\n     * Returns the color used to draw the preview edge. This returns green if\n     * there is no edge validation error and red otherwise.\n     *\n     * @param valid Boolean indicating if the color for a valid edge should be\n     * returned.\n     */\n    getEdgeColor(valid) {\n        return valid ? VALID_COLOR : INVALID_COLOR;\n    }\n    /**\n     * Returns the width used to draw the preview edge. This returns 3 if\n     * there is no edge validation error and 1 otherwise.\n     *\n     * @param valid Boolean indicating if the width for a valid edge should be\n     * returned.\n     */\n    getEdgeWidth(valid) {\n        return valid ? 3 : 1;\n    }\n    /**\n     * Connects the given source and target using a new edge. This\n     * implementation uses <createEdge> to create the edge.\n     *\n     * @param source <Cell> that represents the source terminal.\n     * @param target <Cell> that represents the target terminal.\n     * @param evt Mousedown event of the connect gesture.\n     * @param dropTarget <Cell> that represents the cell under the mouse when it was\n     * released.\n     */\n    connect(source, target, evt, dropTarget = null) {\n        if (target || this.isCreateTarget(evt) || this.graph.isAllowDanglingEdges()) {\n            // Uses the common parent of source and target or\n            // the default parent to insert the edge\n            const model = this.graph.getDataModel();\n            let terminalInserted = false;\n            let edge = null;\n            model.beginUpdate();\n            try {\n                if (source &&\n                    !target &&\n                    !this.graph.isIgnoreTerminalEvent(evt) &&\n                    this.isCreateTarget(evt)) {\n                    target = this.createTargetVertex(evt, source);\n                    if (target) {\n                        dropTarget = this.graph.getDropTarget([target], evt, dropTarget);\n                        terminalInserted = true;\n                        // Disables edges as drop targets if the target cell was created\n                        // FIXME: Should not shift if vertex was aligned (same in Java)\n                        if (dropTarget == null || !dropTarget.isEdge()) {\n                            const pstate = dropTarget\n                                ? this.graph.getView().getState(dropTarget)\n                                : null;\n                            if (pstate) {\n                                const tmp = target.getGeometry();\n                                if (tmp) {\n                                    tmp.x -= pstate.origin.x;\n                                    tmp.y -= pstate.origin.y;\n                                }\n                            }\n                        }\n                        else {\n                            dropTarget = this.graph.getDefaultParent();\n                        }\n                        this.graph.addCell(target, dropTarget);\n                    }\n                }\n                let parent = this.graph.getDefaultParent();\n                if (source &&\n                    target &&\n                    source.getParent() === target.getParent() &&\n                    source.getParent()?.getParent() !== model.getRoot()) {\n                    parent = source.getParent();\n                    if (source.geometry &&\n                        source.geometry.relative &&\n                        target.geometry &&\n                        target.geometry.relative) {\n                        parent = parent.getParent();\n                    }\n                }\n                // Uses the value of the preview edge state for inserting\n                // the new edge into the graph\n                let value = null;\n                let style = {};\n                if (this.edgeState?.cell) {\n                    value = this.edgeState.cell.value;\n                    style = this.edgeState.cell.style ?? {};\n                }\n                edge = this.insertEdge(parent, '', value, source, target, style);\n                if (edge && source) {\n                    // Updates the connection constraints\n                    this.graph.setConnectionConstraint(edge, source, true, this.sourceConstraint);\n                    this.graph.setConnectionConstraint(edge, target, false, this.constraintHandler.currentConstraint);\n                    // Uses geometry of the preview edge state\n                    if (this.edgeState?.cell?.geometry) {\n                        model.setGeometry(edge, this.edgeState.cell.geometry);\n                    }\n                    parent = source.getParent();\n                    // Inserts edge before source\n                    if (this.isInsertBefore(edge, source, target, evt, dropTarget)) {\n                        const index = null;\n                        let tmp = source;\n                        while (tmp &&\n                            tmp.parent != null &&\n                            tmp.geometry != null &&\n                            tmp.geometry.relative &&\n                            tmp.parent !== edge.parent) {\n                            tmp = tmp.getParent();\n                        }\n                        if (tmp != null && tmp.parent != null && tmp.parent === edge.parent) {\n                            model.add(parent, edge, tmp.parent.getIndex(tmp));\n                        }\n                    }\n                    // Makes sure the edge has a non-null, relative geometry\n                    let geo = edge.getGeometry();\n                    if (geo == null) {\n                        geo = new Geometry();\n                        geo.relative = true;\n                        model.setGeometry(edge, geo);\n                    }\n                    // Uses scaled waypoints in geometry\n                    if (this.waypoints.length > 0) {\n                        const s = this.graph.view.scale;\n                        const tr = this.graph.view.translate;\n                        geo.points = [];\n                        for (let i = 0; i < this.waypoints.length; i += 1) {\n                            const pt = this.waypoints[i];\n                            geo.points.push(new Point(pt.x / s - tr.x, pt.y / s - tr.y));\n                        }\n                    }\n                    if (!target && this.currentPoint) {\n                        const t = this.graph.view.translate;\n                        const s = this.graph.view.scale;\n                        const pt = this.originalPoint != null\n                            ? new Point(this.originalPoint.x / s - t.x, this.originalPoint.y / s - t.y)\n                            : new Point(this.currentPoint.x / s - t.x, this.currentPoint.y / s - t.y);\n                        pt.x -= this.graph.getPanDx() / this.graph.view.scale;\n                        pt.y -= this.graph.getPanDy() / this.graph.view.scale;\n                        geo.setTerminalPoint(pt, false);\n                    }\n                    this.fireEvent(new EventObject(InternalEvent.CONNECT, 'cell', edge, 'terminal', target, 'event', evt, 'target', dropTarget, 'terminalInserted', terminalInserted));\n                }\n            }\n            catch (e) {\n                GlobalConfig.logger.show();\n                const errorMessage = `Error in ConnectionHandler: ${e instanceof Error ? e.message + '\\n' + e.stack : 'unknown cause'}`;\n                GlobalConfig.logger.debug(errorMessage);\n            }\n            finally {\n                model.endUpdate();\n            }\n            if (this.select) {\n                this.selectCells(edge, terminalInserted ? target : null);\n            }\n        }\n    }\n    /**\n     * Selects the given edge after adding a new connection. The target argument\n     * contains the target vertex if one has been inserted.\n     */\n    selectCells(edge, target) {\n        this.graph.setSelectionCell(edge);\n    }\n    /**\n     * Creates, inserts and returns the new edge for the given parameters. This\n     * implementation does only use {@link createEdge} if {@link factoryMethod} is defined,\n     * otherwise {@link AbstractGraph.insertEdge} will be used.\n     */\n    insertEdge(parent, id, value, source, target, style) {\n        if (!this.factoryMethod) {\n            return this.graph.insertEdge({ parent, id, value, source, target, style });\n        }\n        let edge = this.createEdge(value, source, target, style);\n        edge = this.graph.addEdge(edge, parent, source, target);\n        return edge;\n    }\n    /**\n     * Hook method for creating new vertices on the fly if no target was\n     * under the mouse. This is only called if <createTarget> is true and\n     * returns null.\n     *\n     * @param evt Mousedown event of the connect gesture.\n     * @param source <Cell> that represents the source terminal.\n     */\n    createTargetVertex(evt, source) {\n        // Uses the first non-relative source\n        let geo = source.getGeometry();\n        while (geo && geo.relative) {\n            source = source.getParent();\n            geo = source.getGeometry();\n        }\n        const clone = this.graph.cloneCell(source);\n        geo = clone.getGeometry();\n        if (geo && this.currentPoint) {\n            const t = this.graph.view.translate;\n            const s = this.graph.view.scale;\n            const point = new Point(this.currentPoint.x / s - t.x, this.currentPoint.y / s - t.y);\n            geo.x = Math.round(point.x - geo.width / 2 - this.graph.getPanDx() / s);\n            geo.y = Math.round(point.y - geo.height / 2 - this.graph.getPanDy() / s);\n            // Aligns with source if within certain tolerance\n            const tol = this.getAlignmentTolerance();\n            if (tol > 0) {\n                const sourceState = this.graph.view.getState(source);\n                if (sourceState != null) {\n                    const x = sourceState.x / s - t.x;\n                    const y = sourceState.y / s - t.y;\n                    if (Math.abs(x - geo.x) <= tol) {\n                        geo.x = Math.round(x);\n                    }\n                    if (Math.abs(y - geo.y) <= tol) {\n                        geo.y = Math.round(y);\n                    }\n                }\n            }\n        }\n        return clone;\n    }\n    /**\n     * Returns the tolerance for aligning new targets to sources. This returns the grid size / 2.\n     */\n    getAlignmentTolerance(evt) {\n        return this.graph.isGridEnabled()\n            ? this.graph.getGridSize() / 2\n            : this.graph.getSnapTolerance();\n    }\n    /**\n     * Creates and returns a new edge using {@link factoryMethod} if one exists. If\n     * no factory method is defined, then a new default edge is returned. The\n     * source and target arguments are informal, the actual connection is\n     * set up later by the caller of this function.\n     *\n     * @param value Value to be used for creating the edge.\n     * @param source {@link Cell} that represents the source terminal.\n     * @param target {@link Cell} that represents the target terminal.\n     * @param style Optional style from the preview edge.\n     */\n    createEdge(value, source, target, style = {}) {\n        let edge = null;\n        // Creates a new edge using the factoryMethod\n        if (this.factoryMethod != null) {\n            edge = this.factoryMethod(source, target, style);\n        }\n        if (edge == null) {\n            edge = new Cell(value || '');\n            edge.setEdge(true);\n            edge.setStyle(style);\n            const geo = new Geometry();\n            geo.relative = true;\n            edge.setGeometry(geo);\n        }\n        return edge;\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes. This should be\n     * called on all instances. It is called automatically for the built-in\n     * instance created for each {@link AbstractGraph}.\n     */\n    onDestroy() {\n        this.graph.removeMouseListener(this);\n        if (this.shape) {\n            this.shape.destroy();\n            this.shape = null;\n        }\n        if (this.marker) {\n            this.marker.destroy();\n            // @ts-expect-error this.marker is null when it is destroyed.\n            this.marker = null;\n        }\n        if (this.constraintHandler) {\n            this.constraintHandler.onDestroy();\n        }\n        if (this.changeHandler) {\n            this.graph.getDataModel().removeListener(this.changeHandler);\n            this.graph.getView().removeListener(this.changeHandler);\n        }\n        if (this.drillHandler) {\n            this.graph.removeListener(this.drillHandler);\n            this.graph.getView().removeListener(this.drillHandler);\n        }\n        if (this.escapeHandler) {\n            this.graph.removeListener(this.escapeHandler);\n        }\n    }\n}\nConnectionHandler.pluginId = 'ConnectionHandler';\nclass ConnectionHandlerCellMarker extends CellMarker {\n    constructor(graph, connectionHandler, validColor = DEFAULT_VALID_COLOR, invalidColor = DEFAULT_INVALID_COLOR, hotspot = DEFAULT_HOTSPOT) {\n        super(graph, validColor, invalidColor, hotspot);\n        this.hotspotEnabled = true;\n        this.connectionHandler = connectionHandler;\n    }\n    // Overrides to return cell at location only if valid (so that\n    // there is no highlight for invalid cells)\n    getCell(me) {\n        let cell = super.getCell(me);\n        this.connectionHandler.error = null;\n        // Checks for cell at preview point (with grid)\n        if (!cell && this.connectionHandler.currentPoint) {\n            cell = this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x, this.connectionHandler.currentPoint.y);\n        }\n        // Uses connectable parent vertex if one exists\n        if (cell && !cell.isConnectable() && this.connectionHandler.cell) {\n            const parent = this.connectionHandler.cell.getParent();\n            if (parent && parent.isVertex() && parent.isConnectable()) {\n                cell = parent;\n            }\n        }\n        if (cell) {\n            if ((this.connectionHandler.graph.isSwimlane(cell) &&\n                this.connectionHandler.currentPoint != null &&\n                this.connectionHandler.graph.hitsSwimlaneContent(cell, this.connectionHandler.currentPoint.x, this.connectionHandler.currentPoint.y)) ||\n                !this.connectionHandler.isConnectableCell(cell)) {\n                cell = null;\n            }\n        }\n        if (cell) {\n            if (this.connectionHandler.isConnecting()) {\n                if (this.connectionHandler.previous) {\n                    this.connectionHandler.error = this.connectionHandler.validateConnection(this.connectionHandler.previous.cell, cell);\n                    if (this.connectionHandler.error !== null &&\n                        this.connectionHandler.error.length === 0) {\n                        cell = null;\n                        // Enables create target inside groups\n                        if (this.connectionHandler.isCreateTarget(me.getEvent())) {\n                            this.connectionHandler.error = null;\n                        }\n                    }\n                }\n            }\n            else if (!this.connectionHandler.isValidSource(cell, me)) {\n                cell = null;\n            }\n        }\n        else if (this.connectionHandler.isConnecting() &&\n            !this.connectionHandler.isCreateTarget(me.getEvent()) &&\n            !this.connectionHandler.graph.isAllowDanglingEdges()) {\n            this.connectionHandler.error = '';\n        }\n        return cell;\n    }\n    // Sets the highlight color according to validateConnection\n    isValidState(state) {\n        if (this.connectionHandler.isConnecting()) {\n            return !this.connectionHandler.error;\n        }\n        return super.isValidState(state);\n    }\n    // Overrides to use marker color only in highlight mode or for\n    // target selection\n    getMarkerColor(evt, state, isValid) {\n        return !this.connectionHandler.connectImage || this.connectionHandler.isConnecting()\n            ? super.getMarkerColor(evt, state, isValid)\n            : NONE;\n    }\n    // Overrides to use hotspot only for source selection otherwise\n    // intersects always returns true when over a cell\n    intersects(state, evt) {\n        if (this.connectionHandler.connectImage || this.connectionHandler.isConnecting()) {\n            return true;\n        }\n        return super.intersects(state, evt);\n    }\n}\nexport default ConnectionHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { GUIDE_COLOR, GUIDE_STROKEWIDTH } from '../../util/Constants.js';\nimport Point from '../geometry/Point.js';\nimport PolylineShape from '../shape/edge/PolylineShape.js';\n/**\n * Implements the alignment of selection cells to other cells in the graph.\n *\n * Constructor: mxGuide\n *\n * Constructs a new guide object.\n */\nclass Guide {\n    constructor(graph, states) {\n        /**\n         * Contains the {@link CellState}s that are used for alignment.\n         */\n        this.states = [];\n        /**\n         * Specifies if horizontal guides are enabled. Default is true.\n         */\n        this.horizontal = true;\n        /**\n         * Specifies if vertical guides are enabled. Default is true.\n         */\n        this.vertical = true;\n        /**\n         * Holds the {@link Shape} for the horizontal guide.\n         */\n        this.guideX = null;\n        /**\n         * Holds the {@link Shape} for the vertical guide.\n         */\n        this.guideY = null;\n        /**\n         * Specifies if rounded coordinates should be used. Default is false.\n         */\n        this.rounded = false;\n        /**\n         * Default tolerance in px if grid is disabled. Default is 2.\n         */\n        this.tolerance = 2;\n        this.graph = graph;\n        this.setStates(states);\n    }\n    /**\n     * Sets the {@link CellState}s that should be used for alignment.\n     */\n    setStates(states) {\n        this.states = states;\n    }\n    /**\n     * Returns true if the guide should be enabled for the given native event. This\n     * implementation always returns true.\n     */\n    isEnabledForEvent(evt) {\n        return true;\n    }\n    /**\n     * Returns the tolerance for the guides. Default value is gridSize / 2.\n     */\n    getGuideTolerance(gridEnabled = false) {\n        return gridEnabled && this.graph.isGridEnabled()\n            ? this.graph.getGridSize() / 2\n            : this.tolerance;\n    }\n    /**\n     * Returns the mxShape to be used for painting the respective guide. This\n     * implementation returns a new, dashed and crisp {@link PolylineShape} using\n     * {@link GUIDE_COLOR} and {@link GUIDE_STROKEWIDTH} as the format.\n     *\n     * @param horizontal Boolean that specifies which guide should be created.\n     */\n    createGuideShape(horizontal = false) {\n        // TODO: Should vertical guides be supported here?? ============================\n        const guide = new PolylineShape([], GUIDE_COLOR, GUIDE_STROKEWIDTH);\n        guide.isDashed = true;\n        return guide;\n    }\n    /**\n     * Returns true if the given state should be ignored.\n     * @param state\n     */\n    isStateIgnored(state) {\n        return false;\n    }\n    /**\n     * Moves the <bounds> by the given {@link Point} and returnt the snapped point.\n     */\n    move(bounds = null, delta, gridEnabled = false, clone = false) {\n        if ((this.horizontal || this.vertical) && bounds) {\n            const { scale } = this.graph.getView();\n            const tt = this.getGuideTolerance(gridEnabled) * scale;\n            const b = bounds.clone();\n            b.x += delta.x;\n            b.y += delta.y;\n            let overrideX = false;\n            let stateX = null;\n            let valueX = null;\n            let overrideY = false;\n            let stateY = null;\n            let valueY = null;\n            let ttX = tt;\n            let ttY = tt;\n            const left = b.x;\n            const right = b.x + b.width;\n            const center = b.getCenterX();\n            const top = b.y;\n            const bottom = b.y + b.height;\n            const middle = b.getCenterY();\n            // Snaps the left, center and right to the given x-coordinate\n            const snapX = (x, state, centerAlign) => {\n                let override = false;\n                if (centerAlign && Math.abs(x - center) < ttX) {\n                    delta.x = x - bounds.getCenterX();\n                    ttX = Math.abs(x - center);\n                    override = true;\n                }\n                else if (!centerAlign) {\n                    if (Math.abs(x - left) < ttX) {\n                        delta.x = x - bounds.x;\n                        ttX = Math.abs(x - left);\n                        override = true;\n                    }\n                    else if (Math.abs(x - right) < ttX) {\n                        delta.x = x - bounds.x - bounds.width;\n                        ttX = Math.abs(x - right);\n                        override = true;\n                    }\n                }\n                if (override) {\n                    stateX = state;\n                    valueX = x;\n                    if (!this.guideX) {\n                        this.guideX = this.createGuideShape(true);\n                        // Makes sure to use SVG shapes in order to implement\n                        // event-transparency on the background area of the rectangle since\n                        // HTML shapes do not let mouseevents through even when transparent\n                        this.guideX.dialect = 'svg';\n                        this.guideX.pointerEvents = false;\n                        this.guideX.init(this.graph.getView().getOverlayPane());\n                    }\n                }\n                overrideX = overrideX || override;\n            };\n            // Snaps the top, middle or bottom to the given y-coordinate\n            const snapY = (y, state, centerAlign) => {\n                let override = false;\n                if (centerAlign && Math.abs(y - middle) < ttY) {\n                    delta.y = y - bounds.getCenterY();\n                    ttY = Math.abs(y - middle);\n                    override = true;\n                }\n                else if (!centerAlign) {\n                    if (Math.abs(y - top) < ttY) {\n                        delta.y = y - bounds.y;\n                        ttY = Math.abs(y - top);\n                        override = true;\n                    }\n                    else if (Math.abs(y - bottom) < ttY) {\n                        delta.y = y - bounds.y - bounds.height;\n                        ttY = Math.abs(y - bottom);\n                        override = true;\n                    }\n                }\n                if (override) {\n                    stateY = state;\n                    valueY = y;\n                    if (!this.guideY) {\n                        this.guideY = this.createGuideShape(false);\n                        // Makes sure to use SVG shapes in order to implement\n                        // event-transparency on the background area of the rectangle since\n                        // HTML shapes do not let mouseevents through even when transparent\n                        this.guideY.dialect = 'svg';\n                        this.guideY.pointerEvents = false;\n                        this.guideY.init(this.graph.getView().getOverlayPane());\n                    }\n                }\n                overrideY = overrideY || override;\n            };\n            for (let i = 0; i < this.states.length; i += 1) {\n                const state = this.states[i];\n                if (state && !this.isStateIgnored(state)) {\n                    // Align x\n                    if (this.horizontal) {\n                        snapX(state.getCenterX(), state, true);\n                        snapX(state.x, state, false);\n                        snapX(state.x + state.width, state, false);\n                        // Aligns left and right of shape to center of page\n                        if (!state.cell) {\n                            snapX(state.getCenterX(), state, false);\n                        }\n                    }\n                    // Align y\n                    if (this.vertical) {\n                        snapY(state.getCenterY(), state, true);\n                        snapY(state.y, state, false);\n                        snapY(state.y + state.height, state, false);\n                        // Aligns left and right of shape to center of page\n                        if (!state.cell) {\n                            snapY(state.getCenterY(), state, false);\n                        }\n                    }\n                }\n            }\n            // Moves cells to the raster if not aligned\n            this.graph.snapDelta(delta, bounds, !gridEnabled, overrideX, overrideY);\n            delta = this.getDelta(bounds, stateX, delta.x, stateY, delta.y);\n            // Redraws the guides\n            const c = this.graph.container;\n            if (!overrideX && this.guideX) {\n                this.guideX.node.style.visibility = 'hidden';\n            }\n            else if (this.guideX) {\n                let minY = null;\n                let maxY = null;\n                if (stateX) {\n                    minY = Math.min(bounds.y + delta.y - this.graph.getPanDy(), stateX.y);\n                    maxY = Math.max(bounds.y + bounds.height + delta.y - this.graph.getPanDy(), \n                    // @ts-ignore stateX! doesn't work for some reason...\n                    stateX.y + stateX.height);\n                }\n                if (minY !== null && maxY !== null) {\n                    this.guideX.points = [new Point(valueX, minY), new Point(valueX, maxY)];\n                }\n                else {\n                    this.guideX.points = [\n                        new Point(valueX, -this.graph.getPanDy()),\n                        new Point(valueX, c.scrollHeight - 3 - this.graph.getPanDy()),\n                    ];\n                }\n                this.guideX.stroke = this.getGuideColor(stateX, true);\n                this.guideX.node.style.visibility = 'visible';\n                this.guideX.redraw();\n            }\n            if (!overrideY && this.guideY != null) {\n                this.guideY.node.style.visibility = 'hidden';\n            }\n            else if (this.guideY != null) {\n                let minX = null;\n                let maxX = null;\n                if (stateY != null && bounds != null) {\n                    minX = Math.min(bounds.x + delta.x - this.graph.getPanDx(), stateY.x);\n                    maxX = Math.max(bounds.x + bounds.width + delta.x - this.graph.getPanDx(), \n                    // @ts-ignore\n                    stateY.x + stateY.width);\n                }\n                if (minX != null && maxX != null && valueY !== null) {\n                    this.guideY.points = [new Point(minX, valueY), new Point(maxX, valueY)];\n                }\n                else if (valueY !== null) {\n                    this.guideY.points = [\n                        new Point(-this.graph.getPanDx(), valueY),\n                        new Point(c.scrollWidth - 3 - this.graph.getPanDx(), valueY),\n                    ];\n                }\n                this.guideY.stroke = this.getGuideColor(stateY, false);\n                this.guideY.node.style.visibility = 'visible';\n                this.guideY.redraw();\n            }\n        }\n        return delta;\n    }\n    /**\n     * Rounds to pixels for virtual states (eg. page guides)\n     */\n    getDelta(bounds, stateX = null, dx, stateY = null, dy) {\n        const s = this.graph.view.scale;\n        if (this.rounded || (stateX != null && stateX.cell == null)) {\n            dx = Math.round((bounds.x + dx) / s) * s - bounds.x;\n        }\n        if (this.rounded || (stateY != null && stateY.cell == null)) {\n            dy = Math.round((bounds.y + dy) / s) * s - bounds.y;\n        }\n        return new Point(dx, dy);\n    }\n    /**\n     * Hides all current guides.\n     */\n    getGuideColor(state, horizontal) {\n        return GUIDE_COLOR;\n    }\n    /**\n     * Hides all current guides.\n     */\n    hide() {\n        this.setVisible(false);\n    }\n    /**\n     * Shows or hides the current guides.\n     */\n    setVisible(visible) {\n        if (this.guideX) {\n            this.guideX.node.style.visibility = visible ? 'visible' : 'hidden';\n        }\n        if (this.guideY) {\n            this.guideY.node.style.visibility = visible ? 'visible' : 'hidden';\n        }\n    }\n    /**\n     * Destroys all resources that this object uses.\n     */\n    destroy() {\n        if (this.guideX) {\n            this.guideX.destroy();\n            this.guideX = null;\n        }\n        if (this.guideY) {\n            this.guideY.destroy();\n            this.guideY = null;\n        }\n    }\n}\nexport default Guide;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport Client from '../../Client.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { contains, getRotatedPoint, isNumeric, toRadians } from '../../util/mathUtils.js';\nimport { convertPoint } from '../../util/styleUtils.js';\nimport RectangleShape from '../shape/node/RectangleShape.js';\nimport Guide from '../other/Guide.js';\nimport Point from '../geometry/Point.js';\nimport { DROP_TARGET_COLOR, INVALID_CONNECT_TARGET_COLOR, NONE, VALID_COLOR, } from '../../util/Constants.js';\nimport CellHighlight from '../cell/CellHighlight.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { getClientX, getClientY, isAltDown, isMultiTouchEvent, } from '../../util/EventUtils.js';\nimport { EdgeHandlerConfig, VertexHandlerConfig } from '../handler/config.js';\n/**\n * Graph event handler that handles selection.\n *\n * Individual cells are handled separately by {@link SelectionCellsHandler} using {@link VertexHandler} or one of the {@link EdgeHandler}s.\n * When the {@link SelectionCellsHandler} plugin is registered in the {@link AbstractGraph}, {@link SelectionHandler} interacts with this plugin to propagate global selection events to individual cells.\n *\n * To avoid the container to scroll a moved cell into view, set {@link scrollOnMove} to `false`.\n *\n * @category Plugin\n */\nclass SelectionHandler {\n    /**\n     * Constructs an event handler that creates handles for the selection cells.\n     *\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     */\n    constructor(graph) {\n        this.refreshThread = null;\n        /**\n         * Defines the maximum number of cells to paint subhandles\n         * for. Default is 50 for Firefox and 20 for IE. Set this\n         * to 0 if you want an unlimited number of handles to be\n         * displayed. This is only recommended if the number of\n         * cells in the graph is limited to a small number, eg.\n         * 500.\n         */\n        this.maxCells = 50;\n        /**\n         * Specifies if events are handled. Default is true.\n         */\n        this.enabled = true;\n        /**\n         * Specifies if drop targets under the mouse should be enabled. Default is\n         * true.\n         */\n        this.highlightEnabled = true;\n        /**\n         * Specifies if cloning by control-drag is enabled. Default is true.\n         */\n        this.cloneEnabled = true;\n        /**\n         * Specifies if moving is enabled. Default is true.\n         */\n        this.moveEnabled = true;\n        /**\n         * Specifies if other cells should be used for snapping the right, center or\n         * left side of the current selection. Default is false.\n         */\n        this.guidesEnabled = false;\n        /**\n         * Whether the handles of the selection are currently visible.\n         */\n        this.handlesVisible = true;\n        /**\n         * Holds the {@link Guide} instance that is used for alignment.\n         */\n        this.guide = null;\n        /**\n         * Stores the x-coordinate of the current mouse move.\n         */\n        this.currentDx = 0;\n        /**\n         * Stores the y-coordinate of the current mouse move.\n         */\n        this.currentDy = 0;\n        /**\n         * Specifies if a move cursor should be shown if the mouse is over a movable\n         * cell. Default is true.\n         */\n        this.updateCursor = true;\n        /**\n         * Specifies if selecting is enabled. Default is true.\n         */\n        this.selectEnabled = true;\n        /**\n         * Specifies if cells may be moved out of their parents. Default is true.\n         */\n        this.removeCellsFromParent = true;\n        /**\n         * If empty parents should be removed from the model after all child cells\n         * have been moved out. Default is true.\n         */\n        this.removeEmptyParents = false;\n        /**\n         * Specifies if drop events are interpreted as new connections if no other\n         * drop action is defined. Default is false.\n         */\n        this.connectOnDrop = false;\n        /**\n         * Specifies if the view should be scrolled so that a moved cell is visible.\n         * @default true\n         */\n        this.scrollOnMove = true;\n        /**\n         * Specifies the minimum number of pixels for the width and height of a\n         * selection border. Default is 6.\n         */\n        this.minimumSize = 6;\n        /**\n         * Specifies the color of the preview shape. Default is black.\n         */\n        this.previewColor = 'black';\n        /**\n         * Specifies if the graph container should be used for preview. If this is used\n         * then drop target detection relies entirely on {@link AbstractGraph.getCellAt} because\n         * the HTML preview does not \"let events through\". Default is false.\n         */\n        this.htmlPreview = false;\n        /**\n         * Reference to the {@link Shape} that represents the preview.\n         */\n        this.shape = null;\n        /**\n         * Specifies if the grid should be scaled. Default is false.\n         */\n        this.scaleGrid = false;\n        /**\n         * Specifies if the bounding box should allow for rotation. Default is true.\n         */\n        this.rotationEnabled = true;\n        /**\n         * Maximum number of cells for which live preview should be used.  Default is 0 which means no live preview.\n         */\n        this.maxLivePreview = 0;\n        /**\n         * Variable allowLivePreview\n         *\n         * If live preview is allowed on this system.  Default is true for systems with SVG support.\n         */\n        this.allowLivePreview = Client.IS_SVG;\n        this.cell = null;\n        this.delayedSelection = false;\n        this.first = null;\n        this.cells = null;\n        this.bounds = null;\n        this.pBounds = null;\n        this.allCells = new Map();\n        this.cellWasClicked = false;\n        this.cloning = false;\n        this.cellCount = 0;\n        this.target = null;\n        this.suspended = false;\n        this.livePreviewActive = false;\n        this.livePreviewUsed = false;\n        this.highlight = null;\n        this.graph = graph;\n        this.graph.addMouseListener(this);\n        // Repaints the handler after autoscroll\n        this.panHandler = () => {\n            if (!this.suspended) {\n                this.updatePreview();\n                this.updateHint();\n            }\n        };\n        this.graph.addListener(InternalEvent.PAN, this.panHandler);\n        // Handles escape keystrokes\n        this.escapeHandler = (sender, evt) => {\n            this.reset();\n        };\n        this.graph.addListener(InternalEvent.ESCAPE, this.escapeHandler);\n        // Updates the preview box for remote changes\n        this.refreshHandler = (sender, evt) => {\n            // Merges multiple pending calls\n            if (this.refreshThread) {\n                window.clearTimeout(this.refreshThread);\n            }\n            // Waits for the states and handlers to be updated\n            this.refreshThread = window.setTimeout(() => {\n                this.refreshThread = null;\n                if (this.first && !this.suspended && this.cells) {\n                    // Updates preview with no translate to compute bounding box\n                    const dx = this.currentDx;\n                    const dy = this.currentDy;\n                    this.currentDx = 0;\n                    this.currentDy = 0;\n                    this.updatePreview();\n                    this.bounds = this.graph.getView().getBounds(this.cells);\n                    this.pBounds = this.getPreviewBounds(this.cells);\n                    if (this.pBounds == null && !this.livePreviewUsed) {\n                        this.reset();\n                    }\n                    else {\n                        // Restores translate and updates preview\n                        this.currentDx = dx;\n                        this.currentDy = dy;\n                        this.updatePreview();\n                        this.updateHint();\n                        if (this.livePreviewUsed) {\n                            // Forces update to ignore last visible state\n                            this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells() ?? [], false, true);\n                            this.updatePreview();\n                        }\n                    }\n                }\n            }, 0);\n        };\n        this.graph.getDataModel().addListener(InternalEvent.CHANGE, this.refreshHandler);\n        this.graph.addListener(InternalEvent.REFRESH, this.refreshHandler);\n        this.keyHandler = (e) => {\n            if (this.graph.container != null &&\n                this.graph.container.style.visibility !== 'hidden' &&\n                this.first != null &&\n                !this.suspended) {\n                const clone = this.graph.isCloneEvent(e) &&\n                    this.graph.isCellsCloneable() &&\n                    this.isCloneEnabled();\n                if (clone !== this.cloning) {\n                    this.cloning = clone;\n                    this.checkPreview();\n                    this.updatePreview();\n                }\n            }\n        };\n        if (typeof document !== 'undefined') {\n            InternalEvent.addListener(document, 'keydown', this.keyHandler);\n            InternalEvent.addListener(document, 'keyup', this.keyHandler);\n        }\n    }\n    /**\n     * Returns <enabled>.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Sets <enabled>.\n     */\n    setEnabled(value) {\n        this.enabled = value;\n    }\n    /**\n     * Returns <cloneEnabled>.\n     */\n    isCloneEnabled() {\n        return this.cloneEnabled;\n    }\n    /**\n     * Sets <cloneEnabled>.\n     *\n     * @param value Boolean that specifies the new clone enabled state.\n     */\n    setCloneEnabled(value) {\n        this.cloneEnabled = value;\n    }\n    /**\n     * Returns {@link oveEnabled}.\n     */\n    isMoveEnabled() {\n        return this.moveEnabled;\n    }\n    /**\n     * Sets {@link oveEnabled}.\n     */\n    setMoveEnabled(value) {\n        this.moveEnabled = value;\n    }\n    /**\n     * Returns <selectEnabled>.\n     */\n    isSelectEnabled() {\n        return this.selectEnabled;\n    }\n    /**\n     * Sets <selectEnabled>.\n     */\n    setSelectEnabled(value) {\n        this.selectEnabled = value;\n    }\n    /**\n     * Returns <removeCellsFromParent>.\n     */\n    isRemoveCellsFromParent() {\n        return this.removeCellsFromParent;\n    }\n    /**\n     * Sets <removeCellsFromParent>.\n     */\n    setRemoveCellsFromParent(value) {\n        this.removeCellsFromParent = value;\n    }\n    /**\n     * Returns true if the given cell and parent should propagate\n     * selection state to the parent.\n     */\n    isPropagateSelectionCell(cell, immediate, me) {\n        const parent = cell.getParent();\n        if (immediate) {\n            const geo = cell.isEdge() ? null : cell.getGeometry();\n            return ((!this.graph.isSiblingSelected(cell) && geo && geo.relative) ||\n                !this.graph.isSwimlane(parent));\n        }\n        return ((!this.graph.isToggleEvent(me.getEvent()) ||\n            (!this.graph.isSiblingSelected(cell) &&\n                !this.graph.isCellSelected(cell) &&\n                !this.graph.isSwimlane(parent)) ||\n            this.graph.isCellSelected(parent)) &&\n            (this.graph.isToggleEvent(me.getEvent()) || !this.graph.isCellSelected(parent)));\n    }\n    /**\n     * Hook to return initial cell for the given event.\n     */\n    getInitialCellForEvent(me) {\n        let state = me.getState();\n        if ((!this.graph.isToggleEvent(me.getEvent()) || !isAltDown(me.getEvent())) &&\n            state &&\n            !this.graph.isCellSelected(state.cell)) {\n            let parent = state.cell.getParent();\n            let next = parent ? this.graph.view.getState(parent) : null;\n            while (next &&\n                !this.graph.isCellSelected(next.cell) &&\n                (next.cell.isVertex() || next.cell.isEdge()) &&\n                this.isPropagateSelectionCell(state.cell, true, me)) {\n                state = next;\n                parent = state.cell.getParent();\n                next = parent ? this.graph.view.getState(parent) : null;\n            }\n        }\n        return state ? state.cell : null;\n    }\n    /**\n     * Hook to return true for delayed selections.\n     */\n    isDelayedSelection(cell, me) {\n        let c = cell;\n        const selectionCellsHandler = this.getSelectionCellsHandler();\n        if (!this.graph.isToggleEvent(me.getEvent()) || !isAltDown(me.getEvent())) {\n            while (c) {\n                if (selectionCellsHandler?.isHandled(c)) {\n                    const cellEditorHandler = this.graph.getPlugin('CellEditorHandler');\n                    return cellEditorHandler?.getEditingCell() !== c;\n                }\n                c = c.getParent();\n            }\n        }\n        return this.graph.isToggleEvent(me.getEvent()) && !isAltDown(me.getEvent());\n    }\n    /**\n     * Implements the delayed selection for the given mouse event.\n     */\n    selectDelayed(me) {\n        const popupMenuHandler = this.graph.getPlugin('PopupMenuHandler');\n        if (!popupMenuHandler || !popupMenuHandler.isPopupTrigger(me)) {\n            let cell = me.getCell();\n            if (cell === null) {\n                cell = this.cell;\n            }\n            if (cell)\n                this.selectCellForEvent(cell, me);\n        }\n    }\n    /**\n     * Selects the given cell for the given {@link MouseEvent}.\n     */\n    selectCellForEvent(cell, me) {\n        const state = this.graph.view.getState(cell);\n        if (state) {\n            if (me.isSource(state.control)) {\n                this.graph.selectCellForEvent(cell, me.getEvent());\n            }\n            else {\n                if (!this.graph.isToggleEvent(me.getEvent()) || !isAltDown(me.getEvent())) {\n                    let parent = cell.getParent();\n                    while (parent &&\n                        this.graph.view.getState(parent) &&\n                        (parent.isVertex() || parent.isEdge()) &&\n                        this.isPropagateSelectionCell(cell, false, me)) {\n                        cell = parent;\n                        parent = cell.getParent();\n                    }\n                }\n                this.graph.selectCellForEvent(cell, me.getEvent());\n            }\n        }\n        return cell;\n    }\n    /**\n     * Consumes the given mouse event.\n     *\n     * **NOTE**: This may be used to enable click events for links in labels on iOS as follows as consuming the initial\n     * touchStart disables firing the subsequent click event on the link.\n     *\n     * ```js\n     * consumeMouseEvent(evtName, me) {\n     *   const source = eventUtils.getSource(me.getEvent());\n     *\n     *   if (!eventUtils.isTouchEvent(me.getEvent()) || source.nodeName != 'A') {\n     *     me.consume();\n     *   }\n     * }\n     * ```\n     */\n    consumeMouseEvent(_evtName, me) {\n        me.consume();\n    }\n    /**\n     * Handles the event by selecting the given cell and creating a handle for it.\n     * By consuming the event all subsequent events of the gesture are redirected to this handler.\n     */\n    mouseDown(_sender, me) {\n        if (!me.isConsumed() &&\n            this.isEnabled() &&\n            this.graph.isEnabled() &&\n            me.getState() &&\n            !isMultiTouchEvent(me.getEvent())) {\n            const cell = this.getInitialCellForEvent(me);\n            if (cell) {\n                this.delayedSelection = this.isDelayedSelection(cell, me);\n                this.cell = null;\n                if (this.isSelectEnabled() && !this.delayedSelection) {\n                    this.graph.selectCellForEvent(cell, me.getEvent());\n                }\n                if (this.isMoveEnabled()) {\n                    const geo = cell.getGeometry();\n                    if (geo &&\n                        this.graph.isCellMovable(cell) &&\n                        (!cell.isEdge() ||\n                            this.graph.getSelectionCount() > 1 ||\n                            (geo.points && geo.points.length > 0) ||\n                            !cell.getTerminal(true) ||\n                            !cell.getTerminal(false) ||\n                            this.graph.isAllowDanglingEdges() ||\n                            (this.graph.isCloneEvent(me.getEvent()) && this.graph.isCellsCloneable()))) {\n                        this.start(cell, me.getX(), me.getY());\n                    }\n                    else if (this.delayedSelection) {\n                        this.cell = cell;\n                    }\n                    this.cellWasClicked = true;\n                    this.consumeMouseEvent(InternalEvent.MOUSE_DOWN, me);\n                }\n            }\n        }\n    }\n    /**\n     * Creates an array of cell states which should be used as guides.\n     */\n    getGuideStates() {\n        const parent = this.graph.getDefaultParent();\n        const filter = (cell) => {\n            const geo = cell.getGeometry();\n            return (!!this.graph.view.getState(cell) && cell.isVertex() && !!geo && !geo.relative);\n        };\n        return this.graph.view.getCellStates(parent.filterDescendants(filter));\n    }\n    /**\n     * Returns the cells to be modified by this handler. This implementation\n     * returns all selection cells that are movable, or the given initial cell if\n     * the given cell is not selected and movable. This handles the case of moving\n     * unselectable or unselected cells.\n     *\n     * @param initialCell <Cell> that triggered this handler.\n     */\n    getCells(initialCell) {\n        if (!this.delayedSelection && this.graph.isCellMovable(initialCell)) {\n            return [initialCell];\n        }\n        return this.graph.getMovableCells(this.graph.getSelectionCells());\n    }\n    /**\n     * Returns the {@link Rectangle} used as the preview bounds for\n     * moving the given cells.\n     */\n    getPreviewBounds(cells) {\n        const bounds = this.getBoundingBox(cells);\n        if (bounds) {\n            // Corrects width and height\n            bounds.width = Math.max(0, bounds.width - 1);\n            bounds.height = Math.max(0, bounds.height - 1);\n            if (bounds.width < this.minimumSize) {\n                const dx = this.minimumSize - bounds.width;\n                bounds.x -= dx / 2;\n                bounds.width = this.minimumSize;\n            }\n            else {\n                bounds.x = Math.round(bounds.x);\n                bounds.width = Math.ceil(bounds.width);\n            }\n            if (bounds.height < this.minimumSize) {\n                const dy = this.minimumSize - bounds.height;\n                bounds.y -= dy / 2;\n                bounds.height = this.minimumSize;\n            }\n            else {\n                bounds.y = Math.round(bounds.y);\n                bounds.height = Math.ceil(bounds.height);\n            }\n        }\n        return bounds;\n    }\n    /**\n     * Returns the union of the {@link CellStates} for the given array of {@link Cells}.\n     * For vertices, this method uses the bounding box of the corresponding shape\n     * if one exists. The bounding box of the corresponding text label and all\n     * controls and overlays are ignored. See also: {@link GraphView#getBounds} and\n     * {@link AbstractGraph.getBoundingBox}.\n     *\n     * @param cells Array of {@link Cells} whose bounding box should be returned.\n     */\n    getBoundingBox(cells) {\n        let result = null;\n        if (cells.length > 0) {\n            for (let i = 0; i < cells.length; i += 1) {\n                if (cells[i].isVertex() || cells[i].isEdge()) {\n                    const state = this.graph.view.getState(cells[i]);\n                    if (state) {\n                        let bbox = null;\n                        if (cells[i].isVertex() && state.shape && state.shape.boundingBox) {\n                            bbox = state.shape.boundingBox;\n                        }\n                        if (bbox) {\n                            if (!result) {\n                                result = Rectangle.fromRectangle(bbox);\n                            }\n                            else {\n                                result.add(bbox);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        return result;\n    }\n    /**\n     * Creates the shape used to draw the preview for the given bounds.\n     */\n    createPreviewShape(bounds) {\n        const shape = new RectangleShape(bounds, NONE, this.previewColor);\n        shape.isDashed = true;\n        if (this.htmlPreview) {\n            shape.dialect = 'strictHtml';\n            shape.init(this.graph.container);\n        }\n        else {\n            // Makes sure to use either VML or SVG shapes in order to implement\n            // event-transparency on the background area of the rectangle since\n            // HTML shapes do not let mouseevents through even when transparent\n            shape.dialect = 'svg';\n            shape.init(this.graph.getView().getOverlayPane());\n            shape.pointerEvents = false;\n            // Workaround for artifacts on iOS\n            if (Client.IS_IOS) {\n                shape.getSvgScreenOffset = () => {\n                    return 0;\n                };\n            }\n        }\n        return shape;\n    }\n    createGuide() {\n        return new Guide(this.graph, this.getGuideStates());\n    }\n    /**\n     * Starts the handling of the mouse gesture.\n     */\n    start(cell, x, y, cells) {\n        this.cell = cell;\n        this.first = convertPoint(this.graph.container, x, y);\n        this.cells = cells ? cells : this.getCells(this.cell);\n        this.bounds = this.graph.getView().getBounds(this.cells);\n        this.pBounds = this.getPreviewBounds(this.cells);\n        this.cloning = false;\n        this.cellCount = 0;\n        for (let i = 0; i < this.cells.length; i += 1) {\n            this.cellCount += this.addStates(this.cells[i], this.allCells);\n        }\n        if (this.guidesEnabled) {\n            this.guide = this.createGuide();\n            const parent = cell.getParent();\n            const ignore = parent.getChildCount() < 2;\n            // Uses connected states as guides\n            const connected = new Map();\n            const opps = this.graph.getOpposites(this.graph.getEdges(this.cell), this.cell);\n            for (let i = 0; i < opps.length; i += 1) {\n                const state = this.graph.view.getState(opps[i]);\n                if (state && !connected.get(state)) {\n                    connected.set(state, true);\n                }\n            }\n            this.guide.isStateIgnored = (state) => {\n                const p = state.cell.getParent();\n                return (!!state.cell &&\n                    ((!this.cloning && !!this.isCellMoving(state.cell)) ||\n                        (state.cell !== (this.target || parent) &&\n                            !ignore &&\n                            !connected.get(state) &&\n                            (!this.target || this.target.getChildCount() >= 2) &&\n                            p !== (this.target || parent))));\n            };\n        }\n    }\n    /**\n     * Adds the states for the given cell recursively to the given Map.\n     * @param cell\n     * @param dict\n     */\n    addStates(cell, dict) {\n        const state = this.graph.view.getState(cell);\n        let count = 0;\n        if (state && !dict.get(cell)) {\n            dict.set(cell, state);\n            count++;\n            const childCount = cell.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                count += this.addStates(cell.getChildAt(i), dict);\n            }\n        }\n        return count;\n    }\n    /**\n     * Returns true if the given cell is currently being moved.\n     */\n    isCellMoving(cell) {\n        return this.allCells.has(cell);\n    }\n    /**\n     * Returns true if the guides should be used for the given {@link MouseEvent}.\n     * This implementation returns {@link Guide#isEnabledForEvent}.\n     */\n    useGuidesForEvent(me) {\n        return this.guide\n            ? this.guide.isEnabledForEvent(me.getEvent()) &&\n                !this.graph.isConstrainedEvent(me.getEvent())\n            : true;\n    }\n    /**\n     * Snaps the given vector to the grid and returns the given mxPoint instance.\n     */\n    snap(vector) {\n        const scale = this.scaleGrid ? this.graph.view.scale : 1;\n        vector.x = this.graph.snap(vector.x / scale) * scale;\n        vector.y = this.graph.snap(vector.y / scale) * scale;\n        return vector;\n    }\n    /**\n     * Returns an {@link Point} that represents the vector for moving the cells\n     * for the given {@link MouseEvent}.\n     */\n    getDelta(me) {\n        const point = convertPoint(this.graph.container, me.getX(), me.getY());\n        if (!this.first)\n            return new Point();\n        return new Point(point.x - this.first.x - this.graph.getPanDx(), point.y - this.first.y - this.graph.getPanDy());\n    }\n    /**\n     * Hook for subclassers do show details while the handler is active.\n     */\n    updateHint(me) {\n        return;\n    }\n    /**\n     * Hooks for subclassers to hide details when the handler gets inactive.\n     */\n    removeHint() {\n        return;\n    }\n    /**\n     * Hook for rounding the unscaled vector. This uses Math.round.\n     */\n    roundLength(length) {\n        return Math.round(length * 100) / 100;\n    }\n    /**\n     * Returns true if the given cell is a valid drop target.\n     */\n    isValidDropTarget(target, me) {\n        return this.cell ? this.cell.getParent() !== target : false;\n    }\n    /**\n     * Updates the preview if cloning state has changed.\n     */\n    checkPreview() {\n        if (this.livePreviewActive && this.cloning) {\n            this.resetLivePreview();\n            this.livePreviewActive = false;\n        }\n        else if (this.maxLivePreview >= this.cellCount &&\n            !this.livePreviewActive &&\n            this.allowLivePreview) {\n            if (!this.cloning || !this.livePreviewActive) {\n                this.livePreviewActive = true;\n                this.livePreviewUsed = true;\n            }\n        }\n        else if (!this.livePreviewUsed && !this.shape && this.bounds) {\n            this.shape = this.createPreviewShape(this.bounds);\n        }\n    }\n    /**\n     * Handles the event by highlighting possible drop targets and updating the preview.\n     */\n    mouseMove(_sender, me) {\n        const { graph } = this;\n        if (!me.isConsumed() &&\n            graph.isMouseDown &&\n            this.cell &&\n            this.first &&\n            this.bounds &&\n            !this.suspended) {\n            // Stops moving if a multi touch event is received\n            if (isMultiTouchEvent(me.getEvent())) {\n                this.reset();\n                return;\n            }\n            let delta = this.getDelta(me);\n            const tol = graph.getEventTolerance();\n            if (this.shape ||\n                this.livePreviewActive ||\n                Math.abs(delta.x) > tol ||\n                Math.abs(delta.y) > tol) {\n                // Highlight is used for highlighting drop targets\n                if (!this.highlight) {\n                    this.highlight = new CellHighlight(this.graph, DROP_TARGET_COLOR, 3);\n                }\n                const clone = graph.isCloneEvent(me.getEvent()) &&\n                    graph.isCellsCloneable() &&\n                    this.isCloneEnabled();\n                const gridEnabled = graph.isGridEnabledEvent(me.getEvent());\n                const cell = me.getCell();\n                let hideGuide = true;\n                let target = null;\n                this.cloning = clone;\n                if (graph.isDropEnabled() && this.highlightEnabled && this.cells) {\n                    // Contains a call to getCellAt to find the cell under the mouse\n                    target = graph.getDropTarget(this.cells, me.getEvent(), cell, clone);\n                }\n                let state = target ? graph.getView().getState(target) : null;\n                let highlight = false;\n                if (state && (clone || (target && this.isValidDropTarget(target, me)))) {\n                    if (this.target !== target) {\n                        this.target = target;\n                        this.setHighlightColor(DROP_TARGET_COLOR);\n                    }\n                    highlight = true;\n                }\n                else {\n                    this.target = null;\n                    if (this.connectOnDrop &&\n                        cell &&\n                        this.cells &&\n                        this.cells.length === 1 &&\n                        cell.isVertex() &&\n                        cell.isConnectable()) {\n                        state = graph.getView().getState(cell);\n                        if (state) {\n                            const error = graph.getEdgeValidationError(null, this.cell, cell);\n                            const color = error === null ? VALID_COLOR : INVALID_CONNECT_TARGET_COLOR;\n                            this.setHighlightColor(color);\n                            highlight = true;\n                        }\n                    }\n                }\n                if (state && highlight) {\n                    this.highlight.highlight(state);\n                }\n                else {\n                    this.highlight.hide();\n                }\n                if (this.guide && this.useGuidesForEvent(me)) {\n                    delta = this.guide.move(this.bounds, delta, gridEnabled, clone);\n                    hideGuide = false;\n                }\n                else {\n                    delta = this.graph.snapDelta(delta, this.bounds, !gridEnabled, false, false);\n                }\n                if (this.guide && hideGuide) {\n                    this.guide.hide();\n                }\n                // Constrained movement if shift key is pressed\n                if (graph.isConstrainedEvent(me.getEvent())) {\n                    if (Math.abs(delta.x) > Math.abs(delta.y)) {\n                        delta.y = 0;\n                    }\n                    else {\n                        delta.x = 0;\n                    }\n                }\n                this.checkPreview();\n                if (this.currentDx !== delta.x || this.currentDy !== delta.y) {\n                    this.currentDx = delta.x;\n                    this.currentDy = delta.y;\n                    this.updatePreview();\n                }\n            }\n            this.updateHint(me);\n            this.consumeMouseEvent(InternalEvent.MOUSE_MOVE, me);\n            // Cancels the bubbling of events to the container so\n            // that the droptarget is not reset due to an mouseMove\n            // fired on the container with no associated state.\n            InternalEvent.consume(me.getEvent());\n        }\n        else if ((this.isMoveEnabled() || this.isCloneEnabled()) &&\n            this.updateCursor &&\n            !me.isConsumed() &&\n            (me.getState() || me.sourceState) &&\n            !graph.isMouseDown) {\n            let cursor = graph.getCursorForMouseEvent(me);\n            const cell = me.getCell();\n            if (!cursor && cell && graph.isEnabled() && graph.isCellMovable(cell)) {\n                if (cell.isEdge()) {\n                    cursor = EdgeHandlerConfig.cursorMovable;\n                }\n                else {\n                    cursor = VertexHandlerConfig.cursorMovable;\n                }\n            }\n            // Sets the cursor on the original source state under the mouse\n            // instead of the event source state which can be the parent\n            if (cursor && me.sourceState) {\n                me.sourceState.setCursor(cursor);\n            }\n        }\n    }\n    /**\n     * Updates the bounds of the preview shape.\n     */\n    updatePreview(remote = false) {\n        if (this.livePreviewUsed && !remote) {\n            if (this.cells) {\n                this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells() ?? [], false);\n                this.updateLivePreview(this.currentDx, this.currentDy);\n            }\n        }\n        else {\n            this.updatePreviewShape();\n        }\n    }\n    /**\n     * Updates the bounds of the preview shape.\n     */\n    updatePreviewShape() {\n        if (this.shape && this.pBounds) {\n            this.shape.bounds = new Rectangle(Math.round(this.pBounds.x + this.currentDx), Math.round(this.pBounds.y + this.currentDy), this.pBounds.width, this.pBounds.height);\n            this.shape.redraw();\n        }\n    }\n    /**\n     * Updates the bounds of the preview shape.\n     */\n    updateLivePreview(dx, dy) {\n        if (!this.suspended) {\n            const states = [];\n            if (this.allCells) {\n                this.allCells.forEach((state) => {\n                    const realState = state ? this.graph.view.getState(state.cell) : null;\n                    // Checks if cell was removed or replaced\n                    if (realState !== state && state) {\n                        state.destroy();\n                        if (realState) {\n                            this.allCells.set(state.cell, realState);\n                        }\n                        else {\n                            this.allCells.delete(state.cell);\n                        }\n                        state = realState;\n                    }\n                    if (state) {\n                        // Saves current state\n                        const tempState = state.clone();\n                        states.push([state, tempState]);\n                        // Makes transparent for events to detect drop targets\n                        if (state.shape) {\n                            if (state.shape.originalPointerEvents === null) {\n                                state.shape.originalPointerEvents = state.shape.pointerEvents;\n                            }\n                            state.shape.pointerEvents = false;\n                            if (state.text) {\n                                if (state.text.originalPointerEvents === null) {\n                                    state.text.originalPointerEvents = state.text.pointerEvents;\n                                }\n                                state.text.pointerEvents = false;\n                            }\n                        }\n                        // Temporarily changes position\n                        if (state.cell.isVertex()) {\n                            state.x += dx;\n                            state.y += dy;\n                            // Draws the live preview\n                            if (!this.cloning) {\n                                state.view.graph.cellRenderer.redraw(state, true);\n                                // Forces redraw of connected edges after all states\n                                // have been updated but avoids update of state\n                                state.view.invalidate(state.cell);\n                                state.invalid = false;\n                                // Hides folding icon\n                                if (state.control && state.control.node) {\n                                    state.control.node.style.visibility = 'hidden';\n                                }\n                            }\n                            // Clone live preview may use text bounds\n                            else if (state.text) {\n                                state.text.updateBoundingBox();\n                                // Fixes preview box for edge labels\n                                if (state.text.boundingBox) {\n                                    state.text.boundingBox.x += dx;\n                                    state.text.boundingBox.y += dy;\n                                }\n                                if (state.text.unrotatedBoundingBox) {\n                                    state.text.unrotatedBoundingBox.x += dx;\n                                    state.text.unrotatedBoundingBox.y += dy;\n                                }\n                            }\n                        }\n                    }\n                });\n            }\n            // Resets the handler if everything was removed\n            if (states.length === 0) {\n                this.reset();\n            }\n            else {\n                // Redraws connected edges\n                const s = this.graph.view.scale;\n                for (let i = 0; i < states.length; i += 1) {\n                    const state = states[i][0];\n                    if (state.cell.isEdge()) {\n                        const geometry = state.cell.getGeometry();\n                        const points = [];\n                        if (geometry && geometry.points) {\n                            for (let j = 0; j < geometry.points.length; j++) {\n                                if (geometry.points[j]) {\n                                    points.push(new Point(geometry.points[j].x + dx / s, geometry.points[j].y + dy / s));\n                                }\n                            }\n                        }\n                        let source = state.visibleSourceState;\n                        let target = state.visibleTargetState;\n                        const pts = states[i][1].absolutePoints;\n                        if (source == null || !this.isCellMoving(source.cell)) {\n                            const pt0 = pts[0];\n                            if (pt0) {\n                                state.setAbsoluteTerminalPoint(new Point(pt0.x + dx, pt0.y + dy), true);\n                                source = null;\n                            }\n                        }\n                        else {\n                            state.view.updateFixedTerminalPoint(state, source, true, this.graph.getConnectionConstraint(state, source, true));\n                        }\n                        if (target == null || !this.isCellMoving(target.cell)) {\n                            const ptn = pts[pts.length - 1];\n                            if (ptn) {\n                                state.setAbsoluteTerminalPoint(new Point(ptn.x + dx, ptn.y + dy), false);\n                                target = null;\n                            }\n                        }\n                        else {\n                            state.view.updateFixedTerminalPoint(state, target, false, this.graph.getConnectionConstraint(state, target, false));\n                        }\n                        state.view.updatePoints(state, points, source, target);\n                        state.view.updateFloatingTerminalPoints(state, source, target);\n                        state.view.updateEdgeLabelOffset(state);\n                        state.invalid = false;\n                        // Draws the live preview but avoids update of state\n                        if (!this.cloning) {\n                            state.view.graph.cellRenderer.redraw(state, true);\n                        }\n                    }\n                }\n                this.graph.view.validate();\n                this.redrawHandles(states);\n                this.resetPreviewStates(states);\n            }\n        }\n    }\n    /**\n     * Redraws the preview shape for the given states array.\n     */\n    redrawHandles(states) {\n        const selectionCellsHandler = this.getSelectionCellsHandler();\n        for (let i = 0; i < states.length; i += 1) {\n            const handler = selectionCellsHandler?.getHandler(states[i][0].cell);\n            handler?.redraw(true);\n        }\n    }\n    /**\n     * Resets the given preview states array.\n     */\n    resetPreviewStates(states) {\n        for (let i = 0; i < states.length; i += 1) {\n            states[i][0].setState(states[i][1]);\n        }\n    }\n    /**\n     * Suspends the livew preview.\n     */\n    suspend() {\n        if (!this.suspended) {\n            if (this.livePreviewUsed) {\n                this.updateLivePreview(0, 0);\n            }\n            if (this.shape) {\n                this.shape.node.style.visibility = 'hidden';\n            }\n            if (this.guide) {\n                this.guide.setVisible(false);\n            }\n            this.suspended = true;\n        }\n    }\n    /**\n     * Suspends the livew preview.\n     */\n    resume() {\n        if (this.suspended) {\n            this.suspended = false;\n            if (this.livePreviewUsed) {\n                this.livePreviewActive = true;\n            }\n            if (this.shape) {\n                this.shape.node.style.visibility = 'visible';\n            }\n            if (this.guide) {\n                this.guide.setVisible(true);\n            }\n        }\n    }\n    /**\n     * Resets the livew preview.\n     */\n    resetLivePreview() {\n        this.allCells.forEach((state) => {\n            // Restores event handling\n            if (state.shape && state.shape.originalPointerEvents !== null) {\n                state.shape.pointerEvents = state.shape.originalPointerEvents;\n                state.shape.originalPointerEvents = null;\n                // Forces repaint even if not moved to update pointer events\n                state.shape.bounds = null;\n                if (state.text && state.text.originalPointerEvents !== null) {\n                    state.text.pointerEvents = state.text.originalPointerEvents;\n                    state.text.originalPointerEvents = null;\n                }\n            }\n            // Shows folding icon\n            if (state.control &&\n                state.control.node &&\n                state.control.node.style.visibility === 'hidden') {\n                state.control.node.style.visibility = '';\n            }\n            // Fixes preview box for edge labels\n            if (!this.cloning) {\n                if (state.text) {\n                    state.text.updateBoundingBox();\n                }\n            }\n            // Forces repaint of connected edges\n            state.view.invalidate(state.cell);\n        });\n        // Repaints all invalid states\n        this.graph.view.validate();\n    }\n    /**\n     * Sets whether the handles attached to the given cells are visible.\n     *\n     * @param cells Array of {@link Cell}s.\n     * @param visible Boolean that specifies if the handles should be visible.\n     * @param force Forces an update of the handler regardless of the last used value.\n     */\n    setHandlesVisibleForCells(cells, visible, force = false) {\n        if (force || this.handlesVisible !== visible) {\n            this.handlesVisible = visible;\n            const selectionCellsHandler = this.getSelectionCellsHandler();\n            for (let i = 0; i < cells.length; i += 1) {\n                const handler = selectionCellsHandler?.getHandler(cells[i]);\n                if (handler) {\n                    handler.setHandlesVisible(visible);\n                    if (visible) {\n                        handler.redraw();\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Sets the color of the rectangle used to highlight drop targets.\n     *\n     * @param color String that represents the new highlight color.\n     */\n    setHighlightColor(color) {\n        if (this.highlight) {\n            this.highlight.setHighlightColor(color);\n        }\n    }\n    /**\n     * Handles the event by applying the changes to the selection cells.\n     */\n    mouseUp(_sender, me) {\n        if (!me.isConsumed()) {\n            if (this.livePreviewUsed) {\n                this.resetLivePreview();\n            }\n            if (this.cell &&\n                this.first &&\n                (this.shape || this.livePreviewUsed) &&\n                isNumeric(this.currentDx) &&\n                isNumeric(this.currentDy)) {\n                const { graph } = this;\n                const cell = me.getCell();\n                if (this.connectOnDrop &&\n                    !this.target &&\n                    cell &&\n                    cell.isVertex() &&\n                    cell.isConnectable() &&\n                    graph.isEdgeValid(null, this.cell, cell)) {\n                    const connectionHandler = graph.getPlugin('ConnectionHandler');\n                    connectionHandler?.connect(this.cell, cell, me.getEvent());\n                }\n                else {\n                    const clone = graph.isCloneEvent(me.getEvent()) &&\n                        graph.isCellsCloneable() &&\n                        this.isCloneEnabled();\n                    const { scale } = graph.getView();\n                    const dx = this.roundLength(this.currentDx / scale);\n                    const dy = this.roundLength(this.currentDy / scale);\n                    const target = this.target;\n                    if (target &&\n                        graph.isSplitEnabled() &&\n                        this.cells &&\n                        graph.isSplitTarget(target, this.cells, me.getEvent())) {\n                        graph.splitEdge(target, this.cells, null, dx, dy, me.getGraphX(), me.getGraphY());\n                    }\n                    else if (this.cells) {\n                        this.moveCells(this.cells, dx, dy, clone, this.target, me.getEvent());\n                    }\n                }\n            }\n            else if (this.isSelectEnabled() && this.delayedSelection && this.cell != null) {\n                this.selectDelayed(me);\n            }\n        }\n        // Consumes the event if a cell was initially clicked\n        if (this.cellWasClicked) {\n            this.consumeMouseEvent(InternalEvent.MOUSE_UP, me);\n        }\n        this.reset();\n    }\n    /**\n     * Resets the state of this handler.\n     */\n    reset() {\n        if (this.livePreviewUsed) {\n            this.resetLivePreview();\n            this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells() ?? [], true);\n        }\n        this.destroyShapes();\n        this.removeHint();\n        this.delayedSelection = false;\n        this.livePreviewActive = false;\n        this.livePreviewUsed = false;\n        this.cellWasClicked = false;\n        this.suspended = false;\n        this.currentDx = 0;\n        this.currentDy = 0;\n        this.cellCount = 0;\n        this.cloning = false;\n        this.allCells.clear();\n        this.pBounds = null;\n        this.target = null;\n        this.first = null;\n        this.cells = null;\n        this.cell = null;\n    }\n    /**\n     * Returns true if the given cells should be removed from the parent for the specified\n     * mousereleased event.\n     */\n    shouldRemoveCellsFromParent(parent, cells, evt) {\n        if (parent.isVertex()) {\n            const pState = this.graph.getView().getState(parent);\n            if (pState) {\n                let pt = convertPoint(this.graph.container, getClientX(evt), getClientY(evt));\n                const alpha = toRadians(pState.style.rotation ?? 0);\n                if (alpha !== 0) {\n                    const cos = Math.cos(-alpha);\n                    const sin = Math.sin(-alpha);\n                    const cx = new Point(pState.getCenterX(), pState.getCenterY());\n                    pt = getRotatedPoint(pt, cos, sin, cx);\n                }\n                return !contains(pState, pt.x, pt.y);\n            }\n        }\n        return false;\n    }\n    /**\n     * Moves the given cells by the specified amount.\n     */\n    moveCells(cells, dx, dy, clone, target, evt) {\n        if (!this.cell)\n            return;\n        if (clone) {\n            cells = this.graph.getCloneableCells(cells);\n        }\n        // Removes cells from parent\n        const parent = this.cell.getParent();\n        if (!target &&\n            parent &&\n            this.isRemoveCellsFromParent() &&\n            this.shouldRemoveCellsFromParent(parent, cells, evt)) {\n            target = this.graph.getDefaultParent();\n        }\n        // Cloning into locked cells is not allowed\n        clone = !!clone && !this.graph.isCellLocked(target || this.graph.getDefaultParent());\n        this.graph.batchUpdate(() => {\n            const parents = [];\n            // Removes parent if all child cells are removed\n            if (!clone && target && this.removeEmptyParents) {\n                // Collects all non-selected parents\n                const dict = new Map();\n                for (let i = 0; i < cells.length; i += 1) {\n                    dict.set(cells[i], true);\n                }\n                // LATER: Recurse up the cell hierarchy\n                for (let i = 0; i < cells.length; i += 1) {\n                    const par = cells[i].getParent();\n                    if (par && !dict.get(par)) {\n                        dict.set(par, true);\n                        parents.push(par);\n                    }\n                }\n            }\n            // Passes all selected cells in order to correctly clone or move into\n            // the target cell. The method checks for each cell if its movable.\n            cells = this.graph.moveCells(cells, dx, dy, clone, target, evt);\n            // Removes parent if all child cells are removed\n            const temp = [];\n            for (let i = 0; i < parents.length; i += 1) {\n                if (this.shouldRemoveParent(parents[i])) {\n                    temp.push(parents[i]);\n                }\n            }\n            this.graph.removeCells(temp, false);\n        });\n        // Selects the new cells if cells have been cloned\n        if (clone) {\n            this.graph.setSelectionCells(cells);\n        }\n        if (this.isSelectEnabled() && this.scrollOnMove) {\n            this.graph.scrollCellToVisible(cells[0]);\n        }\n    }\n    /**\n     * Returns true if the given parent should be removed after removal of child cells.\n     */\n    shouldRemoveParent(parent) {\n        const state = this.graph.view.getState(parent);\n        return (state != null &&\n            (state.cell.isEdge() || state.cell.isVertex()) &&\n            this.graph.isCellDeletable(state.cell) &&\n            state.cell.getChildCount() === 0 &&\n            state.isTransparentState());\n    }\n    /**\n     * Destroy the preview and highlight shapes.\n     */\n    destroyShapes() {\n        // Destroys the preview dashed rectangle\n        if (this.shape) {\n            this.shape.destroy();\n            this.shape = null;\n        }\n        if (this.guide) {\n            this.guide.destroy();\n            this.guide = null;\n        }\n        // Destroys the drop target highlight\n        if (this.highlight) {\n            this.highlight.destroy();\n            this.highlight = null;\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        this.graph.removeMouseListener(this);\n        this.graph.removeListener(this.panHandler);\n        this.graph.removeListener(this.escapeHandler);\n        this.graph.getDataModel().removeListener(this.refreshHandler);\n        this.graph.removeListener(this.refreshHandler);\n        InternalEvent.removeListener(document, 'keydown', this.keyHandler);\n        InternalEvent.removeListener(document, 'keyup', this.keyHandler);\n        this.destroyShapes();\n        this.removeHint();\n    }\n    getSelectionCellsHandler() {\n        return this.graph.getPlugin('SelectionCellsHandler');\n    }\n}\nSelectionHandler.pluginId = 'SelectionHandler';\nexport default SelectionHandler;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { hasScrollbars } from '../../util/styleUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\n/**\n * Implements a handler for panning.\n *\n * @category Navigation\n */\nclass PanningManager {\n    constructor(graph) {\n        /**\n         * Damper value for the panning. Default is 1/6.\n         */\n        this.damper = 1 / 6;\n        /**\n         * Delay in milliseconds for the panning. Default is 10.\n         */\n        this.delay = 10;\n        /**\n         * Specifies if mouse events outside the component should be handled. Default is true.\n         */\n        this.handleMouseOut = true;\n        /**\n         * Border to handle automatic panning inside the component. Default is 0 (disabled).\n         */\n        this.border = 0;\n        this.thread = null;\n        this.active = false;\n        this.tdx = 0;\n        this.tdy = 0;\n        this.t0x = 0;\n        this.t0y = 0;\n        this.dx = 0;\n        this.dy = 0;\n        this.scrollbars = false;\n        this.scrollLeft = 0;\n        this.scrollTop = 0;\n        this.thread = null;\n        this.active = false;\n        this.tdx = 0;\n        this.tdy = 0;\n        this.t0x = 0;\n        this.t0y = 0;\n        this.dx = 0;\n        this.dy = 0;\n        this.scrollbars = false;\n        this.scrollLeft = 0;\n        this.scrollTop = 0;\n        this.mouseListener = {\n            mouseDown: () => {\n                // do nothing\n            },\n            mouseMove: () => {\n                // do nothing\n            },\n            mouseUp: () => {\n                if (this.active) {\n                    this.stop();\n                }\n            },\n        };\n        graph.addMouseListener(this.mouseListener);\n        this.mouseUpListener = () => {\n            if (this.active) {\n                this.stop();\n            }\n        };\n        // Stops scrolling on every mouseup anywhere in the document\n        InternalEvent.addListener(document, 'mouseup', this.mouseUpListener);\n        const createThread = () => {\n            this.scrollbars = hasScrollbars(graph.container);\n            this.scrollLeft = graph.container.scrollLeft;\n            this.scrollTop = graph.container.scrollTop;\n            return window.setInterval(() => {\n                this.tdx -= this.dx;\n                this.tdy -= this.dy;\n                if (this.scrollbars) {\n                    const left = -graph.container.scrollLeft - Math.ceil(this.dx);\n                    const top = -graph.container.scrollTop - Math.ceil(this.dy);\n                    graph.panGraph(left, top);\n                    graph.setPanDx(this.scrollLeft - graph.container.scrollLeft);\n                    graph.setPanDy(this.scrollTop - graph.container.scrollTop);\n                    graph.fireEvent(new EventObject(InternalEvent.PAN));\n                    // TODO: Implement graph.autoExtend\n                }\n                else {\n                    graph.panGraph(this.getDx(), this.getDy());\n                }\n            }, this.delay);\n        };\n        this.isActive = () => {\n            return this.active;\n        };\n        this.getDx = () => {\n            return Math.round(this.tdx);\n        };\n        this.getDy = () => {\n            return Math.round(this.tdy);\n        };\n        this.start = () => {\n            this.t0x = graph.view.translate.x;\n            this.t0y = graph.view.translate.y;\n            this.active = true;\n        };\n        this.panTo = (x, y, w = 0, h = 0) => {\n            if (!this.active) {\n                this.start();\n            }\n            this.scrollLeft = graph.container.scrollLeft;\n            this.scrollTop = graph.container.scrollTop;\n            const c = graph.container;\n            this.dx = x + w - c.scrollLeft - c.clientWidth;\n            if (this.dx < 0 && Math.abs(this.dx) < this.border) {\n                this.dx = this.border + this.dx;\n            }\n            else if (this.handleMouseOut) {\n                this.dx = Math.max(this.dx, 0);\n            }\n            else {\n                this.dx = 0;\n            }\n            if (this.dx == 0) {\n                this.dx = x - c.scrollLeft;\n                if (this.dx > 0 && this.dx < this.border) {\n                    this.dx -= this.border;\n                }\n                else if (this.handleMouseOut) {\n                    this.dx = Math.min(0, this.dx);\n                }\n                else {\n                    this.dx = 0;\n                }\n            }\n            this.dy = y + h - c.scrollTop - c.clientHeight;\n            if (this.dy < 0 && Math.abs(this.dy) < this.border) {\n                this.dy = this.border + this.dy;\n            }\n            else if (this.handleMouseOut) {\n                this.dy = Math.max(this.dy, 0);\n            }\n            else {\n                this.dy = 0;\n            }\n            if (this.dy == 0) {\n                this.dy = y - c.scrollTop;\n                if (this.dy > 0 && this.dy < this.border) {\n                    this.dy -= this.border;\n                }\n                else if (this.handleMouseOut) {\n                    this.dy = Math.min(0, this.dy);\n                }\n                else {\n                    this.dy = 0;\n                }\n            }\n            if (this.dx != 0 || this.dy != 0) {\n                this.dx *= this.damper;\n                this.dy *= this.damper;\n                if (this.thread == null) {\n                    this.thread = createThread();\n                }\n            }\n            else if (this.thread != null) {\n                window.clearInterval(this.thread);\n                this.thread = null;\n            }\n        };\n        this.stop = () => {\n            if (this.active) {\n                this.active = false;\n                if (this.thread != null) {\n                    window.clearInterval(this.thread);\n                    this.thread = null;\n                }\n                this.tdx = 0;\n                this.tdy = 0;\n                if (!this.scrollbars) {\n                    const px = graph.getPanDx();\n                    const py = graph.getPanDy();\n                    if (px != 0 || py != 0) {\n                        graph.panGraph(0, 0);\n                        graph.view.setTranslate(this.t0x + px / graph.view.scale, this.t0y + py / graph.view.scale);\n                    }\n                }\n                else {\n                    graph.setPanDx(0);\n                    graph.setPanDy(0);\n                    graph.fireEvent(new EventObject(InternalEvent.PAN));\n                }\n            }\n        };\n        this.destroy = () => {\n            graph.removeMouseListener(this.mouseListener);\n            InternalEvent.removeListener(document, 'mouseup', this.mouseUpListener);\n        };\n    }\n}\nexport default PanningManager;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../event/EventSource.js';\nimport { hasScrollbars } from '../../util/styleUtils.js';\nimport EventObject from '../event/EventObject.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport { isConsumed, isControlDown, isLeftMouseButton, isMultiTouchEvent, isPopupTrigger, isShiftDown, } from '../../util/EventUtils.js';\nimport PanningManager from '../other/PanningManager.js';\n/**\n * Event handler that pans and creates popupmenus.\n *\n * To use the left mouse button for panning without interfering with cell moving and resizing, use {@link useLeftButtonForPanning} and {@link ignoreCell}.\n *\n * For grid size steps while panning, use {@link useGrid}.\n *\n * When registered in the {@link AbstractGraph.constructor} plugins list, it can be enabled using {@link AbstractGraph.setPanning}.\n *\n * ### Events\n *\n * **{@link InternalEvent.PAN_START}**\n *\n * Fires when the panning handler changes its {@link active} state to `true`.\n *\n * In the {@link EventObject} parameter of the listener function, the `event` property contains the corresponding {@link MouseEvent}.\n *\n * **{@link InternalEvent.PAN}**\n *\n * Fires while handle is processing events.\n *\n * In the {@link EventObject} parameter of the listener function, the `event` property contains the corresponding {@link MouseEvent}.\n *\n * **{@link InternalEvent.PAN_END}**\n *\n * Fires when the panning handler changes its {@link active} state to `false`.\n *\n * In the {@link EventObject} parameter of the listener function, the `event` property contains the corresponding {@link MouseEvent}.\n *\n * @category Plugin\n * @category Navigation\n */\nclass PanningHandler extends EventSource {\n    constructor(graph) {\n        super();\n        this.getPanningManager = () => this.panningManager;\n        /**\n         * Specifies if panning should be active for the left mouse button.\n         * Setting this to true may conflict with {@link RubberBandHandler}.\n         *\n         * @default false\n         */\n        this.useLeftButtonForPanning = false;\n        /**\n         * Specifies if {@link Event.isPopupTrigger} should also be used for panning.\n         * @default true\n         */\n        this.usePopupTrigger = true;\n        /**\n         * Specifies if panning should be active even if there is a cell under the mouse pointer.\n         * @default false\n         */\n        this.ignoreCell = false;\n        /**\n         * Specifies if the panning should be previewed.\n         * @default true\n         */\n        this.previewEnabled = true;\n        /**\n         * Specifies if the panning steps should be aligned to the grid size.\n         * @default false\n         */\n        this.useGrid = false;\n        /**\n         * Specifies if panning should be enabled.\n         * @default false\n         */\n        this.panningEnabled = false;\n        /**\n         * Specifies if pinch gestures should be handled as zoom.\n         * @default true\n         */\n        this.pinchEnabled = true;\n        this.initialScale = 0;\n        /**\n         * Specifies the maximum scale.\n         * @default 8\n         */\n        this.maxScale = 8;\n        /**\n         * Specifies the minimum scale.\n         * @default 0.01\n         */\n        this.minScale = 0.01;\n        /**\n         * Holds the current horizontal offset.\n         */\n        this.dx = 0;\n        /**\n         * Holds the current vertical offset.\n         */\n        this.dy = 0;\n        /**\n         * Holds the x-coordinate of the start point.\n         */\n        this.startX = 0;\n        /**\n         * Holds the y-coordinate of the start point.\n         */\n        this.startY = 0;\n        this.dx0 = 0;\n        this.dy0 = 0;\n        this.panningTrigger = false;\n        this.active = false;\n        this.mouseDownEvent = null;\n        this.graph = graph;\n        this.graph.addMouseListener(this);\n        // Handles force panning event\n        this.forcePanningHandler = (_sender, eo) => {\n            const evtName = eo.getProperty('eventName');\n            const me = eo.getProperty('event');\n            if (evtName === InternalEvent.MOUSE_DOWN && this.isForcePanningEvent(me)) {\n                this.start(me);\n                this.active = true;\n                this.fireEvent(new EventObject(InternalEvent.PAN_START, { event: me }));\n                me.consume();\n            }\n        };\n        this.graph.addListener(InternalEvent.FIRE_MOUSE_EVENT, this.forcePanningHandler);\n        // Handles pinch gestures\n        this.gestureHandler = (_sender, eo) => {\n            if (this.isPinchEnabled()) {\n                const evt = eo.getProperty('event');\n                if (!isConsumed(evt) && evt.type === 'gesturestart') {\n                    this.initialScale = this.graph.view.scale;\n                    // Forces start of panning when pinch gesture starts\n                    if (!this.active && this.mouseDownEvent) {\n                        this.start(this.mouseDownEvent);\n                        this.mouseDownEvent = null;\n                    }\n                }\n                else if (evt.type === 'gestureend' && this.initialScale !== 0) {\n                    this.initialScale = 0;\n                }\n                if (this.initialScale !== 0) {\n                    this.zoomGraph(evt);\n                }\n            }\n        };\n        this.graph.addListener(InternalEvent.GESTURE, this.gestureHandler);\n        this.mouseUpListener = () => {\n            if (this.active) {\n                this.reset();\n            }\n        };\n        // Stops scrolling on every mouseup anywhere in the document\n        InternalEvent.addListener(document, 'mouseup', this.mouseUpListener);\n        this.panningManager = new PanningManager(graph);\n    }\n    /**\n     * Returns true if the handler is currently active.\n     */\n    isActive() {\n        return this.active || this.initialScale !== null;\n    }\n    /**\n     * Returns <panningEnabled>.\n     */\n    isPanningEnabled() {\n        return this.panningEnabled;\n    }\n    /**\n     * Sets <panningEnabled>.\n     */\n    setPanningEnabled(value) {\n        this.panningEnabled = value;\n    }\n    /**\n     * Returns <pinchEnabled>.\n     */\n    isPinchEnabled() {\n        return this.pinchEnabled;\n    }\n    /**\n     * Sets <pinchEnabled>.\n     */\n    setPinchEnabled(value) {\n        this.pinchEnabled = value;\n    }\n    /**\n     * Returns true if the given event is a panning trigger for the optional\n     * given cell. This returns true if control-shift is pressed or if\n     * <usePopupTrigger> is true and the event is a popup trigger.\n     */\n    isPanningTrigger(me) {\n        const evt = me.getEvent();\n        return ((this.useLeftButtonForPanning && !me.getState() && isLeftMouseButton(evt)) ||\n            (isControlDown(evt) && isShiftDown(evt)) ||\n            (this.usePopupTrigger && isPopupTrigger(evt)));\n    }\n    /**\n     * Returns true if the given {@link MouseEvent} should start panning.\n     *\n     * This implementation always returns `true` if {@link ignoreCell} is `true` or for multi touch events.\n     */\n    isForcePanningEvent(me) {\n        return this.ignoreCell || isMultiTouchEvent(me.getEvent());\n    }\n    /**\n     * Handles the event by initiating the panning. By consuming the event all\n     * subsequent events of the gesture are redirected to this handler.\n     */\n    mouseDown(_sender, me) {\n        this.mouseDownEvent = me;\n        if (!me.isConsumed() &&\n            this.isPanningEnabled() &&\n            !this.active &&\n            this.isPanningTrigger(me)) {\n            this.start(me);\n            this.consumePanningTrigger(me);\n        }\n    }\n    /**\n     * Starts panning at the given event.\n     */\n    start(me) {\n        this.dx0 = -this.graph.container.scrollLeft;\n        this.dy0 = -this.graph.container.scrollTop;\n        // Stores the location of the trigger event\n        this.startX = me.getX();\n        this.startY = me.getY();\n        this.dx = 0;\n        this.dy = 0;\n        this.panningTrigger = true;\n    }\n    /**\n     * Consumes the given {@link MouseEvent} if it was a panning trigger in\n     * {@link ouseDown}. The default is to invoke {@link MouseEvent#consume}. Note that this\n     * will block any further event processing. If you haven't disabled built-in\n     * context menus and require immediate selection of the cell on mouseDown in\n     * Safari and/or on the Mac, then use the following code:\n     *\n     * ```javascript\n     * consumePanningTrigger(me)\n     * {\n     *   if (me.evt.preventDefault)\n     *   {\n     *     me.evt.preventDefault();\n     *   }\n     *\n     *   // Stops event processing in IE\n     *   me.evt.returnValue = false;\n     *\n     *   // Sets local consumed state\n     *   if (!Client.IS_SF && !Client.IS_MAC)\n     *   {\n     *     me.consumed = true;\n     *   }\n     * };\n     * ```\n     */\n    consumePanningTrigger(me) {\n        me.consume();\n    }\n    /**\n     * Handles the event by updating the panning on the graph.\n     */\n    mouseMove(_sender, me) {\n        this.dx = me.getX() - this.startX;\n        this.dy = me.getY() - this.startY;\n        if (this.active) {\n            if (this.previewEnabled) {\n                // Applies the grid to the panning steps\n                if (this.useGrid) {\n                    this.dx = this.graph.snap(this.dx);\n                    this.dy = this.graph.snap(this.dy);\n                }\n                this.graph.panGraph(this.dx + this.dx0, this.dy + this.dy0);\n            }\n            this.fireEvent(new EventObject(InternalEvent.PAN, { event: me }));\n        }\n        else if (this.panningTrigger) {\n            const tmp = this.active;\n            // Panning is activated only if the mouse is moved\n            // beyond the graph tolerance\n            this.active =\n                Math.abs(this.dx) > this.graph.getSnapTolerance() ||\n                    Math.abs(this.dy) > this.graph.getSnapTolerance();\n            if (!tmp && this.active) {\n                this.fireEvent(new EventObject(InternalEvent.PAN_START, { event: me }));\n            }\n        }\n        if (this.active || this.panningTrigger) {\n            me.consume();\n        }\n    }\n    /**\n     * Handles the event by setting the translation on the view or showing the\n     * popupmenu.\n     */\n    mouseUp(_sender, me) {\n        if (this.active) {\n            if (this.dx !== 0 && this.dy !== 0) {\n                // Ignores if scrollbars have been used for panning\n                if (!this.graph.isUseScrollbarsForPanning() ||\n                    !hasScrollbars(this.graph.container)) {\n                    const { scale } = this.graph.getView();\n                    const t = this.graph.getView().translate;\n                    this.graph.panGraph(0, 0);\n                    this.panGraph(t.x + this.dx / scale, t.y + this.dy / scale);\n                }\n                me.consume();\n            }\n            this.fireEvent(new EventObject(InternalEvent.PAN_END, { event: me }));\n        }\n        this.reset();\n    }\n    /**\n     * Zooms the graph to the given value and consumed the event if needed.\n     */\n    zoomGraph(evt) {\n        // @ts-ignore evt may have scale property\n        let value = Math.round(this.initialScale * evt.scale * 100) / 100;\n        value = Math.max(this.minScale, value);\n        value = Math.min(this.maxScale, value);\n        if (this.graph.view.scale !== value) {\n            this.graph.zoomTo(value);\n            InternalEvent.consume(evt);\n        }\n    }\n    /**\n     * Handles the event by setting the translation on the view or showing the\n     * popupmenu.\n     */\n    reset() {\n        this.panningTrigger = false;\n        this.mouseDownEvent = null;\n        this.active = false;\n        this.dx = 0;\n        this.dy = 0;\n    }\n    /**\n     * Pans {@link graph} by the given amount.\n     */\n    panGraph(dx, dy) {\n        this.graph.getView().setTranslate(dx, dy);\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     */\n    onDestroy() {\n        this.graph.removeMouseListener(this);\n        this.graph.removeListener(this.forcePanningHandler);\n        this.graph.removeListener(this.gestureHandler);\n        InternalEvent.removeListener(document, 'mouseup', this.mouseUpListener);\n    }\n}\nPanningHandler.pluginId = 'PanningHandler';\nexport default PanningHandler;\n","/*\nCopyright 2025-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { hasScrollbars } from '../../util/styleUtils.js';\nfunction keep2digits(value) {\n    return Number(value.toFixed(2));\n}\n/**\n * A plugin providing methods to fit the graph within its container.\n * @since 0.17.0\n * @category Navigation\n * @category Plugin\n */\nexport class FitPlugin {\n    /**\n     * Constructs the plugin that provides `fit` methods.\n     *\n     * @param graph Reference to the enclosing {@link AbstractGraph}.\n     */\n    constructor(graph) {\n        this.graph = graph;\n        /**\n         * Specifies the minimum scale to be applied in {@link fit}. Set this to `null` to allow any value.\n         * @default 0.1\n         * @since 0.21.0\n         */\n        this.minFitScale = 0.1;\n        /**\n         * Specifies the maximum scale to be applied in {@link fit} and  {@link fitCenter}. Set this to `null` to allow any value.\n         * @default 8\n         */\n        this.maxFitScale = 8;\n    }\n    /**\n     * Scales the graph such that the complete diagram fits into {@link Graph.container} and returns the current scale in the view.\n     * To fit an initial graph prior to rendering, set {@link GraphView.rendering} to `false` prior to changing the model\n     * and execute the following after changing the model.\n     *\n     * ```javascript\n     * graph.view.rendering = false;\n     * // here, change the model\n     * graph.getPlugin<FitPlugin>('fit')?.fit();\n     * graph.view.rendering = true;\n     * graph.refresh();\n     * ```\n     *\n     * To fit and center the graph, use {@link fitCenter}.\n     *\n     * @param options Optional number that specifies the border.\n     * @since 0.21.0\n     */\n    fit(options = {}) {\n        const { border = this.graph.getBorder(), keepOrigin = false, margin = 0, enabled = true, ignoreWidth = false, ignoreHeight = false, maxHeight = null, } = options;\n        const { backgroundImage, container, view } = this.graph;\n        if (container) {\n            // Adds spacing and border from css\n            const cssBorder = this.graph.getBorderSizes();\n            let w1 = container.offsetWidth - cssBorder.x - cssBorder.width - 1;\n            let h1 = maxHeight ?? container.offsetHeight - cssBorder.y - cssBorder.height - 1;\n            let bounds = view.getGraphBounds();\n            if (bounds.width > 0 && bounds.height > 0) {\n                if (keepOrigin && bounds.x != null && bounds.y != null) {\n                    bounds = bounds.clone();\n                    bounds.width += bounds.x;\n                    bounds.height += bounds.y;\n                    bounds.x = 0;\n                    bounds.y = 0;\n                }\n                // LATER: Use unscaled bounding boxes to fix rounding errors\n                const originalScale = view.scale;\n                let w2 = bounds.width / originalScale;\n                let h2 = bounds.height / originalScale;\n                // Fits to the size of the background image if required\n                if (backgroundImage) {\n                    w2 = Math.max(w2, backgroundImage.width - bounds.x / originalScale);\n                    h2 = Math.max(h2, backgroundImage.height - bounds.y / originalScale);\n                }\n                const b = (keepOrigin ? border : 2 * border) + margin + 1;\n                w1 -= b;\n                h1 -= b;\n                let newScale = ignoreWidth\n                    ? h1 / h2\n                    : ignoreHeight\n                        ? w1 / w2\n                        : Math.min(w1 / w2, h1 / h2);\n                const minScale = this.minFitScale ?? 0;\n                const maxScale = this.maxFitScale ?? Infinity;\n                newScale = Math.max(Math.min(newScale, maxScale), minScale);\n                if (enabled) {\n                    if (!keepOrigin) {\n                        if (!hasScrollbars(container)) {\n                            const x0 = bounds.x != null\n                                ? Math.floor(view.translate.x -\n                                    bounds.x / originalScale +\n                                    border / newScale +\n                                    margin / 2)\n                                : border;\n                            const y0 = bounds.y != null\n                                ? Math.floor(view.translate.y -\n                                    bounds.y / originalScale +\n                                    border / newScale +\n                                    margin / 2)\n                                : border;\n                            view.scaleAndTranslate(newScale, x0, y0);\n                        }\n                        else {\n                            view.setScale(newScale);\n                            const newBounds = this.graph.getGraphBounds();\n                            if (newBounds.x != null) {\n                                container.scrollLeft = newBounds.x;\n                            }\n                            if (newBounds.y != null) {\n                                container.scrollTop = newBounds.y;\n                            }\n                        }\n                    }\n                    else if (view.scale != newScale) {\n                        view.setScale(newScale);\n                    }\n                }\n                else {\n                    return newScale;\n                }\n            }\n        }\n        return view.scale;\n    }\n    /**\n     * Fit and center the graph within its container.\n     *\n     * @param options Optional options to customize the fit behavior.\n     * @returns The current scale in the view.\n     */\n    fitCenter(options) {\n        // Inspired by the former examples provided in the Graph.fit JSDoc: https://github.com/maxGraph/maxGraph/blob/v0.16.0/packages/core/src/view/Graph.ts#L845-L861\n        const margin = options?.margin ?? 2;\n        const { container, view } = this.graph;\n        const clientWidth = container.clientWidth - 2 * margin;\n        const clientHeight = container.clientHeight - 2 * margin;\n        const bounds = this.graph.getGraphBounds();\n        const originalScale = view.scale;\n        const width = bounds.width / originalScale;\n        const height = bounds.height / originalScale;\n        // Apply workarounds to avoid rounding impact if fitCenter is called multiple times\n        // Use precise scale value when computing translation values, but round the applied scale\n        // Translate using integer values as this is done in Graph.fit\n        let newScale = Math.min(this.maxFitScale ?? Infinity, clientWidth / width, clientHeight / height);\n        if (!Number.isFinite(newScale)) {\n            newScale = originalScale;\n        }\n        const translateX = Math.floor(view.translate.x +\n            (container.clientWidth - width * newScale) / (2 * newScale) -\n            bounds.x / originalScale);\n        const translateY = Math.floor(view.translate.y +\n            (container.clientHeight - height * newScale) / (2 * newScale) -\n            bounds.y / originalScale);\n        newScale = keep2digits(newScale);\n        view.scaleAndTranslate(newScale, translateX, translateY);\n        return newScale;\n    }\n    /** Do nothing here. */\n    onDestroy() {\n        // no-op\n    }\n}\nFitPlugin.pluginId = 'fit';\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2016, JGraph Ltd\nCopyright (c) 2006-2016, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { convertPoint, getOffset, getScrollOrigin, setOpacity, setPrefixedStyle, } from '../../util/styleUtils.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Point from '../geometry/Point.js';\nimport InternalMouseEvent from '../event/InternalMouseEvent.js';\nimport Client from '../../Client.js';\nimport Rectangle from '../geometry/Rectangle.js';\nimport { isAltDown, isMultiTouchEvent } from '../../util/EventUtils.js';\nimport { clearSelection } from '../../util/domUtils.js';\n/**\n * Event handler that selects rectangular regions.\n *\n * **IMPORTANT**: This is not built-into `maxGraph` i.e. this plugin is not in the `maxGraph` default plugins, see {@link getDefaultPlugins}.\n *\n * To enable rubberband selection in a graph, use the following code.\n *\n * ```javascript\n * const plugins = [\n *   ...getDefaultPlugins(), // or any other plugins you want\n *   RubberBandHandler,\n * ];\n *\n * // Creates the graph with the custom plugins\n * const graph = new Graph(container, undefined, plugins);\n * ```\n *\n * **IMPORTANT**: the RubberBandHandler requires CSS styles in order to work properly.\n * See the CSS rules in the `css/common.css` file provided within the npm package. They relate to the `.mxRubberband` class.\n *\n * @category Plugin\n */\nclass RubberBandHandler {\n    constructor(graph) {\n        this.first = null;\n        this.destroyed = false;\n        this.dragHandler = null;\n        this.dropHandler = null;\n        this.x = 0;\n        this.y = 0;\n        this.width = 0;\n        this.height = 0;\n        /**\n         * Specifies the default opacity to be used for the rubberband div.\n         * Valid values are between `0` and `100`.\n         * @default 20\n         */\n        this.defaultOpacity = 20;\n        /**\n         * Specifies if events are handled.\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * Holds the DIV element which is currently visible.\n         */\n        this.div = null;\n        /**\n         * Holds the DIV element which is used to display the rubberband.\n         */\n        this.sharedDiv = null;\n        /**\n         * Holds the value of the x argument in the last call to {@link update}.\n         */\n        this.currentX = 0;\n        /**\n         * Holds the value of the y argument in the last call to {@link update}.\n         */\n        this.currentY = 0;\n        /**\n         * Optional fade out effect.\n         * @default false\n         */\n        this.fadeOut = false;\n        this.graph = graph;\n        this.graph.addMouseListener(this);\n        // Handles force rubberband event\n        this.forceRubberbandHandler = (sender, evt) => {\n            const evtName = evt.getProperty('eventName');\n            const me = evt.getProperty('event');\n            if (evtName === InternalEvent.MOUSE_DOWN && this.isForceRubberbandEvent(me)) {\n                const offset = getOffset(this.graph.container);\n                const origin = getScrollOrigin(this.graph.container);\n                origin.x -= offset.x;\n                origin.y -= offset.y;\n                this.start(me.getX() + origin.x, me.getY() + origin.y);\n                me.consume(false);\n            }\n        };\n        this.graph.addListener(InternalEvent.FIRE_MOUSE_EVENT, this.forceRubberbandHandler);\n        // Repaints the marquee after autoscroll\n        this.panHandler = () => {\n            this.repaint();\n        };\n        this.graph.addListener(InternalEvent.PAN, this.panHandler);\n        // Does not show menu if any touch gestures take place after the trigger\n        this.gestureHandler = (sender, eo) => {\n            if (this.first) {\n                this.reset();\n            }\n        };\n        this.graph.addListener(InternalEvent.GESTURE, this.gestureHandler);\n    }\n    /**\n     * Creates the rubberband selection shape.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling. This implementation updates{@link enabled}.\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n    /**\n     * Returns true if the given {@link MouseEvent} should start rubberband selection.\n     * This implementation returns true if the alt key is pressed.\n     */\n    isForceRubberbandEvent(me) {\n        return isAltDown(me.getEvent());\n    }\n    /**\n     * Handles the event by initiating a rubberband selection.\n     * By consuming the event all subsequent events of the gesture are redirected to this handler.\n     */\n    mouseDown(_sender, me) {\n        if (!me.isConsumed() &&\n            this.isEnabled() &&\n            this.graph.isEnabled() &&\n            !me.getState() &&\n            !isMultiTouchEvent(me.getEvent())) {\n            const offset = getOffset(this.graph.container);\n            const origin = getScrollOrigin(this.graph.container);\n            origin.x -= offset.x;\n            origin.y -= offset.y;\n            this.start(me.getX() + origin.x, me.getY() + origin.y);\n            // Does not prevent the default for this event so that the\n            // event processing chain is still executed even if we start\n            // rubberbanding. This is required eg. in ExtJs to hide the\n            // current context menu. In mouseMove we'll make sure we're\n            // not selecting anything while we're rubberbanding.\n            me.consume(false);\n        }\n    }\n    /**\n     * Creates the rubberband selection shape.\n     */\n    start(x, y) {\n        this.first = new Point(x, y);\n        const { container } = this.graph;\n        function createMouseEvent(evt) {\n            const me = new InternalMouseEvent(evt);\n            const pt = convertPoint(container, me.getX(), me.getY());\n            me.graphX = pt.x;\n            me.graphY = pt.y;\n            return me;\n        }\n        this.dragHandler = (evt) => {\n            this.mouseMove(this.graph, createMouseEvent(evt));\n        };\n        this.dropHandler = (evt) => {\n            this.mouseUp(this.graph, createMouseEvent(evt));\n        };\n        // Workaround for rubberband stopping if the mouse leaves the container in Firefox\n        if (Client.IS_FF) {\n            InternalEvent.addGestureListeners(document, null, this.dragHandler, this.dropHandler);\n        }\n    }\n    /**\n     * Handles the event by updating the rubberband selection.\n     */\n    mouseMove(_sender, me) {\n        if (!me.isConsumed() && this.first) {\n            const origin = getScrollOrigin(this.graph.container);\n            const offset = getOffset(this.graph.container);\n            origin.x -= offset.x;\n            origin.y -= offset.y;\n            const x = me.getX() + origin.x;\n            const y = me.getY() + origin.y;\n            const dx = this.first.x - x;\n            const dy = this.first.y - y;\n            const tol = this.graph.getEventTolerance();\n            if (this.div || Math.abs(dx) > tol || Math.abs(dy) > tol) {\n                if (!this.div) {\n                    this.div = this.createShape();\n                }\n                // Clears selection while rubberbanding. This is required because\n                // the event is not consumed in mouseDown.\n                clearSelection();\n                this.update(x, y);\n                me.consume();\n            }\n        }\n    }\n    /**\n     * Creates the rubberband selection shape.\n     */\n    createShape() {\n        if (!this.sharedDiv) {\n            this.sharedDiv = document.createElement('div');\n            this.sharedDiv.className = 'mxRubberband';\n            setOpacity(this.sharedDiv, this.defaultOpacity);\n        }\n        this.graph.container.appendChild(this.sharedDiv);\n        const result = this.sharedDiv;\n        if (Client.IS_SVG && this.fadeOut) {\n            this.sharedDiv = null;\n        }\n        return result;\n    }\n    /**\n     * Returns true if this handler is active.\n     */\n    isActive(sender, me) {\n        return this.div && this.div.style.display !== 'none';\n    }\n    /**\n     * Handles the event by selecting the region of the rubberband using {@link AbstractGraph.selectRegion}.\n     */\n    mouseUp(_sender, me) {\n        const active = this.isActive();\n        this.reset();\n        if (active) {\n            this.execute(me.getEvent());\n            me.consume();\n        }\n    }\n    /**\n     * Resets the state of this handler and selects the current region for the given event.\n     */\n    execute(evt) {\n        const rect = new Rectangle(this.x, this.y, this.width, this.height);\n        this.graph.selectRegion(rect, evt);\n    }\n    /**\n     * Resets the state of the rubberband selection.\n     */\n    reset() {\n        if (this.div) {\n            if (Client.IS_SVG && this.fadeOut) {\n                const temp = this.div;\n                setPrefixedStyle(temp.style, 'transition', 'all 0.2s linear');\n                temp.style.pointerEvents = 'none';\n                temp.style.opacity = String(0);\n                window.setTimeout(() => {\n                    if (temp.parentNode)\n                        temp.parentNode.removeChild(temp);\n                }, 200);\n            }\n            else {\n                if (this.div.parentNode)\n                    this.div.parentNode.removeChild(this.div);\n            }\n        }\n        InternalEvent.removeGestureListeners(document, null, this.dragHandler, this.dropHandler);\n        this.dragHandler = null;\n        this.dropHandler = null;\n        this.currentX = 0;\n        this.currentY = 0;\n        this.first = null;\n        this.div = null;\n    }\n    /**\n     * Sets <currentX> and <currentY> and calls {@link repaint}.\n     */\n    update(x, y) {\n        this.currentX = x;\n        this.currentY = y;\n        this.repaint();\n    }\n    /**\n     * Computes the bounding box and updates the style of the `div`.\n     */\n    repaint() {\n        if (this.div && this.first) {\n            const x = this.currentX - this.graph.getPanDx();\n            const y = this.currentY - this.graph.getPanDy();\n            this.x = Math.min(this.first.x, x);\n            this.y = Math.min(this.first.y, y);\n            this.width = Math.max(this.first.x, x) - this.x;\n            this.height = Math.max(this.first.y, y) - this.y;\n            const dx = 0;\n            const dy = 0;\n            this.div.style.left = `${this.x + dx}px`;\n            this.div.style.top = `${this.y + dy}px`;\n            this.div.style.width = `${Math.max(1, this.width)}px`;\n            this.div.style.height = `${Math.max(1, this.height)}px`;\n        }\n    }\n    /**\n     * Destroys the handler and all its resources and DOM nodes.\n     * This does normally not need to be called, it is called automatically when the window unloads.\n     */\n    onDestroy() {\n        if (!this.destroyed) {\n            this.destroyed = true;\n            this.graph.removeMouseListener(this);\n            this.graph.removeListener(this.forceRubberbandHandler);\n            this.graph.removeListener(this.panHandler);\n            this.reset();\n            if (this.sharedDiv) {\n                this.sharedDiv = null;\n            }\n        }\n    }\n}\nRubberBandHandler.pluginId = 'RubberBandHandler';\nexport default RubberBandHandler;\n","/*\nCopyright 2024-present The maxGraph project Contributors\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport CellEditorHandler from './CellEditorHandler.js';\nimport TooltipHandler from './TooltipHandler.js';\nimport SelectionCellsHandler from './SelectionCellsHandler.js';\nimport PopupMenuHandler from './PopupMenuHandler.js';\nimport ConnectionHandler from './ConnectionHandler.js';\nimport SelectionHandler from './SelectionHandler.js';\nimport PanningHandler from './PanningHandler.js';\nimport { FitPlugin } from './FitPlugin.js';\n// Export all plugins and types to have them in the root barrel file\nexport { default as CellEditorHandler } from './CellEditorHandler.js';\nexport { default as ConnectionHandler } from './ConnectionHandler.js';\nexport * from './FitPlugin.js';\nexport { default as PanningHandler } from './PanningHandler.js';\nexport { default as PopupMenuHandler } from './PopupMenuHandler.js';\nexport { default as RubberBandHandler } from './RubberBandHandler.js';\nexport { default as SelectionCellsHandler } from './SelectionCellsHandler.js';\nexport { default as SelectionHandler } from './SelectionHandler.js';\nexport { default as TooltipHandler } from './TooltipHandler.js';\n/**\n * Returns the list of plugins used by default in `maxGraph`.\n *\n * The function returns a new array each time it is called.\n *\n * @category Plugin\n * @since 0.13.0\n */\nexport const getDefaultPlugins = () => [\n    CellEditorHandler,\n    TooltipHandler,\n    SelectionCellsHandler,\n    PopupMenuHandler,\n    ConnectionHandler,\n    SelectionHandler,\n    PanningHandler,\n    FitPlugin,\n];\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport { AbstractGraph } from './AbstractGraph.js';\nimport GraphView from './GraphView.js';\nimport CellRenderer from './cell/CellRenderer.js';\nimport GraphDataModel from './GraphDataModel.js';\nimport { Stylesheet } from './style/Stylesheet.js';\nimport GraphSelectionModel from './GraphSelectionModel.js';\nimport { registerDefaultShapes } from './shape/register-shapes.js';\nimport { registerDefaultEdgeMarkers, registerDefaultEdgeStyles, registerDefaultPerimeters, } from './style/register.js';\nimport { getDefaultPlugins } from './plugins/index.js';\n/**\n * An implementation of {@link AbstractGraph} that automatically loads some default built-ins (plugins, style elements).\n *\n * Good for evaluation and prototyping, but not recommended for production use. Use {@link BaseGraph} instead.\n *\n * @category Graph\n */\nexport class Graph extends AbstractGraph {\n    /**\n     * Creates a new {@link CellRenderer} to be used in this graph.\n     */\n    createCellRenderer() {\n        return new CellRenderer();\n    }\n    /**\n     * Creates a new {@link GraphDataModel} to be used in this graph.\n     */\n    createGraphDataModel() {\n        return new GraphDataModel();\n    }\n    /**\n     * Creates a new {@link GraphView} to be used in this graph.\n     */\n    createGraphView() {\n        return new GraphView(this);\n    }\n    /**\n     * Creates a new {@link GraphSelectionModel} to be used in this graph.\n     */\n    createSelectionModel() {\n        return new GraphSelectionModel(this);\n    }\n    /**\n     * Creates a new {@link Stylesheet} to be used in this graph.\n     */\n    createStylesheet() {\n        return new Stylesheet();\n    }\n    // Register all builtins provided by maxGraph\n    registerDefaults() {\n        registerDefaultEdgeMarkers();\n        registerDefaultEdgeStyles();\n        registerDefaultPerimeters();\n        registerDefaultShapes();\n    }\n    // Use the create factory methods of the class instead of the collaborators because they cannot be passed in the constructor\n    initializeCollaborators(options) {\n        this.cellRenderer = this.createCellRenderer();\n        this.model = options?.model ?? this.createGraphDataModel();\n        this.setSelectionModel(this.createSelectionModel());\n        this.setStylesheet(options?.stylesheet ?? this.createStylesheet());\n        this.view = this.createGraphView();\n    }\n    constructor(container, model, plugins = getDefaultPlugins(), stylesheet) {\n        super({ container, model, plugins, stylesheet: stylesheet ?? undefined });\n    }\n}\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport EventSource from '../event/EventSource.js';\nimport InternalEvent from '../event/InternalEvent.js';\nimport Rectangle from '../geometry/Rectangle.js';\n/**\n * Manager for swimlanes and nested swimlanes that sets the size of newly added\n * swimlanes to that of their siblings, and propagates changes to the size of a\n * swimlane to its siblings, if {@link siblings} is true, and its ancestors, if\n * {@link bubbling} is true.\n *\n * @category Layout\n */\nclass SwimlaneManager extends EventSource {\n    constructor(graph, horizontal = true, addEnabled = true, resizeEnabled = true) {\n        super();\n        /**\n         * Specifies if event handling is enabled.\n         * @default true\n         */\n        this.enabled = true;\n        /**\n         * Specifies the orientation of the swimlanes.\n         * @default true\n         */\n        this.horizontal = true;\n        /**\n         * Specifies if newly added cells should be resized to match the size of their\n         * existing siblings.\n         * @default true\n         */\n        this.addEnabled = true;\n        /**\n         * Specifies if resizing of swimlanes should be handled.\n         * @default true\n         */\n        this.resizeEnabled = true;\n        this.horizontal = horizontal;\n        this.addEnabled = addEnabled;\n        this.resizeEnabled = resizeEnabled;\n        this.addHandler = (sender, evt) => {\n            if (this.isEnabled() && this.isAddEnabled()) {\n                this.cellsAdded(evt.getProperty('cells'));\n            }\n        };\n        this.resizeHandler = (sender, evt) => {\n            if (this.isEnabled() && this.isResizeEnabled()) {\n                this.cellsResized(evt.getProperty('cells'));\n            }\n        };\n        this.setGraph(graph);\n    }\n    /**\n     * Returns true if events are handled. This implementation\n     * returns {@link enabled}.\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n    /**\n     * Enables or disables event handling. This implementation\n     * updates {@link enabled}.\n     *\n     * @param enabled Boolean that specifies the new enabled state.\n     */\n    setEnabled(value) {\n        this.enabled = value;\n    }\n    /**\n     * Returns {@link horizontal}.\n     */\n    isHorizontal() {\n        return this.horizontal;\n    }\n    /**\n     * Sets {@link horizontal}.\n     */\n    setHorizontal(value) {\n        this.horizontal = value;\n    }\n    /**\n     * Returns {@link addEnabled}.\n     */\n    isAddEnabled() {\n        return this.addEnabled;\n    }\n    /**\n     * Sets {@link addEnabled}.\n     */\n    setAddEnabled(value) {\n        this.addEnabled = value;\n    }\n    /**\n     * Returns {@link resizeEnabled}.\n     */\n    isResizeEnabled() {\n        return this.resizeEnabled;\n    }\n    /**\n     * Sets {@link resizeEnabled}.\n     */\n    setResizeEnabled(value) {\n        this.resizeEnabled = value;\n    }\n    /**\n     * Returns the graph that this manager operates on.\n     */\n    getGraph() {\n        return this.graph;\n    }\n    /**\n     * Sets the graph that the manager operates on.\n     */\n    setGraph(graph) {\n        if (this.graph) {\n            this.graph.removeListener(this.addHandler);\n            this.graph.removeListener(this.resizeHandler);\n        }\n        // @ts-expect-error this.graph can be null only when it is being destroyed.\n        this.graph = graph;\n        if (this.graph) {\n            this.graph.addListener(InternalEvent.ADD_CELLS, this.addHandler);\n            this.graph.addListener(InternalEvent.CELLS_RESIZED, this.resizeHandler);\n        }\n    }\n    /**\n     * Returns true if the given swimlane should be ignored.\n     */\n    isSwimlaneIgnored(swimlane) {\n        return !this.getGraph().isSwimlane(swimlane);\n    }\n    /**\n     * Returns true if the given cell is horizontal. If the given cell is not a\n     * swimlane, then the global orientation is returned.\n     */\n    isCellHorizontal(cell) {\n        if (this.graph.isSwimlane(cell)) {\n            const style = this.graph.getCellStyle(cell);\n            return style.horizontal ?? true;\n        }\n        return !this.isHorizontal();\n    }\n    /**\n     * Called if any cells have been added.\n     *\n     * @param cell Array of {@link Cell} that have been added.\n     */\n    cellsAdded(cells) {\n        if (cells.length > 0) {\n            this.graph.batchUpdate(() => {\n                for (const cell of cells) {\n                    if (!this.isSwimlaneIgnored(cell)) {\n                        this.swimlaneAdded(cell);\n                    }\n                }\n            });\n        }\n    }\n    /**\n     * Updates the size of the given swimlane to match that of any existing\n     * siblings swimlanes.\n     *\n     * @param swimlane {@link Cell} that represents the new swimlane.\n     */\n    swimlaneAdded(swimlane) {\n        const parent = swimlane.getParent();\n        const childCount = parent.getChildCount();\n        let geo = null;\n        // Finds the first valid sibling swimlane as reference\n        for (let i = 0; i < childCount; i += 1) {\n            const child = parent.getChildAt(i);\n            if (child !== swimlane && !this.isSwimlaneIgnored(child)) {\n                geo = child.getGeometry();\n                if (geo) {\n                    break;\n                }\n            }\n        }\n        // Applies the size of the refernece to the newly added swimlane\n        if (geo) {\n            const parentHorizontal = parent ? this.isCellHorizontal(parent) : this.horizontal;\n            this.resizeSwimlane(swimlane, geo.width, geo.height, parentHorizontal);\n        }\n    }\n    /**\n     * Called if any cells have been resizes. Calls {@link swimlaneResized} for all\n     * swimlanes where {@link isSwimlaneIgnored} returns false.\n     *\n     * @param cells Array of {@link Cell} whose size was changed.\n     */\n    cellsResized(cells) {\n        if (cells.length > 0) {\n            this.graph.batchUpdate(() => {\n                // Finds the top-level swimlanes and adds offsets\n                for (const cell of cells) {\n                    if (!this.isSwimlaneIgnored(cell)) {\n                        const geo = cell.getGeometry();\n                        if (geo) {\n                            const size = new Rectangle(0, 0, geo.width, geo.height);\n                            let top = cell;\n                            let current = top;\n                            while (current) {\n                                top = current;\n                                current = current.getParent();\n                                const tmp = this.graph.isSwimlane(current)\n                                    ? this.graph.getStartSize(current)\n                                    : new Rectangle();\n                                size.width += tmp.width;\n                                size.height += tmp.height;\n                            }\n                            const parentHorizontal = current\n                                ? this.isCellHorizontal(current)\n                                : this.horizontal;\n                            this.resizeSwimlane(top, size.width, size.height, parentHorizontal);\n                        }\n                    }\n                }\n            });\n        }\n    }\n    /**\n     * Called from {@link cellsResized} for all swimlanes that are not ignored to update\n     * the size of the siblings and the size of the parent swimlanes, recursively,\n     * if {@link bubbling} is true.\n     *\n     * @param swimlane {@link Cell} whose size has changed.\n     */\n    resizeSwimlane(swimlane, w, h, parentHorizontal) {\n        const model = this.graph.getDataModel();\n        model.batchUpdate(() => {\n            const horizontal = this.isCellHorizontal(swimlane);\n            if (!this.isSwimlaneIgnored(swimlane)) {\n                let geo = swimlane.getGeometry();\n                if (geo) {\n                    if ((parentHorizontal && geo.height !== h) ||\n                        (!parentHorizontal && geo.width !== w)) {\n                        geo = geo.clone();\n                        if (parentHorizontal) {\n                            geo.height = h;\n                        }\n                        else {\n                            geo.width = w;\n                        }\n                        model.setGeometry(swimlane, geo);\n                    }\n                }\n            }\n            const tmp = this.graph.isSwimlane(swimlane)\n                ? this.graph.getStartSize(swimlane)\n                : new Rectangle();\n            w -= tmp.width;\n            h -= tmp.height;\n            const childCount = swimlane.getChildCount();\n            for (let i = 0; i < childCount; i += 1) {\n                const child = swimlane.getChildAt(i);\n                this.resizeSwimlane(child, w, h, horizontal);\n            }\n        });\n    }\n    /**\n     * Removes all handlers from the {@link graph} and deletes the reference to it.\n     */\n    destroy() {\n        this.setGraph(null);\n    }\n}\nexport default SwimlaneManager;\n","/*\nCopyright 2021-present The maxGraph project Contributors\nCopyright (c) 2006-2015, JGraph Ltd\nCopyright (c) 2006-2015, Gaudenz Alder\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nimport InternalEvent from '../event/InternalEvent.js';\nimport EventObject from '../event/EventObject.js';\nimport EventSource from '../event/EventSource.js';\n/**\n * @class UndoManager\n *\n * Implements a command history. When changing the graph model, an\n * {@link mxUndoableChange} object is created at the start of the transaction (when\n * model.beginUpdate is called). All atomic changes are then added to this\n * object until the last model.endUpdate call, at which point the\n * {@link mxUndoableEdit} is dispatched in an event, and added to the history inside\n * {@link UndoManager}. This is done by an event listener in\n * {@link Editor.installUndoHandler}.\n *\n * Each atomic change of the model is represented by an object (eg.\n * {@link mxRootChange}, {@link mxChildChange}, {@link mxTerminalChange} etc) which contains the\n * complete undo information. The {@link UndoManager} also listens to the\n * {@link mxGraphView} and stores it's changes to the current root as insignificant\n * undoable changes, so that drilling (step into, step up) is undone.\n *\n * This means when you execute an atomic change on the model, then change the\n * current root on the view and click undo, the change of the root will be\n * undone together with the change of the model so that the display represents\n * the state at which the model was changed. However, these changes are not\n * transmitted for sharing as they do not represent a state change.\n *\n * ### Example\n *\n * When adding an undo manager to a graph, make sure to add it\n * to the model and the view as well to maintain a consistent\n * display across multiple undo/redo steps.\n *\n * ```javascript\n * var undoManager = new UndoManager();\n * var listener(sender, evt)\n * {\n *   undoManager.undoableEditHappened(evt.getProperty('edit'));\n * };\n * graph.getDataModel().addListener(mxEvent.UNDO, listener);\n * graph.getView().addListener(mxEvent.UNDO, listener);\n * ```\n *\n * The code creates a function that informs the undoManager\n * of an undoable edit and binds it to the undo event of\n * {@link mxGraphModel} and {@link mxGraphView} using\n * {@link EventSource.addListener}.\n *\n * ### Event: mxEvent.CLEAR\n *\n * Fires after {@link clear} was invoked. This event has no properties.\n *\n * ### Event: mxEvent.UNDO\n *\n * Fires afer a significant edit was undone in {@link undo}. The `edit`\n * property contains the {@link mxUndoableEdit} that was undone.\n *\n * ### Event: mxEvent.REDO\n *\n * Fires afer a significant edit was redone in {@link redo}. The `edit`\n * property contains the {@link mxUndoableEdit} that was redone.\n *\n * ### Event: mxEvent.ADD\n *\n * Fires after an undoable edit was added to the history. The `edit`\n * property contains the {@link mxUndoableEdit} that was added.\n */\nclass UndoManager extends EventSource {\n    constructor(size = 100) {\n        super();\n        /**\n         * Maximum command history size. 0 means unlimited history. Default is\n         * 100.\n         * @default 100\n         */\n        this.size = 100;\n        /**\n         * Array that contains the steps of the command history.\n         */\n        this.history = [];\n        /**\n         * Index of the element to be added next.\n         */\n        this.indexOfNextAdd = 0;\n        this.size = size;\n        this.clear();\n    }\n    /**\n     * Returns true if the history is empty.\n     */\n    isEmpty() {\n        return this.history.length == 0;\n    }\n    /**\n     * Clears the command history.\n     */\n    clear() {\n        this.history = [];\n        this.indexOfNextAdd = 0;\n        this.fireEvent(new EventObject(InternalEvent.CLEAR));\n    }\n    /**\n     * Returns true if an undo is possible.\n     */\n    canUndo() {\n        return this.indexOfNextAdd > 0;\n    }\n    /**\n     * Undoes the last change.\n     */\n    undo() {\n        while (this.indexOfNextAdd > 0) {\n            const edit = this.history[--this.indexOfNextAdd];\n            edit.undo();\n            if (edit.isSignificant()) {\n                this.fireEvent(new EventObject(InternalEvent.UNDO, { edit }));\n                break;\n            }\n        }\n    }\n    /**\n     * Returns true if a redo is possible.\n     */\n    canRedo() {\n        return this.indexOfNextAdd < this.history.length;\n    }\n    /**\n     * Redoes the last change.\n     */\n    redo() {\n        const n = this.history.length;\n        while (this.indexOfNextAdd < n) {\n            const edit = this.history[this.indexOfNextAdd++];\n            edit.redo();\n            if (edit.isSignificant()) {\n                this.fireEvent(new EventObject(InternalEvent.REDO, { edit }));\n                break;\n            }\n        }\n    }\n    /**\n     * Method to be called to add new undoable edits to the <history>.\n     */\n    undoableEditHappened(undoableEdit) {\n        this.trim();\n        if (this.size > 0 && this.size == this.history.length) {\n            this.history.shift();\n        }\n        this.history.push(undoableEdit);\n        this.indexOfNextAdd = this.history.length;\n        this.fireEvent(new EventObject(InternalEvent.ADD, { edit: undoableEdit }));\n    }\n    /**\n     * Removes all pending steps after <indexOfNextAdd> from the history,\n     * invoking die on each edit. This is called from <undoableEditHappened>.\n     */\n    trim() {\n        if (this.history.length > this.indexOfNextAdd) {\n            const edits = this.history.splice(this.indexOfNextAdd, this.history.length - this.indexOfNextAdd);\n            for (let i = 0; i < edits.length; i += 1) {\n                edits[i].die();\n            }\n        }\n    }\n}\nexport default UndoManager;\n","// src/graph-styles.ts\nimport type { Graph, CellStyle,  } from '@maxgraph/core';\nimport { cloneUtils, Perimeter, EdgeStyle } from '@maxgraph/core';\n\n/**\n * Applique les styles (vertex/edge + styles nomms) au stylesheet du graph.\n *  appeler une seule fois aprs la cration du Graph.\n */\n\nexport function applyGraphStyles(graph: Graph) {\n\n    // Changes the default vertex style in-place\n    let style = graph.getStylesheet().getDefaultVertexStyle();\n    style.shape = 'swimlane';\n\n    style.strokeWidth = 2;\n    style.verticalAlign = 'middle';\n    style.labelBackgroundColor = 'white';\n    style.fontSize = 11;\n    style.startSize = 22;\n    style.horizontal = false;\n    style.fontColor = 'black';\n    style.strokeColor = 'black';\n    delete style.fillColor;\n    style.foldable = true;\n\n    style = cloneUtils.clone(style);\n    graph.getStylesheet().putCellStyle('arrow', style);\n\n    style = cloneUtils.clone(style);\n    style.shape = 'rectangle';\n    style.fontSize = 10;\n    style.rounded = true;\n    style.horizontal = true;\n    style.verticalAlign = 'middle';\n    delete style.startSize;\n    style.labelBackgroundColor = 'none';\n    graph.getStylesheet().putCellStyle('process', style);\n\n\n    style = cloneUtils.clone(style);\n    style.shape = 'ellipse';\n    style.perimeter = Perimeter.EllipsePerimeter;\n    delete style.rounded;\n    graph.getStylesheet().putCellStyle('state', style);\n\n    style = cloneUtils.clone(style);\n    style.shape = 'rhombus';\n    style.perimeter = Perimeter.RhombusPerimeter;\n    style.verticalAlign = 'top';\n    style.spacingTop = 40;\n    style.spacingRight = 64;\n    graph.getStylesheet().putCellStyle('condition', style);\n\n    style = cloneUtils.clone(style);\n    style.shape = 'doubleEllipse';\n    style.perimeter = Perimeter.EllipsePerimeter;\n    style.spacingTop = 28;\n    style.fontSize = 14;\n    style.fontStyle = 1;\n    delete style.spacingRight;\n    graph.getStylesheet().putCellStyle('end', style);\n\n    style = graph.getStylesheet().getDefaultEdgeStyle();\n    style.edgeStyle = 'elbowEdgeStyle';\n    style.endArrow = 'block';\n    style.rounded = true;\n    style.fontColor = 'black';\n    style.strokeColor = 'black';\n\n    style = cloneUtils.clone(style);\n    style.dashed = true;\n    style.endArrow = 'open';\n    style.startArrow = 'oval';\n    graph.getStylesheet().putCellStyle('crossover', style);\n\n}\n\n/*\nexport function applyGraphStyles(graph: Graph) {\n\n    // Creates the stylesheet for the process display\n    let style = graph.getStylesheet().getDefaultVertexStyle();\n    style.fontSize = 11;\n    style.fontColor = 'black';\n    style.strokeColor = '#808080';\n    style.fillColor = 'white';\n    style.gradientColor = 'white';\n    style.gradientDirection = 'east';\n    style.rounded = true;\n    style.shadow = true;\n    style.fontStyle = 1; // bold\n\n    style = graph.getStylesheet().getDefaultEdgeStyle();\n    style.edgeStyle = EdgeStyle.ElbowConnector;\n    style.strokeColor = '#808080';\n    style.rounded = true;\n    style.shadow = true;\n\n    style = {};\n    style.shape = 'swimlane';\n    style.strokeColor = '#a0a0a0';\n    style.fontColor = '#606060';\n    style.fillColor = '#E0E0DF';\n    style.gradientColor = 'white';\n    style.startSize = 30;\n    style.rounded = false;\n    style.fontSize = 12;\n    style.fontStyle = 0;\n    style.horizontal = false;\n    // To improve text quality for vertical labels in some old IE versions...\n    style.labelBackgroundColor = '#efefef';\n\n    graph.getStylesheet().putCellStyle('swimlane', style);\n\n    style = {};\n    style.shape = 'rhombus';\n    style.perimeter = Perimeter.RhombusPerimeter;\n    style.strokeColor = '#91BCC0';\n    style.fontColor = 'gray';\n    style.fillColor = '#91BCC0';\n    style.gradientColor = 'white';\n    style.align = 'center';\n    style.verticalAlign = 'middle';\n    style.fontSize = 16;\n    graph.getStylesheet().putCellStyle('step', style);\n\n    style = {};\n    style.shape = 'ellipse';\n    style.perimeter = Perimeter.EllipsePerimeter;\n    style.fontColor = 'gray';\n    style.fillColor = '#A0C88F';\n    style.gradientColor = 'white';\n    style.strokeColor = '#A0C88F';\n    style.align = 'center';\n    style.verticalAlign = 'middle';\n    style.fontSize = 16;\n    graph.getStylesheet().putCellStyle('start', style);\n\n    style = cloneUtils.clone(style);\n    style.fillColor = '#DACCBC';\n    style.strokeColor = '#AF7F73';\n    graph.getStylesheet().putCellStyle('end', style);\n\n}\n*/\n\n","// src/bpmn-edit.ts\nimport {\n    Graph,\n    RubberBandHandler,\n    InternalEvent,\n    UndoManager,\n    SwimlaneManager, Cell, Client\n} from '@maxgraph/core';\nimport { applyGraphStyles } from './graph-styles';\n\n\nexport interface BpmnEditorContext {\n    graph: Graph;\n    undoManager: UndoManager;\n}\n\nexport function initBpmnEditor(containerId = 'graph-container'): BpmnEditorContext {\n    console.log(' Initialisation du graphe MaxGraph');\n\n    //  faire trs tt (avant cration du Graph)\n    Client.imageBasePath = '/dist/images';\n\n    const container = document.getElementById(containerId) as HTMLElement | null;\n    if (!container) {\n        throw new Error(`#${containerId} introuvable`);\n    }\n    container.tabIndex = 0;\n\n    const graph = new Graph(container);\n\n    //   On applique les styles UNE FOIS ici\n    applyGraphStyles(graph);\n\n    // Applies size changes to siblings and parents\n    new SwimlaneManager(graph);\n\n\n    graph.setDropEnabled(true);\n    graph.setPanning(true);\n    graph.setConnectable(false);\n    graph.setCellsEditable(true);\n    graph.setCellsResizable(true);\n    graph.setCellsMovable(true);\n    graph.setAllowDanglingEdges(false);\n    graph.setDisconnectOnMove(false);\n    graph.setSplitEnabled(false);\n\n    // Slection multiple\n    new RubberBandHandler(graph);\n\n    // Grille\n    graph.gridSize = 10;\n    graph.gridEnabled = true;\n\n    // Undo manager\n    const undoManager = new UndoManager();\n    const listener = (_sender: any, evt: any) => {\n        undoManager.undoableEditHappened(evt.getProperty('edit'));\n    };\n    graph.getDataModel().addListener(InternalEvent.UNDO, listener);\n    graph.getView().addListener(InternalEvent.UNDO, listener);\n\n    //==============================================================================\n    // Drop task on the graph\n\n    const squareIcon = document.getElementById('task-btn');\n\n    squareIcon?.addEventListener('dragstart', (event) => {\n        event.dataTransfer?.setData('node-type', 'task-node');\n    });\n\n    container.addEventListener('dragover', (event) => {\n        event.preventDefault(); // Ncessaire pour autoriser le drop\n    });\n\n\n    container.addEventListener('drop', (event) => {\n        event.preventDefault();\n\n        if (event.dataTransfer?.getData('node-type') == 'task-node') {\n            // Gets drop location point for vertex\n            const pt = graph.getPointForEvent(event);\n\n            // Ajouter un nouveau nud  l'emplacement du drop\n            graph.batchUpdate(() => {\n\n                // Ajouter le carr\n                const parent = graph.getDefaultParent();\n\n                const vertex = graph.insertVertex({\n                    parent,\n                    value: '', // Pas de texte pour le conteneur\n                    position: [pt.x, pt.y], // Position du carr\n                    size: [100, 80], // Taille du carr\n                    style: { baseStyleNames: ['process'] },\n                });\n\n                // Mettre en arrire plan\n                graph.orderCells(true, [vertex]);\n            });\n        }\n    });\n\n    //==============================================================================\n    // Drop state on the graph\n\n    const stateIcon = document.getElementById('state-btn');\n\n    stateIcon?.addEventListener('dragstart', (event) => {\n        event.dataTransfer?.setData('node-type', 'state-node');\n    });\n\n    container.addEventListener('drop', (event) => {\n        event.preventDefault();\n\n        if (event.dataTransfer?.getData('node-type') == 'state-node') {\n            // Gets drop location point for vertex\n            const pt = graph.getPointForEvent(event);\n\n            // Ajouter un nouveau nud  l'emplacement du drop\n            graph.batchUpdate(() => {\n\n                // Ajouter le carr\n                const parent = graph.getDefaultParent();\n\n                const vertex = graph.insertVertex({\n                    parent,\n                    value: '',\n                    position: [pt.x, pt.y],\n                    size: [40, 40],\n                    style: { baseStyleNames: ['state'] },\n                });\n\n                // Mettre en arrire plan\n                graph.orderCells(true, [vertex]);\n            });\n        }\n    });\n\n    //==============================================================================\n    // Drop condition on the graph\n\n    const condIcon = document.getElementById('cond-btn');\n\n    condIcon?.addEventListener('dragstart', (event) => {\n        event.dataTransfer?.setData('node-type', 'cond-node');\n    });\n\n    container.addEventListener('drop', (event) => {\n        event.preventDefault();\n\n        if (event.dataTransfer?.getData('node-type') == 'cond-node') {\n            // Gets drop location point for vertex\n            const pt = graph.getPointForEvent(event);\n\n            // Ajouter un nouveau nud  l'emplacement du drop\n            graph.batchUpdate(() => {\n\n                // Ajouter le carr\n                const parent = graph.getDefaultParent();\n\n                const vertex = graph.insertVertex({\n                    parent,\n                    value: '',\n                    position: [pt.x, pt.y],\n                    size: [40, 40],\n                    style: { baseStyleNames: ['condition'] },\n                });\n\n                // Mettre en arrire plan\n                graph.orderCells(true, [vertex]);\n            });\n        }\n    });\n\n    //==============================================================================\n    // Lane condition on the graph\n\n    const laneIcon = document.getElementById('lane-btn');\n\n    laneIcon?.addEventListener('dragstart', (event) => {\n        event.dataTransfer?.setData('node-type', 'lane-node');\n    });\n\n    container.addEventListener('drop', (event) => {\n        event.preventDefault();\n\n        if (event.dataTransfer?.getData('node-type') == 'lane-node') {\n            // Gets drop location point for vertex\n            const pt = graph.getPointForEvent(event);\n\n            // Ajouter un nouveau nud  l'emplacement du drop\n            graph.batchUpdate(() => {\n\n                // Ajouter le carr\n                const parent = graph.getDefaultParent();\n\n                const vertex = graph.insertVertex({\n                    parent,\n                    value: 'Lane',\n                    position: [pt.x, pt.y],\n                    size: [40, 40],\n                    style: { baseStyleNames: ['lane'] },\n                });\n\n                // Mettre en arrire plan\n                graph.orderCells(true, [vertex]);\n            });\n        }\n    });\n\n    console.log(' Graphe MaxGraph initialis');\n    return { graph, undoManager };\n}\n\nexport function wireEditorUi(ctx: BpmnEditorContext) {\n    const { graph, undoManager } = ctx;\n\n    graph.container.addEventListener('pointerdown', () => {\n        (graph.container as HTMLElement).focus();\n    });\n\n    // Zoom\n    document.getElementById('zoom-in-btn')?.addEventListener('click', () => {\n        graph.zoomIn();\n        console.log(' Zoom in');\n    });\n\n    document.getElementById('zoom-out-btn')?.addEventListener('click', () => {\n        graph.zoomOut();\n        console.log(' Zoom out');\n    });\n\n    document.getElementById('fit-in-btn')?.addEventListener('click', () => {\n        graph.center();\n        console.log(' Vue ajuste');\n    });\n\n    // Boutons Undo/Redo\n    const undoButton = document.getElementById('undoButton') as HTMLButtonElement | null;\n    const redoButton = document.getElementById('redoButton') as HTMLButtonElement | null;\n\n    undoButton?.addEventListener('click', () => {\n        if (undoManager.canUndo()) {\n            undoManager.undo();\n        }\n    });\n\n    redoButton?.addEventListener('click', () => {\n        if (undoManager.canRedo()) {\n            undoManager.redo();\n        }\n    });\n\n    graph.container.addEventListener('keydown', (event: KeyboardEvent) => {\n        // Si l'utilisateur tape dans un champ, ne touche  rien\n        // if (isTypingTarget(event)) return;\n\n        // Ctrl+Z => Undo\n        if (event.ctrlKey && event.key.toLowerCase() === 'z') {\n            event.preventDefault();\n            event.stopPropagation();\n            undoManager.canUndo() && undoManager.undo();\n            return;\n        }\n\n        // Ctrl+Y => Redo\n        if (event.ctrlKey && event.key.toLowerCase() === 'y') {\n            event.preventDefault();\n            event.stopPropagation();\n            undoManager.canRedo() && undoManager.redo();\n            return;\n        }\n\n        // Ctrl+A => select all\n        if (event.ctrlKey && event.key.toLowerCase() === 'a') {\n            event.preventDefault();\n            event.stopPropagation();\n            graph.selectAll();\n            return;\n        }\n\n        // Delete / Backspace => remove selection\n        if (event.key === 'Delete' || event.key === 'Backspace') {\n            // Si l'utilisateur dite un label : laisse MaxGraph grer la touche\n            if (graph.isEditing()) return;\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            const cells = graph.getSelectionCells();\n            if (!cells?.length) return;\n\n            graph.getDataModel().beginUpdate();\n            try {\n                graph.removeCells(cells, true);\n            } finally {\n                graph.getDataModel().endUpdate();\n            }\n        }\n    });\n\n    console.log(' UI ddition cble');\n}\n\nexport function enableArrowKeyMovement(graph: Graph, step = 10) {\n\n    function moveSelectedVertex(graph: Graph, dx: number, dy: number) {\n        const selected = graph.getSelectionCell() as Cell | null;\n        if (selected && selected.isVertex()) {\n            graph.batchUpdate(() => {\n                const geo = selected.getGeometry();\n                if (geo) {\n                    geo.translate(dx, dy);\n                    graph.refresh();\n                }\n            });\n        }\n    }\n\n\n    graph.container.addEventListener('keydown', (event: KeyboardEvent) => {\n        // Si l'utilisateur dite un label : laisse MaxGraph grer la touche\n        if (graph.isEditing()) return;\n\n        const step = 1;\n        switch (event.key) {\n            case 'ArrowUp':\n                moveSelectedVertex(graph, 0, -step);\n                event.preventDefault();\n                break;\n            case 'ArrowDown':\n                moveSelectedVertex(graph, 0, step);\n                event.preventDefault();\n                break;\n            case 'ArrowLeft':\n                moveSelectedVertex(graph, -step, 0);\n                event.preventDefault();\n                break;\n            case 'ArrowRight':\n                moveSelectedVertex(graph, step, 0);\n                event.preventDefault();\n                break;\n        }\n    });\n\n}\n\n\nexport function showStatus(message: string, duration = 2000) {\n    const status = document.getElementById('status');\n    if (!status) return;\n\n    status.textContent = message;\n    status.classList.add('show');\n\n    setTimeout(() => {\n        status.classList.remove('show');\n    }, duration);\n}\n\n\n// Check taget is not an input, textarea or select\nfunction isTypingTarget(ev: KeyboardEvent): boolean {\n    const el = ev.target as HTMLElement | null;\n    if (!el) return false;\n\n    // Remonte au vrai champ si tu as des wrappers\n    const field = el.closest('input, textarea, select, [contenteditable=\"true\"]') as HTMLElement | null;\n    return !!field;\n}\n"],"names":["src","width","height","name","args","key","value","eventSource","funct","i","evt","sender","eventListener","elems","blocks","ret","doExtract","elts","elem","node","parent","text","nodeName","attributeName","attributeValue","ancestor","child","doc","allChildren","sel","state","shape","preventDefault","element","eventName","entry","listenerCount","list","startListener","moveListener","endListener","graph","down","move","up","dblClick","getState","tmp","children","childCount","target","wheelHandler","scale","diff","evtCache","dx0","dy0","dx","dy","tx","ty","cx","cy","stopPropagation","x","y","p","rect","minX","minY","maxX","maxY","r1","r2","b1","b2","amount","cell","result","n","path","index","root","tokens","p1","p2","min","comp","t1","t2","_message","_optionalParams","_baseTimestamp","source","sourceValue","v","dest","mixin","keys","e","mask","style","prefix","b","d","ds","left","offset","sl","st","right","top","bottom","container","scrollOffset","offsetLeft","offsetTop","fixed","r","wnd","includeAncestors","includeDocument","origin","model","cells","flag","fontSize","fontFamily","textWidth","fontStyle","div","txtDecor","size","ascending","lookup","o1","o2","align","valign","str","chars","f","idx2","pattern","postfix","before","next","s","newline","obj","ctor","_clone","transients","shallow","clone","geometry","id","newValue","previous","vertex","edge","connectable","visible","collapsed","terminal","isSource","isOutgoing","userObject","defaultValue","c","cell2","current","vertices","edges","outgoing","ignoredEdge","count","edgeCount","incoming","includeLoops","geo","filter","tmp2","isConnect","view","border","bounds","aspect","point","cursor","terminalState","tr","deg","x0","y0","angle","largeArcFlag","sweepFlag","fS","psai","ctx","cty","cpsi","spsi","rxd","ryd","rxdd","rydd","r1x","r2y","lamda","sds","seif","txd","tyd","rad","s1","dr","sse","seg","segr","t","cpsir1","cpsir2","spsir1","spsir2","mc","ms","x2","y2","x3","y3","rotation","cos","sin","p3","p4","pt","x1","y1","directions","returnValue","quad","constraint","last","dist","m","flipH","flipV","m2","a","tw","th","rw","rh","rx","ry","hotspot","max","w","h","start","alpha","denom","nume_a","nume_b","ua","ub","px","py","dotprod","projlenSq","lenSq","ccw","points","pts","p0","pe","l","vertical","horizontal","_points","segment","isSourceLeft","sourceGeometry","isTargetLeft","targetGeometry","xe","ye","dep","arr","midY","_target","dir","coveredEntries","isRelative","old","ct","sx","sy","fixedAspect","geom","sourceScaled","targetScaled","controlHints","tol","lastPushed","hint","pushPoint","lastInx","hints","currentTerm","currentPt","hozChan","vertChan","currentHint","fixedVertAlign","fixedHozAlign","inHozChan","inVertChan","buffer","sourceEdge","targetEdge","sourceX","sourceY","sourceWidth","sourceHeight","targetX","targetY","targetWidth","targetHeight","sourceBuffer","targetBuffer","totalBuffer","tooShort","portConstraint","newRect","sourceCenX","sourceCenY","targetCenX","targetCenY","sourceTopDist","sourceLeftDist","sourceBottomDist","sourceRightDist","dirPref","horPref","vertPref","preferredHorizDist","preferredVertDist","prefOrdering","preferredOrderSet","sourceIndex","targetIndex","routePattern","currentIndex","lastOrientation","initialOrientation","currentOrientation","nextDirection","directionIndex","direction","tar","sou","side","center","limit","souTar","lastX","deltaX","lastY","deltaY","moveAndExpand","snapCoordinateToGrid","gridSize","snapPointToGrid","gx","gy","isPointInRectangle","getRectangleCenter","getDifferencePoint","movePoint","moveX","moveY","getPointTheta","PRECISION","normalizePoint","getManhattanDistance","toPointFromString","pointString","xy","pointToString","getCellAbsoluteBounds","cellState","cellBounds","translate","round","mStep","config","normalizeAngle","ObstacleMap","opt","bbox","corner","gridKey","rectArr","mapKey","obstacles","obstacle","SortedSet","hashItem","i1","i2","hashItem1","hashItem2","reconstructRoute","parents","endPoint","startCenter","endCenter","route","previousDirection","getRectPoints","step","res","directionPoint","getDirectionAngle","end","directionLength","q","getDirectionChange","angle1","angle2","dirChange","estimateCost","from","endPoints","len","cost","alignPointToCell","edgeState","isSourceCell","onlyHorizontalDirections","cellHeight","onlyVerticalDirections","cellWidth","findRoute","obstacleMap","startPoints","openSet","costs","loopsRemain","endPointsKeys","currentDirectionAngle","previousDirectionAngle","currentKey","currentPoint","currentCost","directionChangedAngle","neighborPoint","neighborKey","costFromStart","router","sourceBBox","targetBBox","routePoints","_vertex","orthogonal","g","det","xout1","xout2","yout1","yout2","dist1","dist2","xout","yout","pi","pi2","beta","base","type","widthFactor","canvas","_shape","unitX","unitY","_source","sw","filled","endOffsetX","endOffsetY","_type","_filled","_sw","swFactor","tk","edgeStyle","metaData","highlightColor","strokeWidth","dashed","color","hit","elt","validColor","invalidColor","enabled","me","isValid","url","op","theta","link","color1","color2","alpha1","alpha2","fixDash","curves","xmlString","linefeed","xml","tab","indent","ns","attrs","val","styleEnabled","svg","href","hash","tagName","namespace","fo","wrap","format","overflow","clip","anchor","alt","gradient","counter","tmpId","stop","stroked","pat","dash","shadow","div2","div3","group","flex","item","block","box","yp","lh","css","lines","textHeight","line","bg","callback","ofl","fw","fh","bgc","stencil","labelMargins","off","strokeDrawn","stroke","fillAndStroke","bb","roundingFactor","arc","rounded","arcSize","close","exclude","initialMove","wp","nx1","ny1","nx2","ny2","rot","grads","fill","events","imageSrc","perimeter","Image","existingEdge","grid","mouse","minDistSq","hl","cp","img","icon","rectangle","sourceState","targetState","selectionHandler","_sender","_evt","dirty","pstate","bends","bend","EdgeStyle.EntityRelation","_index","shapeConstructor","checkShape","handle","length","tt","overrideX","overrideY","snapToPoint","snapToTerminal","other","otherCell","abs","trg","idx","clientX","clientY","gridX","gridY","outline","sourceConstraint","targetConstraint","cloned","gridEnabled","_isClone","_me","pState","ignoreHandles","lab","xn","yn","bn","temp","edgeHandler","resizable","selectionHandlerCheck","fillColor","sizer","strokeColor","real","pos","selectionCellsHandler","handler","raster","overlap","c2","dx2","dy2","dx3","dy3","dx4","dy4","dx5","dy5","tempState","delta","recurse","total","pgeo","constrained","centered","w0","h0","cdx","cdy","padding","crs","da","params","dblClickHandler","tip","pt0","pt1","pt2","rpts","sc","tc","isClone","straight","topmost","includeChildren","mapping","clones","identity","cloneChild","ignoreState","cellStyle","stylesheet","defaultStyle","image","comma","param","allowInvalidEdges","keepPosition","dict","trans","out","absolute","constrain","extend","parentState","zero","oldState","includeEdges","disconnectTerminal","connected","tstate","show","ignoreChildren","gs2","prev","ignoreRelative","newGeo","origCells","isSelected","checked","disconnect","sizeFirst","desc","descItem","ignoreFn","intersection","includeDescendants","rightHalfpane","bottomHalfpane","_cell","addPoint","j","newEdge","allCells","isCollapsed","directed","cancel","autoSize","editingCell","tolerance","mxe","active","selected","swimlanes","panningHandler","connectionHandler","listener","evtName","mouseEvent","candidate","tooltipHandler","currentTime","doubleClickFired","mouseListeners","cellEditorHandler","minimumContainerSize","minimumGraphSize","addOffset","collapse","_collapse","checkFoldable","willCollapse","_willCollapse","startSize","_cells","moveGroup","topBorder","rightBorder","bottomBorder","leftBorder","bundle","back","event","tooltip","verticalAlign","isEdge","overlay","overlays","warning","isSelect","ix","iy","_width","_height","fmt","ps","gb","horizontalCount","verticalCount","drawPageBreaks","breaks","pageBreak","shiftPreview2","tr2","isChanged","widthLimit","heightLimit","ddx","ddy","selectionModel","isNext","isParent","isChild","descendants","selectGroups","changes","coveredElements","addCell","change","removed","par","ignoreGrid","ignoreHorizontal","ignoreVertical","swimlane","_mod","parentCell","includeSources","includeTargets","terminals","message","error","sourceOut","targetIn","multiplicity","err","context","warn","outCount","inCount","rule","relative","geometryClass","_parent","factor","_hasScrollbars","scaleX","scaleY","aspectFactor","rectRight","rectBottom","newHeight","deltaHeightBuffer","upperBuffer","newWidth","deltaWidthBuffer","leftBuffer","newScale","mixIntoGraph","options","EdgeStyle.Loop","fn","newParent","page","hCount","vCount","cw","ch","sh","significant","oldRoot","parentChanged","collision","origin1","origin2","oldIndex","pre","terminalChanged","tmp1","edit","to","cloneAllEdges","markerFunction","strokewidth","sourceMarker","targetMarker","family","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft","background","clipped","labelPadding","textDirection","update","realHtml","ow","oh","margin","html","bd","divs","enableWrap","sizeDiv","property","field","referenced","rstate","rshape","isForceHtml","forceGetCell","cellOverlays","createdOverlays","cellOverlay","overlayShape","_state","control","handleEvents","clickHandler","first","forced","wrapping","clipping","dialect","nextScale","vis","check","styleName","hpos","vpos","lw","textShape","htmlNode","shapes","shapeNode","force","rendering","shapeChanged","acc","added","singleSelection","remove","selectableCell","previousScale","previousTranslate","t0","graphBounds","backgroundImage","absoluteOffset","fg","orig","asp","srcBounds","trgBounds","ignoreScale","orth","opposite","best","segments","markerSize","pointCount","offsetX","offsetY","nx","ny","absolutePoints","totalLength","minDist","xSegment","ySegment","projlen","yDistance","create","eventClientPosition","outWidth","inWidth","outHeight","inHeight","pointerId","pane","hw","hh","isForeground","mid","arrowWidth","endSize","arrow","basex","basey","floorx","floory","p0x","p0y","p1x","p1y","p2x","p2y","p3x","p3y","p5x","p5y","startWidth","endWidth","edgeWidth","openEnded","markerStart","markerEnd","isRounded","i0","orthx","orthy","fns","startNx","startNy","outStartX","outStartY","inEndX","inEndY","dx1","dy1","strokeWidthFactor","angleFactor","outX","outY","inX","inY","c1x","c1y","c2x","c2y","inStartX","inStartY","ptX","ptY","widthArrowRatio","spaceX","spaceY","shapeVertical","realHorizontal","realFlipH","realFlipV","swimlaneLine","sep","shapesToRegister","shapeName","shapeClass","edgeStylesToRegister","EdgeStyle.ElbowConnector","EdgeStyle.ManhattanConnector","EdgeStyle.OrthConnector","EdgeStyle.SegmentConnector","EdgeStyle.SideToSide","EdgeStyle.TopToBottom","metadata","perimetersToRegister","Perimeter.EllipsePerimeter","Perimeter.HexagonPerimeter","Perimeter.RectanglePerimeter","Perimeter.RhombusPerimeter","Perimeter.TrianglePerimeter","markersToRegister","EdgeMarker.createArrow","EdgeMarker.createOpenArrow","EdgeMarker.oval","EdgeMarker.diamond","factory","trigger","keypressHandler","keyupHandler","textarea","resizeHandler","dummy","stateStyle","bold","italic","textareaStyle","stateText","initial","minSize","minWidth","minHeight","restart","stateSource","popupMenuHandler","oldHandlers","factoryMethod","title","iconCls","noHover","col1","col2","col3","td","row","hr","eo","dropTarget","icons","mouseDown","hitsIcon","realPoints","targetPerimeter","sourcePerimeter","c1","valid","terminalInserted","errorMessage","states","guide","stateX","valueX","stateY","valueY","ttX","ttY","middle","snapX","centerAlign","override","snapY","immediate","_evtName","initialCell","ignore","opps","vector","hideGuide","highlight","remote","realState","ptn","createThread","keepOrigin","ignoreWidth","ignoreHeight","maxHeight","cssBorder","w1","h1","originalScale","w2","h2","minScale","maxScale","newBounds","clientWidth","clientHeight","translateX","translateY","createMouseEvent","plugins","addEnabled","resizeEnabled","parentHorizontal","undoableEdit","edits","cloneUtils.clone","containerId","undoManager","undoButton","redoButton","moveSelectedVertex","duration","status"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141]}