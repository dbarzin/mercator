import{I as a,z as d,A as o,B as p,D as g,P as f,F as l,H as v,J as y,R as x,K as b,f as m,L as E}from"./Graph-Cv-_2TnX.js";class H{constructor(t){this.first=null,this.destroyed=!1,this.dragHandler=null,this.dropHandler=null,this.x=0,this.y=0,this.width=0,this.height=0,this.defaultOpacity=20,this.enabled=!0,this.div=null,this.sharedDiv=null,this.currentX=0,this.currentY=0,this.fadeOut=!1,this.graph=t,this.graph.addMouseListener(this),this.forceRubberbandHandler=(e,s)=>{const i=s.getProperty("eventName"),r=s.getProperty("event");if(i===a.MOUSE_DOWN&&this.isForceRubberbandEvent(r)){const h=d(this.graph.container),n=o(this.graph.container);n.x-=h.x,n.y-=h.y,this.start(r.getX()+n.x,r.getY()+n.y),r.consume(!1)}},this.graph.addListener(a.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=()=>{this.repaint()},this.graph.addListener(a.PAN,this.panHandler),this.gestureHandler=(e,s)=>{this.first&&this.reset()},this.graph.addListener(a.GESTURE,this.gestureHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isForceRubberbandEvent(t){return p(t.getEvent())}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!e.getState()&&!g(e.getEvent())){const s=d(this.graph.container),i=o(this.graph.container);i.x-=s.x,i.y-=s.y,this.start(e.getX()+i.x,e.getY()+i.y),e.consume(!1)}}start(t,e){this.first=new f(t,e);const{container:s}=this.graph;function i(r){const h=new E(r),n=m(s,h.getX(),h.getY());return h.graphX=n.x,h.graphY=n.y,h}this.dragHandler=r=>{this.mouseMove(this.graph,i(r))},this.dropHandler=r=>{this.mouseUp(this.graph,i(r))},l.IS_FF&&a.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}mouseMove(t,e){if(!e.isConsumed()&&this.first){const s=o(this.graph.container),i=d(this.graph.container);s.x-=i.x,s.y-=i.y;const r=e.getX()+s.x,h=e.getY()+s.y,n=this.first.x-r,u=this.first.y-h,c=this.graph.getEventTolerance();(this.div||Math.abs(n)>c||Math.abs(u)>c)&&(this.div||(this.div=this.createShape()),v(),this.update(r,h),e.consume())}}createShape(){this.sharedDiv||(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",y(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);const t=this.sharedDiv;return l.IS_SVG&&this.fadeOut&&(this.sharedDiv=null),t}isActive(t,e){return this.div&&this.div.style.display!=="none"}mouseUp(t,e){const s=this.isActive();this.reset(),s&&(this.execute(e.getEvent()),e.consume())}execute(t){const e=new x(this.x,this.y,this.width,this.height);this.graph.selectRegion(e,t)}reset(){if(this.div)if(l.IS_SVG&&this.fadeOut){const t=this.div;b(t.style,"transition","all 0.2s linear"),t.style.pointerEvents="none",t.style.opacity=String(0),window.setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},200)}else this.div.parentNode&&this.div.parentNode.removeChild(this.div);a.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null}update(t,e){this.currentX=t,this.currentY=e,this.repaint()}repaint(){if(this.div&&this.first){const t=this.currentX-this.graph.getPanDx(),e=this.currentY-this.graph.getPanDy();this.x=Math.min(this.first.x,t),this.y=Math.min(this.first.y,e),this.width=Math.max(this.first.x,t)-this.x,this.height=Math.max(this.first.y,e)-this.y;const s=0,i=0;this.div.style.left=`${this.x+s}px`,this.div.style.top=`${this.y+i}px`,this.div.style.width=`${Math.max(1,this.width)}px`,this.div.style.height=`${Math.max(1,this.height)}px`}}onDestroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv&&(this.sharedDiv=null))}}H.pluginId="RubberBandHandler";export{H as R};
