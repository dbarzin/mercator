import{w as M,O as T,i as I,j as p,k as x,c as b,P as w,l as f,m as D,n as S,o as N,p as O,q as v,r as E,t as X,u as A,a as F,v as P,x as $,y as B}from"./Graph-Cv-_2TnX.js";class G{constructor(e,t=null,s="POST",i=!0,n=null,l=null){this.binary=!1,this.withCredentials=!1,this.request=null,this.decodeSimulateValues=!1,this.url=e,this.params=t,this.method=s||"POST",this.async=i,this.username=n,this.password=l}isBinary(){return this.binary}setBinary(e){this.binary=e}getText(){return this.request.responseText}isReady(){return this.request.readyState===4}getDocumentElement(){const e=this.getXml();return e!=null?e.documentElement:null}getXml(){let e=this.request.responseXML;return(e==null||e.documentElement==null)&&(e=new DOMParser().parseFromString(this.request.responseText,"text/xml")),e}getStatus(){var e;return(e=this.request)==null?void 0:e.status}create(){const e=new XMLHttpRequest;return this.isBinary()&&e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e}send(e=null,t=null,s=null,i=null){this.request=this.create(),this.request!=null&&(e!=null&&(this.request.onreadystatechange=()=>{this.isReady()&&(e(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),window.XMLHttpRequest&&s!=null&&i!=null&&(this.request.timeout=s,this.request.ontimeout=i),this.request.send(this.params))}setRequestHeaders(e,t){t!=null&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(e,t=null){e=e||document;let s=null;e===document&&(s=window.onbeforeunload,window.onbeforeunload=null);const i=e.createElement("form");i.setAttribute("method",this.method),i.setAttribute("action",this.url),t!=null&&i.setAttribute("target",t),i.style.display="none",i.style.visibility="hidden";const n=this.params,l=n.indexOf("&")>0?n.split("&"):n.split(" ");for(let u=0;u<l.length;u+=1){const d=l[u].indexOf("=");if(d>0){const m=l[u].substring(0,d);let c=l[u].substring(d+1);this.decodeSimulateValues&&(c=decodeURIComponent(c));const h=e.createElement("textarea");h.setAttribute("wrap","off"),h.setAttribute("name",m),M(h,c),i.appendChild(h)}}e.body.appendChild(i),i.submit(),i.parentNode!=null&&i.parentNode.removeChild(i),s!=null&&(window.onbeforeunload=s)}}const R=o=>{const e=new G(o,null,"GET",!1);return e.send(),e},V=["_x","_y","_width","_height"],k=["_x","_y"];class a{constructor(e,t=[],s=[],i={}){this.template=e,this.exclude=t,this.idrefs=s,this.mapping=i,this.reverse={};for(const n in this.mapping)this.reverse[this.mapping[n]]=n}getName(){return this.name??this.template.constructor.name}setName(e){this.name=e}cloneTemplate(){return new this.template.constructor}getFieldName(e){if(e!=null){const t=this.reverse[e];t!=null&&(e=t)}return e}getAttributeName(e){if(e!=null){const t=this.mapping[e];t!=null&&(e=t)}return e}isExcluded(e,t,s,i){return t==T.FIELD_NAME||this.exclude.indexOf(t)>=0}isReference(e,t,s,i){return t==null?!1:this.idrefs.includes(t)}encode(e,t){const s=e.document.createElement(this.getName());return t=this.beforeEncode(e,t,s),this.encodeObject(e,t,s),this.afterEncode(e,t,s)}encodeObject(e,t,s){e.setAttribute(s,"id",e.getId(t));for(const i in t){let n=i;const l=t[n];l!=null&&!this.isExcluded(t,n,l,!0)&&(I(n)&&(n=null),this.encodeValue(e,t,n,l,s))}}encodeValue(e,t,s,i,n){if(i!=null){if(this.isReference(t,s,i,!0)){const l=e.getId(i);if(l==null){p.logger.warn(`ObjectCodec.encode: No ID for ${this.getName()}.${s}=${i}`);return}i=l}(s==null||e.encodeDefaults||this.template[s]!=i)&&(s=this.getAttributeName(s),this.writeAttribute(e,t,s,i,n))}}writeAttribute(e,t,s,i,n){typeof i!="object"?this.writePrimitiveAttribute(e,t,s,i,n):this.writeComplexAttribute(e,t,s,i,n)}writePrimitiveAttribute(e,t,s,i,n){if(i=this.convertAttributeToXml(e,t,s,i,n),s==null){const l=e.document.createElement("add");typeof i=="function"?l.appendChild(e.document.createTextNode(i)):e.setAttribute(l,"value",i),n.appendChild(l)}else typeof i!="function"&&e.setAttribute(n,s,i)}writeComplexAttribute(e,t,s,i,n){const l=e.encode(i);l!=null?(s!=null&&l.setAttribute("as",s),n.appendChild(l)):p.logger.warn(`ObjectCodec.encode: No node for ${this.getName()}.${s}: ${i}`)}convertAttributeToXml(e,t,s,i,n){return this.isBooleanAttribute(e,t,s,i)&&(i=i==!0?"1":"0"),i}isBooleanAttribute(e,t,s,i){return typeof i.length>"u"&&(i==!0||i==!1)}convertAttributeFromXml(e,t,s){let{value:i}=t;return this.isNumericAttribute(e,t,s)&&(i=parseFloat(i),(Number.isNaN(i)||!Number.isFinite(i))&&(i=0)),i}isNumericAttribute(e,t,s){return s instanceof b&&V.includes(t.name)||s instanceof w&&k.includes(t.name)||x(t.value)}beforeEncode(e,t,s){return t}afterEncode(e,t,s){return s}decode(e,t,s){const i=t.getAttribute("id");let n=e.objects[i];n==null&&(n=s||this.cloneTemplate(),i!=null&&e.putObject(i,n));const l=this.beforeDecode(e,t,n);return this.decodeNode(e,l,n),this.afterDecode(e,l,n)}decodeNode(e,t,s){t!=null&&(this.decodeAttributes(e,t,s),this.decodeChildren(e,t,s))}decodeAttributes(e,t,s){const i=t.attributes;if(i!=null)for(let n=0;n<i.length;n+=1)this.decodeAttribute(e,i[n],s)}isIgnoredAttribute(e,t,s){return t.nodeName==="as"||t.nodeName==="id"}decodeAttribute(e,t,s){if(!this.isIgnoredAttribute(e,t,s)){const i=t.nodeName;let n=this.convertAttributeFromXml(e,t,s);const l=this.getFieldName(i);if(this.isReference(s,l,n,!1)){const u=e.getObject(n);if(u==null){p.logger.warn(`ObjectCodec.decode: No object for ${this.getName()}.${i}=${n}`);return}n=u}this.isExcluded(s,i,n,!1)||(s[i]=n)}}decodeChildren(e,t,s){let i=t.firstChild;for(;i;){const n=i.nextSibling;f(i)&&!this.processInclude(e,i,s)&&this.decodeChild(e,i,s),i=n}}decodeChild(e,t,s){const i=this.getFieldName(t.getAttribute("as"));if(i==null||!this.isExcluded(s,i,t,!1)){const n=this.getFieldTemplate(s,i,t);let l=null;t.nodeName==="add"?(l=t.getAttribute("value"),l==null&&a.allowEval&&(l=D(S(t)))):l=e.decode(t,n);try{this.addObjectValue(s,i,l,n)}catch(u){throw new Error(`${u.message} for ${t.nodeName}`)}}}getFieldTemplate(e,t,s){let i=e[t];return i instanceof Array&&i.length>0&&(i=null),i}addObjectValue(e,t,s,i){var n;s!=null&&s!==i&&(t!=null&&t.length>0?e[t]=s:(n=e.push)==null||n.call(e,s))}processInclude(e,t,s){if(t.nodeName==="include"){const i=t.getAttribute("name");if(i!=null)try{const n=R(i).getDocumentElement();n!=null&&e.decode(n,s)}catch{}return!0}return!1}beforeDecode(e,t,s){return t}afterDecode(e,t,s){return s}}a.allowEval=!1;class r{static register(e,t=!0){if(e!=null){const s=e.getName();r.codecs[s]=e;const i=e.template.constructor.name;t&&i!==s&&r.addAlias(i,s)}return e}static addAlias(e,t){r.aliases[e]=t}static getCodec(e){if(e==null)return null;let t=null,s=typeof e=="string"?e:e.name;const i=r.aliases[s];if(i!=null&&(s=i),t=r.codecs[s]??null,t==null)try{t=new a(new e),r.register(t)}catch{}return t}static getCodecByName(e){let t=r.codecs[e];if(!t){const s=r.aliases[e];s&&(t=r.codecs[s])}return t??null}}r.codecs={};r.aliases={};const H=()=>document.implementation.createDocument("","",null);class y{constructor(e=H()){this.elements={},this.encodeDefaults=!1,this.document=e,this.objects={}}putObject(e,t){return this.objects[e]=t,t}getObject(e){let t=null;if(e!=null&&(t=this.objects[e],t==null&&(t=this.lookup(e),t==null))){const s=this.getElementById(e);s!=null&&(t=this.decode(s))}return t}lookup(e){return null}getElementById(e){return this.updateElements(),this.elements[e]}updateElements(){Object.keys(this.elements).length===0&&this.document.documentElement!=null&&this.addElement(this.document.documentElement)}addElement(e){if(f(e)){const s=e.getAttribute("id");if(s!=null){if(this.elements[s]==null)this.elements[s]=e;else if(this.elements[s]!==e)throw new Error(`${s}: Duplicate ID`)}}let t=e.firstChild;for(;t!=null;)this.addElement(t),t=t.nextSibling}getId(e){let t=null;return e!=null&&(t=this.reference(e),t==null&&e instanceof N&&(t=e.getId(),t==null&&(t=O.create(e),t.length===0&&(t="root")))),t}reference(e){return null}encode(e){let t=null;if(e!=null&&e.constructor!=null){const s=r.getCodec(e.constructor);s!=null?t=s.encode(this,e):v(e)?t=E(this.document,e,!0):p.logger.warn(`Codec.encode: No codec for ${X(e.constructor)}`)}return t}decode(e,t){this.updateElements();let s=null;if(f(e)){const i=r.getCodecByName(e.nodeName);i!=null?s=i.decode(this,e,t):(p.logger.warn(`Codec.decode: No codec found for node '${e.nodeName}', so the node won't be decoded, the original XML Element is returned instead.`),s=e.cloneNode(!0),s.removeAttribute("as"))}return s}encodeCell(e,t,s){const i=this.encode(e);if(i&&t.appendChild(i),s==null||s){const n=e.getChildCount();for(let l=0;l<n;l+=1)this.encodeCell(e.getChildAt(l),t)}}isCellCodec(e){return e&&"isCellCodec"in e&&typeof e.isCellCodec=="function"?e.isCellCodec():!1}decodeCell(e,t=!0){if(!f(e))return null;let s=r.getCodec(e.nodeName);if(!this.isCellCodec(s)){let n=e.firstChild;for(;n!=null&&!this.isCellCodec(s);)s=r.getCodec(n.nodeName),n=n.nextSibling}this.isCellCodec(s)||(s=r.getCodec(N));const i=s==null?void 0:s.decode(this,e);return t&&this.insertIntoGraph(i),i}insertIntoGraph(e){const{parent:t}=e,s=e.getTerminal(!0),i=e.getTerminal(!1);if(e.setTerminal(null,!1),e.setTerminal(null,!0),e.parent=null,t!=null){if(t===e)throw new Error(`${t.id}: Self Reference`);t.insert(e)}s!=null&&s.insertEdge(e,!0),i!=null&&i.insertEdge(e,!1)}setAttribute(e,t,s){t!=null&&s!=null&&e.setAttribute(t,s)}}class q extends a{constructor(){super(new N,["children","edges","overlays","mxTransient"],["parent","source","target"]),this.setName("Cell")}isCellCodec(){return!0}isNumericAttribute(e,t,s){return t.nodeName!=="value"&&super.isNumericAttribute(e,t,s)}isExcluded(e,t,s,i){return super.isExcluded(e,t,s,i)||i&&t==="value"&&f(s)}afterEncode(e,t,s){if(f(t.value)){const i=s;s=E(e.document,t.value,!0),s.appendChild(i);const n=i.getAttribute("id");s.setAttribute("id",String(n)),i.removeAttribute("id")}return s}beforeDecode(e,t,s){let i=t.cloneNode(!0);const n=this.getName();if(t.nodeName!==n){const l=t.getElementsByTagName(n)[0];l!=null&&l.parentNode===t?(A(l,!0),A(l,!1),l.parentNode.removeChild(l),i=l):i=null,s.value=t.cloneNode(!0);const u=s.value.getAttribute("id");u!=null&&(s.setId(u),s.value.removeAttribute("id"))}else s.setId(t.getAttribute("id"));if(i!=null)for(let l=0;l<this.idrefs.length;l+=1){const u=this.idrefs[l],d=i.getAttribute(u);if(d!=null){i.removeAttribute(u);let m=e.objects[d]||e.lookup(d);if(m==null){const c=e.getElementById(d);c!=null&&(m=(r.codecs[c.nodeName]||this).decode(e,c))}s[u]=m}}return i}}class L extends a{constructor(){super(new F),this.setName("GraphDataModel")}encodeObject(e,t,s){const i=e.document.createElement("root");e.encodeCell(t.getRoot(),i),s.appendChild(i)}decodeChild(e,t,s){t.nodeName==="root"?this.decodeRoot(e,t,s):super.decodeChild(e,t,s)}decodeRoot(e,t,s){let i=null,n=t.firstChild;for(;n!=null;){const l=e.decodeCell(n);l!=null&&l.getParent()==null&&(i=l),n=n.nextSibling}i!=null&&s.setRoot(i)}}const z=new Map([["autosize","autoSize"]]);function U(o){const e={};o.startsWith(";")&&(e.ignoreDefaultStyle=!0);const t=o.split(";").filter(([s])=>s);for(const s of t)if(!s.includes("="))!e.baseStyleNames&&(e.baseStyleNames=[]),e.baseStyleNames.push(s);else{const[i,n]=s.split("=");e[z.get(i)??i]=W(n)}return e}function W(o){if(!x(o))return o;let e=parseFloat(o);return(Number.isNaN(e)||!Number.isFinite(e))&&(e=0),e}class J extends q{getName(){return"mxCell"}decodeAttribute(e,t,s){const i=t.nodeName;s&&i=="style"?s.style=U(t.value):super.decodeAttribute(e,t,s)}}class K extends a{getName(){return"mxGeometry"}constructor(){super(new b)}afterDecode(e,t,s){const i=s.points;if(i){const n=[];for(const l of i){const u=l;n.push(new w(u.x,u.y))}s.points=n}return s}}const g={base:!1,model:!1},Q=(o=!1)=>{(!g.base||o)&&(r.register(C({},"Object")),r.register(C([],"Array")),g.base=!0)},C=(o,e)=>{const t=new a(o);return t.setName(e),t},Y=(o=!1)=>{(!g.model||o)&&(r.register(new q),r.register(new L),r.register(C(new b,"Geometry")),r.register(C(new w,"Point")),Q(o),r.addAlias("mxGraphModel","GraphDataModel"),r.addAlias("mxPoint","Point"),r.register(new J,!1),r.register(new K,!1),g.model=!0)};class _{constructor(e){this.dataModel=e,this.registerCodecs()}import(e){const t=typeof e=="string"?P(e):e.ownerDocument;new y(t).decode(t.documentElement,this.dataModel)}export(e){const t=new y().encode(this.dataModel);return(e==null?void 0:e.pretty)??!0?$(t):B(t)}registerCodecs(){Y()}}export{_ as M};
