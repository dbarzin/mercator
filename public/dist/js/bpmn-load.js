import{s as y}from"./bpmn-edit.js";function w(o){return o.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\u007F]/g,"").trim()}function E(o){console.log("ğŸ”§ DÃ©but du parsing BPMN");const c=new DOMParser,i=w(o),a=c.parseFromString(i,"application/xml"),r=a.getElementsByTagName("parsererror")[0];if(r)throw console.error("Erreur XML :",r.textContent),new Error(r.textContent||"Erreur de parsing XML");console.log("ğŸ“¦ Document XML parsÃ©");const n={startEvents:[],tasks:[],gateways:[],endEvents:[],flows:[],participants:[]},e=a.getElementsByTagName("participant");console.log(`ğŸŠ Participants trouvÃ©s: ${e.length}`);for(const s of Array.from(e))n.participants.push({id:s.getAttribute("id"),name:s.getAttribute("name"),processRef:s.getAttribute("processRef")});const t=a.getElementsByTagNameNS("*","startEvent");console.log(`â–¶ï¸ Start events trouvÃ©s: ${t.length}`);for(const s of Array.from(t))n.startEvents.push({id:s.getAttribute("id"),name:s.getAttribute("name")});const l=a.getElementsByTagNameNS("*","task");console.log(`ğŸ“‹ Tasks trouvÃ©es: ${l.length}`);for(const s of Array.from(l))n.tasks.push({id:s.getAttribute("id"),name:s.getAttribute("name")});const u=a.querySelectorAll("exclusiveGateway, parallelGateway, inclusiveGateway");console.log(`ğŸ”€ Gateways trouvÃ©s: ${u.length}`),u.forEach(s=>{n.gateways.push({id:s.getAttribute("id"),name:s.getAttribute("name"),type:s.tagName.replace(/Gateway$/,"")})});const m=a.getElementsByTagNameNS("*","endEvent");console.log(`â¹ï¸ End events trouvÃ©s: ${m.length}`);for(const s of Array.from(m))n.endEvents.push({id:s.getAttribute("id"),name:s.getAttribute("name")});const h=a.getElementsByTagNameNS("*","sequenceFlow");console.log(`â¡ï¸ Flows trouvÃ©s: ${h.length}`);for(const s of Array.from(h))n.flows.push({id:s.getAttribute("id"),source:s.getAttribute("sourceRef"),target:s.getAttribute("targetRef")});const f=a.getElementsByTagNameNS("*","BPMNShape");console.log(`ğŸ“ Shapes trouvÃ©s: ${f.length}`);const d={};for(const s of Array.from(f)){const p=s.getAttribute("bpmnElement"),g=s.getElementsByTagNameNS("*","Bounds")[0];p&&g&&(d[p]={x:parseFloat(g.getAttribute("x")||"0"),y:parseFloat(g.getAttribute("y")||"0"),width:parseFloat(g.getAttribute("width")||"0"),height:parseFloat(g.getAttribute("height")||"0")})}return console.log("ğŸ“ Positions rÃ©cupÃ©rÃ©es:",Object.keys(d).length),console.log("âœ… Parsing terminÃ© avec succÃ¨s"),{elements:n,positions:d,xmlDoc:a}}function b(o,c){console.log("ğŸ¨ DÃ©but du dessin du diagramme");const{elements:i,positions:a}=c,r=o.getDefaultParent(),n={};o.model.beginUpdate();try{o.removeCells(o.getChildCells(r)),console.log("ğŸ§¹ Cellules prÃ©cÃ©dentes supprimÃ©es"),i.participants.forEach(e=>{const t=a[e.id]||{x:100,y:100,width:600,height:250};n[e.id]=o.insertVertex(r,e.id,e.name||"Lane",t.x,t.y,t.width,t.height,{baseStyleNames:["swimlane"]})}),i.startEvents.forEach(e=>{const t=a[e.id]||{x:200,y:150,width:36,height:36};console.log("Add start event ",e.name),n[e.id]=o.insertVertex(r,e.id,e.name||"",t.x,t.y,t.width,t.height,{baseStyleNames:["state"]})}),i.tasks.forEach(e=>{console.log("Add task ",e.name);const t=a[e.id]||{x:300,y:130,width:100,height:80};n[e.id]=o.insertVertex(r,e.id,e.name||"Task",t.x,t.y,t.width,t.height,{baseStyleNames:["process"]})}),i.gateways.forEach(e=>{console.log("Add gateway ",e.name);const t=a[e.id]||{x:450,y:145,width:50,height:50};n[e.id]=o.insertVertex(r,e.id,e.name||"",t.x,t.y,t.width,t.height,{baseStyleNames:["condition"]})}),i.endEvents.forEach(e=>{console.log("Add end event ",e.name);const t=a[e.id]||{x:550,y:152,width:36,height:36};n[e.id]=o.insertVertex(r,e.id,e.name||"",t.x,t.y,t.width,t.height,{baseStyleNames:["state"]})}),i.flows.forEach(e=>{const t=n[e.source],l=n[e.target];t&&l?o.insertEdge(r,e.id,"",t,l,{baseStyleNames:["arrow"]}):console.warn(`âš ï¸ Flow ignorÃ© (source ou target manquant): ${e.id}`)})}finally{o.model.endUpdate()}console.log("âœ… Diagramme dessinÃ© avec succÃ¨s"),setTimeout(()=>{o.center(),console.log("ğŸ“ Vue centrÃ©e")},100)}function x(o,c="file-input"){const i=document.getElementById(c);if(!i){console.warn(`#${c} introuvable, pas de chargement BPMN via fichier`);return}i.addEventListener("change",async a=>{console.log("ğŸ“ Ã‰vÃ©nement file input dÃ©clenchÃ©");const n=a.target.files?.[0];if(!n){console.log("âŒ Pas de fichier sÃ©lectionnÃ©");return}console.log("ğŸ“„ Fichier:",n.name,n.size,"bytes");const e=await n.text();console.log("ğŸ“ Contenu XML (extrait):",e.substring(0,200)+"...");try{console.log("ğŸ” Parsing BPMN...");const t=E(e);console.log("âœ… Parsing rÃ©ussi"),console.log("ğŸ¨ Dessin du diagramme..."),b(o,t);const l=t.elements.startEvents.length+t.elements.tasks.length+t.elements.gateways.length+t.elements.endEvents.length;console.log(`ğŸ“Š Total: ${l} Ã©lÃ©ments, ${t.elements.flows.length} flux`),y("âœ“ Fichier chargÃ© avec succÃ¨s")}catch(t){console.error("âŒ ERREUR:",t),y("âœ— Erreur lors du chargement du fichier")}})}export{x as b};
//# sourceMappingURL=bpmn-load.js.map
