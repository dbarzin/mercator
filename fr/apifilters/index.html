<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://dbarzin.githubs.io/mercator/fr/apifilters/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>API avancée (filtres) - Mercator</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API avanc\u00e9e (filtres)";
        var mkdocs_page_input_path = "apifilters.fr.md";
        var mkdocs_page_url = "/mercator/fr/apifilters/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../" class="icon icon-home"> Mercator
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Rechercher des documents" aria-label="Rechercher des documents" title="Tapez vos mots clés ici" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navigation">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cartography/">Cartographie</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../application/">Application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../maturity/">Maturité</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bpmn/">BPMN 2.0</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../reports/">Rapports</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../usecases/">Cas d'usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../model/">Modèle de données</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../exploration/">Exploration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../admin/">Administration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../import/">Import</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API avancée (filtres)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#filtrage-tri-et-inclusion-de-relations">Filtrage, tri et inclusion de relations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#champs-filtrables">Champs filtrables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#syntaxe-des-filtres">Syntaxe des filtres</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#operateurs-de-filtrage-disponibles">Opérateurs de filtrage disponibles</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#filtres-exacts-et-textuels">Filtres exacts et textuels</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#comparaisons-numeriques">Comparaisons numériques</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#operateurs-avances">Opérateurs avancés</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#recherche-globale-et-filtres-sur-relations">Recherche globale et filtres sur relations</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#filtres-de-dates">Filtres de dates</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#elements-supprimes">Elements supprimés</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tri-des-resultats">Tri des résultats</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#inclusion-de-relations-eager-loading">Inclusion de relations (Eager Loading)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cas-dusage">Cas d'usage</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#filtres-simples">Filtres simples</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#filtres-combines">Filtres combinés</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#filtres-avances">Filtres avancés</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#tri">Tri</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#inclusion-de-relations">Inclusion de relations</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#combinaisons-complexes">Combinaisons complexes</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#droits-dacces">Droits d'accès</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#liaison-entre-les-objets">Liaison entre les objets</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#exemples-de-filtres">Exemples de filtres</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#php">PHP</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#authentification">Authentification</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#liste-des-activites-avec-filtres">Liste des activités avec filtres</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#recuperer-une-activite-avec-relations">Récupérer une activité avec relations</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#python">Python</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bash">bash</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#powershell">Powershell</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#etape-1-authentification-et-obtention-du-jeton-dacces">Étape 1 — Authentification et obtention du jeton d'accès</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#etape-2-utilisation-avec-filtres-et-tri">Étape 2 — Utilisation avec filtres et tri</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#resume-des-fonctionnalites">Résumé des fonctionnalités</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../references/">Références</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Menu de navigation sur mobile">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Mercator</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../" class="icon icon-home" aria-label="Documents"></a></li>
      <li class="breadcrumb-item active">API avancée (filtres)</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/dbarzin/mercator/edit/master/docs/apifilters.fr.md" class="icon icon-github"> Editer dans GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="api-avancee-filtres">API avancée (filtres)</h2>
<p>Ce chapitre vient en complément du chapitre <a href="../api/">API</a>.</p>
<h3 id="filtrage-tri-et-inclusion-de-relations">Filtrage, tri et inclusion de relations</h3>
<p>Les endpoints de liste (<code>GET /api/objets</code>) supportent un système avancé de filtres, tri et inclusion de relations via
les paramètres de requête.</p>
<h4 id="champs-filtrables">Champs filtrables</h4>
<p>Tous les champs déclarés dans le modèle (<code>$fillable</code>) sont automatiquement filtrables. Les filtres sur des champs non
autorisés sont simplement ignorés.</p>
<h4 id="syntaxe-des-filtres">Syntaxe des filtres</h4>
<p>Chaque filtre se présente sous la forme :</p>
<pre><code class="language-text">filter[&lt;champ&gt;]=&lt;valeur&gt;                    # Filtre exact
filter[&lt;champ&gt;_&lt;operateur&gt;]=&lt;valeur&gt;        # Filtre avec opérateur
</code></pre>
<h4 id="operateurs-de-filtrage-disponibles">Opérateurs de filtrage disponibles</h4>
<h5 id="filtres-exacts-et-textuels">Filtres exacts et textuels</h5>
<table>
<thead>
<tr>
<th>Opérateur</th>
<th>Syntaxe</th>
<th>Description</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr>
<td>(aucun)</td>
<td><code>filter[name]=Backup</code></td>
<td>Égalité exacte</td>
<td><code>name = 'Backup'</code></td>
</tr>
<tr>
<td>(partiel)</td>
<td><code>filter[name]=backup</code></td>
<td>Recherche partielle (LIKE) *</td>
<td><code>name LIKE '%backup%'</code></td>
</tr>
</tbody>
</table>
<p><em>* La recherche partielle automatique s'applique aux champs contenant : <code>name</code>, <code>description</code>, <code>email</code></em></p>
<h5 id="comparaisons-numeriques">Comparaisons numériques</h5>
<table>
<thead>
<tr>
<th>Opérateur</th>
<th>Syntaxe</th>
<th>Description</th>
<th>Exemple SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_lt</code></td>
<td><code>filter[recovery_time_objective_lt]=4</code></td>
<td>Inférieur à</td>
<td><code>recovery_time_objective &lt; 4</code></td>
</tr>
<tr>
<td><code>_lte</code></td>
<td><code>filter[recovery_time_objective_lte]=4</code></td>
<td>Inférieur ou égal à</td>
<td><code>recovery_time_objective &lt;= 4</code></td>
</tr>
<tr>
<td><code>_gt</code></td>
<td><code>filter[recovery_time_objective_gt]=8</code></td>
<td>Supérieur à</td>
<td><code>recovery_time_objective &gt; 8</code></td>
</tr>
<tr>
<td><code>_gte</code></td>
<td><code>filter[recovery_time_objective_gte]=8</code></td>
<td>Supérieur ou égal à</td>
<td><code>recovery_time_objective &gt;= 8</code></td>
</tr>
</tbody>
</table>
<h5 id="operateurs-avances">Opérateurs avancés</h5>
<table>
<thead>
<tr>
<th>Opérateur</th>
<th>Syntaxe</th>
<th>Description</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_in</code></td>
<td><code>filter[id_in]=1,2,3</code></td>
<td>Valeur dans une liste</td>
<td><code>id IN (1, 2, 3)</code></td>
</tr>
<tr>
<td><code>_between</code></td>
<td><code>filter[recovery_time_objective_between]=4,24</code></td>
<td>Entre deux valeurs</td>
<td><code>recovery_time_objective BETWEEN 4 AND 24</code></td>
</tr>
<tr>
<td><code>_null</code></td>
<td><code>filter[deleted_at_null]=true</code></td>
<td>Valeur NULL</td>
<td><code>deleted_at IS NULL</code></td>
</tr>
<tr>
<td><code>_null</code></td>
<td><code>filter[description_null]=false</code></td>
<td>Valeur NOT NULL</td>
<td><code>description IS NOT NULL</code></td>
</tr>
<tr>
<td><code>_not</code></td>
<td><code>filter[type_not]=opensource</code></td>
<td>Négation (différent)</td>
<td><code>type != 'opensource'</code></td>
</tr>
</tbody>
</table>
<h5 id="recherche-globale-et-filtres-sur-relations">Recherche globale et filtres sur relations</h5>
<table>
<thead>
<tr>
<th>Opérateur</th>
<th>Syntaxe</th>
<th>Description</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>search</code></td>
<td><code>filter[search]=backup</code></td>
<td>Recherche OR sur tous les champs textuels (name, description, email)</td>
<td><code>name LIKE '%backup%' OR description LIKE '%backup%'</code></td>
</tr>
<tr>
<td>(relation)</td>
<td><code>filter[actors.email]=john</code></td>
<td>Recherche LIKE sur champs de relations</td>
<td><code>actors.email LIKE '%john%'</code></td>
</tr>
<tr>
<td>(relation)</td>
<td><code>filter[contacts.name]=alice</code></td>
<td>Recherche LIKE sur nom dans une relation</td>
<td><code>contacts.name LIKE '%alice%'</code></td>
</tr>
</tbody>
</table>
<h5 id="filtres-de-dates">Filtres de dates</h5>
<p>Pour les champs contenant <code>date</code> ou <code>at</code> dans leur nom :</p>
<table>
<thead>
<tr>
<th>Opérateur</th>
<th>Syntaxe</th>
<th>Description</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_after</code></td>
<td><code>filter[created_at_after]=2024-01-01</code></td>
<td>Après cette date</td>
<td><code>created_at &gt;= '2024-01-01'</code></td>
</tr>
<tr>
<td><code>_before</code></td>
<td><code>filter[updated_at_before]=2024-12-31</code></td>
<td>Avant cette date</td>
<td><code>updated_at &lt;= '2024-12-31'</code></td>
</tr>
</tbody>
</table>
<h5 id="elements-supprimes">Elements supprimés</h5>
<table>
<thead>
<tr>
<th>Syntaxe</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filter[trashed]=with</code></td>
<td>Inclure les éléments supprimés</td>
</tr>
<tr>
<td><code>filter[trashed]=only</code></td>
<td>Uniquement les éléments supprimés</td>
</tr>
</tbody>
</table>
<h4 id="tri-des-resultats">Tri des résultats</h4>
<p>Le tri se fait avec le paramètre <code>sort</code> :</p>
<pre><code class="language-text">sort=&lt;champ&gt;        # Tri ascendant
sort=-&lt;champ&gt;       # Tri descendant
</code></pre>
<p>Exemples :</p>
<ul>
<li><code>sort=name</code> : Tri par nom croissant</li>
<li><code>sort=-created_at</code> : Tri par date de création décroissant</li>
<li><code>sort=recovery_time_objective</code> : Tri par RTO croissant</li>
</ul>
<h4 id="inclusion-de-relations-eager-loading">Inclusion de relations (Eager Loading)</h4>
<p>Les relations entre objets peuvent être chargées avec le paramètre <code>include</code> :</p>
<pre><code class="language-text">include=&lt;relation1&gt;,&lt;relation2&gt;
</code></pre>
<p>Les relations disponibles sont automatiquement détectées depuis le modèle. Pour les activités, par exemple :</p>
<ul>
<li><code>processes</code> : Processus liés</li>
<li><code>operations</code> : Opérations liées</li>
<li><code>applications</code> : Applications liées</li>
<li><code>impacts</code> : Impacts liés</li>
</ul>
<p>Exemple : <code>include=processes,operations</code></p>
<h4 id="cas-dusage">Cas d'usage</h4>
<h5 id="filtres-simples">Filtres simples</h5>
<pre><code class="language-http"># Activités dont le nom contient &quot;sauvegarde&quot;
GET /api/activities?filter[name]=sauvegarde

# Activités avec un RTO inférieur ou égal à 4 heures
GET /api/activities?filter[recovery_time_objective_lte]=4

# Activités avec un ID supérieur ou égal à 100
GET /api/activities?filter[id_gte]=100

# Applications dont le type est différent de &quot;opensource&quot;
GET /api/applications?filter[type_not]=opensource

# Recherche globale sur tous les champs textuels
GET /api/applications?filter[search]=backup

# Recherche sur l'email d'un acteur lié
GET /api/activities?filter[actors.email]=john@example.com
</code></pre>
<h5 id="filtres-combines">Filtres combinés</h5>
<pre><code class="language-http"># Activités dont le nom contient &quot;GDPR&quot; avec RTO &gt;= 8
GET /api/activities?filter[name]=GDPR&amp;filter[recovery_time_objective_gte]=8

# Serveurs créés après le 1er janvier 2024 avec un nom contenant &quot;prod&quot;
GET /api/logical-servers?filter[created_at_after]=2024-01-01&amp;filter[name]=prod

# Applications avec type différent de &quot;opensource&quot; triées par nom
GET /api/applications?filter[type_not]=opensource&amp;sort=name

# Recherche globale &quot;backup&quot; sur toutes les activités avec RTO &lt;= 8
GET /api/activities?filter[search]=backup&amp;filter[recovery_time_objective_lte]=8

# Activités liées à un acteur dont l'email contient &quot;admin&quot;
GET /api/activities?filter[actors.email]=admin&amp;include=actors
</code></pre>
<h5 id="filtres-avances">Filtres avancés</h5>
<pre><code class="language-http"># Activités avec ID dans la liste 1, 2, 3, 5
GET /api/activities?filter[id_in]=1,2,3,5

# Activités avec RTO entre 4 et 24 heures
GET /api/activities?filter[recovery_time_objective_between]=4,24

# Activités sans description
GET /api/activities?filter[description_null]=true

# Inclure les activités supprimées
GET /api/activities?filter[trashed]=with
</code></pre>
<h5 id="tri">Tri</h5>
<pre><code class="language-http"># Tri par nom croissant
GET /api/activities?sort=name

# Tri par date de création décroissant
GET /api/activities?sort=-created_at

# Tri par RTO croissant
GET /api/activities?sort=recovery_time_objective
</code></pre>
<h5 id="inclusion-de-relations">Inclusion de relations</h5>
<pre><code class="language-http"># Charger les processus liés
GET /api/activities?include=processes

# Charger plusieurs relations
GET /api/activities?include=processes,operations,applications

# Activité spécifique avec ses relations
GET /api/activities/1?include=processes,operations
</code></pre>
<h5 id="combinaisons-complexes">Combinaisons complexes</h5>
<pre><code class="language-http"># Activités GDPR avec RTO &gt;= 8, triées par nom, avec relations
GET /api/activities?filter[name]=GDPR&amp;filter[recovery_time_objective_gte]=8&amp;include=processes,operations&amp;sort=name

# Serveurs logiques créés en 2024, sans description, avec tri
GET /api/logical-servers?filter[created_at_after]=2024-01-01&amp;filter[created_at_before]=2024-12-31&amp;filter[description_null]=true&amp;sort=-created_at

# Applications avec plusieurs critères
GET /api/applications?filter[name]=CRM&amp;filter[id_in]=1,2,3&amp;include=databases&amp;sort=-updated_at
</code></pre>
<h3 id="droits-dacces">Droits d'accès</h3>
<p>Il faut s'identifier avec un utilisateur de l'application Mercator pour pouvoir accéder aux API.
Cet utilisateur doit disposer d'un rôle dans Mercator qui lui permet d'accéder / modifier les objets
accédés par l'API.</p>
<p>Lorsque l'authentification réussit, l'API envoie un "access_token" qui doit être passé dans
l'entête "Authorization" de la requête de l'API.</p>
<h3 id="liaison-entre-les-objets">Liaison entre les objets</h3>
<p>Les objets de la cartographie peuvent faire référence à d'autres objets. Par exemple, nous pouvons lier un processus à
une application. Supposons que nous ayons un "processus" qui utilise deux applications "app1" et "app2". Pour ce faire,
nous suivons ces étapes :</p>
<ul>
<li>Étape 1 : Assurez-vous d'avoir l'application_id pour les applications que vous souhaitez lier.</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: 201,
  &quot;name&quot;: &quot;app1&quot;,
  &quot;description&quot;: &quot;desc1&quot;
}
{
  &quot;id&quot;: 202,
  &quot;name&quot;: &quot;app2&quot;,
  &quot;description&quot;: &quot;desc2&quot;
}
</code></pre>
<ul>
<li>Étape 2 : Liez le processus aux applications. Soit avec une mise à jour, soit avec un enregistrement, nous pouvons
  ajouter :</li>
</ul>
<pre><code class="language-json">{
  &quot;id&quot;: 101,
  &quot;name&quot;: &quot;processus&quot;,
  &quot;applications&quot;: [
    201,
    202
  ]
}
</code></pre>
<p>Les noms de toutes les relations disponibles sont automatiquement détectés depuis le modèle. Les relations courantes
incluent : <code>actors</code>, <code>tasks</code>, <code>activities</code>, <code>entities</code>, <code>applications</code>, <code>informations</code>, <code>processes</code>, <code>databases</code>,
<code>logical_servers</code>, <code>modules</code>, <code>operations</code>, <code>certificates</code>, <code>peripherals</code>, <code>physical_servers</code>, etc.</p>
<h3 id="exemples-de-filtres">Exemples de filtres</h3>
<p>Voici quelques exemples d'utilisation de l'API avec PHP :</p>
<h4 id="php">PHP</h4>
<h5 id="authentification">Authentification</h5>
<pre><code class="language-php">&lt;?php
    $curl = curl_init();

    curl_setopt_array($curl, array(
        CURLOPT_URL =&gt; &quot;http://127.0.0.1:8000/api/login&quot;,
        CURLOPT_RETURNTRANSFER =&gt; true,
        CURLOPT_MAXREDIRS =&gt; 10,
        CURLOPT_TIMEOUT =&gt; 30,
        CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
        CURLOPT_CUSTOMREQUEST =&gt; &quot;POST&quot;,
        CURLOPT_POSTFIELDS =&gt; http_build_query(
            array(&quot;login&quot; =&gt; &quot;admin@admin.com&quot;,
                  &quot;password&quot; =&gt; &quot;password&quot;)),
        CURLOPT_HTTPHEADER =&gt; array(
            &quot;accept: application/json&quot;,
            &quot;content-type: application/x-www-form-urlencoded&quot;,
        ),
    ));

    $response = curl_exec($curl);
    $err = curl_error($curl);
    $info = curl_getinfo($curl);

    curl_close($curl);

    if ($err) {
        set_error_handler($err);
    } else {
        if ($info['http_code'] == 200) {
            $access_token = json_decode($response)-&gt;access_token;
        } else {
            set_error_handler(&quot;Login to api failed status 403&quot;);
            error_log($responseInfo['http_code']);
            error_log(&quot;No login api status 403&quot;);
        }
    }

    var_dump($response);
</code></pre>
<h5 id="liste-des-activites-avec-filtres">Liste des activités avec filtres</h5>
<pre><code class="language-php">&lt;?php
    $curl = curl_init();

    // Construire l'URL avec les paramètres de filtrage
    $filters = http_build_query([
        'filter' =&gt; [
            'recovery_time_objective_gte' =&gt; 8,
            'name' =&gt; 'GDPR'
        ],
        'sort' =&gt; '-created_at',
        'include' =&gt; 'processes,operations'
    ]);

    curl_setopt_array($curl, array(
        CURLOPT_URL =&gt; &quot;http://127.0.0.1:8000/api/activities?&quot; . $filters,
        CURLOPT_RETURNTRANSFER =&gt; true,
        CURLOPT_MAXREDIRS =&gt; 10,
        CURLOPT_TIMEOUT =&gt; 30,
        CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
        CURLOPT_CUSTOMREQUEST =&gt; &quot;GET&quot;,
        CURLOPT_HTTPHEADER =&gt; array(
            &quot;accept: application/json&quot;,
            &quot;Authorization: Bearer &quot; . $access_token,
            &quot;cache-control: no-cache&quot;,
            &quot;content-type: application/json&quot;,
        ),
    ));

    $response = curl_exec($curl);
    $err = curl_error($curl);
    curl_close($curl);

    var_dump($response);
</code></pre>
<h5 id="recuperer-une-activite-avec-relations">Récupérer une activité avec relations</h5>
<pre><code class="language-php">&lt;?php
    $curl = curl_init();

    curl_setopt_array($curl, array(
        CURLOPT_URL =&gt; &quot;http://127.0.0.1:8000/api/activities/1?include=processes,operations&quot;,
        CURLOPT_RETURNTRANSFER =&gt; true,
        CURLOPT_MAXREDIRS =&gt; 10,
        CURLOPT_TIMEOUT =&gt; 30,
        CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,
        CURLOPT_CUSTOMREQUEST =&gt; &quot;GET&quot;,
        CURLOPT_HTTPHEADER =&gt; array(
            &quot;accept: application/json&quot;,
            &quot;Authorization: Bearer &quot; . $access_token,
            &quot;cache-control: no-cache&quot;,
            &quot;content-type: application/json&quot;,
        ),
    ));

    $response = curl_exec($curl);
    $err = curl_error($curl);
    curl_close($curl);

    var_dump($response);
</code></pre>
<h4 id="python">Python</h4>
<p>Voici un exemple d'utilisation de l'API en Python avec filtres avancés</p>
<pre><code class="language-python">#!/usr/bin/python3

import requests

vheaders = {}
vheaders['accept'] = 'application/json'
vheaders['content-type'] = 'application/x-www-form-urlencoded'
vheaders['cache-control'] = 'no-cache'

print(&quot;Login&quot;)
response = requests.post(&quot;http://127.0.0.1:8000/api/login&quot;,
    headers=vheaders,
    data={'login':'admin@admin.com', 'password':'password'})
print(response.status_code)

vheaders['Authorization'] = &quot;Bearer &quot; + response.json()['access_token']

# Liste avec filtres et tri
print(&quot;Get workstations with filters&quot;)
params = {
    'filter[name]': 'laptop',
    'sort': '-created_at'
}
response = requests.get(&quot;http://127.0.0.1:8000/api/workstations&quot;, 
    headers=vheaders, 
    params=params)
print(response.json())
print(response.status_code)

# Récupération avec relations
print(&quot;Get activity with relations&quot;)
params = {
    'include': 'processes,operations'
}
response = requests.get(&quot;http://127.0.0.1:8000/api/activities/1&quot;,
    headers=vheaders,
    params=params)
print(response.json())
</code></pre>
<h4 id="bash">bash</h4>
<p>Voici un exemple d'utilisation de l'API en ligne de commande avec <a href="https://curl.se/docs/manpage.html">CURL</a>
et <a href="https://stedolan.github.io/jq/">JQ</a></p>
<pre><code class="language-bash">#!/usr/bin/bash

API_URL=http://127.0.0.1:8000/api
OBJECT=applications
OBJECT_ID=45

# Identifiants valides
data='{&quot;login&quot;:&quot;admin@admin.com&quot;,&quot;password&quot;:&quot;password&quot;}'

# Obtenir un token après connexion
TOKEN=$(curl -s -d ${data} -H &quot;Content-Type: application/json&quot; ${API_URL}/login | jq -r .access_token)

# Liste avec filtres
echo &quot;Liste des applications avec filtres...&quot;
curl -s -X GET &quot;${API_URL}/${OBJECT}?filter[name]=CRM&amp;sort=-created_at&quot; \
  -H &quot;Authorization: Bearer ${TOKEN}&quot; \
  -H &quot;Accept: application/json&quot; | jq .

# Récupération avec relations
echo &quot;Récupération d'un objet avec relations...&quot;
RESPONSE=$(curl -s -X GET &quot;${API_URL}/${OBJECT}/${OBJECT_ID}?include=databases,processes&quot; \
  -H &quot;Authorization: Bearer ${TOKEN}&quot; \
  -H &quot;Accept: application/json&quot;)

echo &quot;Objet récupéré: ${RESPONSE}&quot;

# Mise à jour
RESPONSE=$(echo &quot;$RESPONSE&quot; | jq -c '.')
RESPONSE=$(echo &quot;$RESPONSE&quot; | jq -r '.activities=[1]')

echo &quot;Objet modifié: ${RESPONSE}&quot;

curl -s -X PUT &quot;${API_URL}/${OBJECT}/${OBJECT_ID}&quot; \
  -H &quot;Authorization: Bearer ${TOKEN}&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -H &quot;cache-control: no-cache&quot; \
  -d &quot;$RESPONSE&quot;

# Vérification
UPDATED_OBJECT=$(curl -s -X GET &quot;${API_URL}/${OBJECT}/${OBJECT_ID}&quot; \
  -H &quot;Authorization: Bearer ${TOKEN}&quot; \
  -H &quot;Accept: application/json&quot;)

echo &quot;Objet mis à jour: ${UPDATED_OBJECT}&quot;
</code></pre>
<h4 id="powershell">Powershell</h4>
<p>Le script PowerShell ci-dessous montre comment s'authentifier auprès de l'API et utiliser les filtres avancés.</p>
<h5 id="etape-1-authentification-et-obtention-du-jeton-dacces">Étape 1 — Authentification et obtention du jeton d'accès</h5>
<pre><code class="language-powershell"># Définir l'URL d'authentification et les identifiants
$loginUri = &quot;http://127.0.0.1:8000/api/login&quot;
$loginBody = @{
    login = &quot;admin@admin.com&quot;
    password = &quot;password&quot;
}

# Envoyer la requête d'authentification
try {
    $loginResponse = Invoke-RestMethod -Uri $loginUri -Method Post -Body $loginBody -ContentType &quot;application/x-www-form-urlencoded&quot;
    $token = $loginResponse.access_token
    Write-Host &quot;Jeton d'accès récupéré avec succès.&quot;
} catch {
    Write-Error &quot;Échec de l'authentification : $_&quot;
    return
}
</code></pre>
<h5 id="etape-2-utilisation-avec-filtres-et-tri">Étape 2 — Utilisation avec filtres et tri</h5>
<pre><code class="language-powershell"># Définir les en-têtes
$headers = @{
    'Authorization' = &quot;Bearer $token&quot;
    'Accept'        = 'application/json'
}

# Liste avec filtres
$endPoint = &quot;logical-servers&quot;
$filters = &quot;filter[operating_system]=Linux&amp;sort=-created_at&quot;
$apiUri = &quot;http://127.0.0.1:8000/api/$endPoint?$filters&quot;

try {
    $servers = Invoke-RestMethod -Uri $apiUri -Method Get -Headers $headers
    $servers | Format-Table id, name, operating_system, description
} catch {
    Write-Error &quot;Échec de la requête : $_&quot;
}

# Récupération avec relations
$activityId = 1
$apiUri = &quot;http://127.0.0.1:8000/api/activities/$activityId?include=processes,operations&quot;

try {
    $activity = Invoke-RestMethod -Uri $apiUri -Method Get -Headers $headers
    $activity | ConvertTo-Json -Depth 10
} catch {
    Write-Error &quot;Échec de la requête : $_&quot;
}
</code></pre>
<h3 id="resume-des-fonctionnalites">Résumé des fonctionnalités</h3>
<table>
<thead>
<tr>
<th>Fonctionnalité</th>
<th>Syntaxe</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr>
<td>Filtre exact</td>
<td><code>filter[champ]=valeur</code></td>
<td><code>filter[name]=Backup</code></td>
</tr>
<tr>
<td>Comparaison</td>
<td><code>filter[champ_operateur]=valeur</code></td>
<td><code>filter[recovery_time_objective_gte]=8</code></td>
</tr>
<tr>
<td>Négation</td>
<td><code>filter[champ_not]=valeur</code></td>
<td><code>filter[type_not]=opensource</code></td>
</tr>
<tr>
<td>Liste de valeurs</td>
<td><code>filter[champ_in]=v1,v2,v3</code></td>
<td><code>filter[id_in]=1,2,3</code></td>
</tr>
<tr>
<td>Intervalle</td>
<td><code>filter[champ_between]=min,max</code></td>
<td><code>filter[age_between]=18,65</code></td>
</tr>
<tr>
<td>NULL</td>
<td><code>filter[champ_null]=true/false</code></td>
<td><code>filter[deleted_at_null]=true</code></td>
</tr>
<tr>
<td>Dates</td>
<td><code>filter[champ_after/before]=date</code></td>
<td><code>filter[created_at_after]=2024-01-01</code></td>
</tr>
<tr>
<td>Recherche globale</td>
<td><code>filter[search]=terme</code></td>
<td><code>filter[search]=backup</code></td>
</tr>
<tr>
<td>Relation</td>
<td><code>filter[relation.champ]=valeur</code></td>
<td><code>filter[actors.email]=john</code></td>
</tr>
<tr>
<td>Tri</td>
<td><code>sort=champ</code> ou <code>sort=-champ</code></td>
<td><code>sort=-created_at</code></td>
</tr>
<tr>
<td>Relations</td>
<td><code>include=relation1,relation2</code></td>
<td><code>include=processes,operations</code></td>
</tr>
<tr>
<td>Soft deletes</td>
<td><code>filter[trashed]=with/only</code></td>
<td><code>filter[trashed]=with</code></td>
</tr>
</tbody>
</table>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Navigation de pied de page">
        <a href="../api/" class="btn btn-neutral float-left" title="API"><span class="icon icon-circle-arrow-left"></span> Précédent</a>
        <a href="../references/" class="btn btn-neutral float-right" title="Références">Suivant <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright <a href="https://www.gnu.org/licenses/licenses.en.html">GPL</a>.</p>
  </div>

  Générée avec <a href="https://www.mkdocs.org/">MkDocs</a> avec un <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a> fourni par <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dbarzin/mercator" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../api/" style="color: #fcfcfc">&laquo; Précédent</a></span>
    
    
      <span><a href="../references/" style="color: #fcfcfc">Suivant &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
